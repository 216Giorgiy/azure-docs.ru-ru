---
title: Развертывание приложения ASP.NET и Базы данных SQL Azure с помощью проекта Azure DevOps | Руководство по Azure DevOps Services
description: Проект DevOps упрощает начало работы с Azure. Проект Azure DevOps упрощает развертывание вашего приложения ASP.NET с Базой данных SQL за несколько простых шагов.
ms.author: mlearned
ms.manager: douge
ms.prod: devops
ms.technology: devops-cicd
ms.topic: tutorial
ms.date: 07/09/2018
author: mlearned
monikerRange: vsts
ms.openlocfilehash: d9c7c94e344daee5af87ce40ddf4dcb686696ded
ms.sourcegitcommit: f3bd5c17a3a189f144008faf1acb9fabc5bc9ab7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2018
ms.locfileid: "44297339"
---
# <a name="tutorial--deploy-your-aspnet-app-and-azure-sql-database-with-the-azure-devops-project"></a>Руководство. Развертывание приложения ASP.NET и Базы данных SQL Azure с помощью проекта Azure DevOps

Проект Azure DevOps представляет собой упрощенный интерфейс, к которому вы подключаете существующий код и репозиторий Git. Или можно выбрать один из примеров приложений, чтобы создать конвейер непрерывной интеграции (CI) и непрерывной поставки (CD) в Azure.  Проект DevOps автоматически создает такие ресурсы Azure, как База данных SQL Azure, создает и настраивает в Azure DevOps конвейер выпуска, который содержит конвейер сборки для CI, настраивает конвейер выпуска для CD и создает ресурс Azure Application Insights для мониторинга.

Вы сможете выполнять следующие задачи:

> [!div class="checklist"]
> * Создание проекта Azure DevOps для приложения ASP.NET и Базы данных SQL Azure
> * Настройка Azure DevOps Services и подписки Azure 
> * Изучение конвейера CI в Azure DevOps Services
> * Изучение конвейера CD в Azure DevOps Services
> * Фиксация изменений в Azure DevOps Services и автоматическое развертывание в Azure
> * Подключение к базе данных SQL Azure 
> * Очистка ресурсов

## <a name="prerequisites"></a>Предварительные требования

* Подписка Azure. Вы можете получить бесплатную подписку с помощью [Visual Studio Dev Essentials](https://visualstudio.microsoft.com/dev-essentials/).

## <a name="create-an-azure-devops-project-for-an-aspnet-app-and-azure-sql-database"></a>Создание проекта Azure DevOps для приложения ASP.NET и Базы данных SQL Azure

Проект Azure DevOps создает в Azure конвейер CI/CD.  Вы можете создать **новую организацию Azure DevOps Services** или использовать **существующую организацию**.  Проект Azure DevOps также создает **ресурсы Azure**, такие как база данных SQL, в **подписке Azure** по вашему выбору.

1. Войдите на портал [Microsoft Azure](https://portal.azure.com).

1. Щелкните значок **Создать ресурс** на панели навигации слева, затем выполните поиск по запросу **Проект DevOps**.  Выберите **Создать**.

    ![Начало непрерывной поставки](_img/azure-devops-project-github/fullbrowser.png)

1. Щелкните **.NET**, а затем нажмите кнопку **Далее**.

1. Для параметра **Выберите платформу приложений** выберите **ASP.NET**.

1. Щелкните **Добавить базу данных**, а затем нажмите **Далее**.  

1. Исполняющая среда, которую вы выбрали на предыдущих шагах, определяет тип цели развертывания службы Azure, доступной здесь.  Щелкните **Далее**.

## <a name="configure-azure-devops-services-and-an-azure-subscription"></a>Настройка Azure DevOps Services и подписки Azure

1. Создайте **новую** организацию Azure DevOps Services или выберите **существующую** организацию.  Выберите **имя** для проекта Azure DevOps.  

1. Выберите свою **подписку Azure**.

1. При необходимости перейдите по ссылке **Изменить**, чтобы увидеть дополнительные настройки конфигурации Azure и укажите **имя пользователя** в разделе **Учетные данные для сервера базы данных**.  **Сохраните** **имя пользователя** для следующих шагов этого руководства.
 
1. Если вы выполнили предыдущий шаг, выйдите из области конфигурации Azure и нажмите **Готово**.  В противном случае просто выберите **Готово**.

1. Этот процесс может занять несколько минут.  После завершения процесса на портале Azure откроется **Панель мониторинга** для проекта Azure DevOps.  Вы также можете перейти к **панели мониторинга проекта Azure DevOps** непосредственно на вкладке **Все ресурсы** на **портале Azure**.  В правой части панели мониторинга выберите **Обзор**, чтобы просмотреть запущенное приложение.
    
## <a name="examine-the-azure-devops-services-ci-pipeline"></a>Изучение конвейера CI в Azure DevOps Services

Проект Azure DevOps автоматически настраивает конвейер CI/CD Azure в организации Azure DevOps Services.  Вы можете изучить и настроить конвейер.  Выполните следующие шаги, чтобы лучше понять конвейеры сборки в Azure DevOps Services.

1. Перейдите к **панели мониторинга Azure DevOps**.

1. Щелкните **Конвейеры сборки** в **верхней части** **панели мониторинга проекта Azure DevOps**.  Эта ссылка открывает в новой вкладке браузера конвейер сборки Azure DevOps Services для нового проекта.

1. Поместите указатель мыши справа от конвейера сборки рядом с полем **Состояние**. Выберите отобразившееся **многоточие**.  Это действие открывает меню, в котором можно выполнить несколько действий, таких как **постановка новой сборки в очередь**, **приостановка создания** и **изменение конвейера сборки**.

1. Выберите **Изменить**

1. В этом представлении **рассмотрите различные задачи** для конвейера сборки.  Сборка выполняет несколько задач, например получает источники из репозитория Azure DevOps Services Git, восстанавливает зависимости и публикует используемые для развертывания результаты.

1. Выберите **имя конвейера сборки** в верхней части конвейера сборки.

1. Замените это **имя** более понятным и описательным.  Щелкните **Save & queue** (Сохранить и поместить в очередь), а затем выберите **Сохранить**.

1. Под именем конвейера сборки щелкните **Журнал**.  Вы увидите журнал аудита последних изменений сборки.  Azure DevOps Services отслеживает любые изменения, внесенные в конвейер сборки, и позволяет сравнивать версии.

1. Выберите **Триггеры**.  Проект Azure DevOps автоматически создал триггер CI, и теперь каждая фиксация в репозитории запускает новую сборку.  При желании выберите включение или исключение ветвей из процесса непрерывной интеграции.

1. Щелкните **Период удержания**.  На основе вашего сценария можно указать политики для хранения или удаления определенного количества сборок.

## <a name="examine-the-azure-devops-services-cd-pipeline"></a>Изучение конвейера CD в Azure DevOps Services

Проект Azure DevOps автоматически создает и настраивает необходимые шаги для развертывания из организации Azure DevOps Services в подписку Azure.  Эти шаги включают настройку подключения к службе Azure для аутентификации Azure DevOps Services в подписке Azure.  Также служба автоматизации создает определение выпуска Azure DevOps Services, который выполняет непрерывное развертывание в Azure.  Выполните следующие шаги, чтобы изучить возможности определения выпуска Azure DevOps Services.

1. Щелкните **Сборка и выпуск**, а затем выберите **Выпуски**.  Проект Azure DevOps создал конвейер выпуска Azure DevOps Services для управления развертываниями в Azure.

1. В левой части окна браузера щелкните **многоточие** рядом с конвейером выпуска и выберите **Изменить**.

1. Конвейер выпуска содержит **конвейер**, в котором определен процесс выпуска.  В разделе **Артефакты** выберите **Удалить**.  Конвейер сборки, который вы изучали на предыдущих этапах, создает выходные данные для артефакта. 

1. Справа от значка **Удалить** выберите **значок** **Триггер непрерывного развертывания** (в виде молнии).  Для этого конвейера выпуска активирован триггер непрерывного развертывания.  Триггер запускает развертывание каждый раз, когда имеется новый артефакт сборки.  При желании вы можете отключить триггер, чтобы развертывание требовалось выполнять вручную. 

1. Проект Azure DevOps настраивает случайный пароль SQL и использует этот пароль для конвейера выпуска.  В левой части окна браузера выберите **Переменные**. 

1. **Выполняйте этот шаг, только если вы изменили пароль SQL Server.**  Существует однонаправленная переменная **Пароль**.  Справа от текстового поля **Значение** щелкните значок **Замок**.  **Введите** новый пароль, а затем щелкните **Сохранить**.

1. В левой части браузера выберите **Задачи**, а затем выберите **среду**.  

1. Задачи являются действиями, выполняемыми в процессе развертывания. Они сгруппированы по **этапам**.  Для этого конвейера выпуска определен один этап.  Этот этап содержит задачу **Развертывание службы приложений Azure** и задачу **Развертывание Базы данных SQL Azure**.

1. Выберите задачу **Выполнить SQL Azure** и изучите различные свойства, используемые для развертывания SQL.  В разделе **Пакет развертывания** обратите внимание, что задача использует **DACPAC-файл SQL**.

1. В правой части окна браузера выберите **Просмотреть выпуски**.  В этом представлении можно просмотреть журнал выпусков.

1. Щелкните **многоточие** рядом с одним из выпусков и выберите **Открыть**.  В этом представлении есть несколько меню, которые можно изучить, например меню **сводки**, **связанных рабочих элементов** и **тестов**.

1. Щелкните **Фиксации**.  В этом представлении отображаются фиксации кода, связанные с конкретным развертыванием. Сравните выпуски, чтобы просмотреть различия между развертываниями.

1. Выберите **Журналы**.  Журналы содержат полезную информацию о процессе развертывания.  Их можно просматривать как во время, так и после развертывания.

## <a name="commit-changes-to-azure-devops-services-and-automatically-deploy-to-azure"></a>Фиксация изменений в Azure DevOps Services и автоматическое развертывание в Azure 

 > [!NOTE]
 > В приведенных ниже шагах тестируется конвейер CI/CD с изменением простого текста.  При необходимости вы можете внести изменение схемы SQL Server в таблицу, чтобы протестировать процесс развертывания SQL.

Теперь вы готовы сотрудничать с командой в своем приложении с процессом CI/CD, который автоматически развертывает данные последней работы на вашем веб-сайте.  Каждое изменение в репозитории Git для Azure DevOps Services запускает сборку в Azure DevOps Services, а затем конвейер CD Azure DevOps Services выполняет развертывание в Azure.  Выполните следующие действия или используйте другие методы для фиксации изменений в вашем репозитории.  Изменения кода запускают процесс CI/CD и автоматически развертывают ваши новые изменения в Azure.

1. Щелкните **Код** в меню Azure DevOps Services, чтобы открыть репозиторий.

1. Перейдите в каталог **SampleWebApplication\Views\Home**, затем щелкните **многоточие** рядом с файлом **Index.cshtml**, а затем выберите **Изменить**.

1. Внесите изменения в файл, например, измените некоторый текст внутри одного из тегов **div**.  В правом верхнем углу щелкните **Зафиксировать**.  Щелкните **Зафиксировать** еще раз, чтобы внести изменения. 

1. Через несколько минут **начинается сборка в Azure DevOps Services**, а затем выполняется выпуск для развертывания изменений.  **Состояние сборки** вы можете отслеживать на панели мониторинга для проекта DevOps или на странице браузера, которая отображает организацию Azure DevOps Services.

1. По завершении выпуска **обновите приложение** в браузере, чтобы убедиться, что вы видите изменения.

## <a name="connect-to-the-azure-sql-server-database"></a>Подключение к базе данных SQL Azure

Вам нужны соответствующие разрешения для подключения к базе данных SQL Azure.

1. На панели мониторинга проекта DevOps Azure, выберите **База данных SQL** для перехода на страницу управления базой данных SQL.
   
1. Выберите **Настройка брандмауэра для сервера**, а затем нажмите кнопку **+ Добавить IP-адрес клиента**.  

1. Щелкните **Сохранить**.  IP-адрес клиента теперь разрешает доступ к **ресурсам SQL Server Azure**.

1. Вернитесь к колонке **База данных SQL**. 

1. В правой части экрана щелкните **Имя сервера** для перехода на страницу настройки **SQL Server**.

1. Выберите **Сброс пароля**, введите пароль для **имени для входа администратора SQL Server**, а затем щелкните **Сохранить**.  **Сохраните** пароль для следующих шагов этого руководства.

1. Теперь, при необходимости, можно использовать клиентские средства, например **SQL Server Management Studio** или **Visual Studio** для подключения к Azure SQL Server и Базе данных.  Используйте свойство **Имя сервера** для подключения.

   Если вы не изменяли имя пользователя базы данных при первоначальной настройке проекта DevOps, ваше имя пользователя — это локальная часть вашего адреса электронной почты.  Например, если ваш электронный адрес johndoe@microsoft.com, ваше имя пользователя — johndoe.

 > [!NOTE]
 > Если вы изменили пароль для имени входа в SQL, необходимо изменить пароль в переменной конвейера выпуска Azure DevOps Services, как описано в разделе **Examine the Azure DevOps Services CD pipeline** (Изучение конвейера CD в Azure DevOps Services).

## <a name="clean-up-resources"></a>Очистка ресурсов

 > [!NOTE]
 > При выполнении шагов ниже ресурсы удаляются навсегда.  Используйте эту функцию только после того, как досконально ознакомитесь с подсказками.

Если вы выполняете тестирование, вы можете очистить ресурсы, чтобы избежать непредвиденных расходов.  Вы можете удалить ненужную базу данных SQL Azure и связанные с ней ресурсы, созданные в этом руководстве, с помощью функции **Удалить** на панели мониторинга Azure DevOps.  **Будьте внимательны**, так как функция удаления уничтожает все данные, созданные проектом Azure DevOps в Azure и в Azure DevOps Services, и вы больше не сможете получить эти данные.

1. На **портале Azure** перейдите к **проекту Azure DevOps**.
2. В **верхней правой** стороне панели мониторинга нажмите кнопку **Удалить**.  Прочитав подсказку, щелкните **Да**, чтобы**навсегда удалить** ресурсы.

## <a name="next-steps"></a>Дополнительная информация

Вы можете по желанию изменить эти конвейеры сборки и выпуска в соответствии с потребностями вашей команды. Вы также можете использовать этот шаблон CI/CD в качестве шаблона для других своих проектов.  Вы научились выполнять следующие задачи:

> [!div class="checklist"]
> * Создание проекта Azure DevOps для приложения ASP.NET и Базы данных SQL Azure
> * Настройка Azure DevOps Services и подписки Azure 
> * Изучение конвейера CI в Azure DevOps Services
> * Изучение конвейера CD в Azure DevOps Services
> * Фиксация изменений в Azure DevOps Services и автоматическое развертывание в Azure
> * Подключение к базе данных SQL Azure 
> * Очистка ресурсов

Чтобы получить дополнительные сведения о конвейере Azure, изучите это руководство:

> [!div class="nextstepaction"]
> [Define your multi-stage continuous deployment (CD) process](https://docs.microsoft.com/azure/devops/pipelines/release/define-multistage-release-process?view=vsts) (Определение многоэтапного процесса непрерывного развертывания)

## <a name="videos"></a>Видеоролики

> [!VIDEO https://channel9.msdn.com/Events/Build/2018/BRK3308/player]