<properties
    pageTitle="Отладка приложений Azure в Eclipse"
    description="Узнайте об отладке приложений Azure с помощью набора средств Azure для Eclipse."
    services=""
    documentationCenter="java"
    authors="rmcmurray"
    manager="wpickett"
    editor=""/>

<tags
    ms.service="multiple"
    ms.workload="na"
    ms.tgt_pltfrm="multiple"
    ms.devlang="Java"
    ms.topic="article"
    ms.date="11/30/2015" 
    ms.author="robmcm"/>

<!-- Legacy MSDN URL = https://msdn.microsoft.com/library/azure/hh690949.aspx -->

# Отладка приложений Azure в Eclipse #

С помощью набора средств Azure для Eclipse вы можете выполнять отладку приложений, выполняемых как в Azure, так и в эмуляторе вычислений, при условии использования операционной системы Windows. На следующем рисунке показано диалоговое окно свойств **Отладка**, используемое для включения удаленной отладки.

![][ic719504]

В этом руководстве предполагается, что у вас уже есть успешно созданное приложение, а сами вы знакомы с эмулятором вычислений и развертыванием в Azure.

В качестве отправной точки в этом разделе мы будем использовать приложение из руководства [Использование библиотеки среды выполнения служб Azure в JSP][]. Создайте такое приложение, прежде чем продолжить, если вы еще не сделали этого.

## Отладка приложения во время выполнения в Azure ##

>[AZURE.WARNING]Текущая поддержка удаленной отладки Java в данном наборе средств ориентирована в основном на развертывания, работающие в эмуляторе вычислений Azure. Поскольку подключение отладки не является безопасным, не следует включать удаленную отладку в рабочей среде. Если вам требуется выполнить отладку приложения, запущенного в облаке Azure, используйте промежуточное развертывание, но учтите, что существует вероятность несанкционированного доступа к сеансу отладки, если кто-то знает IP-адрес вашего облачного развертывания, даже если это промежуточное развертывание.

1. Выполните сборку проекта для тестирования в эмуляторе: в обозревателе проектов Eclipse щелкните правой кнопкой мыши элемент **MyAzureProject**, выберите пункт **Свойства**, нажмите кнопку **Azure** и задайте для параметра **Build for** (Сборка для) значение **Deployment to cloud** (Развертывание в облаке).
1. Перестройте проект: в меню Eclipse выберите **Проект** и щелкните **Build All** (Собрать все).
1. Разверните приложение в *промежуточной среде* в Azure.

    >[AZURE.IMPORTANT] Ранее уже упоминалось, что в большинстве случаев отладку настоятельно рекомендуется выполнять в эмуляторе вычислений, поэтому отладку в промежуточной среде следует выполнять только в том случае, когда требуется дополнительная отладка. Рекомендуется не выполнять отладку в рабочей среде.
1. Когда развертывание в Azure будет готово, получите DNS-имя для развертывания с [портала управления Azure][]. Промежуточное развертывание имеет DNS-имя в виде http://*&lt;guid&gt;*.cloudapp.net, где *&lt;guid&gt;* представляет собой значение GUID, назначенное службой Azure.
1. В обозревателе проектов Eclipse щелкните правой кнопкой мыши **WorkerRole1**, выберите пункт **Azure**, а затем щелкните **Отладка**.
1. В диалоговом окне **Properties for WorkerRole1 Debugging** (Свойства для отладки WorkerRole1) выполните следующие действия.
    1. Установите флажок **Enable remote debugging for this role** (Включить удаленную отладку для этой роли).
    1. Для параметра **Input endpoint to use** (Используемая входная конечная точка) используйте значение **Debugging (public:8090, private:8090)** (Отладка — открытый:8090, закрытый:8090).
    1. Убедитесь, что флажок **Start JVM in suspended mode, waiting for a debugger connection** (Запустить JVM в режиме приостановки, ожидая подключение отладчика) снят.

        >[AZURE.IMPORTANT] Параметр **Start JVM in suspended mode, waiting for a debugger connection** (Запустить JVM в режиме приостановки, ожидая подключение отладчика) предназначен только для сценариев расширенной отладки в эмуляторе вычислений (не для развертываний в облаке). Если параметр **Start JVM in suspended mode, waiting for a debugger connection** (Запустить JVM в режиме приостановки, ожидая подключение отладчика) используется, он приостанавливает процесс запуска сервера до подключения отладчика Eclipse к его виртуальной машине Java. Хотя вы можете использовать этот параметр для сеанса отладки с применением эмулятора вычислений, не используйте его для сеанса отладки в облачном развертывании. Инициализация сервера выполняется в рамках задачи запуска Azure, и облако Azure не предоставляет доступ к общедоступным конечным точкам до завершения задачи запуска. Таким образом, процесс запуска не завершается, если этот параметр включен в облачном развертывании, так как получить подключение из внешнего клиента Eclipse будет невозможно.
    1. Щелкните **Create Debug Configurations** (Создать конфигурации отладки).
1. В диалоговом окне **Azure Debug Configuration** (Конфигурация отладки Azure) выполните следующие действия.
    1. Для параметра **Java project to debug** (Проект Java для отладки) выберите проект **MyHelloWorld**.
    1. Для параметра **Configure debugging for** (Настроить отладку для) выберите **Azure cloud (staging)** (Облако Azure, промежуточная среда).
    1. Убедитесь, что флажок **Azure compute emulator** (Эмулятор вычислений Azure) снят.
    1. Для параметра **Узел** введите DNS-имя промежуточного развертывания, но без ****http://** в начале. Например, (используйте свой идентификатор GUID вместо приведенного здесь): **4e616d65-6f6e-6d65-6973-526f62657274.cloudapp.net**.
1. Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно **Azure Debug Configuration** (Конфигурация отладки Azure).
1. Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно **Properties for WorkerRole1 Debugging** (Свойства для отладки WorkerRole1).
1. Если вы еще не задали точку останова в index.jsp, задайте ее:
    1. В обозревателе проектов Eclipse разверните узел **MyHelloWorld**, разверните узел **WebContent** и дважды щелкните **index.jsp**.
    1. В пределах index.jsp щелкните правой кнопкой мыши синюю полосу слева от кода Java и выберите пункт **Toggle Breakpoints** (Переключить точки останова), как показано ниже: ![][ic551537]
1. В меню Eclipse выберите **Выполнить** и щелкните **Debug Configurations** (Конфигурации отладки).
1. В диалоговом окне **Debug Configurations** (Конфигурации отладки) разверните узел **Remote Java Application** (Удаленное приложение Java) на левой панели, выберите **Azure Cloud (WorkerRole1)** (Облако Azure [WorkerRole1]) и нажмите кнопку **Отладка**.
1. В браузере запустите промежуточное приложение ****http://***&lt;guid&gt;***.cloudapp.net/MyHelloWorld**, подставив GUID из DNS-имени вместо *&lt;guid&gt;*. При отображении диалогового окна **Confirm Perspective Switch** (Подтвердить смену перспективы) нажмите кнопку **Да**. Теперь сеанс отладки должен дойти до строки кода, где была задана точка останова.

>[AZURE.NOTE]Если вы пытаетесь запустить удаленное подключение к развертыванию, в котором запущено несколько экземпляров ролей, то вы не сможете контролировать, к какому экземпляру отладчик подключается изначально, поскольку балансировщик нагрузки Azure выбирает экземпляр случайным образом. Однако после подключения к этому экземпляру вы продолжите осуществлять отладку того же самого экземпляра. Обратите внимание и на то, что, если период бездействия длится более 4 минут (например, когда вы надолго останавливаетесь в точке останова), Azure может закрыть подключение.

## Отладка определенного экземпляра роли в развертывании с несколькими экземплярами ##

Если развертывание выполняется в облаке, вы, вероятнее всего, используете для него несколько вычислительных операций или экземпляров роли. Это позволяет воспользоваться преимуществами гарантии доступности Azure в течение 99,95 % всего времени, а также развернуть приложение.

В таких случаях может потребоваться удаленная отладка приложения Java в определенном экземпляре роли. Однако если вы включите для отладки только обычную входную конечную точку, балансировщик нагрузки Azure сделает практически невозможным подключение отладчика к определенному экземпляру роли. Вместо этого подключение будет устанавливаться со случайным экземпляром роли.

Именно в таком сценарии вы можете использовать преимущества входных конечных точек экземпляра, чтобы упростить отладку конкретного экземпляра роли.

Предположим, что вы планируете запустить в развертывании до 5 экземпляров роли. С помощью страницы свойств **Конечные точки** в диалоговом окне свойств роли создайте входную конечную точку экземпляра и присвойте ей диапазон общих портов, а не один номер порта. Например, в поле ввода данных **Общий порт** укажите значение **81–85**.

После развертывания приложения с этой конечной точкой экземпляра Azure присвоит каждому экземпляру роли уникальный номер порта из данного диапазона. Чтобы узнать, какой номер порта назначен какому экземпляру, вы можете воспользоваться переменной среды *InstanceEndpointName***\_PUBLICPORT** (где *InstanceEndpointName* — это имя, назначенное при создании конечной точки экземпляра), которую набор средств автоматически настроил в развертывании (например, возвратив ее значение в нижнем колонтитуле веб-страницы, чтобы вы могли прочитать его при переходе на нее).

Выяснив, какой номер общего порта был назначен этому экземпляру, вы можете сослаться на него в конфигурации отладки в Eclipse, добавив его к имени узла службы. Это позволит отладчику Eclipse подключиться к данному конкретному экземпляру вместо одного из других экземпляров.

## Только для Windows: отладка приложения во время выполнения в эмуляторе вычислений ##

>[AZURE.NOTE]Эмулятор Azure доступен только в Windows. Этот раздел можно пропустить, если вы используете другую операционную систему.

1. Выполните сборку проекта для тестирования в эмуляторе: в обозревателе проектов Eclipse щелкните правой кнопкой мыши элемент **MyAzureProject**, выберите пункт **Свойства**, нажмите кнопку **Azure** и задайте для параметра **Build for** (Сборка для) значение **Testing in emulator** (Тестирование в эмуляторе).
1. Перестройте проект: в меню Eclipse выберите **Проект** и щелкните **Build All** (Собрать все).
1. В обозревателе проектов Eclipse щелкните правой кнопкой мыши **WorkerRole1**, выберите пункт **Azure**, а затем щелкните **Отладка**.
1. В диалоговом окне **Properties for WorkerRole1 Debugging** (Свойства для отладки WorkerRole1) выполните следующие действия.
    1. Установите флажок **Enable remote debugging for this role** (Включить удаленную отладку для этой роли).
    1. Для параметра **Input endpoint to use** (Используемая входная конечная точка) используйте созданную набором средств конечную точку по умолчанию — **Debugging (public:8090, private:8090)** (Отладка — открытый:8090, закрытый:8090).
    1. Убедитесь, что флажок **Start JVM in suspended mode, waiting for a debugger connection** (Запустить JVM в режиме приостановки, ожидая подключение отладчика) снят.

        >[AZURE.IMPORTANT] Параметр **Start JVM in suspended mode, waiting for a debugger connection** (Запустить JVM в режиме приостановки, ожидая подключение отладчика) предназначен только для сценариев расширенной отладки в эмуляторе вычислений (не для развертываний в облаке). Если параметр **Start JVM in suspended mode, waiting for a debugger connection** (Запустить JVM в режиме приостановки, ожидая подключение отладчика) используется, он приостанавливает процесс запуска сервера до подключения отладчика Eclipse к его виртуальной машине Java. Хотя вы можете использовать этот параметр для сеанса отладки с применением эмулятора вычислений, не используйте его для сеанса отладки в облачном развертывании. Инициализация сервера выполняется в рамках задачи запуска Azure, и облако Azure не предоставляет доступ к общедоступным конечным точкам до завершения задачи запуска. Таким образом, процесс запуска не завершается, если этот параметр включен в облачном развертывании, так как получить подключение из внешнего клиента Eclipse будет невозможно.
    1. Щелкните **Create Debug Configurations** (Создать конфигурации отладки).
1. В диалоговом окне **Azure Debug Configuration** (Конфигурация отладки Azure) выполните следующие действия.
    1. Для параметра **Java project to debug** (Проект Java для отладки) выберите проект **MyHelloWorld**.
    1. Для параметра **Configure debugging for** (Настроить отладку для) выберите **Azure compute emulator** (Эмулятор вычислений Azure).
1. Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно **Azure Debug Configuration** (Конфигурация отладки Azure).
1. Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно **Properties for WorkerRole1 Debugging** (Свойства для отладки WorkerRole1).
1. Установите точку останова в index.jsp:
    1. В обозревателе проектов Eclipse разверните узел **MyHelloWorld**, разверните узел **WebContent** и дважды щелкните **index.jsp**.
    1. В пределах index.jsp щелкните правой кнопкой мыши синюю полосу слева от кода Java и выберите пункт **Toggle Breakpoints** (Переключить точки останова), как показано ниже: ![][ic551537] Точка останова задана, если на синей полоске слева от кода Java отображается значок точки останова.
1. Запустите приложение в эмуляторе вычислений, нажав кнопку **Run in Azure Emulator** (Запуск в эмуляторе Azure) на панели инструментов Azure.
1. В меню Eclipse выберите **Выполнить** и щелкните **Debug Configurations** (Конфигурации отладки).
1. В диалоговом окне **Debug Configurations** (Конфигурации отладки) разверните узел **Remote Java Application** (Удаленное приложение Java) на левой панели, выберите **Azure Emulator (WorkerRole1)** (Эмулятор Azure [WorkerRole1]) и нажмите кнопку **Отладка**.
1. Когда эмулятор вычислений сообщит о том, что приложение выполняется, запустите ****http://localhost:8080/MyHelloWorld** в браузере. При отображении диалогового окна **Confirm Perspective Switch** (Подтвердить смену перспективы) нажмите кнопку **Да**. Теперь сеанс отладки должен дойти до строки кода, где была задана точка останова.

Здесь был описан процесс отладки в эмуляторе вычислений, ниже показано, как выполнять отладку приложения, развернутого в Azure.

## Заметки об отладке ##

* После отладки вы можете переключить перспективу с **Отладка** на **Java** через меню Eclipse, щелкнув **Окно**, **Open Perspective** (Открыть перспективу) и выбрав нужную перспективу.
* Чтобы включить удаленную отладку в GlassFish, не используйте функцию конфигурации удаленной отладки из набора средств Azure для Eclipse. Вместо этого настройте GlassFish вручную. Из-за особенностей обработки GlassFish параметров Java, предварительно заданных в переменных среды, функция конфигурации удаленной отладки из набора средств работает с GlassFish неправильно. Если функция конфигурации удаленной отладки из набора средств включена, GlassFish может не запускаться.

## См. также ##

[Набор средств Azure для Eclipse][]

[Создание приложения Hello World для Azure в Eclipse][]

[Установка набора средств Azure для Eclipse][]

Дополнительные сведения об использовании Azure с Java см. в [центре разработчиков Java для Azure][].

<!-- URL List -->

[центре разработчиков Java для Azure]: http://go.microsoft.com/fwlink/?LinkID=699547
[портала управления Azure]: http://go.microsoft.com/fwlink/?LinkID=512959
[Набор средств Azure для Eclipse]: http://go.microsoft.com/fwlink/?LinkID=699529
[Создание приложения Hello World для Azure в Eclipse]: http://go.microsoft.com/fwlink/?LinkID=699533
[Установка набора средств Azure для Eclipse]: http://go.microsoft.com/fwlink/?LinkId=699546
[Использование библиотеки среды выполнения служб Azure в JSP]: http://go.microsoft.com/fwlink/?LinkID=699551

<!-- IMG List -->

[ic719504]: ./media/azure-toolkit-for-eclipse-debugging-azure-applications/ic719504.png
[ic551537]: ./media/azure-toolkit-for-eclipse-debugging-azure-applications/ic551537.png

<!------HONumber=AcomDC_1210_2015-->