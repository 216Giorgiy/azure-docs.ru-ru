---
title: "Масштабирование обнаружения и оценка с помощью переноса Azure | Документы Microsoft"
description: "Описывает, как оценить большое количество локальных компьютеров с помощью службы Azure миграции."
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: article
ms.date: 12/19/2017
ms.author: raynew
ms.openlocfilehash: 9b457252fdb7a1ad62b7e6038b341451df2e1590
ms.sourcegitcommit: 85012dbead7879f1f6c2965daa61302eb78bd366
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/02/2018
---
# <a name="discover-and-assess-a-large-vmware-environment"></a>Обнаружение и оценка крупной среды VMware

В этой статье описывается, как для оценки большое число локальных виртуальных машин (ВМ) с помощью [миграции Azure](migrate-overview.md). Миграция Azure оценивает машины, чтобы проверить ли они подходит для миграции в Azure. Эта служба предоставляет оценкам размеров и затрат для работающих машин в Azure.

## <a name="prerequisites"></a>Технические условия

- **VMware**: виртуальные машины, которые планируется перенести должны находиться под управлением vCenter Server версии 5.5, 6.0 и 6.5. Кроме того необходимо один работающая версия узла ESXi 5.0 или более поздней версии, для развертывания сборщика виртуальной Машины.
- **Учетная запись vCenter**: требуется только для чтения учетной записи для доступа к vCenter Server. Служба "Миграция Azure" использует эту учетную запись для обнаружения локальных виртуальных машин.
- **Разрешения**: В vCenter Server должен иметь разрешения для создания виртуальной Машины путем импорта файла в формате ГОЛОСОВОЙ.
- **Параметры статистики**: параметры статистики vCenter Server должно быть присвоено уровень 3 перед началом развертывания. Если уровень меньше 3, оценка будет работать, но не будет собрать данные о производительности для хранилища и сети. В этом случае размер рекомендации будет основываться на данных производительности для ЦП и памяти и данные конфигурации для дисковых и сетевых адаптеров.

## <a name="plan-azure-migrate-projects"></a>Планирование проектов службы "Миграция Azure"

Планирование обнаружения и оценки на основе следующих ограничений:

| **Сущность** | **Предел компьютера** |
| ---------- | ----------------- |
| Project    | 1,500              | 
| Обнаружение  | 1000              |
| Оценка | 400               |

- При наличии менее 400 машины для обнаружения и оценки необходимо один обнаружения и отдельного проекта. В зависимости от требований можно оценить все машины в одной оценки или компьютеров разделить несколько оценок. 
- Если вы используете машины 400 до 1 000 для обнаружения, необходимо одиночного проекта с одной обнаружения. Однако необходимо будет несколько оценок для оценки этих компьютеров, так как один оценки может содержать до 400 машины.
- Если вы используете машины 1001 до 1500, необходимо одиночного проекта с двумя обнаружения в нем.
- Если вы используете более 1500 машины, необходимо создать несколько проектов, а также выполнять несколько операций обнаружения, в соответствии с требованиями. Например: 
    - Если у вас есть 3 000 компьютеров, можно настроить два проекта с двумя обнаружения или трех проектов с одного обнаружения.
    - Если у вас есть 5 000 компьютеров, можно настроить четырех проектов: две из которых обнаружения 1500 машин и один с обнаружением 500 машин. Кроме того можно настроить пять проектов с одного обнаружения в каждом из них. 

## <a name="plan-multiple-discoveries"></a>Планирование нескольких обнаружения

Же сборщик миграции Azure можно использовать для выполнения нескольких операций обнаружения для одного или нескольких проектов. Эти вопросы планирования следует учитывать:
 
- При выполнении операции обнаружения с помощью сборщика миграции Azure можно задать область обнаружения для папки на сервере vCenter, datacenter, кластера или узла.
- Чтобы сделать более чем одна операция обнаружения, проверьте в vCenter Server, виртуальные машины, нужно выполнить поиск находятся в папки, центры обработки данных, кластеры или узлах, поддерживающих ограничение в 1000 компьютеров.
- Рекомендуется в целях оценки сохранять машин с взаимозависимости в одном проекте и оценки. Убедитесь, что зависимые машины находятся в папке, центра обработки данных и кластера для оценки в vCenter Server.


## <a name="create-a-project"></a>Создание проекта

Создайте проект миграции Azure в соответствии с требованиями:

1. На портале Azure выберите **создать ресурс**.
2. Поиск **миграции Azure**и выберите службу **Azure миграции (Предварительная версия)** в результатах поиска. Щелкните **Создать**.
3. Укажите имя проекта и подписки Azure для проекта.
4. Создайте новую группу ресурсов.
5. Укажите расположение, в котором нужно создать проект, а затем выберите **создать**. Обратите внимание, что по-прежнему можно оценить виртуальные машины для другим целевым расположением. Расположение, указанное для проекта используется для хранения метаданных, собранные из локальных виртуальных машин.

## <a name="set-up-the-collector-appliance"></a>Настройка модуля сборщика

Служба "Миграция Azure" создает локальную виртуальную машину, известную как модуль сборщика. Эту виртуальную Машину обнаруживает виртуальных машин VMware в локальной среде, и он отправляется службе Azure миграцию метаданных о них. Чтобы настроить устройство сборщика, загрузить файл ГОЛОСОВОЙ и импортировать его в локальный экземпляр сервера vCenter.

### <a name="download-the-collector-appliance"></a>Скачивание модуля сборщика

Если у вас есть несколько проектов, необходимо загрузить управляющего устройства сборщика к vCenter Server. После загрузки и установки устройства, запустите его для каждого проекта и укажите проект уникальный идентификатор и ключ.

1. Проект миграции Azure, щелкните **Приступая к работе** > **Discover & Оценка** > **обнаружение машины**.
2. В **обнаружение компьютеров**выберите **загрузки**, чтобы загрузить файл ГОЛОСОВОЙ.
3. В окне **Копирование учетных данных проекта** скопируйте идентификатор и ключ для проекта. Они потребуются при настройке сборщика.

   
### <a name="verify-the-collector-appliance"></a>Проверка модуля сборщика

Убедитесь, что файл ГОЛОСОВОЙ безопасного перед его развертыванием в:

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш OVA-файла.

   ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```

   Пример использования: ```C:\>CertUtil -HashFile C:\AzureMigrate\AzureMigrate.ova SHA256```
3. Убедитесь, что создаваемого хэша соответствует следующие параметры.
 
    Для версии ГОЛОСОВОЙ 1.0.8.38:
    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 | dd27dd6ace28f9195a2b5d52a4003067 
    SHA1 | d2349e06a5d4693fc2a1c0619591b9e45c36d695
    SHA256 | 1492a0c6d6ef76e79269d5cd6f6a22f336341e1accbc9e3dfa5dad3049be6798

    Для версии ГОЛОСОВОЙ 1.0.8.40:
    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 | afbae5a2e7142829659c21fd8a9def3f
    SHA1 | 1751849c1d709cdaef0b02a7350834a754b0e71d
    SHA256 | d093a940aebf6afdc6f616626049e97b1f9f70742a094511277c5f59eacc41ad



## <a name="create-the-collector-vm"></a>Создание виртуальной машины сборщика

Импортируйте загруженный файл vCenter Server.

1. Выберите в консоли клиента vSphere **файл** > **развертывание шаблона OVF**.

    ![Развертывание шаблона OVF](./media/how-to-scale-assessment/vcenter-wizard.png)

2. В мастере развертывания шаблона OVF > **источника**, укажите расположение файла ГОЛОСОВОЙ.
3. В полях**Name** (Имя) и **Location** (Расположение) укажите понятное имя виртуальной машины сборщика и объект инвентаризации, в котором будет размещена эта виртуальная машина.
5. В поле **Host/Cluster** (Узел или кластер) укажите узел или кластер, в котором будет выполняться виртуальная машина сборщика.
7. В поле "Storage" (Хранилище) укажите место хранения данных виртуальной машины сборщика.
8. В поле **Disk Format** (Формат диска) укажите тип и размер диска.
9. В поле **Network Mapping** (Сетевое сопоставление) укажите сеть, к которой будет подключена виртуальная машина сборщика. Сети требуется подключение к Интернету для отправки метаданных в Azure. 
10. Просмотрите и подтвердите параметры и нажмите кнопку **Готово**.

## <a name="identify-the-id-and-key-for-each-project"></a>Определите идентификатор и ключ для каждого проекта

При наличии нескольких проектов убедитесь определить идентификатор и ключ для каждого из них. Ключ необходим при запуске сборщика для обнаружения виртуальных машин.

1. Проект, щелкните **Приступая к работе** > **Discover & Оценка** > **обнаружение машины**.
2. В окне **Копирование учетных данных проекта** скопируйте идентификатор и ключ для проекта. 
    ![Копировать учетные данные проекта](./media/how-to-scale-assessment/copy-project-credentials.png)

## <a name="set-the-vcenter-statistics-level"></a>Установите уровень статистики vCenter
Ниже приведен список счетчиков производительности, собранных в процессе обнаружения. По умолчанию на различных уровнях в vCenter Server, счетчики. 

Рекомендуется устанавливать наибольшее общего уровня (3) для статистики уровня, чтобы правильно собираются данные счетчиков. Если задать на более низком уровне vCenter, только некоторые счетчики могут собираться полностью, с остальной присвоено значение 0. Оценка может отображать неполные данные. 

Кроме того, в следующей таблице перечислены результаты оценки, которые будут затронуты, если счетчик не собираются.

|Счетчик                                  |Уровень    |Уровень на устройство  |Влияние на оценку                               |
|-----------------------------------------|---------|------------------|------------------------------------------------|
|cpu.usage.average                        | 1       |Нет данных                |Рекомендуемый размер виртуальной Машины и затрат                    |
|mem.usage.average                        | 1       |Нет данных                |Рекомендуемый размер виртуальной Машины и затрат                    |
|virtualDisk.read.average                 | 2       |2                 |Размер диска, затраты на хранение и размер виртуальной Машины         |
|virtualDisk.write.average                | 2       |2                 |Размер диска, затраты на хранение и размер виртуальной Машины         |
|virtualDisk.numberReadAveraged.average   | 1       |3                 |Размер диска, затраты на хранение и размер виртуальной Машины         |
|virtualDisk.numberWriteAveraged.average  | 1       |3                 |Размер диска, затраты на хранение и размер виртуальной Машины         |
|net.received.average                     | 2       |3                 |Стоимость размер и сети виртуальной Машины                        |
|net.transmitted.average                  | 2       |3                 |Стоимость размер и сети виртуальной Машины                        |

> [!WARNING]
> Если установленных более высоком уровне статистики, он будет занять дня для создания счетчиков производительности. Таким образом рекомендуется выполнить обнаружение через день.

## <a name="run-the-collector-to-discover-vms"></a>Запуск сборщика для обнаружения виртуальных машин

Для каждого обнаружения, необходимо выполнить запустите сборщик для виртуальных машин в требуемая область обнаружения. Выполняйте операции обнаружения по очереди. Параллельные операции обнаружения не поддерживаются, и у всех операций обнаружения должны быть разные области.

1. В консоли клиента vSphere щелкните правой кнопкой мыши виртуальную машину и выберите **Open Console** (Открыть консоль).
2. Укажите язык, часовой пояс и параметры пароля для модуля.
3. На рабочем столе, выберите **запуск сборщика** ярлык.
4. В сборщике миграции Azure откройте **предварительной настройки** и затем:

   a. Примите условия лицензии и прочитайте информацию от сторонних производителей.

   Сборщик проверит наличие доступа к Интернету у виртуальной машины.
   
   Б. Если ВМ получает доступ к Интернету через прокси-сервер, выберите **параметры прокси-сервера**и укажите адрес прокси-сервера и порт прослушивания. Укажите учетные данные, если для прокси-сервера требуется аутентификация.

   Сборщик проверяет, что запущена служба сборщика. Эта служба устанавливается по умолчанию на виртуальной машине сборщика.

   c. Загрузите и установите VMware PowerCLI.

5. В **укажите сведения о сервере vCenter**, выполните следующие действия:
    - Укажите имя (FQDN) или IP-адрес vCenter Server.
    - В **имя пользователя** и **пароль**, укажите учетные данные учетной записи только для чтения, которые сборщик будет использовать для обнаружения виртуальных машин в vCenter Server.
    - В **выберите область**, выберите область для обнаружения виртуальной Машины. Сборщик может обнаруживать только виртуальные машины в указанной области. Областью может быть определенная папка, центр обработки данных или кластер. Он не должен содержать более 1 000 виртуальных машин. 
    - В **vCenter категории тегов для группирования**выберите **нет**.

    ![Выбор области](./media/how-to-scale-assessment/select-scope.png)

6. В **миграции проекта укажите**, укажите идентификатор и ключ для проекта. Если не удалось скопировать их, откройте портал Azure от сборщика виртуальной Машины. В проекте **Обзор** выберите **обнаружение компьютеров** и скопировать значения.  
7. В **следить за ходом выполнения коллекции**, отслеживать процесс обнаружения и убедитесь, что метаданные, полученные от виртуальных машин в области. Сборщик предоставляет приблизительное время завершения обнаружения.


### <a name="verify-vms-in-the-portal"></a>Проверка виртуальных машин на портале

Длительность обнаружения зависит от количества виртуальных машин, обнаружение которых выполняется. Как правило для 100 виртуальных машин, обнаружение завершения вокруг часа после завершения сборщика. 

1. Проект миграции планировщик, щелкните **управление** > **машины**.
2. Проверьте, появились ли на портале виртуальные машины, которые нужно было обнаружить.


## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как [создать группу](how-to-create-a-group.md) для оценки.
- [Узнайте больше](concepts-assessment-calculation.md) о вычислении оценок.
