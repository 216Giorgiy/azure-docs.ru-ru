---
title: "Масштабирование обнаружения и оценки с помощью службы \"Миграция Azure\" | Документация Майкрософт"
description: "В этой статье описывается, как оценить большое число локальных компьютеров с помощью службы \"Миграция Azure\"."
services: migrate
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: dde0d07f-94b7-4b6a-a158-a89aa9324a35
ms.service: migrate
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 11/22/2017
ms.author: raynew
ms.openlocfilehash: 930ec182cf329e7dda072dc49bd7f70abb413f2d
ms.sourcegitcommit: f847fcbf7f89405c1e2d327702cbd3f2399c4bc2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/28/2017
---
# <a name="discover-and-assess-a-large-vmware-environment"></a>Обнаружение и оценка крупной среды VMware

В этой статье описывается, как оценить большое число локальных компьютеров с помощью службы [Миграция Azure](migrate-overview.md). Служба "Миграция Azure" оценивает компьютеры, чтобы проверить, подходят ли они для миграции в Azure, и предоставляет оценку размера и затрат, необходимых для выполнения компьютера в Azure.

## <a name="prerequisites"></a>Предварительные требования

- **VMware**. Требуется по крайней мере одна виртуальная машина VMware, размещенная на узле или кластере ESXi под управлением версии 5.0 или более поздней версии. Этим узлом или кластером должен управлять сервер vCenter Server версии 5.5 или 6.0.
- **Учетная запись vCenter**. Необходима учетная запись только для чтения с учетными данными администратора для сервера vCenter Server. Служба "Миграция Azure" использует эту учетную запись для обнаружения виртуальных машин.
- **Разрешения**. На сервере vCenter Server необходимы разрешения для создания виртуальной машины путем импорта OVA-файла.
- **Параметры статистики**. Перед началом развертывания для сервера vCenter Server нужно задать параметры статистики уровня 2 или выше.

## <a name="plan-azure-migrate-projects"></a>Планирование проектов службы "Миграция Azure"

Проект службы "Миграция Azure" может оценить до 1500 компьютеров. Отдельный процесс обнаружения в проекте может обнаружить до 1000 компьютеров.

- Если вам нужно обнаружить менее 1000 компьютеров, то вам нужен один проекта с одним процессом обнаружения.
- Если у вас от 1000 до 1500 компьютеров, то вам нужен один проект с двумя процессами обнаружения.
- Если у вас более 1500 компьютеров, необходимо создать несколько проектов и выполнять несколько процессов обнаружения, в соответствии с требованиями. Например:
    - Если у вас 3000 компьютеров, можно настроить два проекта с двумя процессами обнаружения или три проекта с одним процессом обнаружения в каждом.
    - Если у вас 5000 компьютеров, можно настроить четыре проекта. Два — с процессом обнаружения 1500 компьютеров, и один — с процессом обнаружения 500 компьютеров. Кроме того, можно настроить пять проектов с одним процессом обнаружения в каждом из них. 
- При выполнении обнаружения в службе "Миграция Azure" можно задать область обнаружения, указав папку, центр обработки данных или кластер VMware.
- Чтобы выполнить больше одного обнаружения, в vCenter убедитесь, что виртуальные машины, которые нужно обнаружить, размещены в папках, центрах обработки данных или кластерах, поддерживающих ограничение в 1000 компьютеров.
- В целях оценки рекомендуется размещать компьютеры с взаимными зависимостями в рамках одного проекта и оценки. Поэтому в vCenter убедитесь, что зависимые компьютеры находятся в одной папке, центре обработки данных или кластере, предназначенном для оценки.


## <a name="create-a-project"></a>Создание проекта

Создайте проект службы "Миграция Azure" в соответствии со своими требованиями.

1. На портале Azure щелкните **Создать ресурс**.
2. Выполните поиск **Миграция Azure** и выберите службу **Миграция Azure (preview)** в результатах поиска. Затем щелкните **Создать**.
3. Укажите имя проекта и подписку Azure для него.
4. Создайте новую группу ресурсов.
5. Укажите регион, в котором следует создать проект, а затем нажмите кнопку **Создать**. Метаданные, полученные из локальных виртуальных машин, будут храниться в этом регионе.

## <a name="set-up-the-collector-appliance"></a>Настройка модуля сборщика

Служба "Миграция Azure" создает локальную виртуальную машину, известную как модуль сборщика. Эта виртуальная машина обнаруживает локальные виртуальные машины VMware и отправляет метаданные о них в службу "Миграция Azure". Чтобы настроить модуль сборщика, скачайте OVA-файл и импортируйте его на локальный сервер vCenter Server для создания виртуальной машины.

### <a name="download-the-collector-appliance"></a>Скачивание модуля сборщика

Если у вас есть несколько проектов, необходимо только один раз скачать модуль сборщика на сервер vCenter Server. После скачивания и установки модуля запустите его для каждого проекта, указав уникальный идентификатор и ключ проекта.

1. В проекте службы "Миграция Azure" щелкните **Начало работы** > **Обнаружение и оценка** > **Обнаружение компьютеров**.
2. В окне **Обнаружение компьютеров** щелкните **Скачать**, чтоб скачать OVA-файл.
3. В окне **Копирование учетных данных проекта** скопируйте идентификатор и ключ для проекта. Они потребуются при настройке сборщика.

   
### <a name="verify-the-collector-appliance"></a>Проверка модуля сборщика

Прежде чем развертывать OVA-файл, убедитесь, что он не поврежден.

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш OVA-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример использования: ```C:\>CertUtil -HashFile C:\AzureMigrate\AzureMigrate.ova SHA256```
3. Созданный хэш должен соответствовать этим параметрам.

    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 | c283f00f46484bf673dc8383b01d0741 
    SHA1 | 8f49b47f53d051af1780bbc725659ce64e717ed4
    SHA256 | 7aecdbdb2aea712efe99d0c1444503f52d16de5768e783465e226fbbca71501d

## <a name="create-the-collector-vm"></a>Создание виртуальной машины сборщика

Импортируйте скачанный файл на сервер vCenter Server.

1. В консоли клиента vSphere щелкните **File** (Файл)  >  **Deploy OVF Template** (Развернуть шаблон OVF).

    ![Развертывание шаблона OVF](./media/how-to-scale-assessment/vcenter-wizard.png)

2. В мастере развертывания шаблона OVF выберите **Source** (Источник) и укажите расположение OVA-файла.
3. В полях**Name** (Имя) и **Location** (Расположение) укажите понятное имя виртуальной машины сборщика и объект инвентаризации, в котором будет размещена эта виртуальная машина.
5. В поле **Host/Cluster** (Узел или кластер) укажите узел или кластер, в котором будет выполняться виртуальная машина сборщика.
7. В поле "Storage" (Хранилище) укажите место хранения данных виртуальной машины сборщика.
8. В поле **Disk Format** (Формат диска) укажите тип и размер диска.
9. В поле **Network Mapping** (Сетевое сопоставление) укажите сеть, к которой будет подключена виртуальная машина сборщика. Этой сети требуется подключение к Интернету для отправки метаданных в Azure. 
10. Просмотрите и подтвердите параметры, а затем нажмите кнопку **Finish** (Готово).

## <a name="identify-the-key-and-id-for-each-project"></a>Определение ключа и идентификатора для каждого проекта

Если у вас несколько проектов, обязательно определите идентификатор и ключ для каждой из них. Ключ необходим при запуске сборщика для обнаружения виртуальных машин.

1. В проекте щелкните **Начало работы** > **Обнаружение и оценка** > **Обнаружение компьютеров**.
2. В окне **Копирование учетных данных проекта** скопируйте идентификатор и ключ для проекта. 
    ![Идентификатор проекта](./media/how-to-scale-assessment/project-id.png)

## <a name="vcenter-statistics-level-to-collect-the-performance-counters"></a>Уровень статистики vCenter для сбора данных счетчиков производительности
Ниже приведен список счетчиков, данные которых собираются в процессе обнаружения. Счетчики по умолчанию доступны на разных уровнях на сервере vCenter Server. Мы рекомендуем установить наибольший общий уровень (уровень 3) для статистики, чтобы данные счетчиков собирались правильно. Если задать более низкий уровень статистики vCenter, то полностью смогут быть собраны только данные нескольких счетчиков, остальные же покажут 0. Поэтому оценка может отображать неполные данные. В следующей таблице показаны результаты оценки, на которые повлияет отсутствие данных какого-либо счетчика.

|Счетчик                                  |Уровень    |На уровне устройства  |Влияние на оценку                               |
|-----------------------------------------|---------|------------------|------------------------------------------------|
|cpu.usage.average                        | 1       |Нет данных                |Рекомендуемый размер и стоимость виртуальной машины                    |
|mem.usage.average                        | 1       |Нет данных                |Рекомендуемый размер и стоимость виртуальной машины                    |
|virtualDisk.read.average                 | 2       |2                 |Размер диска, стоимость хранения и размер виртуальной машины         |
|virtualDisk.write.average                | 2       |2                 |Размер диска, стоимость хранения и размер виртуальной машины         |
|virtualDisk.numberReadAveraged.average   | 1       |3                 |Размер диска, стоимость хранения и размер виртуальной машины         |
|virtualDisk.numberWriteAveraged.average  | 1       |3                 |Размер диска, стоимость хранения и размер виртуальной машины         |
|net.received.average                     | 2       |3                 |Размер виртуальной машины и стоимость сети                        |
|net.transmitted.average                  | 2       |3                 |Размер виртуальной машины и стоимость сети                        |

> [!WARNING]
> Если вы только что задали более высокий уровень статистики, то для создания данных счетчиков производительности потребуется до одного дня. Поэтому рекомендуется выполнить обнаружение через один день.

## <a name="run-the-collector-to-discover-vms"></a>Запуск сборщика для обнаружения виртуальных машин

Для каждого обнаружения, которое необходимо выполнить, следует запустить сборщик для виртуальных машин в требуемой области обнаружения. Выполняйте операции обнаружения по очереди. Параллельные операции обнаружения не поддерживаются, и у всех операций обнаружения должны быть разные области.

1. В консоли клиента vSphere щелкните правой кнопкой мыши виртуальную машину и выберите **Open Console** (Открыть консоль).
2. Укажите язык, часовой пояс и параметры пароля для модуля.
3. На рабочем столе щелкните ярлык **Run collector** (Запустить сборщик).
4. В сборщике службы "Миграция Azure" откройте раздел **Set Up Prerequisites** (Настройка предварительных требований).
    - Примите условия лицензии и прочитайте информацию от сторонних производителей.
    - Сборщик проверит наличие доступа к Интернету у виртуальной машины.
    - Если виртуальная машина подключена к Интернету через прокси-сервер, щелкните **Proxy settings** (Параметры прокси-сервера) и укажите адрес и порт прослушивания прокси-сервера. Укажите учетные данные, если для прокси-сервера требуется аутентификация.
    - Сборщик проверит, запущена ли служба профилировщика Windows. Эта служба устанавливается по умолчанию на виртуальной машине сборщика.
    - Скачайте и установите VMware vSphere PowerCLI.
. В окне **Обнаружение компьютеров** выполните следующие действия.
    - Укажите полное доменное имя или IP-адрес сервера vCenter Server.
    - В полях **Имя пользователя** и **Пароль** укажите данные учетной записи только для чтения, которую сборщик будет использовать для обнаружения виртуальных машин на сервере vCenter Server.
    - В поле **Область сбора данных** выберите область обнаружения виртуальных машин. Сборщик может обнаруживать только виртуальные машины в указанной области. Областью может быть определенная папка, центр обработки данных или кластер. Она не должна содержать более 1000 виртуальных машин. 
    - Для параметра n **Tag category for grouping** (Категория тегов для группирования) выберите **Нет**.

        ![Выбор области](./media/how-to-scale-assessment/select-scope.png)

1. В поле **Выбор проекта** укажите идентификатор и ключ для проекта. Если вы не скопировали их, откройте портал Azure на виртуальной машине сборщика. На странице **Обзор** проекта щелкните **Обнаружение компьютеров** и скопируйте соответствующие значения.  
В окне **Complete Discovery** (Завершение обнаружения) наблюдайте процесс обнаружения и убедитесь, что метаданные собираются из виртуальных машин в области обнаружения. Сборщик предоставляет приблизительное время завершения обнаружения.


### <a name="verify-vms-in-the-portal"></a>Проверка виртуальных машин на портале

Длительность обнаружения зависит от количества виртуальных машин, обнаружение которых выполняется. Обычно для 100 виртуальных машин после завершения работы сборщика обнаружение занимает примерно час. 

1. В проекте службы "Миграция Azure" щелкните **Управление** > **Компьютеры**.
2. Проверьте, появились ли на портале виртуальные машины, которые нужно было обнаружить.


## <a name="next-steps"></a>Дальнейшие действия

- Узнайте, как [создать группу](how-to-create-a-group.md) для оценки.
- [Узнайте больше](concepts-assessment-calculation.md) о вычислении оценок.