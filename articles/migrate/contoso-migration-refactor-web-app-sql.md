---
title: Выполнение рефакторинга приложения Contoso путем его переноса в виртуальные машины Azure и в группу доступности SQL Server AlwaysOn | Документация Майкрософт
description: Узнайте, как Contoso меняет размещение локального приложения путем перемещения его в веб-приложение контейнера Azure и Базу данных SQL Server Azure.
services: site-recovery
author: rayne-wiselman
ms.service: site-recovery
ms.topic: conceptual
ms.date: 07/12/2018
ms.author: raynew
ms.openlocfilehash: f4a348815ef058cb795ed12e8f118b494650a555
ms.sourcegitcommit: e0a678acb0dc928e5c5edde3ca04e6854eb05ea6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/13/2018
ms.locfileid: "39005196"
---
# <a name="contoso-migration-refactor-an-on-premises-app-to-an-azure-web-app-and-azure-sql-database"></a>Миграция в компании Contoso: рефакторинг локального приложения для веб-приложения Azure и Базы данных SQL Azure

В этой статье показано, как компания Contoso выполняет рефакторинг своего приложения SmartHotel в Azure. Специалисты компании перенесут виртуальную машину внешнего интерфейса приложения в веб-приложение Azure, а базу данных приложения — в Базу данных SQL Azure.

Это документ из цикла статей о том, как вымышленная компания Contoso переносит локальные ресурсы в облако Microsoft Azure. В статьях этого цикла содержатся общие сведения и сценарии развертывания, в которых проиллюстрирована настройка инфраструктуры миграции, оценка пригодности локальных ресурсов для миграции и выполнение различных типов миграции. Сценарии описаны в порядке возрастания сложности. Со временем мы добавим в этот цикл и другие статьи.

**Статья** | **Дополнительные сведения** | **Состояние**
--- | --- | ---
[Статья 1. Общие сведения](contoso-migration-overview.md) | Предоставляет общие сведения о стратегии миграции Contoso, цикле статей и примерах приложений, которые мы используем. | Доступна
[Статья 2. Развертывания инфраструктуры Azure](contoso-migration-infrastructure.md) | Здесь рассказывается о том, как Contoso готовит свою локальную инфраструктуру Azure для миграции. Для всех сценариев миграции Contoso используется одна и та же инфраструктура. | Доступна
[Статья 3. Доступ к локальным ресурсам](contoso-migration-assessment.md)  | В этой статье рассказывается, как компания Contoso выполняет оценку своего локального двухуровневого приложения SmartHotel в VMware. Для оценки виртуальных машин приложения компания Contoso использует службу [Миграция Azure](migrate-overview.md). Для оценки базы данных SQL Server приложения используется [помощник по миграции баз данных](https://docs.microsoft.com/sql/dma/dma-overview?view=sql-server-2017). | Доступна
[Статья 4. Повторное размещение приложения на виртуальных машинах Azure и в управляемом экземпляре SQL](contoso-migration-rehost-vm-sql-managed-instance.md) | Здесь демонстрируется, как Contoso выполняет процесс миграции приложения SmartHotel в Azure по методу lift-and-shift. Contoso переносит интерфейсную ВМ приложения с помощью [Azure Site Recovery](https://docs.microsoft.com/azure/site-recovery/site-recovery-overview). Базу данных приложения она переносит в управляемый экземпляр SQL с помощью [Azure Database Migration Service](https://docs.microsoft.com/azure/dms/dms-overview). | Доступна
[Статья 5. Перемещение приложения в виртуальные машины Azure](contoso-migration-rehost-vm.md) | В этой статье рассказывается, как компания Contoso переносит виртуальные машины приложения SmartHotel, используя только Site Recovery. | Доступна
[Статья 6. Повторное размещение приложения на виртуальных машинах Azure и в группах доступности SQL Server AlwaysOn](contoso-migration-rehost-vm-sql-ag.md) | Здесь показан выполняемый в Contoso процесс миграции приложения SmartHotel. Contoso использует Site Recovery для переноса ВМ приложений и службы миграции баз данных для миграции базы данных приложения в кластер SQL Server, защищенный группой доступности AlwaysOn. | Доступна
[Статья 7. Повторное размещение приложения Linux на виртуальных машинах Azure](contoso-migration-rehost-linux-vm.md) | Здесь показано, как компания Contoso осуществляет миграцию приложения Linux osTicket по методу lift-and-shift на виртуальные машины Azure с помощью Site Recovery | Доступна
[Статья 8. Повторное размещение приложения Linux на виртуальных машинах Azure и сервере MySQL в Azure](contoso-migration-rehost-linux-vm-mysql.md) | В этой статье рассказывается, как компания Contoso выполняет миграцию приложения Linux osTicket на виртуальные машины Azure с помощью Site Recovery и миграцию базы данных приложения в экземпляр Azure MySQL Server с помощью MySQL Workbench. | Доступна
Статья 9. Рефакторинг приложения для веб-приложения Azure и Базы данных SQL Azure | В статье описывается, как Contoso переносит приложение SmartHotel в веб-приложение Azure, а базу данных приложения — в экземпляр SQL Server Azure. | Эта статья
[Статья 10. Рефакторинг приложения Linux для веб-приложений Azure и MySQL для Azure](contoso-migration-refactor-linux-app-service-mysql.md) | В статье описывается, как Contoso переносит приложение osTicket для Linux в веб-приложения Azure на нескольких сайтах, интегрированных с GitHub для непрерывной поставки. Специалисты компании переносят базу данных приложения в экземпляр MySQL в Azure. | Доступна
[Статья 11. Рефакторинг TFS в VSTS](contoso-migration-tfs-vsts.md) | В этой статье показано, как Contoso выполняет миграцию локального развертывания Team Foundation Server (TFS) путем его переноса в Visual Studio Team Services (VSTS) в Azure. | Доступна
[Статья 12. Повторное проектирование приложения для использования контейнеров Azure и Базы данных SQL Azure](contoso-migration-rearchitect-container-sql.md) | В статье описывается, как Contoso переносит и повторно проектирует приложение SmartHotel в Azure. Специалисты компании повторно проектируют веб-уровень приложения как контейнер Windows и переносят базу данных приложения в Базу данных SQL Azure. | Доступна
[Статья 13. Повторное создание приложения в Azure](contoso-migration-rebuild.md) | В статье описывается, как Contoso повторно создает свое приложение SmartHotel, используя ряд возможностей и служб Azure, включая Службу приложений Azure, Azure Kubernetes, "Функции Azure", Cognitive Services и Cosmos DB. | Доступна


В этой статье рассказывается, как Contoso выполняет миграцию двухуровневого приложения Windows. NET SmartHotel, работающего на виртуальных машинах VMware в Azure. Это приложение с открытым исходным кодом, и если вы хотите использовать его, загрузите его с [GitHub](https://github.com/Microsoft/SmartHotel360).

## <a name="business-drivers"></a>Бизнес-факторы

Совместными усилиями ИТ-руководство и деловые партнеры определили указанные ниже цели этой миграции.

- **Адаптация к расширению бизнеса**. По мере развития компании Contoso растет нагрузка на локальные системы и инфраструктуры.
- **Повышение эффективности**: Contoso необходимо удалить ненужные процедуры и оптимизировать процессы для разработчиков и пользователей.  Бизнес нуждается в том, чтобы ИТ были быстрыми и чтобы не тратить время или деньги, обеспечивая более высокие требования клиентов.
- **Повышение гибкости**. ИТ-отдел компании Contoso нуждается в большей гибкости в отношении потребностей бизнеса. Должна реагировать быстрее, чем изменения на рынке, чтобы включить успех в глобальную экономику реагирования.  Он не должен мешать или становиться помехой для бизнеса.
- **Масштабирование**. По мере того как бизнес успешно растет, ИТ-отдел компании Contoso должен предоставлять системы, способные расти с тем же темпом.
- **Расходы**. Contoso хочет минимизировать стоимость лицензии.

## <a name="migration-goals"></a>Цели миграции

Группа, работающая над облачной инфраструктурой компании Contoso, определила цели этой миграции. Эти цели использовались для определения оптимального метода миграции.

**Требования** | **Дополнительные сведения**
--- | --- 
**Приложение** | Потребность использовать приложение в Azure всегда будет критически важной.<br/><br/> Должны быть доступны те же возможности производительности, что и в настоящее время в VMware.<br/><br/> Специалисты компании не хотят вкладывать средства в это приложение. Они просто хотят безопасно переместить его в облако.<br/><br/> Специалисты компании хотят прекратить поддержку ОС Windows Server 2008 R2, на которой в настоящее время работает приложение.<br/><br/> Они хотят отойти от SQL Server 2008 R2, чтобы начать использовать современную платформу базы данных PaaS, что снизит необходимость в управлении.<br/><br/> Contoso хочет применить свои инвестиции в лицензирование SQL Server и Software Assurance, где это возможно.<br/><br/> Кроме того, компания Contoso хочет перенести единую точку отказа на веб-уровень.
**Ограничения** | Приложение состоит из приложения ASP.NET и службы WCF, работающей на той же виртуальной машине. С помощью Службы приложений Azure специалисты компании хотят разделить это приложение между двумя веб-приложениями. 
**Таблицы Azure** | Специалисты компании хотят перенести приложение в Azure, но не запускать его на виртуальных машинах. Они хотят использовать службы Azure PaaS и для уровня данных, и для веб-уровня. 

## <a name="solution-design"></a>Архитектура решения

Определив свои цели и требования, Contoso начинает разработку и анализ решения развертывания и идентифицирует процесс миграции, включая службы Azure, которые будут использоваться при этой миграции.

### <a name="current-app"></a>Текущее приложение

- Локальное приложение SmartHotel разбито на уровни на двух виртуальных машинах (WEBVM и SQLVM).
- Виртуальные машины расположены на узле VMware ESXi **contosohost1.contoso.com** (версии 6.5).
- Средой VMware управляет сервер vCenter Server 6.5 (**vcenter.contoso.com**), который запущен на виртуальной машине.
- Contoso использует локальный центр обработки данных (contoso-datacenter) с локальным контроллером домена (**contosodc1**).
- После завершения миграции локальные виртуальные машины в центре обработки данных Contoso будут выведены из эксплуатации.


### <a name="proposed-solution"></a>Предлагаемое решение

- Для уровня базы данных приложения компания Contoso сравнивает Базу данных SQL Azure с SQL Server (в [этой статье](https://docs.microsoft.com/azure/sql-database/sql-database-features)). Специалисты компании решили продолжить работу с Базой данных SQL Azure по нескольким причинам:
    - База данных SQL Azure — это управляемая реляционная база данных. Она обеспечивает прогнозируемую производительность на нескольких уровнях обслуживания с почти нулевым администрированием. Среди преимуществ: динамическая масштабируемость без простоя, встроенная интеллектуальная оптимизация, глобальная масштабируемость и доступность.
    - Возможно использование упрощенного Помощника по миграции данных (DMA) для оценки и переноса локальной базы данных в SQL Azure.
    - В программе Software Assurance можно обменять имеющиеся лицензии на сниженные тарифы в Базе данных SQL с помощью программы "Преимущество гибридного использования Azure" для SQL Server. Это может обеспечить экономию до 30 %.
    - База данных SQL предоставляет ряд функций безопасности, включая постоянное шифрование, динамическую маскировку данных, обеспечение безопасности на уровне строк и обнаружение угроз.
- Специалисты компании решили использовать Службу приложений Azure для веб-уровня приложения. Служба PaaS позволяет развернуть приложение, внеся лишь несколько изменений в конфигурацию. Специалисты компании хотят использовать Visual Studio для внесения изменений и развертывания двух веб-приложений. Одно для веб-сайта, а другое для службы приложения WCF.
  
### <a name="solution-review"></a>Проверка решения
Contoso оценивает предлагаемый дизайн, составляя список плюсов и минусов.

**Рассмотрение** | **Дополнительные сведения**
--- | ---
**Преимущества** | Код приложения SmartHotel потребуется изменить для миграции в Azure.<br/><br/> Компания может задействовать свои инвестиции в программу Software Assurance, используя предложение "Преимущество гибридного использования Azure" для SQL Server и Windows Server.<br/><br/> После миграции можно будет отказаться от поддержки Windows Server 2008 R2. [Узнайте больше](https://support.microsoft.com/lifecycle).<br/><br/> Специалисты компании могут настроить веб-уровень приложения с несколькими экземплярами, и таким образом он больше не будет являться единой точкой отказа.<br/><br/> Исчезнет зависимость от устаревающей SQL Server 2008 R2.<br/><br/> База данных SQL поддерживает технические требования Contoso. Специалисты компании провели оценку локальной базы данных с помощью Помощника по миграции данных и обнаружили, что она является совместимой.<br/><br/> База данных SQL включает встроенную отказоустойчивость, которую Contoso не нужно настраивать. Это гарантия того, что уровень данных больше не является единой точкой отказа.
**Недостатки** | Служба приложений Azure поддерживает только одно развертывание приложения для каждого веб-приложения. Это означает, что необходимо подготавливать два веб-приложения (одно для веб-сайта, а другое для службы WCF).<br/><br/> Если для переноса своей базы данных специалисты компании будут использовать Помощник по миграции данных вместо Службы миграции данных, инфраструктура Contoso не будет готова к переносу баз данных в масштабе. Им нужно будет создать другой регион для обеспечения отработки отказа в случае недоступности основного региона.

## <a name="proposed-architecture"></a>Предлагаемая архитектура

![Архитектура сценария](media/contoso-migration-refactor-web-app-sql/architecture.png) 


### <a name="migration-process"></a>Процесс миграции

1. Компания Contoso подготавливает экземпляр SQL Azure и переносит в него базу данных SmartHotel.
2. Специалисты компании подготавливают и настраивают веб-приложения и развертывают в них приложения SmartHotel.

    ![Процесс миграции](media/contoso-migration-refactor-web-app-sql/migration-process.png) 

### <a name="azure-services"></a>Службы Azure

**Служба** | **Описание** | **Стоимость**
--- | --- | ---
[Помощник по миграции баз данных (DMA)](https://docs.microsoft.com/sql/dma/dma-overview?view=ssdt-18vs2017) | DMA используется для оценки и выявления проблем совместимости, которые могут повлиять на функциональность их базы данных в Azure. Помощник оценивает соотношение характеристик между источниками и целями SQL и предоставляет рекомендации по улучшению производительности и надежности. | Это средство можно загрузить бесплатно.
[база данных SQL Azure;](https://azure.microsoft.com/services/sql-database/) | Интеллектуальная полностью управляемая реляционная служба облачной базы данных. | Стоимость зависит от функций, пропускной способности и размера. [Узнайте больше](https://azure.microsoft.com/pricing/details/sql-database/managed/).
[Веб-приложения Службы приложений Azure](https://docs.microsoft.com/azure/app-service/app-service-web-overview) | Создавайте мощные облачные приложения с помощью полностью управляемой платформы. | Стоимость зависит от размера, расположения и длительности использования. [Узнайте больше](https://azure.microsoft.com/pricing/details/app-service/windows/).

## <a name="prerequisites"></a>Предварительные требования

Ниже показано, что вам (и компании Contoso) необходимо сделать, чтобы выполнить этот сценарий:

**Требования** | **Дополнительные сведения**
--- | ---
**Подписка Azure.** | Вы должны были создать подписку, когда выполняли внутреннюю оценку в первой статье этой серии. Если у вас еще нет подписки Azure, создайте [бесплатную учетную запись Azure](https://azure.microsoft.com/pricing/free-trial/).<br/><br/> Если вы создаете бесплатную учетную запись, вы являетесь администратором своей подписки и можете выполнять любые действия.<br/><br/> Если вы используете существующую подписку, в которой не являетесь администратором, администратор должен назначить вам права владельца или участника.
**Инфраструктура Azure** | [Узнайте, как](contoso-migration-infrastructure.md) компания Contoso настраивает инфраструктуру Azure.


## <a name="scenario-steps"></a>Шаги выполнения сценария

Ниже рассказывается, как компания Contoso выполняет миграцию.

> [!div class="checklist"]
> * **Шаг 1. Подготовка экземпляра Базы данных SQL в Azure**. Contoso подготавливает экземпляр SQL в Azure. После миграции веб-сайта приложения в Azure веб-приложение службы WCF будет указывать на этот экземпляр.
> * **Шаг 2. Миграция базы данных с помощью DMA**. Специалисты компании переносят базу данных приложения с помощью Помощника по миграции данных.
> * **Шаг 3. Подготовка веб-приложений**. Специалисты компании подготавливают два веб-приложения.
> * **Шаг 4. Настройка строк подключения**. Специалисты компании настраивают строки подключения для обеспечения взаимодействия веб-приложения веб-уровня, веб-приложения службы WCF и экземпляра SQL.
> * **Шаг 5. Публикация веб-приложений**. На последнем этапе компания Contoso публикует приложения в Azure.


## <a name="step-1-provision-an-azure-sql-database"></a>Шаг 1. Подготовка Базы данных SQL Azure

1. Специалисты компании выбирают Базу данных SQL в Azure. 

    ![Подготовка SQL](media/contoso-migration-refactor-web-app-sql/provision-sql1.png)

2. Они указывают имя базы данных в соответствии с базой данных, работающей на локальной виртуальной машине (**SmartHotel.Registration**). Они размещают базу данных в группе ресурсов ContosoRG. Это группа ресурсов, которую специалисты компании используют для рабочих ресурсов в Azure.

    ![Подготовка SQL](media/contoso-migration-refactor-web-app-sql/provision-sql2.png)

3. Специалисты компании настраивают новый экземпляр SQL Server (**sql-smarthotel-eus2**) в основном регионе.

    ![Подготовка SQL](media/contoso-migration-refactor-web-app-sql/provision-sql3.png)

4. Они задают ценовую категорию в соответствии с потребностями своего сервера и базы данных, а также предпочитают сэкономить с помощью предложения "Преимущество гибридного использования Azure", так как у них уже есть лицензия SQL Server.
5. Для определения размера они используют вариант приобретения на основе виртуальных ядер и устанавливают ограничения в соответствии с ожидаемыми требованиями.

    ![Подготовка SQL](media/contoso-migration-refactor-web-app-sql/provision-sql4.png)

6. Затем они создают экземпляр базы данных.

    ![Подготовка SQL](media/contoso-migration-refactor-web-app-sql/provision-sql5.png)

7. После создания экземпляра они открывают базу данных и отмечают сведения, которые им нужны при использовании Помощника по миграции базы данных.

    ![Подготовка SQL](media/contoso-migration-refactor-web-app-sql/provision-sql6.png)


**Нужна дополнительная помощь?**

- [Получение справки](https://docs.microsoft.com/azure/sql-database/sql-database-get-started-portal) о подготовке Базы данных SQL.
- [Дополнительные сведения об](https://docs.microsoft.com/azure/sql-database/sql-database-vcore-resource-limits-elastic-pools) ограничениях ресурсов в модели приобретения на основе виртуальных ядер.


## <a name="step-2-migrate-the-database-with-dma"></a>Шаг 2. Миграция базы данных с помощью DMA

Contoso перенесет базу данных SmartHotel с помощью DMA.

### <a name="install-dma"></a>Установка DMA

1. Они загружают инструмент с [центра загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=53595) к локальной виртуальной машине SQL Server (**SQLVM**).
2. Они запускают установку (DownloadMigrationAssistant.msi) на виртуальной машине.
3. Перед закрытием мастера на странице **Готово** необходимо выбрать **Launch Microsoft Data Migration Assistant** (Запустить помощник по миграции данных Майкрософт).

### <a name="migrate-the-database-with-dma"></a>Миграция базы данных с помощью DMA

1. В DMA создайте проект (**SmartHotelDB**) и выберите **миграцию**. 
2. Специалисты компании выбирают тип исходного сервера **SQL Server**, а целевого — **База данных SQL Azure**. 

    ![DMA](media/contoso-migration-refactor-web-app-sql/dma-1.png)

3. В подробностях о миграции они добавляют **SQLVM** в качестве исходного сервера и базу данных **SmartHotel.Registration**. 

     ![DMA](media/contoso-migration-refactor-web-app-sql/dma-2.png)

4. Они получают ошибку, которая, по всей видимости, связана с проверкой аутентификации. Однако после анализа оказывается, что проблема заключается в наличии точки (.) в имени базы данных. В качестве обходного решения специалисты компании решают подготовить новую базу данных SQL, используя имя **SmartHotel-Registration**. При повторном запуске DMA они смогут выбрать имя **SmartHotel-Registration** и продолжить работу с мастером.

    ![DMA](media/contoso-migration-refactor-web-app-sql/dma-3.png)

5. На вкладке **выбора объектов** они выбирают таблицы базы данных и генерируют скрипт SQL.

    ![DMA](media/contoso-migration-refactor-web-app-sql/dma-4.png)

6. После того как DMS создаст скрипт, нужно нажать кнопку **Deploy schema** (Развернуть схему).

    ![DMA](media/contoso-migration-refactor-web-app-sql/dma-5.png)

7. DMA подтверждает, что развертывание выполнено успешно.

    ![DMA](media/contoso-migration-refactor-web-app-sql/dma-6.png)

8. Теперь специалисты компании начинают процесс миграции.

    ![DMA](media/contoso-migration-refactor-web-app-sql/dma-7.png)

9. После завершения миграции Contoso может проверить, что база данных запущена в экземпляре SQL Azure.

    ![DMA](media/contoso-migration-refactor-web-app-sql/dma-8.png)

10. Специалисты компании удаляют на портале Azure дополнительную базу данных SQL **SmartHotel.Registration**.

    ![DMA](media/contoso-migration-refactor-web-app-sql/dma-9.png)


## <a name="step-3-provision-web-apps"></a>Шаг 3. Подготовка веб-приложений

Сейчас, когда база данных уже перенесена, Contoso может подготовить два веб-приложения.

1. На портале специалисты компании выбирают **Веб-приложение**.

    ![Веб-приложение](media/contoso-migration-refactor-web-app-sql/web-app1.png)

2. Они указывают имя приложения (**SHWEB EUS2**), запускают его в Windows и помещают в производственную группу ресурсов **ContosoRG**. Специалисты компании создают план и новую службу приложения.

    ![Веб-приложение](media/contoso-migration-refactor-web-app-sql/web-app2.png)

3. После подготовки веб-приложения специалисты компании повторяют процедуру для создания веб-приложения службы WCF (**SHWCF-EUS2**).

    ![Веб-приложение](media/contoso-migration-refactor-web-app-sql/web-app3.png)

4. По завершении создания специалисты компании перейдут по адресам приложений, чтобы проверить, что они были созданы успешно.

## <a name="step-4-configure-connection-strings"></a>Шаг 4. Настройка строк подключения

Компания Contoso должна убедиться, что веб-приложения и база данных могут взаимодействовать. Чтобы сделать это, они настраивают строки подключения в коде и в веб-приложениях.

1. В веб-приложении для службы WCF (**SHWCF-EUS2**) > **Параметры** > **Параметры приложения** они добавляют новую строку подключения с именем **DefaultConnection**.
2. Строка подключения извлекается из базы данных **SmartHotel-Registration** и должна быть обновлена с правильными учетными данными.

    ![Строка подключения](media/contoso-migration-refactor-web-app-sql/string1.png)

3. С помощью Visual Studio специалисты компании Contoso открывают файл решения в папке **SmartHotel360-internal-booking-apps**. В разделе **ConnectionStrings** файла web.config для службы WCF (SmartHotel.Registration.Wcf) нужно указать строку подключения.

     ![Строка подключения](media/contoso-migration-refactor-web-app-sql/string2.png)

4. В разделе **client** файла web.config для SmartHotel.Registration.Web нужно указать новое расположение службы WCF. Это URL-адрес веб-приложения WCF, на котором размещена конечная точка службы.

    ![Строка подключения](media/contoso-migration-refactor-web-app-sql/strings3.png)


## <a name="step-5-publish-web-apps"></a>Шаг 5. Публикация веб-приложений

На последнем этапе компания Contoso публикует веб-приложения в Azure.

1. В Visual Studio специалисты компании щелкают правой кнопкой мыши проект SmartHotel.REgistration.Wcf > **Опубликовать**.

    ![Опубликовать](media/contoso-migration-refactor-web-app-sql/publish-web1.png)

2. Специалисты компании начинают публикацию.

    ![Опубликовать](media/contoso-migration-refactor-web-app-sql/publish-web2.png)

3. Они выбирают существующую службу приложений, так как они уже создали веб-приложение.

    ![Опубликовать](media/contoso-migration-refactor-web-app-sql/publish-web3.png)

4. После того как специалисты компании выбрали приложение WCF, Visual Studio развертывает его.

    ![Опубликовать](media/contoso-migration-refactor-web-app-sql/publish-web4.png)

5. Затем специалисты компании повторяют действия для публикации веб-приложения SmartHotel.Registration.Web.

    ![Опубликовать](media/contoso-migration-refactor-web-app-sql/publish-web5.png)


На этом этапе приложение успешно перенесено в Azure.

## <a name="clean-up-after-migration"></a>Очистка после миграции

После миграции специалистам компании Contoso необходимо выполнить указанные ниже действия по очистке.  

- Удалите локальные виртуальные машины из перечня в vCenter.
- Удалить виртуальные машины из локальных заданий резервного копирования.
- Обновите внутреннюю документацию, чтобы показать новые расположения приложения SmartHotel. Покажите базу данных как запущенную в Базе данных SQL Azure, а внешний интерфейс как запущенный в двух веб-приложениях.
- Проверить все ресурсы, взаимодействующие с резервными виртуальными машинами, и обновить все соответствующие параметры или документы согласно новой конфигурации.


## <a name="review-the-deployment"></a>Проверка развертывания

Теперь, когда выполняется миграция ресурсов в Azure, компании Contoso необходимо полностью ввести его в эксплуатацию и защитить свою новую инфраструктуру.

### <a name="security"></a>Безопасность

- Contoso необходимо обеспечить безопасность своей новой базы данных **SmartHotel-Registration**. [Узнайте больше](https://docs.microsoft.com/azure/sql-database/sql-database-security-overview).
- В частности, нужно обновить веб-приложения для использования SSL с сертификатами.

### <a name="backups"></a>Резервные копии

- Contoso следует рассмотреть требования резервного копирования для Базы данных SQL Azure. [Узнайте больше](https://docs.microsoft.com/azure/sql-database/sql-database-automated-backups).
- Нужно рассмотреть реализацию групп отработки отказа для обеспечения отказоустойчивости в регионе для базы данных. [Узнайте больше](https://docs.microsoft.com/azure/sql-database/sql-database-geo-replication-overview).
- Contoso необходимо рассмотреть развертывание веб-приложения в основном регионе "Восточная часть США 2" и в регионе "Центральная часть США" для обеспечения отказоустойчивости. Специалисты компании могут настроить диспетчер трафика для обеспечения отработки отказа в случае региональных сбоев.

### <a name="licensing-and-cost-optimization"></a>Лицензирование и оптимизация затрат

- После развертывания всех ресурсов специалисты компании Contoso должны назначить теги Azure в соответствии со своим [планированием инфраструктуры](contoso-migration-infrastructure.md#set-up-tagging).
- Полное лицензирование входит в стоимость служб PaaS, которые использует Contoso. Это будет вычтено из EA.
1. Компания будет использовать Управление затратами Azure по лицензии Cloudyn (дочернее подразделение корпорации Майкрософт). Это решение по управлению затратами для нескольких облаков позволяет использовать Azure и другие облачные ресурсы, а также управлять ими.  Дополнительные сведения об управлении расходами см. [на этой странице](https://docs.microsoft.com/azure/cost-management/overview). 

## <a name="conclusion"></a>Заключение

В этой статье специалисты компании Contoso выполнили рефакторинг приложения SmartHotel в Azure путем миграции виртуальной машины внешнего интерфейса приложения в два веб-приложения Azure. Они перенесли базу данных приложения в Базу данных SQL Azure.






