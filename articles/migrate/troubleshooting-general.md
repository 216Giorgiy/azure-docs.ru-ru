---
title: Устранение неполадок в службе "Миграция Azure" | Документация Майкрософт
description: Эта статья содержит обзор известных проблем в службе "Миграция Azure" и советы по устранению распространенных ошибок.
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: troubleshooting
ms.date: 03/19/2018
ms.author: raynew
ms.openlocfilehash: b2c89a980411cac02f46bc91d53620bc94fa845b
ms.sourcegitcommit: 6fcd9e220b9cd4cb2d4365de0299bf48fbb18c17
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/05/2018
---
# <a name="troubleshoot-azure-migrate"></a>Устранение неполадок в службе "Миграция Azure"

## <a name="troubleshoot-common-errors"></a>Устранение распространенных ошибок

Служба [Миграция Azure](migrate-overview.md) выполняет оценку локальных рабочих нагрузок для переноса в Azure. Используйте эту статью для устранения неполадок при развертывании и использовании службы "Миграция Azure".


**Сборщик не может подключиться к Интернету**

Это может произойти, если используемый компьютер находится за прокси-сервером. Убедитесь, что вы предоставляете учетные данные авторизации, требуемые прокси-сервером.
При использовании любого прокси-сервера брандмауэра на основе URL-адреса для управления исходящими подключениями, внесите в список этих разрешений требуемые URL-адреса:

**URL-адрес** | **Назначение**  
--- | ---
*.portal.azure.com | Требуется для проверки подключения к службе Azure и проверки с синхронизацией времени.
*.oneget.org | Необходимо скачать модуль PowerCLI vCenter на основе PowerShell.

**Сборщику не удается подключиться к проекту, используя идентификатор и ключ проекта, скопированные на портале.**

Убедитесь, что вы скопировали и вставили правильную информацию. Чтобы устранить неполадки, установите агент Microsoft Monitoring Agent (MMA) и проверьте, может ли MMA подключиться к проекту. Для этого сделайте следующее:

1. Скачайте [MMA](https://go.microsoft.com/fwlink/?LinkId=828603) на виртуальную машину сборщика.
2. Чтобы начать установку, дважды щелкните скачанный файл.
3. В программе установки на странице **приветствия** нажмите кнопку **Далее**. На странице **Условия лицензии** нажмите кнопку **Принимаю**, чтобы принять условия лицензии.
4. В поле **Конечная папка** оставьте или измените папку установки по умолчанию. Нажмите кнопку **Далее**.
5. В разделе **Параметры установки агента** выберите **Azure Log Analytics (OMS)** > **Далее**.
6. Щелкните **Добавить**, чтобы добавить новую рабочую область Log Analytics. Вставьте скопированные идентификатор и ключ проекта. Нажмите кнопку **Далее**.
7. Убедитесь, что агент может подключиться к проекту. Если установить подключение не удается, проверьте параметры. Если агент может подключиться к проекту, но сборщик — нет, обратитесь в службу поддержки.


**Ошибка 802. Возникает ошибка синхронизации даты и времени.**

Часы сервера могут быть не синхронизированы с текущим временем более чем на пять минут. Измените время на виртуальной машине сборщика с соответствии с текущим временем, как показано ниже.

1. Откройте командную строку с правами администратора на этой виртуальной машине.
2. Чтобы проверить часовой пояс, выполните команду w32tm /tz.
3. Чтобы синхронизировать время, выполните команду w32tm /resync.

**Ключ проекта содержит символы "==" в конце. Они кодируются сборщиком в другие буквенно-цифровые знаки. Так и должно быть?**

Да, каждый ключ проекта заканчивается "==". Сборщик шифрует ключ проекта, прежде чем обрабатывать его.

**В данных о производительности дисков и сетевых адаптеров отображаются нули**

Это может произойти, если на сервере vCenter Server задан уровень статистики меньше 3. На уровне 3 или выше vCenter сохраняет журнал производительности виртуальной машины, записывая в него данные о вычислениях, хранилище и сети. Для уровня ниже 3 vCenter не сохраняет данные хранилища и сети, а сохраняет только данные ЦП и памяти. В этом сценарии данные производительности в службе "Миграция Azure" показывают ноль, и она предоставляет рекомендации по размеру дисков и сетей на основе метаданных, собранных из локальных компьютеров.

Чтобы включить сбор данных о производительности дисков и сети, измените параметр уровня статистики на 3. Затем подождите по крайней мере один день. Это требуется, чтобы обнаружить среду и оценить ее.

**Мной были установлены агенты и созданы группы с помощью визуализации зависимостей. Теперь после отработки отказа на компьютере отображается действие "Установить агент" вместо "Просмотреть зависимости"**
* После плановой или внеплановой отработки отказа локальные компьютеры отключаются и запускаются эквивалентные компьютеры в Azure. Эти компьютеры получают другие MAC-адреса. Они могут получить другой IP-адрес, если пользователь не указал сохранение локального IP-адреса. Если MAC-адрес и IP-адрес отличаются, служба "Миграция Azure" не связывает локальные компьютеры с какими-либо данными зависимостей сопоставления служб и предлагает пользователю установить агенты вместо просмотра зависимостей.
* Поле тестовой отработки отказа локальные компьютеры остаются включенными, как ожидается. Каждый эквивалентный компьютер, запускаемый в Azure, получает другой MAC-адрес и может получить другой IP-адрес. Если только пользователь не блокирует исходящий трафик OMS с этих компьютеров, служба "Миграция Azure" не связывает локальные компьютеры с какими-либо данными зависимостей сопоставления служб и предлагает пользователю установить агенты вместо просмотра зависимостей.


## <a name="troubleshoot-readiness-issues"></a>Устранение проблемы готовности

**Проблема** | **Исправление**
--- | ---
Неподдерживаемый тип загрузки | Azure не поддерживает виртуальные машины с типом загрузки EFI. Перед миграцией рекомендуем преобразовать тип загрузки в BIOS. <br/><br/>Для переноса таких виртуальных машин можно использовать [Azure Site Recovery](https://docs.microsoft.com/azure/site-recovery/tutorial-migrate-on-premises-to-azure), так как эта служба в процессе миграции преобразует тип загрузки виртуальной машины в BIOS.
Условно поддерживаемая ОС Windows | Закончился срок поддержки ОС. Для [поддержки в Azure](https://aka.ms/WSosstatement) требуется соглашение Custom Support Agreement (CSA). Перед миграцией в Azure обновите ОС.
Неподдерживаемая версия Windows | Azure поддерживает только [определенные версии ОС Windows](https://aka.ms/WSosstatement). Перед миграцией в Azure обновите ОС на компьютере.
Условно поддерживаемая ОС Linux | Azure поддерживает только [определенные версии ОС Linux](../virtual-machines/linux/endorsed-distros.md). Перед миграцией в Azure обновите ОС на компьютере.
Неподдерживаемая ОС Linux | Компьютер может загружаться в Azure, но установленная на нем ОС в Azure не поддерживается. Перед миграцией в Azure замените ОС одной из [поддерживаемых версий Linux](../virtual-machines/linux/endorsed-distros.md).
Неизвестная операционная система | Операционная система виртуальной машины была указана в vCenter Server как "Другая". Поэтому службе "Миграция Azure" не удалось определить готовность виртуальной машины к работе в Azure. Перед переносом компьютера убедитесь, что запущенная на нем операционная система [поддерживается](https://aka.ms/azureoslist) в Azure.
Неподдерживаемая разрядность ОС | Виртуальные машины с 32-разрядной операционной системой могут загружаться в Azure. Но перед миграцией в Azure рекомендуем обновить ОС виртуальной машины с 32-разрядной на 64-разрядную.
Требуется подписка Visual Studio. | На компьютере выполняется клиентская ОС Windows, которая поддерживается только в подписке Visual Studio.
Не удалось найти хранилище с требуемой производительностью. | Производительность хранилища (число операций ввода-вывода и пропускная способность), необходимая для компьютера, превышает возможности поддерживаемых виртуальных машин Azure. Снизьте требования к хранилищу для компьютера перед выполнением миграции.
Не удалось найти виртуальную машину с требуемой производительностью сети. | Производительность сети (скорость входящего и исходящего трафика), необходимая для компьютера, превышает возможности поддерживаемых виртуальных машин Azure. Уменьшите требования к сети для компьютера.
Не удалось найти виртуальную машину в указанной ценовой категории. | Если установлена ценовая категория "Стандартный", перед миграцией в Azure рекомендуем уменьшить размер виртуальной машины. Если установлена категория размера "Базовый" рекомендуем изменить ценовую категорию оценки на "Стандартный".
Не удалось найти виртуальную машину в указанном расположении. | Используйте другое целевое расположение, прежде чем выполнять миграцию.
Один или несколько неподходящих дисков. | Один или несколько дисков, подключенных к виртуальной машине, не соответствуют требованиям Azure. Размер каждого диска, присоединенного к виртуальной машине, не должен превышать 4 ТБ. Если ваш диск большего размера, сожмите его перед миграцией в Azure. Убедитесь, что [управляемые диски виртуальной машины](https://docs.microsoft.com/azure/azure-subscription-service-limits#storage-limits) Azure поддерживают производительность (операции ввода-вывода в секунду и пропускную способность), которая требуется для каждого диска.   
Один или несколько неподходящих сетевых адаптеров. | Удалите неиспользуемые сетевые адаптеры с компьютера перед миграцией.
Число дисков превышает ограничение | Удалите неиспользуемые диски с компьютера перед миграцией.
Размер диска превышает ограничение | Azure поддерживает диски размером до 4 ТБ. Уменьшите диски до размера менее 4 ТБ перед выполнением миграции.
Диск недоступен в указанном расположении | Убедитесь, что диск доступен в целевом расположении, прежде чем выполнять миграцию.
Недоступен диск для обеспечения указанной избыточности | Диск должен использовать тип избыточности хранилища, указанный в параметрах оценки (по умолчанию — LRS).
Не удалось определить пригодность диска из-за внутренней ошибки | Попробуйте создать новую оценку для группы.
Виртуальная машина с требуемым числом ядер и объемом памяти не найдена | Службе Azure не удалось найти подходящий тип виртуальной машины. Уменьшите объем памяти и число ядер на локальном компьютере, прежде чем выполнять миграцию.
Не удалось определить пригодность виртуальной машины из-за внутренней ошибки. | Попробуйте создать новую оценку для группы.
Не удалось определить пригодность одного или нескольких дисков из-за внутренней ошибки. | Попробуйте создать новую оценку для группы.
Не удалось определить пригодность одного или нескольких сетевых адаптеров из-за внутренней ошибки. | Попробуйте создать новую оценку для группы.


## <a name="collect-logs"></a>Сбор журналов

**Как собирать журналы на виртуальной машине сборщика?**

Ведение журнала включено по умолчанию. Журналы расположены в следующих папках:

- C:\Profiler\ProfilerEngineDB.sqlite
- C:\Profiler\Service.log
- C:\Profiler\WebApp.log

Чтобы собирать данные трассировки событий Windows, выполните следующее.

1. На виртуальной машине сборщика откройте командное окно PowerShell.
2. Выполните команду **Get-EventLog -LogName Application | export-csv eventlog.csv**.

**Как собирать журналы сетевого трафика на портале?**

1. Откройте браузер, перейдите [к порталу](https://portal.azure.com) и войдите в него.
2. Нажмите клавишу F12, чтобы открыть средства для разработчиков. При необходимости снимите флажок **Clear entries on navigation** (Очищать записи при переходе).
3. Щелкните вкладку **Network** (Сеть) и начните сбор журналов сетевого трафика.
 - В Chrome установите флажок **Preserve log** (Сохранить журнал). Запись должна начаться автоматически. Красный кружок указывает, что данные трафика записываются. Если он не отображается, щелкните черный кружок, чтобы начать запись.
 - В Microsoft Edge или Internet Explorer запись должна начаться автоматически. Если это не так, нажмите зеленую кнопку воспроизведения.
4. Попробуйте воспроизвести ошибку.
5. Если при записи возникла ошибка, остановите запись и сохраните копию записанных действий.
 - В Chrome щелкните запись правой кнопкой мыши и выберите **Save as HAR with content** (Сохранить как HAR-файл с содержимым). Журналы будут заархивированы в формате ZIP и экспортированы в виде HAR-файла.
 - В Edge или Internet Explorer щелкните значок **Экспорт собранного трафика**. Журнал будет заархивирован в формате ZIP и экспортирован.
6. Перейдите на вкладку **Консоль**, чтобы проверить наличие предупреждений или ошибок. Чтобы сохранить журнал консоли, сделайте следующее.
 - В Chrome щелкните правой кнопкой мыши в любом месте в журнале консоли. Выберите **Save as** (Сохранить как), чтобы заархивировать журнал в формате ZIP и экспортировать его.
 - В Microsoft Edge или Internet Explorer щелкните правой кнопкой мыши ошибки и выберите **Копировать все**.
7. Закройте средства для разработчиков.


## <a name="vcenter-errors"></a>Ошибки vCenter

### <a name="error-unhandledexception-internal-error-occured-systemiofilenotfoundexception"></a>Ошибка UnhandledException. Произошла внутренняя ошибка: System.IO.FileNotFoundException

Эта проблема возникает в версиях сборщика ниже 1.0.9.5. Вы можете столкнуться с ней при работе в версии сборщика 1.0.9.2 или общедоступной предварительной версии, например 1.0.8.59. Щелкните [эту ссылку, чтобы найти подробный ответ на форумах](https://social.msdn.microsoft.com/Forums/azure/en-US/c1f59456-7ba1-45e7-9d96-bae18112fb52/azure-migrate-connect-to-vcenter-server-error?forum=AzureMigrate).

[Обновите сборщик, чтобы устранить проблему](https://aka.ms/migrate/col/checkforupdates).

### <a name="error-unabletoconnecttoserver"></a>Ошибка UnableToConnectToServer

Не удается подключиться к vCenter Server Servername.com:9443 из-за ошибки: "There was no endpoint listening at https://Servername.com:9443/sdk that could accept the message" (Ни одна конечная точка, которая могла бы принять сообщение, не ожидала передачи данных по адресу https://Servername.com:9443/sdk).

Это происходит, если компьютеру сборщика не удается разрешить указанное имя сервера vCenter Server или порт указан неправильно. Если порт не указан, сборщик по умолчанию будет пытаться подключиться к порту 443.

1. Попробуйте проверить связь с сайтом Servername.com с компьютера сборщика.
2. Если не удается выполнить шаг 1, попробуйте подключиться к серверу vCenter Server по IP-адресу.
3. Определите правильный номер порта для подключения к серверу vCenter Server.
4. Наконец, проверьте, работает ли сервер vCenter Server.

## <a name="collector-error-codes-and-recommended-actions"></a>Коды ошибок сборщика и рекомендуемые действия

|           |                                |                                                                               |                                                                                                       |                                                                                                                                            | 
|-----------|--------------------------------|-------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------| 
| Код ошибки | Имя ошибки                      | Сообщение                                                                       | Возможные причины                                                                                        | Рекомендуемое действие                                                                                                                          | 
| 601       | CollectorExpired               | Истек срок действия сборщика.                                                        | Срок действия сборщика истек.                                                                                    | Скачайте новую версию сборщика и повторите попытку.                                                                                      | 
| 751       | UnableToConnectToServer        | Не удалось подключиться к vCenter Server "%Имя;" из-за ошибки: %Сообщение_об_ошибке;     | Дополнительные сведения приводятся в сообщении об ошибке.                                                             | Устраните указанную проблему и повторите попытку.                                                                                                           | 
| 752       | InvalidvCenterEndpoint         | Сервер "%Имя;" не является сервером vCenter Server.                                  | Предоставьте сведения о vCenter Server.                                                                       | Повторите операцию с правильной информацией о vCenter Server.                                                                                   | 
| 753       | InvalidLoginCredentials        | Не удалось подключиться к vCenter Server "%Имя;" из-за ошибки: %Сообщение_об_ошибке; | Не удалось подключиться к vCenter Server, так как указаны недействительные учетные данные для входа.                             | Укажите правильные учетные данные для входа.                                                                                    | 
| 754       | NoPerfDataAvaialable           | Данные о производительности недоступны.                                               | Проверьте уровень статистики в vCenter Server. Чтобы предоставлялись данные производительности, здесь должен быть указан уровень 3. | Установите уровень статистики 3 (на 5 минут, 30 минут или на 2 часа) и повторите попытку примерно через сутки.                   | 
| 756       | NullInstanceUUID               | Обнаружен компьютер со значением NULL для InstanceUUID                                  | Возможно, в vCenter Server существует недопустимый объект.                                                      | Устраните указанную проблему и повторите попытку.                                                                                                           | 
| 757       | VMNotFound                     | Виртуальная машине не найдена                                                  | Возможно, виртуальная машина %VMID; удалена                                                                | Убедитесь, что в период обнаружения существуют виртуальные машины, выбранные для области vCenter                                      | 
| 758       | GetPerfDataTimeout             | Истекло время ожидания запроса VCenter. Сообщение %Сообщение;                                  | Неправильные учетные данные для vCenter Server.                                                              | Проверьте учетные данные vCenter Server и убедитесь, что vCenter Server доступен. Повторите операцию. Если проблема не исчезла, обратитесь в службу поддержки. | 
| 759       | VmwareDllNotFound              | Библиотека DLL VMWare.Vim не найдена.                                                     | PowerCLI установлен неправильно.                                                                   | Проверьте, правильно ли установлен PowerCLI. Повторите операцию. Если проблема не исчезла, обратитесь в службу поддержки.                               | 
| 800       | ServiceError                   | Служба Сборщика Миграции Azure не запущена.                               | Служба Сборщика Миграции Azure не запущена.                                                       | Примените оснастку services.msc, чтобы запустить эту службу, затем повторите операцию.                                                                             | 
| 801       | PowerCLIError                  | Не удалось установить VMware PowerCLI.                                          | Не удалось установить VMware PowerCLI.                                                                  | Повторите операцию. Если проблема повторится, установите службу вручную и повторите операцию.                                                   | 
| 802       | TimeSyncError                  | Время не синхронизировано с сервером времени в Интернете.                            | Время не синхронизировано с сервером времени в Интернете.                                                    | Убедитесь, что время на компьютере указано верно с учетом часового пояса, затем повторите операцию.                                 | 
| 702       | OMSInvalidProjectKey           | Указан недопустимый ключ проекта.                                                | Указан недопустимый ключ проекта.                                                                        | Повторите операцию с правильным ключом проекта.                                                                                              | 
| 703       | OMSHttpRequestException        | Ошибка при отправке запроса. Сообщение %Сообщение;                                | Проверьте идентификатор и ключ проекта, а также убедитесь, что конечная точка доступна.                                       | Повторите операцию. Если проблема будет повторяться, обратитесь в службу поддержки Майкрософт.                                                                     | 
| 704       | OMSHttpRequestTimeoutException | Истекло время ожидания запроса HTTP. Сообщение %Сообщение;                                     | Проверьте идентификатор и ключ проекта, а также убедитесь, что конечная точка доступна.                                       | Повторите операцию. Если проблема будет повторяться, обратитесь в службу поддержки Майкрософт.                                                                     | 
