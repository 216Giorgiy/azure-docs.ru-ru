---
title: Сведения о модуле сборщика в службе "Миграция Azure" | Документация Майкрософт
description: В этой статье объясняется, как использовать модуль сборщика в службе "Миграция Azure".
author: snehaamicrosoft
ms.service: azure-migrate
ms.topic: conceptual
ms.date: 10/30/2018
ms.author: snehaa
services: azure-migrate
ms.openlocfilehash: 81e6731068db84f02073f02c49bea9a8fb7c7c70
ms.sourcegitcommit: dbfd977100b22699823ad8bf03e0b75e9796615f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2018
ms.locfileid: "50241197"
---
# <a name="about-the-collector-appliance"></a>Сведения о модуле сборщика

 Данная статья содержит информацию о Сборщике Миграции Azure.

Сборщик Миграции Azure — это простой модуль, который можно использовать для обнаружения локального окружения vCenter для оценки с помощью службы [Миграция Azure](migrate-overview.md) перед миграцией в Azure.  

## <a name="discovery-methods"></a>Методы обнаружения

Существует два метода модуля сборщика: однократное или непрерывное обнаружение.

### <a name="one-time-discovery"></a>Однократное обнаружение

Модуль сборщика единовременно взаимодействует с vCenter Server для сбора метаданных о виртуальных машинах. При использовании этого метода:

- Модуль не подключен непрерывно к проекту "Миграция Azure".
- Изменения в локальной среде не отражаются в Миграции Azure после завершения обнаружения. Чтобы отразить любые изменения, вам нужно снова обнаружить ту же среду в одном проекте.
- При сборе данных о производительности для виртуальной машины модуль использует исторические данные о производительности, хранящиеся в vCenter Server. Он собирает журнал производительности за прошлый месяц.
- Для архива сбора данных о рабочих характеристиках необходимо установить параметры статистики в vCenter Server уровень 3. После установки уровня 3 необходимо подождать по крайней мере один день, чтобы vCenter собрал данные счетчиков производительности. Рекомендуется выполнить обнаружение через один день. Если вы хотите оценить среды на основе данных производительности за неделю или месяц, необходимо подождать.
- В этом методе обнаружения служба "Миграция Azure" собирает для каждой метрики средние счетчики (не пиковые счетчики), что может привести к уменьшению размера. Чтобы получить более точные размеры результатов, рекомендуется использовать параметр непрерывного обнаружения.

### <a name="continuous-discovery"></a>Непрерывное обнаружение

Модуль сборщика непрерывно подключен к проекту службы "Миграция Azure" и непрерывно собирает данные о производительности виртуальных машин.

- Сборщик постоянно профилирует локальную среду для сбора данных об использовании в режиме реального времени каждые 20 секунд.
- Модуль загружает 20-секундные образцы и создает одну точку данных каждые 15 минут.
- Чтобы создать точку данных, модуль выбирает пиковое значение из 20-секундных образцов и отправляет его в Azure.
- Эта модель не зависит от параметров статистики сервера vCenter Server для сбора данных о производительности.
- Вы можете остановить непрерывное профилирование в любое время в Сборщике.

Обратите внимание, что модуль только непрерывно собирает данные о производительности. Он не обнаруживает изменения конфигурации в локальной среде (например, добавление, удаление виртуальной машины, добавление диска и т. д.). Если в локальной среде была изменена конфигурация и вам нужно отразить эти изменения на портале, сделайте следующее:

- Добавление элементов (виртуальных машин, дисков, ядер и т. д.). Чтобы отразить эти изменения на портале Azure, вы можете остановить обнаружение с модуля, а затем запустить его снова. Это позволит обновить изменения в проекте "Миграция Azure".

- Удаление виртуальных машин. Из-за особенностей конструкции модуля удаление виртуальных машин не отражается даже при остановке и повторном запуске обнаружения. Это связано с тем, что данные из последующих обнаружений добавляются к более старым обнаружениям, а не переопределяются. В этом случае вы можете просто игнорировать виртуальную машину на портале, удалив ее из своей группы и пересчитав оценку.

> [!NOTE]
> Функция непрерывного обнаружения доступна в предварительной версии. Рекомендуем использовать этот метод, так как он собирает детализированные данные о производительности и приводит к выбору оптимальной конфигурации.

## <a name="deploying-the-collector"></a>Развертывание Сборщика

Модуль сборщика развертывается с использованием шаблона OVF:

- Скачайте шаблон OVF из проекта "Миграция Azure" на портале Azure. Импортируйте скачанный файл на сервер vCenter Server, чтобы настроить виртуальную машину модуля сборщика.
- Из файла OVF VMware настраивает виртуальную машину с 4 ядрами, 8 ГБ ОЗУ и 1 диском размером 80 ГБ. Используется ОС Windows Server 2012 R2 (64-разрядная версия).
- При запуске Сборщика для проверки возможности подключения к службе "Миграция Azure" выполняется ряд предварительных проверок.

- [Дополнительные сведения](tutorial-assessment-vmware.md#create-the-collector-vm) о создании Сборщика.


## <a name="collector-prerequisites"></a>Предварительные требования для Сборщика

Сборщик должен пройти несколько проверок предварительных требований, чтобы он мог подключиться к службе "Миграция Azure" по Интернету и отправлять обнаруженные данные.

- **Проверьте подключение к Интернету**. Сборщик может подключиться к Интернету напрямую или через прокси-сервер.
    - Проверяется подключение к [обязательным и необязательным URL-адресам](#connect-to-urls).
    - Если у вас есть прямое подключение к Интернету, никаких конкретных действий не требуется — только проверка того, что Сборщик может подключиться к требуемым URL-адресам.
    - В случае подключения через прокси-сервер обратите внимание на [приведенные ниже требования](#connect-via-a-proxy).
- **Проверьте синхронизацию времени**. Сборщик нужно синхронизировать с сервером времени в Интернете, чтобы обеспечить аутентификацию запросов к службе.
    - Чтобы проверить время, URL-адрес portal.azure.com должен быть доступен для сборщика.
    - Если виртуальная машина не синхронизирована, измените время на виртуальной машине со Сборщиком в соответствии с текущим временем. Чтобы проверить часовой пояс, откройте командную строку с правами администратора на этой виртуальной машине и выполните команду **w32tm /tz**. Чтобы синхронизировать время, выполните команду **w32tm /resync**.
- **Проверьте запуск службы сборщика**. Служба "Сборщик Миграции Azure" должна быть запущена на виртуальной машине со Сборщиком.
    - Служба запускается автоматически после загрузки виртуальной машины.
    - Если служба не запущена, запустите ее с помощью панели управления.
    - Служба сборщика отвечает за подключение к серверу vCenter Server, сбор метаданных и данных о производительности виртуальной машины и их отправку в службу "Миграция Azure".
- **Проверьте установку VMware PowerCLI 6.5**. Чтобы Сборщик мог обмениваться данными с сервером vCenter Server, нужно установить модуль PowerShell VMware PowerCLI 6.5.
    - Если Сборщик может получить доступ к URL-адресам, необходимым для установки модуля, модуль устанавливается автоматически во время развертывания Сборщика.
    - В противном случае вам придется установить [модуль вручную](#install-vwware-powercli-module-manually).
- **Проверьте подключение к vCenter Server**. Сборщик должен быть подключен к vCenter Server и иметь возможность отправлять запросы к виртуальным машинам (запрашивать их метаданные и данные счетчиков производительности). [Проверьте предварительные требования](#connect-to-vcenter-server) для подключения.


### <a name="connect-to-the-internet-via-a-proxy"></a>Подключение к Интернету через прокси-сервер

- Если для прокси-сервера требуется аутентификация, можно указать имя пользователя и пароль при настройке Сборщика.
- IP-адрес или полное доменное имя прокси-сервера должны иметь формат *http://IPaddress* или *http://FQDN*.
- Поддерживается только прокси-сервер HTTP. Сборщик не поддерживает прокси-серверы на основе HTTPS.
- Если прокси-сервер является перехватчиком, необходимо импортировать его сертификат на виртуальную машину со Сборщиком.
    1. В виртуальной машине со Сборщиком перейдите в меню **Пуск** > **Управление сертификатами компьютеров**.
    2. В средстве "Сертификаты" в разделе **Сертификаты — локальный компьютер** найдите **Доверенные издатели** > **Сертификаты**.

        ![Средство "Сертификаты"](./media/concepts-intercepting-proxy/certificates-tool.png)

    3. Скопируйте сертификат прокси-сервера в виртуальную машину со Сборщиком. Вам может потребоваться получить его от сетевого администратора.
    4. Дважды щелкните сертификат и нажмите кнопку **Установить сертификат**.
    5. В мастере импорта сертификатов для параметра "Расположение хранилища" выберите **Локальный компьютер**.

    ![Расположение хранилища сертификатов](./media/concepts-intercepting-proxy/certificate-store-location.png)

    6. Выберите **Поместить все сертификаты в следующее хранилище** > **Обзор** > **Доверенные издатели**. Нажмите кнопку **Готово** , чтобы импортировать сертификат.

    ![Хранилище сертификатов](./media/concepts-intercepting-proxy/certificate-store.png)

    7. Убедитесь, что сертификат импортирован, как и ожидалось, и проверьте, что предварительная проверка подключения к Интернету выполнена должным образом.




### <a name="connect-to-urls"></a>Подключение к URL-адресам

Проверка подключения производится с помощью подключения к URL-адресам из списка.

**URL-адрес** | **Дополнительные сведения**  | **Проверка предварительных требований**
--- | --- | ---
*.portal.azure.com | Проверяется возможность подключения со службой Azure и синхронизация времени. | Проверьте доступ к нужному URL-адресу.<br/><br/> Если подключение отсутствует, проверка завершается ошибкой.
*.oneget.org:443<br/><br/> *.windows.net:443<br/><br/> *.windowsazure.com:443<br/><br/> *.powershellgallery.com:443<br/><br/> *.msecnd.net:443<br/><br/> *.visualstudio.com:443| Необходимо загрузить модуль PowerCLI vCenter на основе PowerShell. | Проверьте доступ к необязательным URL-адресам.<br/><br/> Проверка предварительных требований не завершится сбоем.<br/><br/> Автоматическая установка модуля на виртуальную машину со Сборщиком завершится сбоем. Вам придется установить модуль вручную.


### <a name="install-vmware-powercli-module-manually"></a>Установка модуля VMware PowerCLI вручную

1. Установите модуль, используя [эти шаги](https://blogs.vmware.com/PowerCLI/2017/04/powercli-install-process-powershell-gallery.html). В этих шагах описывается установка в сетевом и автономном режимах.
2. Если виртуальная машина со Сборщиком находится в автономном режиме и модуль устанавливается на другой компьютер с доступом в Интернет, необходимо скопировать файлы VMware.* с этого компьютера на виртуальную машину со Сборщиком.
3. После установки вы можете перезапустить предварительные проверки, чтобы подтвердить, что PowerCLI установлен.

### <a name="connect-to-vcenter-server"></a>Подключение к vCenter Server

Сборщик подключается к vCenter Server и запрашивает метаданные виртуальной машины и счетчики производительности. Вот что нужно для этого подключения:

- Поддерживаются только версии vCenter Server 5.5, 6.0 и 6.5.
- Для обнаружения вам нужна учетная запись только для чтения с разрешениями, приведенными ниже. Для обнаружения можно получить доступ только к тем центрам обработки данных, которые доступны в рамках этой учетной записи.
- По умолчанию к vCenter Server можно подключиться с помощью полного доменного имени или IP-адреса. Если vCenter Server прослушивает другой порт, можно подключиться к нему, используя формат *IP-адрес:номер_порта* или *FQDN:номер_порта*.
- Чтобы собирать данные о производительности для хранилища и сети, для параметров статистики vCenter Server необходимо установить уровень 3.
- Если уровень ниже 3, обнаружение будет работать, но данные о производительности собираться не будут. Некоторые счетчики могут быть собраны, но другие будут установлены на ноль.
- Если данные о производительности хранилища и сети не собираются, рекомендации по объему оценки будут основаны на данных о производительности ЦП и памяти, а также конфигурации диска и сетевых адаптеров.
- Для сборщика требуется сеть, по которой он сможет напрямую подключаться к серверу vCenter.

#### <a name="account-permissions"></a>Разрешения учетной записи

**Учетная запись.** | **Разрешения**
--- | ---
Учетная запись пользователя с правами только для чтения (минимум) | Объект центра обработки данных –> Распространение на дочерний объект, роль Read-only   


## <a name="collector-communications"></a>Обмен данными, выполняемый Сборщиком

Сборщик обменивается данными, как показано на следующей схеме и описано в таблице.

![Схема связей сборщика](./media/tutorial-assessment-vmware/portdiagram.PNG)


**С чем взаимодействует Сборщик** | **Порт** | **Дополнительные сведения**
--- | --- | ---
со службой "Миграция Azure" | TCP 443 | Сборщик взаимодействует со службой "Миграция Azure" через порт 443 по протоколу SSL.
с сервером vCenter | TCP 443 | Сборщик должен иметь возможность взаимодействовать с сервером vCenter.<br/><br/> По умолчанию он подключается к vCenter через порт 443.<br/><br/> Если vCenter Server ожидает передачи данных на другом порте, на Сборщике этот порт должен быть доступен как исходящий.
RDP | TCP 3389 |


## <a name="securing-the-collector-appliance"></a>Обеспечение безопасности модуля сборщика

Рекомендуем выполнить описанные ниже действия для защиты модуля сборщика.

- Не предоставляйте пароли администратора неавторизованным лицам и не помещайте такие пароли в ненадлежащих расположениях.
- Завершайте работу модуля, когда он не используется.
- Подключите модуль к защищенной сети.
- По завершении миграции удалите экземпляр модуля.
- Кроме того, не забудьте также удалить резервные копии дисков (VMDK), так как на дисках могут храниться кэшированные учетные данные vCenter.

## <a name="os-license-in-the-collector-vm"></a>Лицензия ОС на виртуальной машине со Сборщиком

Сборщик данных поставляется с оценочной лицензией Windows Server 2012 R2, которая действительна в течение 180 дней. Если срок действия ознакомительного периода для виртуальной машины со Сборщиком истекает, рекомендуется скачать новый OVA-файл и создать новый модуль.

## <a name="updating-the-os-of-the-collector-vm"></a>Обновление операционной системы на виртуальной машине со Сборщиком

Несмотря на то что модуль сборщика имеет лицензию на пробное использование в течение 180 дней, вам нужно постоянно обновлять ОС в модуле, чтобы избежать автоматического завершения его работы.

- Если Сборщик не обновляется в течение 60 дней, он запускает автоматическое завершение работы компьютера.
- Если выполняется обнаружение, компьютер не будет отключен, даже если прошло 60 дней. Когда задание обнаружения будет завершено, компьютер отключится.
- Если Сборщик используется более 60 дней, рекомендуем постоянно поддерживать компьютер в обновленном состоянии, запуская средство обновления Windows.

## <a name="upgrading-the-collector-appliance-version"></a>Обновление версии модуля сборщика

Сборщик можно обновить до последней версии, не скачивая OVA-файл повторно.

1. Скачайте [пакет обновления](concepts-collector-upgrade.md) последней версии.
2. Чтобы обеспечить защиту скачиваемых исправлений, откройте командное окно от имени администратора и выполните указанную ниже команду для создания хэша ZIP-файла. Созданный хэш должен совпадать с хэшем, предусмотренным для определенной версии:

    ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```

    (Пример использования: C:\>CertUtil -HashFile C:\AzureMigrate\CollectorUpdate_release_1.0.9.14.zip SHA256.)
3. Скопируйте ZIP-файл на виртуальную машину сборщика службы "Миграция Azure" (модуль сборщика).
4. Щелкните ZIP-файл правой кнопкой мыши и выберите "Извлечь все".
5. Щелкните файл Setup.ps1 правой кнопкой мыши и выберите Run with PowerShell (Запуск с помощью PowerShell), а затем следуйте инструкциям на экране, чтобы установить обновление.

## <a name="discovery-process"></a>Процесс обнаружения

После настройки модуля можно запустить обнаружение. Вот как это работает:

- Запускайте обнаружение по областям. Будут обнаружены все виртуальные машины в указанном пути инвентаризации vCenter.
    - Одновременно задавайте только одну область.
    - Область может включать в себя 1500 виртуальных машин или меньше.
    - Областью может быть центр обработки данных, папка или узел ESXi.
- После соединения с vCenter Server можно подключиться, указав проект миграции для сбора.
- Виртуальные машины обнаруживаются, а их метаданные и данные о производительности отправляются в Azure. Эти действия являются частью задания сбора.
    - Модулю сборщика предоставляется определенный идентификатор, который сохраняется для отдельной машины во всех обнаружениях.
    - Выполняемому заданию коллекции присваивается идентификатор конкретного сеанса. Идентификатор изменяется для каждого задания сбора и может использоваться для устранения неполадок.

### <a name="collected-metadata"></a>Собранные метаданные

Модуль сборщика обнаруживает следующие статические метаданные для виртуальных машин:

- Отображаемое имя виртуальной машины (в vCenter Server).
- Путь инвентаризации виртуальной машины (узел или папка на сервере vCenter Server).
- IP-адрес
- MAC-адрес.
- Операционная система
- Число ядер, дисков и сетевых адаптеров.
- Объем памяти, размеры диска.
- Счетчики производительности виртуальной машины, диска и сети.

#### <a name="performance-counters"></a>Счетчики производительности

- **Однократное обнаружение**: когда данные счетчиков собираются для однократного обнаружения, обратите внимание на следующее:

    - Сбор и отправка метаданных конфигурации в проект может занять до 15 минут.
    - После сбора данных конфигурации данные о производительности станут доступны на портале в течение часа.
    - После того как метаданные станут доступны на портале, появится список виртуальных машин, и вы можете начать создавать группы для оценки.
- **Непрерывное обнаружение**: для непрерывного обнаружения обратите внимание на следующее:
    - Данные конфигурации для виртуальной машины станут доступны в течение часа после запуска обнаружения.
    - Данные о производительности станут доступными через 2 часа.
    - После запуска обнаружения подождите по крайней мере один день, чтобы модуль создал профиль среды, прежде чем создавать оценки.

**Счетчик** | **Level** | **Уровень каждого устройства** | **Влияние на оценку**
--- | --- | --- | ---
cpu.usage.average | 1 | Нет данных | Рекомендуемый размер и стоимость виртуальной машины  
mem.usage.average | 1 | Нет данных | Рекомендуемый размер и стоимость виртуальной машины  
virtualDisk.read.average | 2 | 2 | Вычисляет размер диска, затраты на хранение и размер виртуальной машины
virtualDisk.write.average | 2 | 2  | Вычисляет размер диска, затраты на хранение и размер виртуальной машины
virtualDisk.numberReadAveraged.average | 1 | 3 |  Вычисляет размер диска, затраты на хранение и размер виртуальной машины
virtualDisk.numberWriteAveraged.average | 1 | 3 |   Вычисляет размер диска, затраты на хранение и размер виртуальной машины
net.received.average | 2 | 3 |  Вычисляет размер виртуальной машины                          |
net.transmitted.average | 2 | 3 | Вычисляет размер виртуальной машины     

## <a name="next-steps"></a>Дополнительная информация

[Настройка оценки локальных виртуальных машин VMware](tutorial-assessment-vmware.md)
