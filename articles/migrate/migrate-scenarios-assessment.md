---
title: Оценка готовности локальных рабочих нагрузок к миграции в Azure с помощью службы "Миграция Azure" и помощника по миграции данных | Документация Майкрософт
description: Узнайте, как подготовить Azure для миграции локальных компьютеров с помощью помощника по миграции данных (DMA) и службы "Миграция Azure".
services: site-recovery
author: rayne-wiselman
ms.service: site-recovery
ms.topic: tutorial
ms.date: 04/16/2018
ms.author: raynew
ms.custom: MVC
ms.openlocfilehash: 1ac6c3e428148a6609b264b0b8f8cff416b0fa4d
ms.sourcegitcommit: 1362e3d6961bdeaebed7fb342c7b0b34f6f6417a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/18/2018
---
# <a name="scenario-1-assess-on-premises-workloads-for-migration-to-azure"></a>Сценарий 1. Оценка готовности локальных рабочих нагрузок к миграции в Azure

Компания Contoso хочет провести техническую и финансовую оценку, чтобы выяснить, подходят ли их рабочие нагрузки для миграции в облако Azure. В частности, компания хочет оценить совместимость компьютеров и баз данных для миграции и оценить емкость и затраты на управление своими ресурсами в Azure.

Чтобы попробовать и лучше понять используемые технологии, компания оценивает и переносит небольшое локальное приложение для путешествий. Это двухуровневое приложение с веб-приложением на одной виртуальной машине и базой данных SQL Server на второй. Приложение развертывается в VMware, а управление средой осуществляется с помощью сервера vCenter Server. Оценка будет выполняться с помощью помощника по миграции данных (DMA) и службы "Миграция Azure".

**Технология** | **Описание** | **Стоимость**
--- | --- | ---
[DMA](https://docs.microsoft.com/sql/dma/dma-overview?view=ssdt-18vs2017) | DMA оценивает и обнаруживает проблемы совместимости, которые могут повлиять на функциональность базы данных в Azure. Он также оценивает равенство функций между исходным и целевым серверами SQL Server и предоставляет рекомендации по улучшению производительности и надежности вашей целевой среды. | Это средство можно загрузить бесплатно. 
[Миграция Azure](https://docs.microsoft.com/azure/migrate/migrate-overview) | Служба помогает оценить готовность локальных компьютеров к миграции в Azure Она оценивает пригодность компьютеров для миграции и предоставляет оценку размеров и стоимости для работы в Azure. Сейчас для перехода на виртуальные машины Azure служба "Миграция Azure" может оценить только локальные виртуальные машины VMware. | В настоящее время (апрель 2018 года) за использование этой службы не взимается плата.
[Схема услуги](https://docs.microsoft.com/azure/operations-management-suite/operations-management-suite-service-map) | Служба "Миграция Azure" использует решение "Сопоставление служб" для отображения зависимостей между компьютерами, которые вы хотите перенести. |  Это решение является частью службы Azure Log Analytics. Его можно использовать в течение 180 дней без каких-либо затрат. 

В этом сценарии мы загрузим и запустим DMA для оценки локальной базы данных SQL Server нашего туристического приложения. Мы будем использовать службу "Миграция Azure" с сопоставлением зависимостей для оценки виртуальных машин приложения, прежде чем переносить их в Azure.

> [!NOTE]
> В этом сценарии целью нашей оценки базы данных будет "SQL Server на виртуальной машине Azure". Однако в статье со следующим сценарием мы выполним миграцию в управляемый экземпляр SQL Azure. Мы используем этот подход, так как DMA в настоящее время не поддерживает оценку целевого управляемого экземпляра SQL Azure.

## <a name="architecture"></a>Архитектура

В этом сценарии мы настроим 

 ![Архитектура оценки миграции](./media/migrate-scenarios-assessment/migration-assessment-architecture.png)

В этом сценарии:
- Contoso использует локальный центр обработки данных (**contoso-datacenter**) с локальным контроллером домена (**contosodc1**).
- Внутреннее туристическое приложение расположено на нескольких виртуальных машинах (**WEBVM** и **SQLVM**) и находится на узле VMware ESXi **contosohost1.contoso.com**.
- Средой VMware управляет сервер vCenter Server (**vcenter.contoso.com**), который запущен на виртуальной машине.




## <a name="prerequisites"></a>предварительным требованиям

Для развертывания этого сценария вам потребуются следующие компоненты:

- Локальный сервер vCenter Server версии 5.5, 6.0 или 6.5.
- Учетная запись только для чтения на сервере vCenter Server или разрешения на ее создание. 
- Разрешения на создание виртуальной машины на сервере vCenter Server с использованием шаблона в формате OVA.
- По крайней мере один узел ESXi версии 5.0 или выше.
- По крайней мере две виртуальные машины VMware, на одной из который выполняется база данных SQL Server.
- У вас должны быть разрешения на установку агентов службы "Миграция Azure" на каждой виртуальной машине.
- Виртуальные машины должны иметь прямое подключение к Интернету.
        Вы можете ограничить доступ к [требуемым URL-адресам](https://docs.microsoft.com/azure/migrate/concepts-collector#collector-pre-requisites) в Интернете.
        Если у вас есть компьютеры без подключения к Интернету, на них необходимо загрузить и установить [шлюз OMS](../log-analytics/log-analytics-oms-gateway.md).
- Полное доменное имя виртуальной машины, на которой запущен экземпляр SQL Server, для оценки базы данных.
- Чтобы DMA мог подключиться, брандмауэр Windows, работающий на виртуальной машине SQL Server, должен разрешать внешние подключения по TCP-порту 1433 (по умолчанию).


## <a name="scenario-overview"></a>Обзор сценария

Вот что мы собираемся делать:


> [!div class="checklist"]
> * **Шаг 1. Подготовка Azure**. Вам понадобится подписка Azure.
> * **Шаг 2. Скачивание и установка DMA**. Подготовка DMA для оценки локальной базы данных SQL Server.
> * **Шаг 3. Оценка базы данных**. Запуск и анализ оценки базы данных.
> * **Шаг 4. Подготовка к оценке виртуальной машины с помощью службы "Миграция Azure"**. Настройка локальных учетных записей и параметров VMware.
> * **Шаг 5. Поиск локальных виртуальных машин**. Создание виртуальной машины сборщика службы "Миграция Azure". Затем мы запустим сборщик, чтобы обнаружить виртуальные машины для оценки.
> * **Шаг 6. Подготовка к анализу зависимостей** . Установка агентов службы "Миграция Azure" на виртуальных машинах, чтобы получить сопоставление зависимостей между виртуальными машинами.
> * **Шаг 7. Оценка виртуальных машин**. Проверка зависимостей, группировка виртуальных машин и выполнение оценки. После того как оценка будет выполнена, проанализируйте ее в процессе подготовки к миграции.


## <a name="step-1-prepare-azure"></a>Шаг 1. Подготовка Azure

Если у вас еще нет подписки Azure, создайте [бесплатную учетную запись Azure](https://azure.microsoft.com/pricing/free-trial/).

- Если вы создаете бесплатную учетную запись, вы являетесь администратором своей подписки и можете выполнять любые действия.
- Если вы используете существующую подписку, в которой не являетесь администратором, администратор должен назначить вам права владельца или участника подписки или группы ресурсов, которую вы используете в этом сценарии.


## <a name="step-2-download-and-install-the-dma"></a>Шаг 2. Скачивание и установка DMA

1. Загрузите DMA из [Центра загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=53595).
    - Вы можете установить помощник на любом компьютере, который может подключиться к экземпляру SQL. Вам не нужно запускать его на компьютере SQL Server.
    - Его также не следует запускать на хост-компьютере SQL Server.
2. Дважды щелкните загруженный файл (DownloadMigrationAssistant.msi), чтобы начать установку.
3. На странице **Готово** установите флажок **Launch Microsoft Data Migration Assistant** (Запустить помощник по миграции данных Майкрософт) и нажмите кнопку **Готово**.

## <a name="step-3-run-and-analyze-the-database-assessment"></a>Шаг 3. Запуск и анализ оценки базы данных

Запустите оценку, чтобы проанализировать исходный экземпляр SQL Server по отношению к указанному целевому объекту.

1. На вкладке **Создание** выберите **Оценка** и введите имя проекта оценки.
2. В поле **Source server type** (Тип исходного сервера) выберите **SQL Server**. В поле **Target server type** (Тип целевого сервера) выберите **SQL Server on Azure Virtual Machines** (SQL Server на виртуальных машинах Azure).

    ![Выбор источника](./media/migrate-scenarios-assessment/dma-assessment-1.png)

    > [!NOTE]
      В настоящее время DMA не поддерживает оценку для перехода на управляемый экземпляр SQL. В качестве возможного решения можно использовать SQL Server на виртуальной машине Azure в качестве предполагаемого целевого объекта оценки.

1.  В поле **Выберите целевую версию** укажите целевую версию SQL Server, которую вы хотите запустить в Azure, и выберите дополнительные параметры оценки:
    - Параметр **Проблемы совместимости** позволяет узнать об изменениях, которые могут прервать миграцию или для которых потребуется незначительная корректировка перед миграцией. Он также сообщает об используемых функциях, которые устарели. Проблемы упорядочены по уровню совместимости. 
    - Параметр **Рекомендации по новым функциям** сообщает о новых возможностях целевой платформы SQL Server, которые можно использовать в базе данных после миграции. Они упорядочены по производительности, безопасности и типам хранилища. 

    ![Выбор цели](./media/migrate-scenarios-assessment/dma-assessment-2.png)

2. В окне **Connect to a server** (Подключение к серверу) укажите имя компьютера с экземпляром SQL Server, тип проверки подлинности и сведения о подключении. Щелкните **Подключить**.

    ![Выбор цели](./media/migrate-scenarios-assessment/dma-assessment-3.png)
    
3. В окне **Добавить источник** выберите базу данных, которую вы хотите оценить, и нажмите кнопку **Добавить**.
4. Создается оценка с указанным именем.

    ![Создание оценки](./media/migrate-scenarios-assessment/dma-assessment-4.png)

5.  Нажмите кнопку **Далее** для запуска оценки.
6. На вкладке **Просмотр результатов** вы увидите результаты проверок оценки, которые вы выбрали.


### <a name="analyze-the-database-assessment"></a>Анализ оценки базы данных

Результаты отобразятся в помощнике, как только будут доступны. 

1. В отчете **Проблемы совместимости** проверьте, есть ли у вашей базы данных проблемы по каждому уровню совместимости и способы их устранения. Уровни совместимости сопоставляются с версиями SQL Server следующим образом:
    - 100: SQL Server 2008/база данных SQL Azure
    - 110: SQL Server 2012/база данных SQL Azure
    - 120: SQL Server 2014/база данных SQL Azure
    - 130: SQL Server 2016/база данных SQL Azure
    - 140: SQL Server 2017/база данных SQL Azure

    ![Проблемы совместимости](./media/migrate-scenarios-assessment/dma-assessment-5.png)

2. В отчете **Рекомендуемые возможности** просмотрите функции для обеспечения производительности и безопасности, а также возможности хранения, которые рекомендуется настроить после миграции. Рекомендуется использовать различные функции, в том числе выполняющуюся в памяти OLTP и columnstore, Stretch Database, Always Encrypted, динамическое маскирование данных и прозрачное шифрование данных.

    ![Рекомендуемые возможности](./media/migrate-scenarios-assessment/dma-assessment-6.png)

3. Чтобы исправить какие-либо проблемы, щелкните **Перезапустить оценку** для повторного перезапуска. 
4. Щелкните **Экспортировать отчет**, чтобы получить отчет об оценке в формате JSON или CSV.

Если вы проводите более масштабную оценку:

- Вы можете одновременно выполнить несколько оценок и просмотреть их состояние, открыв страницу **​All Assessments** (Все оценки).
- Вы можете [консолидировать оценки в базе данных SQL Server](https://docs.microsoft.com/sql/dma/dma-consolidatereports?view=ssdt-18vs2017#import-assessment-results-into-a-sql-server-database).
- Вы можете [консолидировать оценки в отчете PowerBI](https://docs.microsoft.com/sql/dma/dma-powerbiassesreport?view=ssdt-18vs2017).


## <a name="step-4-prepare-for-vm-assessment-with-azure-migrate"></a>Шаг 4. Подготовка к оценке виртуальных машин с помощью службы "Миграция Azure"

Создайте учетную запись VMware, которую служба "Миграция Azure" будет использовать для автоматического обнаружения виртуальных машин для оценки. Убедитесь, что у вас есть разрешения на создание виртуальной машины, обратите внимание на порты, которые должны быть открыты, и установите уровень параметров статистики.

### <a name="set-up-a-vmware-account"></a>Настройка учетной записи VMware

 Вам потребуется учетная запись только для чтения в vCenter. Если у вас ее нет, создайте учетную запись VMware со следующими свойствами.

- Потребуется по крайней мере пользователь только для чтения.
- Разрешения: объект центра обработки данных –> распространение на дочерний объект, роль только для чтения.
- Сведения: пользователь назначается на уровне центра обработки данных и поэтому имеет доступ ко всем объектам в центре обработки данных.
- Если нужно ограничить доступ, назначьте дочерним объектам (узлы vSphere, хранилища данных, виртуальные машины и сети) роль **Без доступа** с параметром **Propagate to child** (Распространить на дочерний объект).

### <a name="verify-permissions-to-create-a-vm"></a>Проверка разрешений для создания виртуальной машины

Проверьте наличие разрешений для создания виртуальной машины путем импорта OVA-файла. [Узнайте больше](https://kb.vmware.com/s/article/1023189?other.KM_Utility.getArticleLanguage=1&r=2&other.KM_Utility.getArticleData=1&other.KM_Utility.getArticle=1&ui-comm-runtime-components-aura-components-siteforce-qb.Quarterback.validateRoute=1&other.KM_Utility.getGUser=1).

### <a name="verify-ports"></a>Проверка портов

В этом сценарии мы настроим сопоставление зависимостей. Для этой функции требуется наличие агента, установленного на виртуальных машинах, которые вы оцениваете. Этот агент должен иметь возможность подключиться к Azure по TCP-порту 443 на каждой виртуальной машине. [Узнайте больше](https://docs.microsoft.com/azure/log-analytics/log-analytics-concept-hybrid) о требованиях к подключению.


### <a name="set-statistics-settings"></a>Настройка параметров статистики

Перед началом развертывания для сервера vCenter Server нужно задать параметры статистики уровня 3. Обратите внимание на следующее.
- Когда вы установите уровень, нужно подождать по крайней мере один день, прежде чем приступить к оценке. В противном случае она может работать не так, как ожидалось.
- Если уровень выше 3, оценка будет работать, но при этом:
    - Данные о производительности дисков и сетей не будут собраны.
    - Для хранилища служба "Миграция Azure" рекомендует стандартный диск в Azure того же размера, что и локальный.
    - С точки зрения сети для каждого локального сетевого адаптера рекомендуется наличие сетевого адаптера в Azure.
    - С точки зрения среды выполнения приложений служба"Миграция Azure" анализирует количество ядер и объем памяти и рекомендует виртуальную машину Azure с такой же конфигурацией. Если доступно несколько соответствующих размеров виртуальных машин, служба выбирает рекомендуемый, который обеспечивает наименьшие затраты.
   
    
[Дополнительные сведения](https://docs.microsoft.com/azure/migrate/concepts-assessment-calculation#sizing) о размерах при использовании уровня 3.

Установите уровень следующим образом:

1. В веб-клиенте vSphere откройте экземпляр сервера vCenter Server.
2. Выберите вкладку **Управление** и в поле **Параметры** щелкните **Общие**.
3. Щелкните **Изменить** и на вкладке **Статистика** установите для уровня статистики значение **Уровень 3**.

    ![Установка уровня статистики vCenter](./media/migrate-scenarios-assessment/vcenter-statistics-level.png)



## <a name="step-5-discover-vms"></a>Шаг 5. Обнаружение виртуальных машин

Создайте проект службы "Миграция Azure", а затем загрузите и настройте виртуальную машину сборщика. Запустите сборщик для обнаружения виртуальных машин.

### <a name="create-a-project"></a>Создание проекта

1. Войдите на [портал Azure](https://portal.azure.com) и щелкните **Создать ресурс**.
2. Выполните поиск по запросу **Миграция Azure**. Выберите службу **Миграция Azure** в результатах поиска и нажмите кнопку **Создать**.
3. Укажите имя проекта и подписку Azure.
4. Создайте новую группу ресурсов.
5. Укажите расположение для создания проекта и нажмите кнопку **Создать**.

    - Проект службы "Миграция Azure" можно создать только в регионах "Западно-центральная часть США" и "Восточная часть США".
    - Можно запланировать перенос в любое целевое расположение.
    - В расположении проекта хранятся только метаданные, собранные с локальных виртуальных машин.

    ![Служба "Миграция Azure"](./media/migrate-scenarios-assessment/project-1.png)


    

### <a name="download-the-collector-appliance"></a>Скачивание модуля сборщика

Служба "Миграция Azure" создает локальную виртуальную машину, известную как модуль сборщика. Эта виртуальная машина обнаруживает локальные виртуальные машины VMware и отправляет метаданные о них в службу "Миграция Azure". Чтобы настроить модуль сборщика, скачайте OVA-файл и импортируйте его на локальный сервер vCenter Server для создания виртуальной машины.

1. В проекте службы "Миграция Azure" щелкните **Начало работы** > **Обнаружение и оценка** > **Обнаружение компьютеров**.
2. В окне **Обнаружение компьютеров** щелкните **Скачать**, чтоб скачать OVA-файл.
3. В окне **Копирование учетных данных проекта** скопируйте идентификатор и ключ проекта. Они потребуются при настройке сборщика.

    ![Скачивание OVA-файла](./media/migrate-scenarios-assessment/download-ova.png) 

### <a name="verify-the-collector-appliance"></a>Проверка модуля сборщика

Прежде чем развертывать OVA-файл, убедитесь, что он не поврежден.

1. На компьютере, на который был скачан файл, откройте командное окно с правами администратора.
2. Выполните следующую команду, чтобы создать хэш OVA-файла.
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - Пример использования: ```C:\>CertUtil -HashFile C:\AzureMigrate\AzureMigrate.ova SHA256```
3. Созданный хэш должен соответствовать этим параметрам (версия 1.0.9.7).
    
    **Алгоритм** | **Значение хэша**
    --- | ---
    MD5 | d5b6a03701203ff556fa78694d6d7c35
    SHA1 | f039feaa10dccd811c3d22d9a59fb83d0b01151e
    SHA256 | e5e997c003e29036f62bf3fdce96acd4a271799211a84b34b35dfd290e9bea9c
    

### <a name="create-the-collector-appliance"></a>Создание модуля сборщика

Импортируйте скачанный файл на сервер vCenter Server.

1. В консоли клиента vSphere щелкните **File** (Файл)  >  **Deploy OVF Template** (Развернуть шаблон OVF).

    ![Развертывание шаблона OVF](./media/migrate-scenarios-assessment/vcenter-wizard.png) 

2. В мастере развертывания шаблона OVF выберите **Source** (Источник), укажите расположение OVA-файла и нажмите кнопку **Next** (Далее).
3. На вкладке **OVF Template Details** (Сведения о шаблоне OVF) нажмите кнопку **Next** (Далее). На странице **End User License Agreement** (Лицензионное соглашение) нажмите кнопку **Accept** (Принять), чтобы принять лицензионное соглашение и нажмите кнопку **Next** (Далее).
4. В полях **имени и расположения** укажите понятное имя виртуальной машины сборщика и расположение объекта инвентаризации, в котором будет размещена эта виртуальная машина, а затем нажмите кнопку **Next** (Далее). Укажите узел или кластер, в котором будет выполняться модуль сборщика.
5. В поле **Storage** (Хранилище) укажите, где следует хранить файлы модуля, и нажмите кнопку **Next** (Далее).
6. В поле **Disk Format** (Формат диска) укажите, как следует подготовить хранилище.
7. В поле **Network Mapping** (Сетевое сопоставление) укажите сеть, к которой будет подключена виртуальная машина сборщика. Этой сети требуется подключение к Интернету для отправки метаданных в Azure. 
8. На странице **Ready to complete** (Все готово к выполнению) просмотрите параметры, установите флажок **Power on after deployment** (Включить питание после развертывания), а затем нажмите кнопку **Finish** (Готово).

После создания модуля отобразится сообщение об успешном завершении.

### <a name="run-the-collector-to-discover-vms"></a>Запуск сборщика для обнаружения виртуальных машин

Прежде чем начать, обратите внимание, что в данный момент сборщик поддерживает только "Английский (США)" в качестве языка операционной системы и языка интерфейса сборщика.

1. В консоли клиента vSphere щелкните правой кнопкой мыши виртуальную машину и выберите **Open Console** (Открыть консоль).
2. Укажите язык, часовой пояс и параметры пароля для модуля.
3. На рабочем столе щелкните ярлык **Run collector** (Запустить сборщик).

    ![Ярлык сборщика](./media/migrate-scenarios-assessment/collector-shortcut.png) 
    
4. В сборщике службы "Миграция Azure" откройте раздел **Set Up Prerequisites** (Настройка предварительных требований).
    - Примите условия лицензии и прочитайте информацию от сторонних производителей.
    - Сборщик проверяет, что виртуальная машина имеет доступ к Интернету, время синхронизировано, а служба сборщика запущена (она установлена ​​по умолчанию на виртуальной машине). Он также устанавливает VMware PowerCLI. 
    
    > [!NOTE]
    > Предполагается, что виртуальная машина имеет прямой доступ к Интернету без прокси-сервера.

    ![Проверка предварительных требований](./media/migrate-scenarios-assessment/collector-verify-prereqs.png)
    

5. В разделе **Specify vCenter Server details** (Укажите сведения о vCenter Server) выполните следующие действия:
    - Укажите полное доменное имя или IP-адрес сервера vCenter Server.
    - В полях **Имя пользователя** и **Пароль** укажите данные учетной записи только для чтения, которую сборщик будет использовать для обнаружения виртуальных машин на сервере vCenter Server.
    - В поле **Select scope** (Выбор области) выберите область обнаружения виртуальных машин. Сборщик может обнаруживать только виртуальные машины в указанной области. Областью может быть определенная папка, центр обработки данных или кластер. Она не должна содержать более 1000 виртуальных машин. 

    ![Подключение к vCenter](./media/migrate-scenarios-assessment/collector-connect-vcenter.png)

6. В разделе **Specify migration project** (Укажите проект миграции) укажите идентификатор и ключ проекта службы "Миграция Azure", скопированные на портале. Если вы не скопировали их, откройте портал Azure на виртуальной машине сборщика. На странице **Обзор** проекта щелкните **Обнаружение компьютеров** и скопируйте соответствующие значения.  

    ![Подключение к Azure](./media/migrate-scenarios-assessment/collector-connect-azure.png)

7. В окне **View collection progress** (Просмотр хода выполнения сборщика) наблюдайте за обнаружением и убедитесь, что в области обнаружения собираются метаданные с виртуальных машин. Сборщик предоставляет приблизительное время завершения обнаружения.

    ![Выполняется сборка](./media/migrate-scenarios-assessment/collector-collection-process.png)
   


### <a name="verify-vms-in-the-portal"></a>Проверка виртуальных машин на портале

После завершения сборки проверьте, что виртуальные машины отображаются на портале.

1. В проекте службы "Миграция Azure" щелкните **Управление** > **Компьютеры**.
2. Проверьте, появились ли на странице виртуальные машины, которые нужно было обнаружить.

    ![Обнаруженные компьютеры](./media/migrate-scenarios-assessment/discovery-complete.png)

3. Обратите внимание, что в настоящее время на компьютерах не установлены агенты службы "Миграция Azure". Они нужны, чтобы мы могли просматривать зависимости.
    
    ![Обнаруженные компьютеры](./media/migrate-scenarios-assessment/machines-no-agent.png)



## <a name="step-6-prepare-for-dependency-analysis"></a>Шаг 6. Подготовка к анализу зависимостей

Чтобы просмотреть зависимости между виртуальными машинами, которые мы хотим оценить, загрузите и установите агенты на виртуальных машинах веб-приложения — WEBVM и SQLVM.

### <a name="take-a-snapshot"></a>Создание моментального снимка

Если вы хотите создать копию виртуальной машины, прежде чем изменить ее, сделайте снимок перед установкой агентов.

![Моментальный снимок компьютера](./media/migrate-scenarios-assessment/snapshot-vm.png) 


### <a name="download-and-install-the-vm-agents"></a>Скачивание и установка агентов виртуальной машины

1.  На странице проекта службы "Миграция Azure" > **Компьютеры** выберите компьютер и щелкните **Требует установки** в столбце **Зависимости**.
2.  На странице **Обнаружение компьютеров** загрузите и установите Microsoft Monitoring Agent (MMA) и агент зависимостей на каждую виртуальную машину.
3.  Скопируйте идентификатор и ключ рабочей области. Они понадобятся при установке MMA.

    ![Скачивание агента](./media/migrate-scenarios-assessment/download-agents.png) 



#### <a name="install-the-mma"></a>Установка MMA

1. Дважды щелкните скачанный файл агента.
2. На странице **приветствия** нажмите кнопку **Далее**. На странице **Условия лицензии** нажмите кнопку **Принимаю**, чтобы принять условия лицензии.
3. В поле **Конечная папка** оставьте папку установки по умолчанию. Нажмите кнопку **Далее**. 
4. В окне **Параметры установки агента** установите флажок **Connect the agent to Azure Log Analytics** (Подключить агент к Azure Log Analytics)  > **Далее**. 

    ![Установка MMA](./media/migrate-scenarios-assessment/mma-install.png) 
5. В окне **Azure Log Analytics** вставьте идентификатор и ключ рабочей области, скопированные на портале. Нажмите кнопку **Далее**.
    ![Установка MMA](./media/migrate-scenarios-assessment/mma-install2.png) 

6. На странице **Ready to Install** (Все готово для установки) установите MMA.



#### <a name="install-the-dependency-agent"></a>Установка агента зависимостей

1.  Дважды щелкните загруженный файл агента зависимостей.
2.  На странице **Условия лицензии** нажмите кнопку **Принимаю**, чтобы принять условия лицензии.
3.  В окне **Идет установка** дождитесь завершения процесса установки. Нажмите кнопку **Далее**.

    ![Агент зависимостей](./media/migrate-scenarios-assessment/dependency-agent.png) 


       
## <a name="step-7-run-and-analyze-the-vm-assessment"></a>Шаг 7. Запуск и анализ оценки виртуальных машин

Проверьте зависимости компьютеров и создайте группу. Затем запустите оценку.

### <a name="verify-dependencies-and-create-a-group"></a>Проверьте зависимости и создайте группу.

1.  На странице **Компьютеры** щелкните **Показать зависимости** напротив виртуальных машин, которые вы хотите проанализировать.

    ![Просмотр зависимостей компьютера](./media/migrate-scenarios-assessment/view-machine-dependencies.png) 

2. На карте зависимостей SQLVM появятся следующие сведения:

    - Группы процессов или процессы с активными сетевыми соединениями, запущенными на SQLVM, в течение указанного периода времени (час по умолчанию).
    - Входящие (клиент) и исходящие (сервер) TCP-подключения всех зависимых компьютеров.
    - Зависимые компьютеры с установленными агентами службы "Миграция Azure" показаны в виде отдельных полей.
    - Для компьютеров без установленных агентов отображаются сведения о портах и ​​IP-адресах.
    
 3. Для компьютеров с установленным агентом (WEBVM) щелкните поле компьютера, чтобы просмотреть дополнительные сведения, включая полное доменное имя, операционную систему и MAC-адрес. 

    ![Просмотр зависимостей группы](./media/migrate-scenarios-assessment/sqlvm-dependencies.png)

4. Теперь выберите виртуальные машины, которые хотите добавить в группу (SQLVM и WEBVM).  Чтобы выбрать несколько виртуальных машин, щелкните их, удерживая клавишу CTRL.
5. Щелкните **Создать группу** и укажите имя (smarthotelapp).

> [!NOTE]
    > Чтобы просмотреть более подробные зависимости, можно расширить диапазон времени. Можно выбрать конкретную продолжительность или даты начала и окончания. 


### <a name="run-an-assessment"></a>Запуск оценки


1. На странице **Группы**  откройте группу (smarthotelapp).
2. Щелкните **Создать оценку**.

    ![Создание оценки](./media/migrate-scenarios-assessment/run-vm-assessment.png)

3. Оценка отображается на странице **Управление** > **Оценки**.


### <a name="modify-assessment-settings"></a>Изменение параметров оценки

В этом руководстве мы использовали параметры оценки по умолчанию, но вы можете настроить параметры следующим образом:

1. В проекте миграции на странице **Оценки** выберите оценку и щелкните **Изменить свойства**.
2. Измените свойства в соответствии со сведениями, приведенными в таблице ниже.

    **Параметр** | **Дополнительные сведения** | **По умолчанию**
    --- | --- | ---
    **Целевое расположение** | Расположение Azure для миграции. | Значение по умолчанию отсутствует.
    **Избыточность хранилища** | Тип избыточности хранилища для виртуальных машин Azure после миграции. | По умолчанию используется [локально избыточное хранилище (LRS)](../storage/common/storage-redundancy-lrs.md). Служба "Миграция Azure" поддерживает только управляемые оценки на основе дисков, а управляемые диски поддерживают только LRS, поэтому сейчас свойство имеет только вариант LRS. 
    **Условия определения размера** | Условия, используемые в службе "Миграция Azure", для установки правильного размера виртуальных машин Azure. Можно выбрать условие определения размера *на основе производительности* или *как для локальных ВМ* без учета журнала производительности. | По умолчанию установлено определение размера на основе производительности.
    **Журнал производительности** | Период, который нужно учитывать для оценки производительности виртуальных машин. Это свойство применимо только в случае, если используется *определение размера на основе производительности*. | Значение по умолчанию — один день.
    **Использование процентиля** | Значение процентиля примера производительности, которое учитывается для выбора правильного размера. Это свойство применимо только в случае, если используется *определение размера на основе производительности*.  | Значение по умолчанию — 95-й процентиль.
    **Ценовая категория** | Вы можете указать [ценовую категорию ("Базовый" или "Стандартный")](../virtual-machines/windows/sizes-general.md) целевых виртуальных машин Azure. Например, при планировании переноса рабочей среды можно рассмотреть использование уровня "Стандартный", который предоставляет виртуальные машины с низкой задержкой, но может быть более затратным. В среде разработки и тестирования, в свою очередь, можно использовать уровень "Базовый" с виртуальными машинами с большей задержкой, но меньшими затратами. | По умолчанию применяется категория [Стандартный](../virtual-machines/windows/sizes-general.md).
    **Фактор комфорта** | При оценке в службе "Миграция Azure" учитывается буфер (фактор комфорта). Этот буфер применяется на основе данных об использовании компьютера для виртуальных машин (показателей ЦП, памяти, диска и сети). Фактор комфорта учитывается, например, для сезонного использования и малого количества записей в журнале с потенциальным повышением в будущем.<br/><br/> Например, если виртуальная машина с 10 ядрами загружена на 20 %, обычно в результате оценки определяется виртуальная машина с 2 ядрами. Но с фактором комфорта 2.0x в результате определяется машина с 4 ядрами. | Значение по умолчанию — "1,3x".
    **ПРЕДЛОЖЕНИЕ** | Выбранное [предложение Azure](https://azure.microsoft.com/support/legal/offer-details/). | По умолчанию используется [Оплата по мере использования](https://azure.microsoft.com/offers/ms-azr-0003p/).
    **Валюта** | Валюта для выставления счетов. | По умолчанию это доллары США.
    **Скидка (%)** | Любая относящаяся к подписке скидка, предоставляемая в рамках предложения Azure. | Значение по умолчанию — 0 %.
    **Преимущество гибридного использования Azure** | Укажите, есть ли у вас лицензия Software Assurance и распространяется ли на вас программа [Преимущество гибридного использования Azure](https://azure.microsoft.com/pricing/hybrid-use-benefit/). Если установлено значение "Да", то для виртуальных машин Windows действуют цены, отличные от цен Microsoft Azure. | Значение по умолчанию — "Да".

3. Нажмите кнопку **Сохранить**, чтобы обновить параметры оценки.


### <a name="analyze-the-vm-assessment"></a>Анализ оценки виртуальных машин

Оценка службы "Миграция Azure" включает в себя информацию о том, совместимы ли локальные виртуальные машины с Azure, правильный размер для виртуальной машины Azure, а также предполагаемые ежемесячные затраты в Azure. 

![Отчет об оценке](./media/migrate-scenarios-assessment/assessment-overview.png)

#### <a name="review-confidence-rating"></a>Просмотр рейтинга достоверности

![Отображение оценки](./media/migrate-scenarios-assessment/assessment-display.png)

Оценка получает рейтинг достоверности от 1 до 5 звезд (1 звезда — самый низкий, а 5 звезд — самый высокий).
- Оценка достоверности назначается на основе доступности точек данных, необходимых для вычисления оценки.
- Это помогает оценить надежность рекомендаций по выбору размера, предоставленных службой "Миграция Azure".
- Оценка достоверности необходима, если вы *определяете размер на основе производительности*, так как служба "Миграция Azure" может не иметь достаточного количества точек данных для определения размера на основе использования. При *определении размера как для локальной виртуальной машины* значение оценки достоверности всегда равно 5 звездам, так как в службе "Миграция Azure" есть все данные для определения размера виртуальной машины.
- В зависимости от процента доступных точек данных оценка достоверности может быть такой:

   **Уровень доступности точек данных** | **Оценка достоверности**
   --- | ---
   0–20 % | 1 звезда
   21–40 % | 2 звезды
   41–60 % | 3 звезды
   61–80 % | 4 звезды
   81–100 % | 5 звезд

#### <a name="verify-readiness"></a>Проверка готовности

![Оценка готовности](./media/migrate-scenarios-assessment/azure-readiness.png)  

В отчете об оценке представлены сведения в виде таблицы. Обратите внимание, что для отображения размера на основе производительности службе "Миграция Azure" требуются следующие сведения. Если эти сведения невозможно собрать, оценка размера может быть неточной.

- Данные об использовании ЦП и памяти.
- Сведения об операциях записи и чтения в секунду и пропускной способности для каждого диска, присоединенного к виртуальной машине.
- Сведения о входящем и исходящем сетевом трафике для каждого сетевого адаптера, подключенного к виртуальной машине.


**Параметр** | **Указание** | **Дополнительные сведения**
--- | --- | ---
**Готовность виртуальной машины Azure** | Указывает, готова ли виртуальная машина к миграции. | Возможны следующие состояния:</br><br/>— Ready for Azure (Готова к работе в Azure);<br/><br/>— Ready with conditions (Готова при выполнении условий); <br/><br/>— Not ready for Azure (Не готова к работе в Azure);<br/><br/>— "Уровень готовности неизвестен".<br/><br/> Если виртуальная машина не готова, вы увидите шаги по устранению проблем.
**Размер виртуальной машины Azure** | Для готовых виртуальных машин мы рекомендуем размер виртуальной машины Azure. | Рекомендация по размеру зависит от свойств оценки:<br/><br/>Если вы использовали размер на основе производительности, при определении размера учитывается история производительности виртуальных машин.<br/><br/>При определении размера как для локальной виртуальной машины учитывается размер локальной виртуальной машины, а данные об использовании — нет.
**Рекомендуемое средство** | Так как агенты установлены на компьютерах, служба "Миграция Azure" просматривает процессы, выполняемые внутри компьютера, и определяет, является ли он компьютером базы данных.
**Сведения о виртуальной машине** | В отчете показаны параметры локальной виртуальной машины, включая операционную систему, тип загрузки, данные о диске и хранилище.




#### <a name="review-monthly-cost-estimates"></a>Просмотр примерной стоимости в месяц

В этом представлении отображается общая стоимость вычислений и хранения для запуска виртуальных машин в Azure, а также сведения для каждой машины. 

![Оценка готовности](./media/migrate-scenarios-assessment/azure-costs.png) 

- Ожидаемая стоимость рассчитывается с использованием рекомендаций по размеру для виртуальной машины.
- Примерная ежемесячная стоимость вычислений и хранилища суммируется для всех виртуальных машин в группе. 


## <a name="conclusion"></a>Заключение

В этом сценарии вы выполнили следующее:

> [!div class="checklist"]
> * Оценили локальную базу данных с помощью инструмента DMA.
> * Оценили локальные виртуальные машины, используя сопоставление зависимостей вместе со службой "Миграция Azure".
> * Просмотрели оценки, чтобы убедиться, что локальные ресурсы готовы к миграции в Azure.

## <a name="next-steps"></a>Дополнительная информация

Перейдите к следующему сценарию, чтобы выполнить миграцию "lift-and-shift" локальных виртуальных машин в Azure.



