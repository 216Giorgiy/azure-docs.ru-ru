---
title: Рефакторинг развертывания Team Foundation Server в Visual Studio Team Services (VSTS) в Azure | Документация Майкрософт
description: Узнайте, как Contoso выполняет рефакторинг локального развертывания TFS, перемещая его в Visual Studio Team Services (VSTS) в Azure.
services: site-recovery
author: rayne-wiselman
ms.service: site-recovery
ms.topic: conceptual
ms.date: 09/05/2018
ms.author: raynew
ms.openlocfilehash: 6b2067556cb42a1d40b3a8ba2bc681fbd602ab8d
ms.sourcegitcommit: 3d0295a939c07bf9f0b38ebd37ac8461af8d461f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/06/2018
ms.locfileid: "43842642"
---
# <a name="contoso-migration--refactor-a-team-foundation-server-deployment-to-visual-studio-team-services-vsts"></a>Миграция в компании Contoso: рефакторинг развертывания Team Foundation Server в Visual Studio Team Services (VSTS)

В этой статье показано, как Contoso выполняет рефакторинг локального развертывания Team Foundation Server (TFS), перемещая его в Visual Studio Team Services (VSTS) в Azure. Команда разработчиков Contoso использовала TFS для совместной работы и контроля версий в течение последних пяти лет. Теперь разработчики хотят перейти на облачное решение для разработки и тестирования, а также для управления версиями. VSTS сыграет роль, когда команда перейдет на модель DevOps и разработает новые облачные приложения.

Это документ из цикла статей о том, как вымышленная компания Contoso переносит локальные ресурсы в облако Microsoft Azure. Этот цикл содержит общие сведения и сценарии, которые иллюстрируют настройку инфраструктуры миграции и выполнение миграций различных типов. Сценарии становятся все более сложными. Со временем мы добавим другие статьи.


**Статья** | **Дополнительные сведения** | **Состояние**
--- | --- | ---
[Статья 1. Общие сведения](contoso-migration-overview.md) | Обзор серии статей, стратегии миграции компании Contoso и используемых в этой серии примеров приложений. | Доступна
[Статья 2. Развертывание инфраструктуры миграции в Contoso](contoso-migration-infrastructure.md) | Компания Contoso готовит локальную инфраструктуру и инфраструктуру Azure для миграции. Для всех статей миграции в серии используется одна и та же инфраструктура. | Доступна
[Статья 3. Оценка готовности локальных ресурсов к переносу в Azure](contoso-migration-assessment.md)  | Компания Contoso выполняет оценку локального приложения SmartHotel360 в VMware. Для оценки виртуальных машин приложения Contoso использует службу "Миграция Azure". Для оценки базы данных SQL Server приложения используется Помощник по миграции данных. | Доступна
[Статья 4. Повторное размещение приложения на виртуальной машине Azure и в Управляемом экземпляре Базы данных SQL](contoso-migration-rehost-vm-sql-managed-instance.md) | Специалисты компании Contoso переносят локальное приложение SmartHotel360 в Azure по методу lift-and-shift. Специалисты компании Contoso переносят виртуальную машину внешнего интерфейса приложения с помощью [Azure Site Recovery](https://docs.microsoft.com/azure/site-recovery/site-recovery-overview). Они переносят базу данных приложения в Управляемый экземпляр Базы данных SQL Azure с помощью [Azure Database Migration Service](https://docs.microsoft.com/azure/dms/dms-overview). | Доступна   
[Статья 5. Повторное размещение приложения на виртуальных машинах Azure](contoso-migration-rehost-vm.md) | Специалисты компании Contoso переносят виртуальные машины приложения SmartHotel360 на виртуальные машины Azure с помощью службы Site Recovery. | Доступна
[Статья 6. Повторное размещение на виртуальных машинах Azure и в группах доступности SQL Server](contoso-migration-rehost-vm-sql-ag.md) | Компания Contoso переносит приложение SmartHotel360. Для переноса виртуальных машин приложения компания Contoso использует Site Recovery. Она использует службу Azure Database Migration Service для миграции базы данных приложения в кластер SQL Server, который защищен группой доступности AlwaysOn. | Доступна
[Статья 7. Повторное размещение приложения Linux на виртуальных машинах Azure](contoso-migration-rehost-linux-vm.md) | Специалисты компании Contoso выполняют миграцию приложения osTicket для Linux по методу lift-and-shift на виртуальные машины Azure с помощью Azure Site Recovery. | Доступна
[Статья 8. Повторное размещение приложения Linux на виртуальных машинах Azure и MySQL Server в Azure](contoso-migration-rehost-linux-vm-mysql.md) | Специалисты компании Contoso переносят приложение osTicket для Linux на виртуальные машины Azure с помощью Azure Site Recovery, а также переносят базу данных приложения в экземпляр Azure MySQL Server, используя MySQL Workbench. | Доступна
[Статья 9. Рефакторинг приложения в веб-приложениях Azure и базе данных SQL Azure](contoso-migration-refactor-web-app-sql.md) | Специалисты компании Contoso переносят приложение SmartHotel360 в веб-приложение Azure, а базу данных приложения — в экземпляр SQL Server Azure с помощью Помощника по миграции баз данных. | Доступна
[Статья 10. Рефакторинг приложения Linux в веб-приложениях Azure и Azure MySQL](contoso-migration-refactor-linux-app-service-mysql.md) | Специалисты компании Contoso переносят свое приложение osTicket для Linux в веб-приложение Azure в нескольких регионах Azure с помощью диспетчера трафика Azure, интегрированного с GitHub для непрерывной поставки. Компания Contoso переносит базу данных приложения в экземпляр Базы данных Azure для MySQL. | Доступна 
Статья 11. Рефакторинг TFS в VSTS | Специалисты компании Contoso переносят локальное развертывание Team Foundation Server в Visual Studio Team Services в Azure. | Эта статья
[Статья 12. Перепроектирование приложения для использования контейнеров Azure и Базы данных SQL Azure](contoso-migration-rearchitect-container-sql.md) | Специалисты компании Contoso переносят приложение SmartHotel360 в Azure. Затем уровень веб-приложений преобразуется в контейнер Windows, работающий в Azure Service Fabric, и базу данных в службе "База данных SQL Azure". | Доступна
[Статья 13. Повторное создание приложения в Azure](contoso-migration-rebuild.md) | Специалисты компании Contoso выполняют повторную сборку приложения SmartHotel360, используя ряд возможностей и служб Azure, включая Службу приложений Azure, Службу Azure Kubernetes (AKS), Функции Azure, Cognitive Services и Azure Cosmos DB. | Доступна



## <a name="business-drivers"></a>Бизнес-факторы

Команда ИТ-руководителей тесно сотрудничала с деловыми партнерами для определения будущих целей. Партнеры не слишком озабочены средствами и технологиями разработки, но они отметили следующие моменты:

- **Программное обеспечение**. Независимо от основного бизнеса, все компании теперь являются компаниями-разработчиками программного обеспечения, включая Contoso. Бизнес-руководство заинтересовано в том, как ИТ-специалисты могут помочь внедрить новые методы работы для пользователей и условия взаимодействия для своих клиентов.
- **Эффективность**. Contoso необходимо оптимизировать процесс и удалить ненужные процедуры для разработчиков и пользователей. Это позволит компании более эффективно выполнять требования клиентов. Компания нуждается в быстрой работе ИТ-отдела без потери времени или денег.
- **Динамичность**. ИТ-отдел Contoso должен отвечать потребностям бизнеса и реагировать быстрее, чем рынок, чтобы обеспечить успех в глобальной экономике. ИТ-отдел не должен быть препятствием для бизнеса.

## <a name="migration-goals"></a>Цели миграции

Группа, работающая над облачной инфраструктурой компании Contoso, определила цели этой миграции в VSTS:

- Команде нужен инструмент для переноса данных в облако. Необходимо несколько процессов, выполняемых вручную.
- Данные рабочих элементов и история за последний год должны быть перенесены.
- Команда разработчиков не хочет создавать новые имена пользователей и пароли. Все текущие системные назначения должны быть сохранены.
- Они хотят отказаться от Team Foundation Version Control (TFVC) в пользу Git для управления версиями.
- Переключение на Git будет "переносом подсказок", при котором импортируется только последняя версия исходного кода. Это произойдет во время простоя, когда все операции будут остановлены по причине переноса базы кода. Команда понимает, что после перемещения будет доступна только текущая история главной ветви.
- Они обеспокоены изменениями и хотят протестировать их, прежде чем выполнять полный переход. Команда хочет сохранить доступ к TFS даже после перехода на VSTS.
- Компания Contoso владеет несколькими коллекциями и хочет начать с той, которая содержит всего несколько проектов, чтобы лучше понять процесс.
- Команда понимает, что коллекции TFS поддерживают отношения "один к одному" с учетными записями VSTS с несколькими URL-адресами. Однако это соответствует текущей модели разделения для баз кода и проектов.


## <a name="proposed-architecture"></a>Предлагаемая архитектура

- Contoso переместит свои проекты TFS в облако и больше не будет размещать свои проекты или систему управления версиями в локальной среде.
- TFS будет перенесен в VSTS.
- В настоящее время Contoso имеет одну коллекцию TFS с именем **ContosoDev**, которая будет перенесена в учетную запись VSTS под названием **contosodevmigration.visualstudio.com**.
- Проекты, рабочие элементы, ошибки и итерации с прошлого года будут перенесены в VSTS.
- Специалисты компании Contoso будут использовать Azure Active Directory, который они настроили во время развертывания [инфраструктуры Azure](contoso-migration-infrastructure.md) в начале планирования миграции. 


![Архитектура сценария](./media/contoso-migration-tfs-vsts/architecture.png) 


## <a name="migration-process"></a>Процесс миграции

Порядок миграции в Contoso будет следующим:

1. Потребуется серьезная подготовка. В качестве первого шага компания Contoso должна обновить свою реализацию TFS до поддерживаемого уровня. В настоящее время компания Contoso использует TFS 2017 с обновлением 3, но для переноса базы данных им необходимо запустить поддерживаемую версию 2018 с последними обновлениями.
2. После обновления компания Contoso запустит средство миграции TFS и проведет проверку своей коллекции.
3. Contoso создаст набор файлов подготовки и выполнит пробный перенос для тестирования.
4. Затем специалисты Contoso выполнят другой перенос, на этот раз полный, включающий рабочие элементы, ошибки, спринты и код.
5. После миграции они переместят свой код из TFVC в Git.

![Процесс миграции](./media/contoso-migration-tfs-vsts/migration-process.png) 


## <a name="scenario-steps"></a>Шаги выполнения сценария

Миграция в Contoso будет осуществляться следующим образом:

> [!div class="checklist"]
> * **Шаг 1. Создание учетной записи хранения Azure**. Эта учетная запись хранения будет использоваться во время процесса миграции.
> * **Шаг 2. Обновление TFS**. Специалисты Contoso обновят развертывание до TFS 2018 с обновлением 2. 
> * **Шаг 3. Проверка коллекции**. Contoso проверит свою коллекцию TFS для подготовки к миграции.
> * **Шаг 4. Создание файла подготовки**. Специалисты Contoso создадут файлы миграции с помощью средства миграции TFS. 


## <a name="step-1-create-a-storage-account"></a>Шаг 1. Создание учетной записи хранения

1. На портале Azure администраторы Contoso создадут учетную запись хранения (**contosodevmigration**).
2. Они размещают учетную запись в дополнительном регионе, который они используют для отработки отказа — "Центральная часть США". Они используют стандартную учетную запись общего назначения с локально избыточным хранилищем.

    ![Учетная запись хранения](./media/contoso-migration-tfs-vsts/storage1.png) 


**Нужна дополнительная помощь?**

- [Общие сведения о службе хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-introduction).
- [Создание учетной записи хранения](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account).


## <a name="step-2-upgrade-tfs"></a>Шаг 2. Обновление TFS

Администраторы Contoso обновляют сервер TFS до TFS 2018 с обновлением 2. Перед запуском:

- Они скачивают [TFS 2018 с обновлением 2](https://visualstudio.microsoft.com/downloads/).
- Они проверяют [требования к оборудованию](https://docs.microsoft.com/tfs/server/requirements), а также читают [заметки о выпуске](https://docs.microsoft.com/visualstudio/releasenotes/tfs2018-relnotes) и [сложности при обновлении](https://docs.microsoft.com/tfs/server/upgrade/get-started#before-you-upgrade-to-tfs-2018).

Они выполняют обновление следующим образом:

1. Чтобы начать работу, они создают резервную копию своего сервера TFS (работает на виртуальной машине VMware) и делают моментальный снимок VMware.

    ![TFS](./media/contoso-migration-tfs-vsts/upgrade1.png) 

2. Установщик TFS запускается, и они выбирают место для установки. Установщику требуется доступ к Интернету.

    ![TFS](./media/contoso-migration-tfs-vsts/upgrade2.png) 

3. По завершении установки запустится мастер настройки сервера.

    ![TFS](./media/contoso-migration-tfs-vsts/upgrade3.png) 

4. После проверки мастер завершит обновление.

     ![TFS](./media/contoso-migration-tfs-vsts/upgrade4.png) 

5. Специалисты компании проверяют установку TFS, просматривая проекты, рабочие элементы и код.

     ![TFS](./media/contoso-migration-tfs-vsts/upgrade5.png) 

> [!NOTE]
> Некоторым обновлениям TFS необходимо запустить мастер настройки компонентов после завершения обновления. [Узнайте больше](https://docs.microsoft.com/vsts/work/customize/configure-features-after-upgrade?utm_source=ms&utm_medium=guide&utm_campaign=vstsdataimportguide&view=vsts).

**Нужна дополнительная помощь?**

Ознакомьтесь с дополнительными сведениями об [обновлении TFS](https://docs.microsoft.com/tfs/server/upgrade/get-started).

## <a name="step-3-validate-the-tfs-collection"></a>Шаг 3. Проверка коллекции TFS

Администраторы Contoso запускают средство миграции TFS в базе данных коллекции ContosoDev для ее проверки перед переносом.

1. Специалисты Contoso скачивают и распаковывают [средство миграции TFS](https://www.microsoft.com/download/details.aspx?id=54274). Важно скачать версию для обновления TFS, которое выполняется. Версию можно проверить в консоли администратора.

    ![TFS](./media/contoso-migration-tfs-vsts/collection1.png)

2. Они запускают средство для выполнения проверки, указав URL-адрес коллекции командных проектов:

        **TfsMigrator validate /collection:http://contosotfs:8080/tfs/ContosoDev**


3. В средстве отображается ошибка.

    ![TFS](./media/contoso-migration-tfs-vsts/collection2.png)

5. Они обнаружили, что файлы журналов находятся в папке **Logs** непосредственно перед расположением средства. Файл журнала создается для каждой основной проверки. **TfsMigration.log** содержит основную информацию.

    ![TFS](./media/contoso-migration-tfs-vsts/collection3.png)

4. Специалисты компании находят эту запись, связанную с удостоверением.

    ![TFS](./media/contoso-migration-tfs-vsts/collection4.png)

5. Они запускают **TfsMigration validate /help** в командной строке и видят, что для проверки удостоверений требуется команда **/tenantDomainName**.

     ![TFS](./media/contoso-migration-tfs-vsts/collection5.png)

6. Они снова запускают команду проверки и добавляют это значение вместе со своим именем ADRE AD: **TfsMigrator validate /collection:http://contosotfs:8080/tfs/ContosoDev /tenantDomainName:contosomigration.onmicrosoft.com**.

    ![TFS](./media/contoso-migration-tfs-vsts/collection7.png)

7. Появится окно входа в Azure AD, где они вводят учетные данные глобального администратора.

     ![TFS](./media/contoso-migration-tfs-vsts/collection8.png)

8. Проверка проходит и подтверждается средством.

    ![TFS](./media/contoso-migration-tfs-vsts/collection9.png)



## <a name="step-4-create-the-migration-files"></a>Шаг 4. Создание файлов миграции

После завершения проверки администраторы Contoso могут использовать средство миграции TFS для создания файлов миграции.

1. Они выполняют этап подготовки в средстве.

    **TfsMigrator prepare /collection:http://contosotfs:8080/tfs/ContosoDev /tenantDomainName:contosomigration.onmicrosoft.com /accountRegion:cus**

     ![Подготовка.](./media/contoso-migration-tfs-vsts/prep1.png)

    Во время подготовки выполняется следующее:
    - Коллекция проверяется для поиска списка всех пользователей, и заполняется журнал схемы идентификации (**IdentityKapLog.csv**]).
    - Подготавливается соединение с Azure Active Directory, чтобы найти соответствие для каждого идентификатора.
    - Contoso уже развернула Azure AD и синхронизировала его с помощью AD Connect, поэтому во время подготовки соответствующие идентификаторы будут найдены и помечены как активные.

2. Появится окно входа в Azure AD, где они вводят учетные данные глобального администратора.

    ![Подготовка.](./media/contoso-migration-tfs-vsts/prep2.png)

3. Подготовка завершается, и средство сообщает, что файлы импорта были успешно созданы.

    ![Подготовка.](./media/contoso-migration-tfs-vsts/prep3.png)

4. Теперь они могут видеть, что файлы IdentityMapLog.csv и import.json были созданы в новой папке.

    ![Подготовка.](./media/contoso-migration-tfs-vsts/prep4.png)

5. Файл import.json предоставляет параметры импорта. Он включает в себя информацию, такую ​​как имя требуемой учетной записи и данные учетной записи хранения. Большинство полей заполнены автоматически. Некоторым полям потребовался ввод пользователя. Специалисты компании открывают файл и добавляют созданное имя учетной записи VSTS: **contosodevmigration**. С этим именем их URL-адрес VSTS будет таким: **contosodevmigration.visualstudio.com**.

    ![Подготовка.](./media/contoso-migration-tfs-vsts/prep5.png)

    > [!NOTE]
    > Учетная запись должна быть создана до миграции. После завершения миграции ее можно изменить.

6. Они просматривают файл журнала схемы идентификации, в котором отображаются учетные записи, которые будут перенесены в VSTS во время импорта. 

    - Активные идентификаторы станут пользователями в VSTS после импорта.
    - В VSTS эти идентификаторы будут лицензированы и отображаться в качестве пользователя в учетной записи после миграции.
    - Эти идентификаторы отмечены как **Активные** в столбце **Expected Import Status** (Ожидаемое состояние импорта) в файле.

    ![Подготовка.](./media/contoso-migration-tfs-vsts/prep6.png)



## <a name="step-5-migrate-to-vsts"></a>Шаг 5. Миграция в VSTS

После подготовки администраторы Contoso могут сосредоточиться на миграции. После выполнения миграции они перейдут с использования TFVC на Git для контроля версий.

Прежде чем начать, администраторы планируют время простоя с командой разработчиков, чтобы перевести коллекцию в автономный режим для миграции. Ниже приведены шаги процесса миграции.

1. **Отключение коллекции**. Они идентифицируют данные коллекции, которые находятся в базе данных конфигурации сервера TFS, когда коллекция подключена и находится в оперативном режиме. Когда коллекция отключается от сервера TFS, она делает копию этих данных идентификации и упаковывает ее в коллекцию для переноса. Без этих данных операция импорта идентификаторов не может быть выполнена. Рекомендуется, чтобы коллекция была отключена до тех пор, пока импорт не будет завершен, так как невозможно импортировать изменения, произошедшие во время импорта.
2. **Создание резервной копии**. Следующим шагом процесса миграции для компании является создание резервной копии, которую можно импортировать в VSTS. Пакет приложения уровня данных (DACPAC) — это функция SQL Server, которая позволяет вносить изменения в базу данных в один файл для развертывания в других экземплярах SQL. Пакет также может быть восстановлен непосредственно в VSTS, и поэтому используется как способ упаковки для переноса данных коллекции в облако. Contoso будет использовать средство SqlPackage.exe для создания DACPAC. Это средство включено в средства SQL Server Data Tools.
3. **Передача в хранилище**. При создании DACPAC они загружают его в службу хранилища Azure. После его загрузки они получают подписанный URL-адрес (SAS), чтобы разрешить средству миграции TFS доступ к хранилищу.
4. **Заполнение полей импорта**. Специалисты компании могут заполнить недостающие поля в файле импорта, включая параметры DACPAC. Для начала нужно указать, что требуется импорт **DryRun** (пробное выполнение), чтобы проверить, что все работает должным образом перед полной миграцией.
5. **Пробное выполнение**. Помогает при пробном переносе коллекции. Пробное выполнение имеет ограниченный срок службы и удаляется до того, как начнется перенос. Экземпляры выполнения автоматически удаляются через заданный период времени. Напоминание о том, когда пробное выполнение будет удалено, включается в сообщение электронной почты, полученное после завершения импорта. Примите его к сведению и планируйте соответствующим образом.
6. **Завершение рабочей миграции**. По завершении пробной миграции администраторы Contoso выполняют окончательную миграцию, обновив файл import.json и снова запустив импорт.



### <a name="detach-the-collection"></a>Отключение коллекции

До запуска администраторы Contoso берут локальную резервную копию SQL Server и моментальный снимок VMware сервера TFS, прежде чем отключить коллекцию.

1.  В консоли администратора TFS они выбирают коллекцию, которую хотят отключить (**ContosoDev**).

    ![Миграция](./media/contoso-migration-tfs-vsts/migrate1.png)

2. На вкладке **Общее** они выбирают **Отсоединить коллекцию**.

    ![Миграция](./media/contoso-migration-tfs-vsts/migrate2.png)

3. В мастере "Отсоединение коллекции командных проектов" в поле **Сообщение обслуживания** они вводят сообщение для пользователей, которые могут попытаться подключиться к проектам в коллекции.

    ![Миграция](./media/contoso-migration-tfs-vsts/migrate3.png)

4. В окне **Ход выполнения отсоединения** они отслеживают ход выполнения и нажимают кнопку **Далее**, когда процесс заканчивается.

    ![Миграция](./media/contoso-migration-tfs-vsts/migrate4.png)

5. По завершении проверки они нажимают кнопку **Отсоединить** в окне **Проверки готовности**.

    ![Миграция](./media/contoso-migration-tfs-vsts/migrate5.png)

6. Они нажимают кнопку **Закрыть**, чтобы закончить.

    ![Миграция](./media/contoso-migration-tfs-vsts/migrate6.png)

6. В консоли администратора TFS больше не используется ссылка на коллекцию.

    ![Миграция](./media/contoso-migration-tfs-vsts/migrate7.png)


### <a name="generate-a-dacpac"></a>Создание пакета DACPAC

Администраторы Contoso создают резервную копию (DACPAC) для импорта в VSTS.

- SqlPackage.exe в SQL Server Data Tools используется для создания DACPAC. Существует несколько версий SqlPackage.exe, установленных со средствами SQL Server Data Tools, расположенными в папках с такими именами, как 120, 130 и 140. Для подготовки DACPAC важно использовать правильную версию.
- При импорте TFS 2018 должен использоваться SqlPackage.exe из папки с номером 140 или выше.  Для CONTOSOTFS этот файл находится в папке: **C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\Common7\IDE\Extensions\Microsoft\SQLDB\DAC\140**.


Администраторы Contoso создают DACPAC следующим образом:

1. Они открывают командную строку и переходят в расположение SQLPackage.exe. Они вводят следующую команду для создания DACPAC:

    **SqlPackage.exe /sourceconnectionstring:"Data Source=SQLSERVERNAME\INSTANCENAME;Initial Catalog=Tfs_ContosoDev;Integrated Security=True" /targetFile:C:\TFSMigrator\Tfs_ContosoDev.dacpac /action:extract /p:ExtractAllTableData=true /p:IgnoreUserLoginMappings=true /p:IgnorePermissions=true /p:Storage=Memory** 

    ![Azure Backup](./media/contoso-migration-tfs-vsts/backup1.png)

2. После запуска команды появляется следующее сообщение.

    ![Azure Backup](./media/contoso-migration-tfs-vsts/backup2.png)

3. Они проверяют свойства файла DACPAC.

    ![Azure Backup](./media/contoso-migration-tfs-vsts/backup3.png)

### <a name="update-the-file-to-storage"></a>Обновление файла в хранилище

После создания DACPAC специалисты Contoso загружают его в хранилище Azure.

1. Они [скачивают и устанавливают](https://azure.microsoft.com/features/storage-explorer/) Обозреватель службы хранилища Azure.

    ![Передать](./media/contoso-migration-tfs-vsts/backup5.png)

4. Они подключаются к своей подписке и определяют учетную запись хранения, которую создали для миграции (**contosodevmigration**). Они создают новый контейнер больших двоичных объектов **vstsmigration**.

    ![Передать](./media/contoso-migration-tfs-vsts/backup6.png)

5. Они указывают файл DACPAC для передачи в виде блочного BLOB-объекта.

    ![Передать](./media/contoso-migration-tfs-vsts/backup7.png)
    
7. После загрузки файла они щелкают имя файла > **Создать SAS**. Они расширяют контейнеры больших двоичных объектов в рамках учетной записи хранения, выбирают контейнер с файлами импорта и щелкают **Get Shared Access Signature** (Получить подписанный URL-адрес).

    ![Передать](./media/contoso-migration-tfs-vsts/backup8.png)

8. Они принимают значения по умолчанию и нажимают кнопку **Создать**. Таким образом они получают доступ на 24 часа.

    ![Передать](./media/contoso-migration-tfs-vsts/backup9.png)

9. Они копируют URL-адрес SAS, чтобы его можно было использовать в средстве миграции TFS.

    ![Передать](./media/contoso-migration-tfs-vsts/backup10.png)

> [!NOTE]
> Миграция должна произойти раньше в пределах разрешенного временного окна, или срок действия разрешений истечет.
> Не создавайте ключ SAS на портале Azure. Создаваемые таким образом ключи основаны на учетной записи и не будут работать с импортом.

### <a name="fill-in-the-import-settings"></a>Заполнение параметров импорта

Ранее администраторы Contoso частично заполняли файл спецификации импорта (import.json). Теперь нужно добавить остальные параметры.

Они открывают файл import.json и заполняют следующие поля: •   Location: расположение ключа SAS, который был сгенерирован ранее.
•   Dacpac: укажите имя файла DACPAC, который вы загрузили в учетную запись хранения. Включите расширение ".dacpac".
•   ImportType: в этом случае установите значение DryRun.


![Импорт параметров](./media/contoso-migration-tfs-vsts/import1.png)


### <a name="do-a-dry-run-migration"></a>Выполнение пробной миграции

Администраторы Contoso выполняют тестовую миграцию, позволяющую убедиться в правильной работе всех компонентов.

1. Они открывают командную строку и переходят в расположение TfsMigration (C:\TFSMigrator).
2. В качестве первого шага они проверяют файл импорта. Они хотят убедиться, что файл имеет правильный формат и что ключ SAS работает.

    **TfsMigrator import /importFile:C:\TFSMigrator\import.json /validateonly**

3. Проверка возвращает ошибку, так как для ключа SAS требуется более длительный срок действия.

    ![Пробный запуск](./media/contoso-migration-tfs-vsts/test1.png)

3. Они используют Обозреватель службы хранилища Azure для создания нового ключа SAS с 7-дневным сроком действия.

    ![Пробный запуск](./media/contoso-migration-tfs-vsts/test2.png)

3. Они обновляют файл import.json и снова запускают проверку. На этот раз она завершается успешно.

    **TfsMigrator import /importFile:C:\TFSMigrator\import.json /validateonly**

    ![Пробный запуск](./media/contoso-migration-tfs-vsts/test3.png)
    
7. Они инициируют пробный запуск:

    **TfsMigrator import /importFile:C:\TFSMigrator\import.json**

8. Чтобы подтвердить миграцию выдается соответствующее сообщение. Обратите внимание на время, в течение которого промежуточные данные будут сохраняться после пробного запуска.

    ![Пробный запуск](./media/contoso-migration-tfs-vsts/test4.png)

9. Появится окно входа в Azure AD, где следует ввести учетные данные администратора Contoso.

    ![Пробный запуск](./media/contoso-migration-tfs-vsts/test5.png)

10. В сообщении отображается информация об импорте.

    ![Пробный запуск](./media/contoso-migration-tfs-vsts/test6.png)

11. Через 15 минут они переходят по URL-адресу и видят следующую информацию:

     ![Пробный запуск](./media/contoso-migration-tfs-vsts/test7.png)

12. После завершения миграции команда разработчиков Contoso входит в VSTS, чтобы проверить, работает ли пробный запуск. После аутентификации VSTS нуждается в некоторых данных для подтверждения учетной записи.

    ![Пробный запуск](./media/contoso-migration-tfs-vsts/test8.png)

13. В VSTS руководитель разработчиков может видеть, что проекты были перенесены в VSTS. Появится уведомление о том, что учетная запись будет удалена через 15 дней.

    ![Пробный запуск](./media/contoso-migration-tfs-vsts/test9.png)

14. Руководитель разработчиков открывает один из проектов и щелкает **Рабочие элементы** > **Назначено мне**. Будет показано, что данные рабочих элементов были перенесены вместе с идентификатором.

    ![Пробный запуск](./media/contoso-migration-tfs-vsts/test10.png)

15. Клиент также проверяет другие проекты и код, чтобы подтвердить, что исходный код и история были перенесены.

    ![Пробный запуск](./media/contoso-migration-tfs-vsts/test11.png)


### <a name="run-the-production-migration"></a>Выполнение миграции рабочей среды

После завершения пробного запуска администраторы Contoso переходят к миграции рабочей среды. Они удаляют данные пробного выполнения, обновляют параметры импорта и снова запускают импорт.

1. На портале VSTS они удаляют учетную запись пробного выполнения.
2. Они обновляют файл import.json, чтобы установить для параметра **ImportType** значение **ProductionRun**.

    ![Производство](./media/contoso-migration-tfs-vsts/full1.png)

3. Они начинают миграцию так же, как и пробное выполнение: **TfsMigrator import /importFile:C:\TFSMigrator\import.json**.
4. Появится сообщение с подтверждением миграции и предупреждением, что данные могут храниться в безопасном расположении в качестве промежуточной области на срок до семи дней.

    ![Производство](./media/contoso-migration-tfs-vsts/full2.png)

5. На странице входа в Azure AD они указывают учетные данные администратора Contoso.

    ![Производство](./media/contoso-migration-tfs-vsts/full3.png)

6. В сообщении отображается информация об импорте.

    ![Производство](./media/contoso-migration-tfs-vsts/full4.png)

7. Через 15 минут они переходят по URL-адресу и видят следующую информацию:

    ![Производство](./media/contoso-migration-tfs-vsts/full5.png)

8. После завершения миграции команда разработчиков Contoso входит в VSTS, чтобы проверить, работает ли миграция. После входа в систему клиент может увидеть, что проекты были перенесены.

    ![Производство](./media/contoso-migration-tfs-vsts/full6.png)

8. Руководитель разработчиков открывает один из проектов и щелкает **Рабочие элементы** > **Назначено мне**. Будет показано, что данные рабочих элементов были перенесены вместе с идентификатором.

    ![Производство](./media/contoso-migration-tfs-vsts/full7.png)

9. Клиент проверяет данные других рабочих элементов для подтверждения.

    ![Производство](./media/contoso-migration-tfs-vsts/full8.png)

15. Клиент также проверяет другие проекты и код, чтобы подтвердить, что исходный код и история были перенесены.

    ![Производство](./media/contoso-migration-tfs-vsts/full9.png)


### <a name="move-source-control-from-tfvc-to-git"></a>Перемещение системы управления версиями из TFVC в Git

После завершения миграции Contoso хочет перейти с использования TFVC на Git для управления исходным кодом. Администраторам Contoso необходимо импортировать исходный код, в настоящее время находящийся в учетной записи VSTS, в репозиторий Git в той же учетной записи.

1. На портале VSTS они открывают один из репозиториев TFVC (**$/PolicyConnect**) и просматривают его.

    ![Git](./media/contoso-migration-tfs-vsts/git1.png)

2. В раскрывающемся списке **Источник** они щелкают **Импорт**.

    ![Git](./media/contoso-migration-tfs-vsts/git2.png)

3. На вкладке **Тип источника** они выбирают **TFVC** и указывают путь к репозиторию. Они решают не переносить историю.

    ![Git](./media/contoso-migration-tfs-vsts/git3.png)

    > [!NOTE]
    > Из-за различий в хранении информации о контроле версий в TFVC и Git компании Contoso рекомендуется не переносить историю. Это тот подход, который корпорация Майкрософт предприняла при переносе Windows и других продуктов из системы централизованного управления версиями в Git.

4. После импорта администраторы проверяют код.

    ![Git](./media/contoso-migration-tfs-vsts/git4.png)

5. Они повторяют процесс для второго репозитория (**$/SmartHotelContainer**).

    ![Git](./media/contoso-migration-tfs-vsts/git5.png)

6. После изучения источника команда разработки соглашается с тем, что переход на VSTS завершен. Теперь VSTS становится источником для всех операций разработки в командах, участвующих в миграции.

    ![Git](./media/contoso-migration-tfs-vsts/git6.png)



**Нужна дополнительная помощь?**

[Дополнительные сведения](https://docs.microsoft.com/vsts/git/import-from-tfvc?view=vsts) об импорте из TFVC.

##  <a name="clean-up-after-migration"></a>Очистка после миграции

После завершения миграции Contoso необходимо выполнить следующие действия:

- Ознакомиться со сведениями о дополнительных операциях [после импорта](https://docs.microsoft.com/vsts/articles/migration-post-import?view=vsts).
- Удалите репозитории TFVC или сделайте их доступными в режиме только для чтения. Базы кода не должны использоваться, но на них можно ссылаться для просмотра истории.

## <a name="next-steps"></a>Дополнительная информация

Компании Contoso понадобиться провести обучение работе с VSTS и Git для соответствующих участников команды.



