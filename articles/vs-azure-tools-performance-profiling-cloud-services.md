<properties 
   pageTitle="Тестирование производительности облачной службы"
   description="Протестируйте производительность облачной службы с помощью профилировщика Visual Studio"
   services="visual-studio-online"
   documentationCenter="n/a"
   authors="patshea123"
   manager="douge"
   editor="tlee" />
<tags 
   ms.service="visual-studio-online"
   ms.devlang="multiple"
   ms.topic="article"
   ms.workload="na"
   ms.tgt_pltfrm="na"
   ms.date="08/12/2015"
   ms.author="patshea" />

# Тестирование производительности облачной службы 

##Обзор

Производительность облачной службы можно проверить следующими способами.

- Воспользоваться системой диагностики Azure для сбора сведений о запросах и подключениях и просмотра статистики сайта, которые показывают, как работает служба с точки зрения клиента. Для начала работы см. [Настройка системы диагностики для облачных служб и виртуальных машин Azure](http://go.microsoft.com/fwlink/p/?LinkId=623009).

- Воспользоваться профилировщиком Visual Studio для выполнения глубокого анализа вычислительных аспектов работы службы. Как описано в этом разделе, с помощью профилировщика можно измерить производительность работы службы в Azure. Сведения о том, как использовать профилировщик для измерения производительности работы службы, запущенной локально в эмуляторе вычислений, см. в разделе [Тестирование производительности облачной службы Azure, запущенной локально в эмуляторе вычислений, с помощью профилировщика Visual Studio](http://go.microsoft.com/fwlink/p/?LinkId=262845).



## Выбор метода тестирования производительности

###Воспользуйтесь системой диагностики Azure для сбора:###

- статистики для веб-страниц или служб, такой как запросы и подключения;

- статистики по ролям, например, частоты перезапуска роли;

- общей информации об использовании памяти, например, процента времени, занимаемого сборщиком мусора, и набора памяти запущенной роли.

###Воспользуйтесь профилировщиком Visual Studio для:###

- определения функций, на выполнение которых уходит большая часть времени;

- измерения количества времени, которое занимает каждая часть программы с большим объемом вычислений;

- сравнения подробных отчетов о производительности для двух версий службы;

- анализа выделения памяти более подробно, чем на уровне отдельных выделений памяти;

- анализа проблем параллелизма в многопоточном коде.

С помощью профилировщика можно собирать данные при запуске облачной службы локально или в Azure.

###Сбор данных профилирования локально позволит:###

- протестировать производительность части облачной службы (например, выполнение определенной рабочей роли), которая не требует реалистичного моделирования нагрузки;

- протестировать производительность облачной службы изолированно в контролируемых условиях;

- протестировать производительность облачной службы перед ее развертыванием в Azure;

- протестировать производительность облачной службы в частном порядке, без нарушения работы существующих развертываний;

- протестировать производительность облачной службы без платы за ее запуск в Azure.

###Сбор данных профилирования в Azure позволит:###

- протестировать производительность облачной службы с моделируемой или реальной нагрузкой;

- использовать метод инструментирования для сбора данных профилирования, как описано далее в этом разделе;

- протестировать производительность облачной службы в среде, которая аналогична рабочей среде для запуска службы.

Нагрузка для тестирования облачных служб обычно моделируется для обычной или нештатной ситуации.

## Профилирование облачной службы в Azure

При публикации облачной службы из Visual Studio можно выполнить профилирование службы и задать параметры профилирования, которые позволят получить необходимую вам информацию. Сеанс профилирования запускается для каждого экземпляра роли. Дополнительные сведения о публикации службы из Visual Studio см. в разделе [Публикация в облачной службе Azure из Visual Studio](https://msdn.microsoft.com/library/azure/ee460772.aspx).

Чтобы узнать больше о профилировании производительности в Visual Studio, см. статьи [Руководство для начинающих по профилированию производительности](https://msdn.microsoft.com/library/azure/ms182372.aspx) и [Анализ производительности приложения с помощью инструментов профилирования](https://msdn.microsoft.com/library/azure/z9z62c29.aspx).

>[AZURE.NOTE]При публикации облачной службы можно включить IntelliTrace или профилирование. И то, и другое одновременно включить нельзя.

###Методы сбора данных профилировщика###
Для профилирования можно использовать различные методы сбора данных в зависимости от того, какую статистику по производительности необходимо получить:

- **Выборка из ЦП** — этот метод осуществляет сбор статистики приложения, которую удобно использовать для первоначального анализа проблем использования ЦП. Большинство исследований производительности рекомендуется начинать с выборки из ЦП. Сбор данных выборки ЦП не оказывает существенного влияния на профилируемое приложение.

- **Инструментирование** — этот метод осуществляет сбор подробных временных данных, которые удобно использовать для целенаправленного анализа и для анализа проблем производительности ввода/вывода. Метод инструментирования регистрирует каждый вход и выход из функции и каждый вызов функции для всех функций модуля во время профилирования. Этот метод удобен для сбора подробных временных данных для заданного фрагмента кода и для оценки влияния операций ввода/вывода на производительность приложения. На компьютерах, работающих под управлением 32-разрядных операционных систем, этот метод недоступен. Этот метод доступен только при запуске облачной службы в Azure, а не локально в эмуляторе вычислений.

- **Выделение памяти .NET** — этот метод осуществляет сбор данных о выделении памяти .NET Framework с помощью метода профилирования с выборкой. Собранные данные включают количество и размер выделенных объектов.

- **Параллелизм** — этот метод осуществляет сбор данных о конфликтах ресурсов и данных о выполнении процессов и потоков. Эти данные полезны для анализа многопоточных и многопроцессных приложений. Метод параллелизма собирает данные для каждого события, которое блокирует выполнение кода, например когда поток ожидает освобождения доступа к заблокированному ресурсу приложения. Этот метод удобен для анализа многопоточных приложений.

- Также можно включить **профилирование межуровневого взаимодействия**, которое предоставляет дополнительные сведения о времени выполнения синхронных вызовов ADO.NET в функциях многоуровневых приложений, взаимодействующих с одной или несколькими базами данных. Данные о межуровневом взаимодействии можно получить с помощью любого из методов профилирования. Дополнительные сведения о профилировании межуровневого взаимодействия см. в разделе [Представление межуровневого взаимодействия](https://msdn.microsoft.com/library/azure/dd557764.aspx).

## Настройка параметров профилирования

На рисунке ниже показано, как настроить параметры профилирования в диалоговом окне "Публикация приложения Azure".

![Настроить параметры профилирования](./media/vs-azure-tools-performance-profiling-cloud-services/IC526984.png)


### Для настройки параметров профилирования

1. Откройте контекстное меню проекта Azure в обозревателе решений и выберите **Опубликовать**. Подробные инструкции для публикации облачной службы см. в разделе [Публикация облачной службы с помощью инструментов Azure](http://go.microsoft.com/fwlink/p?LinkId=623012).

1. В диалоговом окне **Публикация приложения Azure** выберите вкладку **Дополнительные параметры**.

1. Чтобы включить профилирование, установите флажок **Включить профилирование**.

1. Чтобы настроить параметры профилирования, выберите гиперссылку **Параметры**. Откроется диалоговое окно "Параметры профилирования".

1. С помощью переключателей из раздела **Какой способ профилирования вы хотели бы использовать** выберите нужный тип профилирования.

1. Для сбора данных профилирования для межуровневого взаимодействия установите флажок **Включить профилирование межуровневого взаимодействия**.

1. Чтобы сохранить параметры, нажмите кнопку **ОК**. При публикации приложения эти параметры будут использованы для создания сеанса профилирования для каждой роли.

## Просмотр отчетов профилирования

Сеанс профилирования создается для каждого экземпляра роли в облачной службе. Для просмотра отчетов профилирования для каждой сессии в Visual Studio откройте окно обозревателя сервера и выберите вычислительный узел Azure, после чего выберите экземпляр роли. Затем вы сможете просмотреть отчет о профилировании, как показано на следующем рисунке.

![Просмотр отчета профилирования Azure](./media/vs-azure-tools-performance-profiling-cloud-services/IC748914.png)



### Для просмотра отчетов профилирования

1. Чтобы открыть окно обозревателя сервера в Visual Studio, выберите меню "Представление", затем "Обозреватель сервера".

1. Выберите вычислительный узел Azure и затем выберите узел развертывания Azure для облачной службы, которую вы выбрали для профилирования при публикации из Visual Studio.

1. Для просмотра отчетов о профилировании для экземпляра роли выберите роль в службе, откройте контекстное меню для заданного экземпляра роли и выберите "Просмотр отчета профилирования". Из Azure будет загружен отчет в виде VSP-файла, и состояние загрузки будет показано в Журнале действий Azure. После завершения загрузки отчет о профилировании откроется во вкладке под названием <Role name>\_<Instance Number>\_<identifier>.vsp в редакторе Visual Studio. Будут показаны сводные данные отчета.

1. Для отображения различных представлений отчета выберите необходимый тип представления в списке "Текущее представление". Дополнительные сведения см. в разделе [Представления отчетов инструментов профилирования](https://msdn.microsoft.com/library/bb385755.aspx).

## Дальнейшие действия

[Отладка облачных служб](http://go.microsoft.com/fwlink//p/?LinkID=62304)

[Публикация в облачной службе Azure из Visual Studio](http://go.microsoft.com/fwlink//p/?LinkID=623012)

<!---HONumber=August15_HO8-->