<properties urlDisplayName="Debug Websites (Node)" pageTitle="Способы отладки веб-сайтов Azure в Node.js" metaKeywords="отладка веб-сайта azure, отладка azure, устранение неполадок веб-сайта azure, устранение неполадок узла веб-сайта azure" description="Learn how to debug an Azure website in Node.js." metaCanonical="" services="web-sites" documentationCenter="nodejs" title="How to debug a Node.js application in Azure Websites" authors="larryfr" solutions="" manager="wpickett" editor="mollybos" />

<tags ms.service="web-sites" ms.workload="web" ms.tgt_pltfrm="na" ms.devlang="nodejs" ms.topic="article" ms.date="09/17/2014" ms.author="larryfr" />





#Настройка приложения Node.js для веб-сайтов Windows Azure

Windows Azure предоставляет встроенные средства диагностики, которые помогают настраивать приложения Node.js, размещенные на веб-сайтах Azure. В этой статье вы узнаете, как включить ведение журналов stdout и stderr, отображать сведения об ошибках в браузере, а также загружать и просматривать файлы журнала.

Диагностика для приложений Node.js, размещенных в Azure, обеспечивается с помощью [IISNode]. Хотя в данной статье рассматриваются наиболее общие параметры для сбора диагностических сведений, она не является полным справочником по работе с IISNode. Дополнительные сведения о работе с IISNode см. в разделе [Справка по IISNode] на GitHub.

##<a id="enablelogging"></a>Включение ведения журналов

По умолчанию веб-сайты Azure записывают только диагностические сведения о развертывании, например при развертывании веб-сайта с использованием Git. Эта информация полезна при возникновении проблем во время развертывания, таких как сбой при установке модуля, на который ссылается файл **package.json**, или при использовании пользовательского сценария развертывания.

Чтобы включить ведение журнала для потоков stdout и stderr, необходимо создать файл **IISNode.yml** в корне приложения Node.js и добавить следующий код:

	loggingEnabled: true

Это обеспечивает ведение журнала для потоков stderr и stdout из приложения Node.js.

Файл **IISNode.yml** может также использоваться для управления возвратом понятных пользователю сведений об ошибках или ошибках разработчика в браузер при сбое. Чтобы включить вывод сведений об ошибках разработчика, добавьте в файл **IISNode.yml** следующую строку:

	devErrorsEnabled: true

После включения этого параметра IISNode будет возвращать последние 64 КБ данных, отправленных в stderr, вместо понятного пользователю сообщения об ошибке, такого как "Внутренняя ошибка сервера".

<div class="dev-callout">
<strong>Примечание.</strong>
<p>Хотя параметр devErrorsEnabled полезен при диагностике проблем во время разработки, его включение в рабочей среде может привести к тому, что конечному пользователю будут отправляться ошибки разработки.</p>
</div>

Если файл **IISNode.yml** еще не существует в приложении, необходимо перезапустить веб-сайт после публикации обновленного приложения. При простом изменении настроек в существующем файле **IISNode.yml**, который ранее был опубликован, перезагрузка не требуется.

<div class="dev-callout">
<strong>Примечание.</strong>
<p>Если веб-сайт был создан с помощью средства командной строки Azure или командлетов PowerShell Azure, автоматически создается файл по умолчанию <strong>IISNode.yml</strong>.</p>
</div>

Чтобы перезапустить веб-сайт, выберите этот сайт на [портале управления Azure] и нажмите кнопку **ПЕРЕЗАГРУЗИТЬ**:

![restart button][кнопка перезагрузки]

Если в среде разработки установлены средства командной строки Azure, для перезагрузки воспользуйтесь следующей командой:

	azure site restart [sitename]

<div class="dev-callout">
<strong>Примечание.</strong>
<p>Хотя параметры конфигурации LoggingEnabled и devErrorsEnabled наиболее часто используются в IISNode.yml для сбора диагностических сведений, IISNode.yml можно использовать для настройки различных параметров среды размещения. Полный список параметров конфигурации см. в файле <a href="https://github.com/tjanczuk/iisnode/blob/master/src/config/iisnode_schema.xml">iisnode_schema.xml</a>.</p>
</div>

##<a id="viewlogs"></a>Доступ к журналам

Доступ к журналам диагностики может осуществляться тремя способами: с использованием протокола FTP (File Transfer Protocol), путем загрузки ZIP-архива или в режиме потока журнала с обновлением в реальном времени (также известного как заключительный фрагмент). Загрузка ZIP-архива файлов журналов или просмотр потока в режиме реального времени требует наличия средств командной строки Azure. Их можно установить с помощью следующей команды:

	npm install azure-cli -g

После установки доступ к данным средствам осуществляется с помощью команды "azure". Предварительно в средствах командной строки должно быть настроено использование подписки Azure. Сведения о том, как выполнить эту задачу, см. в разделе **Загрузка и импорт настроек публикации** статьи [Использование средств командной строки Azure].

###FTP

Чтобы получить доступ к диагностической информации через FTP, перейдите на [портал Azure], выберите свой веб-сайт, затем выберите команду **ПАНЕЛЬ МОНИТОРИНГА**. В разделе **быстрых ссылок** ссылки **ЖУРНАЛЫ ДИАГНОСТИКИ FTP** и **ЖУРНАЛЫ ДИАГНОСТИКИ FTPS** позволяют перейти к журналам с помощью протокола FTP.

<div class="dev-callout">
<strong>Примечание.</strong>
<p>Если имя пользователя и пароль для FTP или развертывания еще не указаны, это можно сделать на странице управления <strong>QuickStart</strong>, выбрав команду <strong>Настройка учетных данных для развертывания</strong>.</p>
</div>

URL-адрес FTP, возвращаемый в панели мониторинга, относится к каталогу **LogFiles**, который будет содержать следующие вложенные папки.

* [Метод развертывания]. При использовании такого метода развертывания, как Git, будет создан каталог с тем же именем, который будет содержать сведения, связанные с развертываниями.

* nodejs - данные Stdout и stderr, регистрируемые во всех экземплярах вашего приложения, если параметр loggingEnabled имеет значение true.

###ZIP-архив

Чтобы загрузить ZIP-архив журналов диагностики, выполните следующую команду в средствах командной строки Azure:

	azure site log download [sitename]

В результате в текущий каталог будет помещен файл **diagnostics.zip**. Данный архив содержит следующую структуру каталогов:

* deployments - журнал сведений о развертываниях вашего приложения.

* LogFiles

	* [Метод развертывания]. При использовании такого метода развертывания, как Git, будет создан каталог с тем же именем, который будет содержать сведения, связанные с развертываниями.

	* nodejs - данные Stdout и stderr, регистрируемые во всех экземплярах вашего приложения, если параметр loggingEnabled имеет значение true.

###Поток в реальном времени (заключительный фрагмент)

Чтобы просмотреть поток журналов диагностики в реальном времени, выполните следующую команду в средствах командной строки Azure:

	azure site log tail [sitename]

В результате будет возвращен поток событий журнала, которые обновляются по мере их возникновения на сервере. Этот поток будет возвращать сведения о развертывании, а также сведения stdout и stderr (если параметр loggingEnabled имеет значение true).

##<a id="nextsteps"></a>Дальнейшие действия

В этой статье вы узнали, как включить данные диагностики для Azure и получить к ним доступ. Эта информация полезна для понимания проблем, возникающих в приложении. Кроме того, с ее помощью можно выявить проблему с используемым модулем, несоответствие версии Node.js, используемой для веб-сайтов Azure, и версии среды развертывания.

Сведения по работе с модулями Azure см. в разделе [Использование модулей Node.js с приложениями Azure].

Сведения об определении версии Node.js для своего приложения см. в разделе [Установка версии Node.js в приложении Azure].

[IISNode]: https://github.com/tjanczuk/iisnode
[Справка по IISNode]: https://github.com/tjanczuk/iisnode#readme
[Использование средств командной строки Azure]: /ru-ru/documentation/articles/xplat-cli/
[Использование модулей Node.js с приложениями Azure]: /ru-ru/documentation/articles/nodejs-use-node-modules-azure-apps/
[Установка версии Node.js в приложении Azure]: /ru-ru/documentation/articles/nodejs-specify-node-version-azure-apps/
[Портал управления Azure]: https://manage.windowsazure.com/

[кнопка перезагрузки]: ./media/web-sites-nodejs-debug/restartbutton.png
