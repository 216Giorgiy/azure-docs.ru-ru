---
title: Использование Экземпляров контейнеров Azure в качестве агента сборки Jenkins
description: Сведения о том, как использовать Экземпляры контейнеров Azure в качестве агента сборки Jenkins.
services: container-instances
author: neilpeterson
manager: jeconnoc
ms.service: container-instances
ms.topic: article
ms.date: 04/20/2018
ms.author: nepeters
ms.openlocfilehash: dbe418db8fb3d73739a30b60703f15b3dc47b291
ms.sourcegitcommit: fa493b66552af11260db48d89e3ddfcdcb5e3152
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2018
---
# <a name="use-azure-container-instances-as-a-jenkins-build-agent"></a>Использование Экземпляров контейнеров Azure в качестве агента сборки Jenkins

Экземпляры контейнеров Azure предоставляют доступную по требованию изолированную среду выполнения с накапливаемыми ресурсами для контейнерных рабочих нагрузок. Эти характеристики делают экземпляры контейнеров Azure отличной платформой для масштабного выполнения заданий сборки Jenkins. В этом документе описано, как развертывать и использовать сервер Jenkins, для которого целевым объектом сборки указаны экземпляры контейнеров Azure.

См. дополнительные сведения об [экземплярах контейнеров Azure][about-aci].

## <a name="deploy-jenkins-server"></a>Развертывание сервера Jenkins

На портале Azure выберите **Создать ресурс** и выполните поиск по строке **Jenkins**. Выберите предложения Jenkins, издателем для которого указана корпорация **Microsoft**, и щелкните **Создать**.

Введите следующие сведения в форму и щелкните **ОК**.

- **Имя**. Произвольное имя для развертывания Jenkins.
- **Имя пользователя**. Используется для администрирования виртуальной машины Jenkins.
- **Тип проверки подлинности**. Здесь мы рекомендуем выбрать "Открытый ключ SSH". Если этот флажок установлен, скопируйте сюда открытый ключ SSH, который будет использоваться при входе на виртуальную машину Jenkins.
- **Подписка**. Выберите нужную подписку Azure.
- **Группа ресурсов.** Создайте новую группу ресурсов или выберите существующую.
- **Расположение**. Выберите расположение для сервера Jenkins.

![Основные параметры для развертывания портала Jenkins](./media/container-instances-jenkins/jenkins-portal-01.png)

В форме дополнительных параметров заполните следующие данные:

- **Размер**. Выберите соответствующий вариант для виртуальной машины Jenkins.
- **Тип диска виртуальной Машины**. Выберите для сервера Jenkins один из двух вариантов: HDD (жесткий диск) или SSD (твердотельный накопитель).
- **Виртуальная сеть** (необязательно). Выберите виртуальную сеть, чтобы изменить настройки по умолчанию.
- **Подсети**. Выберите нужные подсети, проверьте информацию о них и щелкните **ОК**.
- **Общедоступный IP-адрес**. Для IP-адреса вы можете присвоить произвольное имя, настроить SKU и (или) способ назначения.
- **Метка доменного имени**. Укажите это значение, чтобы создать полный URL-адрес для виртуальной машины Jenkins.
- **Тип выпуска Jenkins**.Выберите один из следующих вариантов: LTS, Weekly build или Azure Verified.

![Дополнительные параметры для развертывания портала Jenkins](./media/container-instances-jenkins/jenkins-portal-02.png)

Для параметра интеграции субъекта-службы выберите значение **Auto(MSI)**, чтобы [служба управляемых удостоверений Azure][managed-service-identity] автоматически создала удостоверение аутентификации для этого экземпляра Jenkins. Выберите режим "Вручную", если вы можете предоставить собственные учетные данные для субъекта-службы.

Облачные агенты настраивают облачную платформу для заданий сборки Jenkins. Для работы с этим документом выберите ACI. Облачный агент ACI запускает каждое задание сборки Jenkins в отдельном Экземпляре контейнера Azure.

![Параметры интеграции с облаком для развертывания портала Jenkins](./media/container-instances-jenkins/jenkins-portal-03.png)

Когда вы завершите настройку интеграции, щелкните **ОК**, а затем еще раз **ОК** на странице со сводной информацией о проверке. Щелкните **Создать** на странице сводной информации об условиях использования. Развертывание сервера Jenkins занимает несколько минут.

## <a name="configure-jenkins"></a>Настройка Jenkins

На портале Azure перейдите к группе ресурсов Jenkins, выберите виртуальную машину Jenkins и запишите ее DNS-имя.

![Инструкции по входу в Jenkins](./media/container-instances-jenkins/jenkins-portal-fqdn.png)

Откройте в браузере страницу с DNS-именем виртуальной машины Jenkins и скопируйте полученную строку SSH.

![Инструкции по входу в Jenkins](./media/container-instances-jenkins/jenkins-portal-04.png)

Откройте сеанс терминала в системе разработки и вставьте в него строку SSH, полученную на последнем шаге. Вместо строки username укажите имя пользователя, которое вы выбрали при развертывании сервера Jenkins.

Подключившись к серверу, введите следующую команду, чтобы получить исходный пароль администратора.

```
sudo cat /var/lib/jenkins/secrets/initialAdminPassword
```

Завершите сеанс SSH и отключите туннель, затем откройте в браузере адрес http://localhost:8080. Вставьте исходный пароль в соответствующее поле, как показано на следующем рисунке. Когда все будет готово, щелкните **Продолжить**.

![Разблокировка Jenkins](./media/container-instances-jenkins/jenkins-portal-05.png)

Выберите действие **Установить предлагаемые подключаемые модули**, чтобы установить все рекомендуемые подключаемые модули Jenkins.

![Установка подключаемого модуля Jenkins](./media/container-instances-jenkins/jenkins-portal-06.png)

Создайте новую учетную запись администратора. Эта учетная запись потребуется для входа на экземпляр Jenkins и работы с ним.

![Создание пользователя Jenkins](./media/container-instances-jenkins/jenkins-portal-07.png)

Когда все будет готово, выберите **Сохранить и завершить**, а затем **Начать работу с Jenkins**, чтобы завершить процесс настройки.

Итак, конфигурация Jenkins завершена, и можно переходить к сборке и развертыванию кода. В этом примере для демонстрации сборки Jenkins на экземплярах контейнера Azure используется простое приложение Java.

## <a name="create-build-job"></a>Создание задания сборки

Если в качестве целевого объекта для сборки Jenkins используется образ контейнера, в указанном образе должны содержаться все необходимые средства для успешной сборки. Чтобы указать образ, выберите **Управление Jenkins** > **Настройка системы** и прокрутите вниз до раздела **Облако**. Для этого примера укажите значение `microsoft/java-on-azure-jenkins-slave` для образа Docker.

После этого щелкните **Сохранить**, чтобы вернуться на панель мониторинга Jenkins.

![Конфигурация облака в Jenkins](./media/container-instances-jenkins/jenkins-aci-image.png)

Теперь создайте задание сборки Jenkins. Выберите **Новый элемент**, присвойте проекту сборки произвольное имя, например `aci-java-demo`, затем выберите тип **Универсальный проект** и щелкните **ОК**.

![Создание задания Jenkins](./media/container-instances-jenkins/jenkins-new-job.png)

В разделе **Общие** проверьте, что установлен флажок **Ограничения для запуска этого проекта**. В поле "Выражение метки" введите `linux`. Такая конфигурация гарантирует, что это задание сборки будет выполняться только в облаке экземпляров контейнеров Azure.

![Создание задания Jenkins](./media/container-instances-jenkins/jenkins-job-01.png)

В разделе управления исходным кодом выберите `Git` и введите `https://github.com/spring-projects/spring-petclinic.git` в поле URL-адреса репозитория. Репозиторий GitHub содержит пример кода для приложения.

![Добавление исходного кода в задание Jenkins](./media/container-instances-jenkins/jenkins-job-02.png)

В разделе "Сборка" выберите действие **Добавить шаг сборки** и щелкните `Invoke top-level Maven targets`. Введите `package` в качестве целевого объекта для шага сборки.

![Добавление шага сборки Jenkins](./media/container-instances-jenkins/jenkins-job-03.png)

По завершении нажмите кнопку **Сохранить**.

## <a name="run-the-build-job"></a>Запустите задание сборки.

Чтобы проверить задание сборки и увидеть, как экземпляры контейнеров Azure используются в качестве платформы сборки, запустите сборку вручную.

Выберите **Начать сборку**, чтобы начать сборку. Запуск задания занимает несколько минут. Когда оно выполняется, его состояние будет примерно таким, как на следующих изображениях.

![Добавление шага сборки Jenkins](./media/container-instances-jenkins/jenkins-job-status.png)

Пока выполняется задание, откройте портал Azure и найдите группу ресурсов Jenkins. Здесь вы увидите, что создан новый экземпляр контейнера Azure. Внутри этого экземпляра выполняется задание Jenkins.

![Сборка Jenkins в экземпляре контейнера Azure](./media/container-instances-jenkins/jenkins-aci.png)

Если Jenkins выполняет больше заданий, чем настроенное число исполнителей Jenkins (по умолчанию 2), он создает несколько экземпляров контейнера Azure.

![Сборка Jenkins в экземпляре контейнера Azure](./media/container-instances-jenkins/jenkins-aci-multi.png)

После завершения всех заданий сборки все экземпляры контейнеров Azure удаляются.

![Сборка Jenkins в экземпляре контейнера Azure](./media/container-instances-jenkins/jenkins-aci-none.png)

## <a name="next-steps"></a>Дополнительная информация

Дополнительные сведения об использовании Jenkins в Azure см. в статье [Jenkins в Azure][jenkins-azure].

<!-- LINKS - internal -->
[about-aci]: ./container-instances-overview.md
[jenkins-azure]: ../jenkins/overview.md
[managed-service-identity]: ../active-directory/managed-service-identity/overview.md