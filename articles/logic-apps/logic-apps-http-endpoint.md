---
title: "Вызовы, срабатывания триггеров и создание вложенных рабочих процессов для приложений логики с помощью конечных точек HTTP — приложения логики Azure | Документация Майкрософт"
description: "Добавление и настройка конечных точек HTTP для вызова, срабатывания триггеров или создания вложенных рабочих процессов для приложений логики в Azure"
services: logic-apps
documentationcenter: .net,nodejs,java
author: jeffhollan
manager: anneta
editor: 
ms.assetid: 73ba2a70-03e9-4982-bfc8-ebfaad798bc2
ms.service: logic-apps
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: integration
ms.custom: H1Hack27Feb2017
ms.date: 10/18/2016
ms.author: jehollan
translationtype: Human Translation
ms.sourcegitcommit: 1e6ae31b3ef2d9baf578b199233e61936aa3528e
ms.openlocfilehash: 8c4cb0aefcd7241b17c6afcf33496c1fc2e6f675
ms.lasthandoff: 03/03/2017

---

# <a name="add-http-endpoints-to-call-trigger-or-nest-logic-app-workflows"></a>Добавление и настройка конечных точек HTTP для вызова, срабатывания триггеров или создания вложенных рабочих процессов для приложений логики

Приложения логики могут предоставлять доступ к синхронным конечным точкам HTTP, выступающим в качестве триггеров, с помощью которых можно вызывать приложения логики. Также можно использовать схему вызываемых конечных точек для вызова приложений логики в виде вложенных рабочих процессов. Для этого нужно добавить в приложение логики действие **Выбор рабочего процесса приложения логики**.

Для получения запросов можно использовать следующие триггеры:

* Запрос
* apiConnectionWebhook,
* httpWebhook.

В этом разделе в качестве примера используется триггер **Request**, но все принципы точно так же применяются к триггерам других типов.

## <a name="add-a-trigger-to-your-logic-app-definition"></a>Добавление триггера в определение приложения логики

1. В конструкторе приложений логики добавьте триггер, который может принимать входящие запросы, в определение приложения логики. Например, добавьте триггер **Request** в приложение логики.

2.    В разделе **Схема JSON текста запроса** можно ввести схему JSON для полезных данных, которые будут получены. Если у вас нет схемы, выберите **Использовать полезную нагрузку из примера для создания схемы**, чтобы создать схему JSON из примера полезных данных.

    Конструктор использует эту схему для создания маркеров, которые помогают использовать, анализировать и передавать данные от триггера через рабочий процесс.

    ![Добавление действия Request][2]

2.    Сохранив определение приложения логики, вы получите URL-адрес созданного обратного вызова в поле **HTTP POST на этот URL-адрес**, как в следующем примере:

    ``` text
    https://prod-03.eastus.logic.azure.com:443/workflows/080cb66c52ea4e9cabe0abf4e197deff/triggers/myendpointtrigger?*signature*...
    ```

    Этот URL-адрес содержит ключ подписанного URL-адреса в параметрах запроса, используемого для проверки подлинности. 
    Эту конечную точку также можно получить на портале Azure:

    ![URL-адрес конечной точки][1]

    Или путем вызова:

    ``` text
    POST https://management.azure.com/{resourceID of your logic app}/triggers/myendpointtrigger/listCallbackURL?api-version=2015-08-01-preview
    ```

### <a name="change-the-http-method-for-your-trigger"></a>Изменение метода HTTP для триггера

По умолчанию триггер Request ожидает запрос HTTP POST. Чтобы настроить другой метод HTTP, выберите **Показать дополнительные параметры**.

> [!NOTE]
> Допускается только один тип метода.

### <a name="customize-the-relative-trigger-url"></a>Настройка относительного URL-адреса триггера

Также можно настроить относительный путь URL-адреса запроса для передачи параметров.

1. Для триггера **Request** выберите **Показать дополнительные параметры**. В разделе **Относительный путь** введите `customer/{customerId}`.

    ![Относительный URL-адрес триггера](./media/logic-apps-http-endpoint/relativeurl.png)

2.    Для использования параметра обновите действие **Response**.

    *    В средстве выбора маркеров должен появиться `customerId`.
    *    Обновите текст действия **Response**, чтобы оно возвращало `Hello {customerId}`.

    ![Относительный URL-адрес ответа](./media/logic-apps-http-endpoint/relativeurlresponse.png)

3. Сохраните приложение логики. URL-адрес запроса изменяется, и теперь в нем указан относительный путь.

4. Скопируйте новый URL-адрес запроса и вставьте его в новое окно браузера. Замените `{customerId}` на `123` и нажмите клавишу ВВОД.

    Вы должны получить следующий текст: `Your customer Id is 123`.

### <a name="security-for-the-trigger-url"></a>Безопасность URL-адреса триггера

Безопасность при создании URL-адресов обратного вызова для приложений логики обеспечивается с помощью подписанного URL-адреса. Подпись передается в качестве параметра запроса и проверяется перед запуском приложения логики. Подпись создается на основе уникального сочетания секретного ключа для каждого приложения логики, имени триггера и выполняемой операции. Не имея доступа к секретному ключу приложения логики, создать действительную подпись невозможно.

## <a name="call-your-logic-app-triggers-endpoint"></a>Вызов конечной точки триггера для приложения логики

После создания конечной точки можно вызвать приложение логики, добавив метод `POST` к полному URL-адресу. В текст можно включать дополнительные заголовки и любое другое содержимое. При использовании типа содержимого `application/json` можно ссылаться на свойства из самого запроса. В противном случае содержимое считается отдельной двоичной единицей, которая может передаваться в другие API-интерфейсы, но на которую нельзя ссылаться внутри рабочего процесса, пока содержимое не будет преобразовано. Например, если передать содержимое `application/xml`, можно использовать `@xpath()` для извлечения XPath или `@json()` для преобразования XML в JSON. Дополнительные сведения о [работе с типами содержимого](../logic-apps/logic-apps-content-type.md).

Схему JSON также можно указать в определении. При использовании этой схемы конструктор создаст маркеры, которые затем можно будет передать в действия. Например, в следующем примере маркеры `title` и `name` доступны в конструкторе:

```
{
    "properties":{
        "title": {
            "type": "string"
        },
        "name": {
            "type": "string"
        }
    },
    "required": [
        "title",
        "name"
    ],
    "type": "object"
}
```

## <a name="reference-the-content-from-the-incoming-request"></a>Ссылка на содержимое входящего запроса

Функция `@triggerOutputs()` выводит содержимое входящего запроса. Результаты выглядят следующим образом.

```
{
    "headers" : {
        "content-type" : "application/json"
    },
    "body" : {
        "myprop" : "a value"
    }
}
```

Для доступа к свойству `body` можно использовать сокращенный вариант `@triggerBody()`. 

## <a name="respond-to-the-request"></a>Ответ на запрос

Для некоторых запросов, которые запускают приложение логики, можно передать определенное содержимое вызывающему объекту. Для составления кода состояния, текста и заголовков ответа можно использовать тип действия **Response**. Но если действие **Response** не включено, конечная точка приложения логики *немедленно* возвращает ответ **202 Accepted**.

![Действие ответа HTTP][3]

``` json
"Response": {
        "conditions": [],
        "inputs": {
            "body": {
                "name": "@{triggerBody()['name']}", 
                    "title": "@{triggerBody()['title']}"
            },
            "headers": {
                "content-type": "application/json"
            },
            "statusCode": 200
        },
        "type": "Response"
}
```

У ответов есть следующие свойства:

| Свойство | Описание |
| --- | --- |
| statusCode |Код состояния HTTP для ответа на входящий запрос. Это может быть любой допустимый код состояния, который начинается с 2xx, 4xx или 5xx. Но коды состояния 3xx не допускаются. |
| текст |Тело ответа. Это может быть строка, объект JSON и даже двоичное содержимое из предыдущего шага. |
| headers |В ответ можно включить любое число заголовков. |

В приложении логики для получения ответа на исходный запрос следует завершить все шаги, необходимые для получения ответа, в течение *60 секунд*. Исключение составляет только *вызов рабочего процесса в качестве вложенного приложения логики*. Если в течение 60 секунд ответ не получен, срок действия входящего запроса истечет, и будет получен ответ HTTP **408 Client timeout**. Для вложенных приложений логики родительское приложение логики будет ожидать ответ до конца, независимо от того, сколько времени на это потребуется.

## <a name="advanced-endpoint-configuration"></a>Расширенная настройка конечной точки

Приложения логики имеют встроенную поддержку конечной точки прямого доступа и всегда используют метод `POST` для запуска приложения логики. Ранее приложение API **Прослушиватель HTTP** также поддерживало изменение сегментов URL-адреса и метода HTTP. Также можно настроить дополнительную защиту или пользовательский домен, добавив эти компоненты в узел приложения API (веб-приложение, в котором находится приложение API). 

С помощью **управления API** доступны следующие функции:

* [Изменение метода запроса](https://msdn.microsoft.com/library/azure/dn894085.aspx#SetRequestMethod)
* [Изменение сегментов URL-адреса запроса](https://msdn.microsoft.com/library/azure/7406a8ce-5f9c-4fae-9b0f-e574befb2ee9#RewriteURL)
* Настройка доменов управления API на вкладке **Настройка** классического портала Azure.
* Настройка политики для проверки базовой проверки подлинности.

## <a name="summary-of-migration-from-2014-12-01-preview"></a>Отличия от версии 2014-12-01-preview

| 2014-12-01-preview | 2016-06-01 |
| --- | --- |
| Щелкните приложение API **Прослушиватель HTTP**. |Щелкните **Ручной триггер** (приложение API не требуется). |
| Параметр прослушивателя HTTP*Sends response automatically*(Отправляет ответ автоматически). |Добавьте действие **Response** в определение рабочего процесса или не делайте этого. |
| Настройка базовой проверки подлинности или OAuth |с помощью управления API |
| Настройка метода HTTP |с помощью управления API |
| Настройка относительного пути |с помощью управления API |
| Ссылка на текст входящего ответа через `@triggerOutputs().body.Content` |Ссылка через `@triggerOutputs().body` |
| **Отправка HTTP-ответа** для прослушивателя HTTP. |Щелкните **Ответить на запрос HTTP** (приложение API не требуется) |

[1]: ./media/logic-apps-http-endpoint/manualtriggerurl.png
[2]: ./media/logic-apps-http-endpoint/manualtrigger.png
[3]: ./media/logic-apps-http-endpoint/response.png

