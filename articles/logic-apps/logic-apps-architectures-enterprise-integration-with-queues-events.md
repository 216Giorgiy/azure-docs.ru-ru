---
title: Эталонная архитектура Azure Integration Services
description: Эталонная архитектура, показывающая, как реализовать корпоративный шаблон интеграции с помощью Logic Apps, управления API Azure, служебной шины и службы "Сетка событий".
author: mattfarm
manager: jonfan
editor: ''
services: logic-apps api-management
documentationcenter: ''
ms.assetid: ''
ms.service: logic-apps
ms.workload: logic-apps
ms.tgt_pltfrm: ''
ms.devlang: ''
ms.topic: article
ms.date: 06/15/2018
ms.author: LADocs; estfan
ms.openlocfilehash: db3350b3c70f6e6f35949e8423334061849b7b37
ms.sourcegitcommit: 16ddc345abd6e10a7a3714f12780958f60d339b6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/19/2018
ms.locfileid: "36232211"
---
# <a name="enterprise-integration-with-queues-and-events-reference-architecture"></a>Эталонная архитектура корпоративной интеграции с использованием очередей и событий

## <a name="overview"></a>Обзор

В этой эталонной архитектуре показан набор проверенных практик для приложения интеграции, которое использует Azure Integration Services. Эта архитектура может служить основой для многих шаблонов приложений, требующих API HTTP, рабочего процесса и оркестрации.

*Есть множество возможных применений технологии интеграции: от простого приложения "точка — точка" до полной служебной шины предприятия. В этой серии наборов архитектуры изложены компоненты многократного использования для создания любого приложения интеграции. Архитекторы должны учитывать компоненты, которые им понадобятся для своих приложений и инфраструктуры.*

![Корпоративная интеграция с использованием очередей и событий. Схема архитектуры.](media/logic-apps-architectures-enterprise-integration-with-queues-events/integr_queues_events_arch_diagram.png)

## <a name="architecture"></a>Архитектура

Эта архитектура создана на основе архитектуры, описанной в статье [Простая Корпоративная интеграция. Эталонная архитектура](logic-apps-architectures-simple-enterprise-integration.md). Она содержит следующие компоненты:

- группа ресурсов; Группа ресурсов — это логический контейнер для ресурсов Azure.
- Управление API Azure. Управление API Azure — это полностью управляемая платформа для публикации, обеспечения безопасности и трансформации API HTTP.
- Портал разработчика службы "Управление API". Каждый экземпляр службы "Управление API Azure" включает портал разработчиков, предоставляющий доступ к документации, примерам кода и возможностям тестирования API.
- Azure Logic Apps. Logic Apps — это независимая от сервера платформа для создания корпоративных рабочих процессов и интеграции.
- Соединители. Соединители используются Logic Apps для подключения к часто используемым службам. Logic Apps уже имеет сотни различных соединителей, также они могут создаваться с помощью пользовательского соединителя.
- Служебная шина Azure. Служебная шина обеспечивает безопасный и надежный обмен сообщениями. Сообщения могут использоваться для открепления приложений друг от друга и интеграции с другими системами на основе сообщений.
- Сетка событий Azure. Сетка событий — это независимая от сервера платформа для публикации и доставки событий приложения.
- IP-адрес. Служба "Управление API Azure" имеет фиксированный общедоступный IP-адрес и имя домена. Имя домена представляет собой поддомен azure-api.net, например contoso.azure-api.net. Logic Apps и служебная шина также имеют общедоступный IP-адрес; однако в этой архитектуре мы ограничиваем доступ к конечным точкам приложения Logic Apps только IP-адресом управления API (для обеспечения безопасности). Вызовы к служебной шине защищены с помощью подписанного URL-адреса.
- Azure DNS. Azure DNS является службой размещения для доменов DNS, предоставляющей разрешение имен с помощью инфраструктуры Microsoft Azure. Размещая домены в Azure, вы можете управлять своими записями DNS с помощью тех же учетных данных, API и инструментов и оплачивать использование, как и другие службы Azure. Чтобы использовать пользовательское доменное имя, (например contoso.com), создайте записи DNS, которые позволяют сопоставить это доменное имя с IP-адресом. Дополнительные сведения см. в статье о настройке имени личного домена в службе "Управление API Azure".
- Azure Active Directory (Azure AD). Выполняйте аутентификацию при помощи Azure AD или другого поставщика удостоверений. Azure AD обеспечивает проверку подлинности для доступа к конечным точкам API (путем передачи JSON Web Token для службы "Управление API" на проверку) и может обеспечить доступ к порталу разработчиков службы "Управление API" (только для уровней "Стандартный" и "Премиум").

В этой архитектуре предусмотрены некоторые основные шаблоны ее работы:

1. Существующие серверные API-интерфейсы HTTP публикуются на портале разработчика службы "Управление API", что позволяет разработчикам (либо внутренним разработчикам организации, либо внешним) интегрировать вызовы этих API-интерфейсов в приложения.
2. Составные API созданы с помощью Logic Apps. Они оркеструют вызовы к системам SAAS, службам Azure и любым API, опубликованным в службе "Управление API". Кроме того, Logic Apps публикуются через портал разработчика службы "Управление API".
3. Приложения получают маркер безопасности OAuth 2.0, необходимый для доступа к API, с помощью Azure Active Directory.
4. Служба "Управление API Azure" проверяет маркер безопасности и передает запрос серверному API или приложению логики.
5. Очереди служебной шины используются для отделения действий приложения и сглаживания всплесков нагрузки. Сообщения добавляются в очереди приложениями Logic Apps, сторонними приложениями или (не показано) путем публикации очереди в качестве HTTP API через управление API.
6. При добавлении сообщений в очередь служебной шины запускается событие. Приложение логики запускается этим событием и обрабатывает сообщение.
7. Аналогичным образом другие службы Azure (например, хранилище BLOB-объектов, концентратор событий) также публикуют события в службу "Сетка событий". Это вызывает приложение логики для получения событий и выполнения последующих действий.

## <a name="recommendations"></a>Рекомендации

Описанная здесь архитектура может не соответствовать вашим требованиям. Используйте рекомендации из этого раздела в качестве отправной точки.

### <a name="service-bus-tier"></a>Уровень служебной шины

Используйте служебную шину уровня "Премиум", так как в настоящее время он поддерживает уведомления сетки событий (ожидается поддержка для всех уровней). Сведения о ценах на служебную шину см. [здесь](https://azure.microsoft.com/pricing/details/service-bus/).

### <a name="event-grid-pricing"></a>Сведения о ценах на службу "Сетка событий"

Служба "Сетка событий" работает с использованием безсерверной модели, а счета выставляются на основе количества операций (выполнение события). Дополнительные сведения см. на странице расценок [за использование службы "Сетка событий"](https://azure.microsoft.com/pricing/details/event-grid/). В службе "Сетка событий" в настоящее время нет требований по уровню.

### <a name="use-peeklock-when-consuming-service-bus-messages"></a>Использование PeekLock при получении сообщений служебной шины

При создании приложений логики для получения сообщений служебной шины используйте [PeekLock](../service-bus-messaging/service-bus-fundamentals-hybrid-solutions.md#queues) для доступа к группе сообщений. Приложение логики затем может выполнить шаги для проверки каждого сообщения перед завершением или отменой. Такой подход защищает от случайной потери сообщений.

### <a name="check-for-multiple-objects-when-an-event-grid-trigger-fires"></a>Поиск нескольких объектов при срабатывании триггера службы "Сетка событий"

Срабатывание триггеров службы "Сетка событий" означает, что по крайней мере 1 из этих событий произошло. Например, когда служба "Сетка событий" запускает приложение логики в ответ на появление сообщения в очереди служебной шины, приложение всегда должно предполагать, что для обработки может быть доступно одно или несколько сообщений.

### <a name="region"></a>Регион

Подготовьте службу "Управление API", Logic Apps и служебную шину в одном регионе, чтобы свести к минимуму задержки в сети. Обычно лучше выбирать регион, ближайший к пользователям приложения.

Группа ресурсов также привязана к региону, в котором хранятся метаданные развертывания и из которого выполняются шаблоны использования. Поместите группу ресурсов и все ее ресурсы в один регион. Это повысит доступность во время развертывания.

## <a name="scalability-considerations"></a>Вопросы масштабируемости

Служебная шина Azure уровня "Премиум" может горизонтально масштабировать число единиц обмена сообщениями для достижения более высокой масштабируемости. Уровень "Премиум" может иметь 1, 2 или 4 единицы обмена сообщениями. Дополнительные сведения см. в статье [Рекомендации по повышению производительности с помощью обмена сообщениями через служебную шину](../service-bus-messaging/service-bus-performance-improvements.md).

## <a name="availability-considerations"></a>Вопросы доступности

На момент написания статьи для службы управления API Azure действует соглашение об уровне обслуживания с доступностью 99,9 % для уровней "Базовый", "Стандартный" и "Премиум". Конфигурации уровня "Премиум" с развертыванием по крайне мере одной единицы в двух и более регионах имеют соглашение об уровне обслуживания с доступностью 99,95 %.

На момент написания статьи для Azure Logic Apps предоставляется соглашение об уровне обслуживания (SLA) на уровне 99,9 %.

### <a name="disaster-recovery"></a>Аварийное восстановление

Для служебной шины Azure уровня "Премиум" рекомендуется реализовать географически распределенное аварийное восстановление для отработки отказа при серьезном сбое. Дополнительные сведения см. в статье [Географическое аварийное восстановление в служебной шине Azure](../service-bus-messaging/service-bus-geo-dr.md).

## <a name="manageability-considerations"></a>Вопросы управляемости

Создайте отдельные группы ресурсов для рабочей среды, сред разработки и тестирования. Так будет проще управлять развертыванием, удалять тестовые развертывания и назначать права доступа.
При назначении ресурсов в группы ресурсов учитывайте следующие факторы:

- Жизненный цикл. Обычно в группу ресурсов лучше объединять ресурсы с одинаковым жизненным циклом.
- Доступ. С помощью [управления доступом на основе ролей](../role-based-access-control/overview.md) (RBAC) вы можете применить политики доступа к ресурсам в группе.
- Выставление счетов. Вы сможете просматривать сведенные затраты для группы ресурсов.
- Ценовая категория для службы "Управление API". Мы рекомендуем использовать уровень разработки для сред разработки и тестирования. В подготовительной среде мы рекомендуем развернуть реплику производственной среды, выполнить тесты, а затем завершить работу, чтобы минимизировать затраты.

Дополнительные сведения см. в статье [Общие сведения о диспетчере ресурсов Azure](../azure-resource-manager/resource-group-overview.md).

### <a name="deployment"></a>Развертывание

Мы рекомендуем использовать [шаблоны Azure Resource Manager](../azure-resource-manager/resource-group-authoring-templates.md) для развертывания службы "Управление API Azure", Logic Apps, службы "Сетка событий" и служебной шины. Шаблоны облегчают автоматическое развертывание с помощью PowerShell или интерфейса командной строки Azure.

Корпорация Майкрософт рекомендует размещать службу "Управление API", любые отдельные экземпляры Logic Apps, разделы службы "Сетка событий" и пространства имен служебной шины в собственных шаблонах Resource Manager. Это позволит хранить их в системах управления версиями. Затем эти шаблоны можно развернуть вместе или по отдельности в рамках непрерывной интеграции и непрерывного развертывания (CI/CD).

### <a name="diagnostics-and-monitoring"></a>Диагностика и мониторинг

Служебную шину, ​​как и управление API и Logic Apps, можно отслеживать с помощью Azure Monitor. Azure Monitor включен по умолчанию и предоставляет сведения с учетом различных метрик, настроенных для каждой службы.

## <a name="security-considerations"></a>Вопросы безопасности

Защитите служебную шину с помощью подписанного URL-адреса (SAS). [Проверка подлинности SAS](../service-bus-messaging/service-bus-sas.md) позволяет предоставлять пользователю доступ к ресурсам служебной шины с определенными правами. Дополнительные сведения см. в статье [Аутентификация и авторизация в служебной шине](../service-bus-messaging/service-bus-authentication-and-authorization.md).

Кроме того, если очередь служебной шины должна быть предоставлена ​​как конечная точка HTTP (чтобы разрешить публикацию новых сообщений), для ее защиты путем превращения в интерфейсную следует использовать управление API. Затем при необходимости можно обеспечить защиту с помощью сертификатов или OAuth. Проще всего использовать приложения логики с триггером запросов и ответов HTTP в качестве посредника.

Служба "Сетка событий" защищает доставку событий с помощью кода проверки. Если вы используете приложения логики для использования события, это выполняется автоматически. Дополнительные сведения см. в статье [Сетка событий Azure: безопасность и проверка подлинности](../event-grid/security-authentication.md).

## <a name="next-steps"></a>Дополнительная информация

* [Простая Корпоративная интеграция. Эталонная архитектура](logic-apps-architectures-simple-enterprise-integration.md)
