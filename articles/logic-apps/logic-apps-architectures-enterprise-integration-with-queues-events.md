---
title: Шаблон архитектуры корпоративной интеграции в Azure Integration Services
description: В этой эталонной архитектуре показано, как реализовать шаблон корпоративной интеграции с помощью Azure Logic Apps, Службы управления Azure API, Служебной шины Azure и Сетки событий Azure.
services: logic-apps
ms.service: logic-apps
ms.suite: integration
author: mattfarm
ms.author: mattfarm
ms.reviewer: jonfan, estfan, LADocs
ms.topic: article
ms.date: 06/15/2018
ms.openlocfilehash: 2ffb1f7edef0cf92cbbf7adc4314967858bcfeb1
ms.sourcegitcommit: 2ad510772e28f5eddd15ba265746c368356244ae
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/28/2018
ms.locfileid: "43128649"
---
# <a name="enterprise-integration-architecture-with-queues-and-events"></a>Архитектура корпоративной интеграции с использованием очередей и событий

В этой статье описывается архитектура корпоративной интеграции, где используются проверенные методы, которые можно применить к приложению интеграции при использовании Azure Integration Services. Вы можете использовать эту архитектуру в качестве основы для множества различных шаблонов приложений, для которых требуются API-интерфейсы HTTP, рабочий процесс и оркестрация.

![Схема архитектуры. Корпоративная интеграция с использованием очередей и событий](media/logic-apps-architectures-enterprise-integration-with-queues-events/integr_queues_events_arch_diagram.png)

В цикле статей об архитектуре описываются многократно используемые компоненты, с помощью которых можно создать универсальное приложение интеграции. Так как технология интеграции включает множество возможных приложений, начиная от простых приложений типа "точка — точка" и заканчивая полнофункциональными корпоративными приложениями Служебной шины Azure, изучите, какие компоненты вам нужно реализовать для своих приложений и инфраструктуры.

## <a name="architecture-components"></a>Компоненты архитектуры

Эта архитектура основывается на архитектуре, описанной в статье [Эталонная архитектура: простая корпоративная интеграция](../logic-apps/logic-apps-architectures-simple-enterprise-integration.md). [Рекомендации](../logic-apps/logic-apps-architectures-simple-enterprise-integration.md#recommendations) этой архитектуры также применимы здесь, но для краткости они опущены из раздела [рекомендаций](#recommendations) в этой статье. Эта архитектура корпоративной интеграции включает в себя следующие компоненты:

- **Группа ресурсов** — [это](../azure-resource-manager/resource-group-overview.md) логический контейнер для ресурсов Azure.

- **Управление API Azure**. Служба [управления API](https://docs.microsoft.com/azure/api-management/) — это полностью управляемая платформа для публикации, обеспечения безопасности и преобразования API HTTP.

- **Портал разработчика для службы управления API**. Каждый экземпляр службы управления API Azure обеспечивает доступ к [порталу разработки](../api-management/api-management-customize-styles.md). Этот портал предоставляет вам доступ к документации и примерам кода. На портале разработки вы также можете тестировать API-интерфейсы.

- **Azure Logic Apps**. [Logic Apps](../logic-apps/logic-apps-overview.md) — это независимая от сервера платформа для создания корпоративных рабочих процессов и интеграции.

- **Соединители** [используются](../connectors/apis-list.md) в Logic Apps для подключения к часто используемым службам. Logic Apps предлагает сотни соединителей, но вы также можете создать настраиваемый соединитель.

- **Служебная шина Azure** [обеспечивает](../service-bus-messaging/service-bus-messaging-overview.md) безопасный и надежный обмен сообщениями. Сообщения могут использоваться для отделения приложений друг от друга и интеграции с другими системами на основе сообщений.

- **Сетка событий Azure** — [это](../event-grid/overview.md) независимая от сервера платформа для публикации и доставки событий приложения.

- **IP-адрес**. Служба управления API Azure имеет фиксированный общедоступный [IP-адрес](../virtual-network/virtual-network-ip-addresses-overview-arm.md) и доменное имя. Доменное имя по умолчанию является поддоменом azure-api.net, например contoso.azure api.net, но также можно настроить [личные домены](../api-management/configure-custom-domain.md). У Logic Apps и служебной шины также есть общедоступный IP-адрес. Однако в этой архитектуре для обеспечения безопасности мы ограничиваем доступ к вызовам конечных точек Logic Apps только IP-адресом управления API. Вызовы к служебной шине защищены с помощью подписанного URL-адреса (SAS).

- **Azure DNS** — [это](https://docs.microsoft.com/azure/dns/) служба размещения для доменов DNS. Azure DNS осуществляет разрешение имен на базе инфраструктуры Microsoft Azure. Размещая домены в Azure, вы можете управлять своими записями DNS с помощью тех же учетных данных, интерфейсов API и инструментов и оплачивать использование, как и другие службы Azure. Чтобы использовать имя личного домена, например contoso.com, создайте записи DNS, которые позволяют сопоставить это доменное имя с IP-адресом. Дополнительные сведения см. в разделе [Настройка пользовательского имени домена](../api-management/configure-custom-domain.md).

- **Azure Active Directory (Azure AD)**. Вы можете использовать [Azure AD](https://docs.microsoft.com/azure/active-directory/) или другой поставщик удостоверений для проверки подлинности. Azure AD обеспечивает аутентификацию доступа к конечным точкам API, передавая [JSON Web Token в службу управления API](../api-management/policies/authorize-request-based-on-jwt-claims.md) для проверки. Azure AD может защитить доступ к порталу разработки для службы управления API на уровнях "Стандартный" и "Премиум".

## <a name="patterns"></a>Шаблоны 

Эта архитектура использует некоторые шаблоны работы, которые имеют основополагающее значение для ее функционирования.

* Существующие API HTTP серверной части публикуются через портал разработчика для службы управления API. На портале разработчики, которые являются внутренними для организации, внешними или внутренними и внешними,  
могут интегрировать вызовы для этих API в приложения.

* Составные API создаются с помощью приложений логики. Они оркеструют вызовы к системам SaaS (программное обеспечение как услуга), службам Azure и любым API, опубликованным в службе управления API. Кроме того, приложения логики [публикуются через портал разработки для службы управления API](../api-management/import-logic-app-as-api.md).

* Приложения используют Azure AD для [получения маркера безопасности OAuth 2.0](../api-management/api-management-howto-protect-backend-with-aad.md), необходимого для получения доступа к API.

* Служба управления API Azure [проверяет маркер безопасности](../api-management/api-management-howto-protect-backend-with-aad.md) и передает запрос в API серверной части или приложение логики.

* Очереди Служебной шины Azure используются для [отделения](../service-bus-messaging/service-bus-messaging-overview.md) действий приложения и [сглаживания всплесков нагрузки](https://docs.microsoft.com/azure/architecture/patterns/queue-based-load-leveling). Сообщения добавляются в очереди приложениями логики, сторонними приложениями или (не показано) путем публикации очереди в качестве API HTTP посредством службы управления API.

* При добавлении сообщений в очередь служебной шины запускается событие. Событие запускает приложение логики, которое затем обрабатывает сообщение.

* Другие службы Azure (например, хранилище BLOB-объектов Azure и служба "Центры событий Azure") также публикуют события в службу "Сетка событий". Эти службы активирует получение приложением логики события и выполнения последующих действий.

## <a name="recommendations"></a>Рекомендации

Ваши требования могут не соответствовать универсальной архитектуре, описанной в этой статье. Используйте рекомендации из этого раздела в качестве отправной точки.

### <a name="service-bus-tier"></a>Уровень служебной шины

Используйте служебную шину уровня "Премиум", которая поддерживает уведомления службы "Сетка событий". Дополнительные сведения см. на странице [цен на служебную шину](https://azure.microsoft.com/pricing/details/service-bus/).

### <a name="event-grid-pricing"></a>Сведения о ценах на службу "Сетка событий"

Служба "Сетка событий" использует бессерверную модель. Плата начисляется на основе количества операций (выполнения событий). Дополнительные сведения см. на странице [цен на службу "Сетка событий"](https://azure.microsoft.com/pricing/details/event-grid/). В настоящее время нет рекомендаций по уровню для службы "Сетка событий".

### <a name="use-peeklock-to-consume-service-bus-messages"></a>Использование сообщений служебной шины с помощью PeekLock

При создании приложения логики для сообщений служебной шины настройте для него использование [PeekLock](../service-bus-messaging/service-bus-fundamentals-hybrid-solutions.md#queues) для доступа к группе сообщений. При использовании PeekLock приложение логики может проверять каждое сообщение перед завершением или отменой. Такой подход защищает от случайной потери сообщений.

### <a name="check-for-multiple-objects-when-an-event-grid-trigger-fires"></a>Поиск нескольких объектов при срабатывании триггера службы "Сетка событий"

Когда активируется триггер службы "Сетка событий", это означает, что "произошло по крайней мере одно из этих событий". Например, когда служба "Сетка событий" запускает приложение логики в ответ на появление сообщения в очереди служебной шины, приложение логики всегда должно предполагать, что для обработки может быть доступно одно или несколько сообщений.

### <a name="region"></a>Регион

Чтобы свести к минимуму задержки в сети, подготовьте службу управления API, Logic Apps и служебную шину в одном регионе. Обычно лучше выбирать регион, ближайший к пользователям.

Группа ресурсов также привязана к региону. Регион определяет, где хранить метаданные развертывания и где выполнить шаблон развертывания. Чтобы увеличить доступность во время развертывания, поместите группу ресурсов и ее ресурсы в один регион.

## <a name="scalability"></a>Масштабируемость

Служебная шина Azure уровня "Премиум" может горизонтально масштабировать число единиц обмена сообщениями для достижения более высокой масштабируемости. В конфигурациях уровня "Премиум" может быть одна, две или четыре единицы обмена сообщениями. Дополнительные сведения о масштабировании служебной шины см. в статье [Рекомендации по повышению производительности с помощью обмена сообщениями через служебную шину](../service-bus-messaging/service-bus-performance-improvements.md).

## <a name="availability"></a>Доступность

* На данный момент для службы управления API Azure действует соглашение об уровне обслуживания с доступностью 99,9 % для уровней "Базовый", "Стандартный" и "Премиум". Конфигурации уровня "Премиум" с развертыванием по крайней мере одной единицы в двух и более регионах имеют соглашение об уровне обслуживания с доступностью 99,95 %.

* В настоящее время соглашение об уровне обслуживания для Azure Logic Apps обеспечивает уровень доступности 99,9 %.

### <a name="disaster-recovery"></a>Аварийное восстановление

Для служебной шины Azure уровня "Премиум" рекомендуется реализовать геоизбыточное аварийное восстановление для отработки отказа при серьезном сбое. Дополнительные сведения см. в разделе [Географическое аварийное восстановление в служебной шине Azure](../service-bus-messaging/service-bus-geo-dr.md).

## <a name="manageability"></a>Управляемость

Создайте отдельные группы ресурсов для рабочей среды, сред разработки и тестирования. Так будет проще управлять развертываниями, удалять тестовые развертывания и назначать права доступа.

При назначении ресурсов группам ресурсов учитывайте следующие факторы.

* **Жизненный цикл**. Обычно в группу ресурсов лучше объединять ресурсы с одинаковым жизненным циклом.

* **Доступ**. С помощью [управления доступом на основе ролей (RBAC)](../role-based-access-control/overview.md) вы можете применить политики доступа к ресурсам в группе.

* **Выставление счетов**. Вы сможете просматривать сведенные затраты для группы ресурсов.

* **Ценовая категория для службы "Управление API"**. Используйте уровень разработки для сред разработки и тестирования. Чтобы свести к минимуму затраты во время предварительной подготовки, разверните реплику рабочей среды, запустите тесты, а затем завершите работу.

Дополнительные сведения см. в [обзоре Azure Resource Manager](../azure-resource-manager/resource-group-overview.md).

## <a name="deployment"></a>Развертывание

* Используйте [шаблоны Azure Resource Manager](../azure-resource-manager/resource-group-authoring-templates.md) для развертывания службы управления API, Logic Apps, службы "Сетка событий" и служебной шины. Шаблоны упрощают автоматическое развертывание с помощью PowerShell или Azure CLI.

* Разместите службу управления API, любые отдельные приложения логики, разделы службы "Сетка событий" и пространства имен служебной шины в собственных шаблонах Resource Manager. При использовании отдельных шаблонов можно сохранять ресурсы в системе управления версиями. Затем эти шаблоны можно развернуть вместе или по отдельности в рамках непрерывной интеграции и непрерывного развертывания (CI/CD).

## <a name="diagnostics-and-monitoring"></a>Диагностика и мониторинг

Служебную шину (​​как и службу управления API, и Logic Apps) можно отслеживать с помощью службы Azure Monitor, включенной по умолчанию. Azure Monitor предоставляет сведения на основе метрик, настроенных для каждой службы. 

## <a name="security"></a>Безопасность

Защитите служебную шину с помощью подписанного URL-адреса (SAS). Например, вы можете предоставить пользователю доступ к ресурсам служебной шины с определенными правами, используя [проверку подлинности на основе SAS](../service-bus-messaging/service-bus-sas.md). Дополнительные сведения см. в разделе [Аутентификация и авторизация в служебной шине](../service-bus-messaging/service-bus-authentication-and-authorization.md).

Если очередь служебной шины должна быть предоставлена ​​как конечная точка HTTP (чтобы разрешить публикацию новых сообщений), для ее защиты путем превращения в интерфейсную следует использовать службу управления API. Затем при необходимости вы можете защитить конечную точку с помощью сертификатов или проверки подлинности OAuth. Проще всего защитить конечную точку с помощью приложения логики с триггером HTTP-запросов и HTTP-ответов в качестве посредника.

Служба "Сетка событий" защищает доставку событий с помощью кода проверки. Если вы используете события с помощью Logic Apps, проверка выполняется автоматически. Дополнительные сведения см. в разделе [Сетка событий: безопасность и проверка подлинности](../event-grid/security-authentication.md).

## <a name="next-steps"></a>Дополнительная информация

* Узнайте больше о [простой корпоративной интеграции](logic-apps-architectures-simple-enterprise-integration.md).
