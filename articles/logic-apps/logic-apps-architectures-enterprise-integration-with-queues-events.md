---
title: Эталонная архитектура корпоративной интеграции Azure Integration Services
description: Описывается эталонная архитектура, показывающая, как реализовать шаблон корпоративной интеграции с помощью Logic Apps, службы управления API, служебной шины и службы "Сетка событий".
author: mattfarm
manager: jonfan
editor: ''
services: logic-apps api-management
documentationcenter: ''
ms.assetid: ''
ms.service: logic-apps
ms.workload: logic-apps
ms.tgt_pltfrm: ''
ms.devlang: ''
ms.topic: article
ms.date: 06/15/2018
ms.author: LADocs; estfan
ms.openlocfilehash: 9eef382ea264bcf9e59dcc408d14a59355b0369b
ms.sourcegitcommit: fab878ff9aaf4efb3eaff6b7656184b0bafba13b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/22/2018
ms.locfileid: "42445683"
---
# <a name="reference-architecture-enterprise-integration-with-queues-and-events"></a>Эталонная архитектура: корпоративная интеграция с использованием очередей и событий

В приведенной ниже эталонной архитектуре показан набор проверенных практик, которые можно применить для приложения интеграции, использующего Azure Integration Services. Эта архитектура может служить основой для многих шаблонов приложений, требующих интерфейсов API HTTP, рабочего процесса и оркестрации.

![Схема архитектуры. Корпоративная интеграция с использованием очередей и событий](media/logic-apps-architectures-enterprise-integration-with-queues-events/integr_queues_events_arch_diagram.png)

*Существует много потенциальных приложений для применения технологии интеграции. Это могут быть самые разные приложения, от простого приложения, использующего подключение типа "точка — точка", до полноценного корпоративного приложения служебной шины Azure. В цикле статей об архитектуре описываются многократно используемые компоненты, с помощью которых можно создать универсальное приложение интеграции. Архитекторам следует рассмотреть компоненты, необходимые для реализации приложения и инфраструктуры.*

## <a name="architecture"></a>Архитектура

Эта архитектура создана [на основе](logic-apps-architectures-simple-enterprise-integration.md) архитектуры *простой корпоративной интеграции*. К ней относятся [рекомендации по простой корпоративной архитектуре](logic-apps-architectures-simple-enterprise-integration.md#recommendations). Они опущены в разделе [рекомендаций](#recommendations) этой статьи для краткости. 

Архитектура состоит из следующих компонентов.

- **Группа ресурсов**. [Группа ресурсов](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-overview) — это логический контейнер для ресурсов Azure.
- **Служба управления Azure API.** [Управление API](https://docs.microsoft.com/azure/api-management/) — это полностью управляемая платформа, которая используется для публикации, защиты и преобразования интерфейсов API HTTP.
- **Портал разработчика для службы управления API**. Каждому экземпляру службы управления API Azure представляется доступ к [порталу разработчика](https://docs.microsoft.com/azure/api-management/api-management-customize-styles). На портале разработчика для службы управления API можно получить доступ к документации и примерам кода. Кроме того, на портале разработчика можно протестировать интерфейсы API.
- **Azure Logic Apps**. [Logic Apps](https://docs.microsoft.com/azure/logic-apps/logic-apps-overview) — это бессерверная платформа, используемая для создания корпоративных рабочих процессов и интеграции.
- **Соединители**. [Соединители](https://docs.microsoft.com/azure/connectors/apis-list) используются в Logic Apps для подключения к часто используемым службам. В Logic Apps уже имеются сотни различных соединителей, также можно создать пользовательский соединитель.
- **Служебная шина Azure**. [Служебная шина](https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview) обеспечивает безопасный и надежный обмен сообщениями. Сообщения могут использоваться для отделения приложений друг от друга и интеграции с другими системами на основе сообщений.
- **Сетка событий Azure**. Служба [Сетка событий](https://docs.microsoft.com/azure/event-grid/overview) — это бессерверная платформа для публикации и доставки событий приложения.
- **IP-адрес.** Служба управления API Azure имеет фиксированный общедоступный [IP-адрес](https://docs.microsoft.com/azure/virtual-network/virtual-network-ip-addresses-overview-arm) и доменное имя. Доменное имя по умолчанию является поддоменом azure-api.net, например contoso.azure api.net, но также можно настроить [личные домены](https://docs.microsoft.com/azure/api-management/configure-custom-domain). У Logic Apps и служебной шины также есть общедоступный IP-адрес. Однако в этой архитектуре мы ограничиваем доступ к конечным точкам Logic Apps только IP-адресом управления API (для обеспечения безопасности). Вызовы к служебной шине защищены с помощью подписанного URL-адреса (SAS).
- **Azure DNS**. [Azure DNS](https://docs.microsoft.com/azure/dns/) — это служба размещения для доменов DNS. Azure DNS осуществляет разрешение имен на базе инфраструктуры Microsoft Azure. Размещая домены в Azure, вы можете управлять своими записями DNS с помощью тех же учетных данных, интерфейсов API и инструментов и оплачивать использование, как и другие службы Azure. Чтобы использовать пользовательское доменное имя (например, contoso.com), создайте записи DNS, которые позволяют сопоставить это доменное имя с IP-адресом. Дополнительные сведения см. в разделе [Настройка пользовательского имени домена](https://docs.microsoft.com/en-us/azure/api-management/configure-custom-domain).
- **Azure Active Directory (Azure AD).** Выполняйте аутентификацию при помощи [Azure AD](https://docs.microsoft.com/azure/active-directory/) или другого поставщика удостоверений. Azure AD обеспечивает аутентификацию доступа к конечным точкам API, передавая [JSON Web Token в службу управления API](https://docs.microsoft.com/azure/api-management/policies/authorize-request-based-on-jwt-claims) для проверки. Azure AD может защитить доступ к порталу разработчика для службы управления API (только для уровней "Стандартный" и "Премиум").

В этой архитектуре предусмотрены некоторые шаблоны, являющиеся основой ее работы.

* Существующие API HTTP серверной части публикуются через портал разработчика для службы управления API. На портале разработчики (внутренние разработчики организации, внешние разработчики или и те, и другие) могут интегрировать вызовы этих интерфейсов API в приложения.
* Составные API создаются с помощью Logic Apps. Они оркеструют вызовы к системам SaaS (программное обеспечение как услуга), службам Azure и любым API, опубликованным в службе управления API. [Кроме того, приложения логики публикуются](https://docs.microsoft.com/azure/api-management/import-logic-app-as-api) через портал разработчика для службы управления API.
- Приложения используют Azure AD для [получения маркера безопасности OAuth 2.0](https://docs.microsoft.com/azure/api-management/api-management-howto-protect-backend-with-aad), необходимого для получения доступа к API.
- Служба управления API [проверяет маркер безопасности](https://docs.microsoft.com/azure/api-management/api-management-howto-protect-backend-with-aad) и передает запрос в API серверной части или приложение логики.
- Очереди служебной шины используются для [отделения](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messaging-overview) действий приложения и [сглаживания всплесков нагрузки](https://docs.microsoft.com/azure/architecture/patterns/queue-based-load-leveling). Сообщения добавляются в очереди приложениями логики, сторонними приложениями или (не показано) путем публикации очереди в качестве API HTTP посредством службы управления API.
- При добавлении сообщений в очередь служебной шины запускается событие. Оно активирует приложение логики. Затем приложение логики обрабатывает сообщение.
- Другие службы Azure (например, хранилище BLOB-объектов Azure и служба "Центры событий Azure") также публикуют события в службу "Сетка событий". Эти службы активирует получение приложением логики события и выполнения последующих действий.

## <a name="recommendations"></a>Рекомендации

Ваши требования могут не вполне соответствовать универсальной архитектуре, описанной в этой статье. Используйте рекомендации из этого раздела в качестве отправной точки.

### <a name="service-bus-tier"></a>Уровень служебной шины

Используйте служебную шину уровня "Премиум". Уровень "Премиум" поддерживает уведомления службы "Сетка событий". Дополнительные сведения см. на странице [цен на служебную шину](https://azure.microsoft.com/pricing/details/service-bus/).

### <a name="event-grid-pricing"></a>Сведения о ценах на службу "Сетка событий"

Служба "Сетка событий" использует бессерверную модель. Плата начисляется на основе на количества операций (выполнения событий). Дополнительные сведения см. на странице [цен на службу "Сетка событий"](https://azure.microsoft.com/pricing/details/event-grid/). В настоящее время нет рекомендаций по уровню для службы "Сетка событий".

### <a name="use-peeklock-to-consume-service-bus-messages"></a>Использование сообщений служебной шины с помощью PeekLock

При создании приложения логики для сообщений служебной шины используйте [PeekLock](../service-bus-messaging/service-bus-fundamentals-hybrid-solutions.md#queues) для доступа к группе сообщений. При использовании PeekLock приложение логики может проверять каждое сообщение перед завершением или отменой. Такой подход защищает от случайной потери сообщений.

### <a name="check-for-multiple-objects-when-an-event-grid-trigger-fires"></a>Поиск нескольких объектов при срабатывании триггера службы "Сетка событий"

Когда активируется триггер службы "Сетка событий", это означает, что "произошло по крайней мере одно из этих событий". Например, когда служба "Сетка событий" запускает приложение логики в ответ на появление сообщения в очереди служебной шины, приложение логики всегда должно предполагать, что для обработки может быть доступно одно или несколько сообщений.

### <a name="region"></a>Регион

Подготовьте службу управления API, Logic Apps и служебную шину в одном регионе, чтобы свести к минимуму задержки в сети. Обычно лучше выбирать регион, ближайший к пользователям.

Группа ресурсов также привязана к региону. Регион определяет, где хранятся метаданные развертывания и откуда выполняется шаблон развертывания. Поместите группу ресурсов и ее ресурсы в один регион, чтобы увеличить доступность во время развертывания.

## <a name="scalability"></a>Масштабируемость

Служебная шина Azure уровня "Премиум" может горизонтально масштабировать число единиц обмена сообщениями для достижения более высокой масштабируемости. В конфигурациях уровня "Премиум" может быть одна, две или четыре единицы обмена сообщениями. Дополнительные сведения о масштабировании служебной шины см. в статье [Рекомендации по повышению производительности с помощью обмена сообщениями через служебную шину](../service-bus-messaging/service-bus-performance-improvements.md).

## <a name="availability"></a>Доступность

На данный момент для службы управления API Azure действует соглашение об уровне обслуживания с доступностью 99,9 % для уровней "Базовый", "Стандартный" и "Премиум". Конфигурации уровня "Премиум" с развертыванием по крайне мере одной единицы в двух и более регионах имеют соглашение об уровне обслуживания с доступностью 99,95 %.

В настоящее время соглашение об уровне обслуживания для Azure Logic Apps обеспечивает уровень доступности 99,9 %.

### <a name="disaster-recovery"></a>Аварийное восстановление

Для служебной шины Azure уровня "Премиум" рекомендуется реализовать геоизбыточное аварийное восстановление для отработки отказа при серьезном сбое. Дополнительные сведения см. в разделе [Географическое аварийное восстановление в служебной шине Azure](../service-bus-messaging/service-bus-geo-dr.md).

## <a name="manageability"></a>Управляемость

Создайте отдельные группы ресурсов для рабочей среды, сред разработки и тестирования. Так будет проще управлять развертываниями, удалять тестовые развертывания и назначать права доступа.

При назначении ресурсов в группы ресурсов учитывайте следующие факторы.

- **Жизненный цикл**. Обычно в группу ресурсов лучше объединять ресурсы с одинаковым жизненным циклом.
- **Доступ**. С помощью [управления доступом на основе ролей](../role-based-access-control/overview.md) (RBAC) вы можете применить политики доступа к ресурсам в группе.
- **Выставление счетов**. Вы сможете просматривать сведенные затраты для группы ресурсов.
- **Ценовая категория для службы управления API**. Мы рекомендуем использовать уровень "Разработка" для сред разработки и тестирования. В подготовительной среде мы рекомендуем развернуть реплику рабочей среды, выполнить тесты, а затем завершить работу, чтобы минимизировать затраты.

Дополнительные сведения см. в [обзоре Azure Resource Manager](../azure-resource-manager/resource-group-overview.md).

### <a name="deployment"></a>Развертывание

Мы рекомендуем использовать [шаблоны Azure Resource Manager](../azure-resource-manager/resource-group-authoring-templates.md) для развертывания службы управления API, Logic Apps, службы "Сетка событий" и служебной шины. Шаблоны упрощают автоматическое развертывание с помощью PowerShell или Azure CLI.

Мы рекомендуем размещать службу управления API, любые отдельные приложения логики, разделы службы "Сетка событий" и пространства имен служебной шины в собственных шаблонах Resource Manager. При использовании отдельных шаблонов можно сохранять ресурсы в системе управления версиями. Затем эти шаблоны можно развернуть вместе или по отдельности в рамках непрерывной интеграции и непрерывного развертывания (CI/CD).

### <a name="diagnostics-and-monitoring"></a>Диагностика и мониторинг

Служебную шину (​​как и службу управления API, и Logic Apps) можно отслеживать с помощью Azure Monitor. Azure Monitor предоставляет сведения на основе метрик, настроенных для каждой службы. Azure Monitor включен по умолчанию.

## <a name="security"></a>Безопасность

Защитите служебную шину с помощью SAS. Можно использовать [аутентификацию SAS](../service-bus-messaging/service-bus-sas.md), чтобы предоставлять пользователю доступ к ресурсам служебной шины с определенными правами. Дополнительные сведения см. в разделе [Аутентификация и авторизация в служебной шине](../service-bus-messaging/service-bus-authentication-and-authorization.md).

Если очередь служебной шины должна быть предоставлена ​​как конечная точка HTTP (чтобы разрешить публикацию новых сообщений), для ее защиты путем превращения в интерфейсную следует использовать службу управления API. Затем при необходимости можно обеспечить ее защиту с помощью сертификатов или OAuth. Проще всего защитить конечную точку с помощью приложения логики с триггером HTTP-запросов и HTTP-ответов в качестве посредника.

Служба "Сетка событий" защищает доставку событий с помощью кода проверки. Если вы используете события с помощью Logic Apps, проверка выполняется автоматически. Дополнительные сведения см. в разделе [Сетка событий: безопасность и проверка подлинности](../event-grid/security-authentication.md).

## <a name="next-steps"></a>Дополнительная информация

- Узнайте больше о [простой корпоративной интеграции](logic-apps-architectures-simple-enterprise-integration.md).
