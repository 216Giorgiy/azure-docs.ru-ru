---
title: Azure Integration Services. Простая Корпоративная интеграция
description: Эталонная архитектура, показывающая, как реализовать простой шаблон корпоративной интеграции с помощью Azure Logic Apps и управления API Azure
author: mattfarm
manager: jonfan
editor: ''
services: logic-apps api-management
documentationcenter: ''
ms.assetid: ''
ms.service: logic-apps
ms.workload: logic-apps
ms.tgt_pltfrm: ''
ms.devlang: ''
ms.topic: article
ms.date: 06/15/2018
ms.author: LADocs; estfan
ms.openlocfilehash: 17f591a470bf65d3c9365bca9c5ae2d5a6c9574f
ms.sourcegitcommit: 16ddc345abd6e10a7a3714f12780958f60d339b6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/19/2018
ms.locfileid: "36232115"
---
# <a name="simple-enterprise-integration---reference-architecture"></a>Простая Корпоративная интеграция. Эталонная архитектура

## <a name="overview"></a>Обзор

В этой эталонной архитектуре показан набор проверенных практик для приложения интеграции, которое использует Azure Integration Services. Эта архитектура может служить основой для многих шаблонов приложений, требующих API HTTP, рабочего процесса и оркестрации.

*Есть множество возможных применений технологии интеграции: от простого приложения "точка — точка" до полной служебной шины предприятия. В этой серии наборов архитектуры изложены компоненты многократного использования для создания любого приложения интеграции. Архитекторы должны учитывать компоненты, которые им понадобятся для своих приложений и инфраструктуры.*

   ![Схема архитектуры. Простая интеграция архитектуры](./media/logic-apps-architectures-simple-enterprise-integration/simple_arch_diagram.png)

## <a name="architecture"></a>Архитектура

Архитектура состоит из следующих компонентов.

- группа ресурсов; Группа ресурсов — это логический контейнер для ресурсов Azure.
- Управление API Azure. Управление API Azure — это полностью управляемая платформа для публикации, обеспечения безопасности и трансформации API HTTP.
- Портал разработчика службы "Управление API". Каждый экземпляр службы "Управление API Azure" включает портал разработчиков, предоставляющий доступ к документации, примерам кода и возможностям тестирования API.
- Azure Logic Apps. Logic Apps — это независимая от сервера платформа для создания корпоративных рабочих процессов и интеграции.
- Соединители. Соединители используются Logic Apps для подключения к часто используемым службам. Logic Apps уже имеет сотни различных соединителей, также они могут создаваться с помощью пользовательского соединителя.
- IP-адрес. Служба "Управление API Azure" имеет фиксированный общедоступный IP-адрес и имя домена. Имя домена представляет собой поддомен azure-api.net, например contoso. azure-api.net. Logic Apps также имеет общедоступный IP-адрес; однако в этой архитектуре мы ограничиваем доступ к конечным точкам приложения Logic Apps только IP-адресом управления API (для обеспечения безопасности).
- Azure DNS. Azure DNS является службой размещения для доменов DNS, предоставляющей разрешение имен с помощью инфраструктуры Microsoft Azure. Размещая домены в Azure, вы можете управлять своими записями DNS с помощью тех же учетных данных, API и инструментов и оплачивать использование, как и другие службы Azure. Чтобы использовать пользовательское доменное имя, (например contoso.com), создайте записи DNS, которые позволяют сопоставить это доменное имя с IP-адресом. Дополнительные сведения см. в статье о настройке имени личного домена в службе "Управление API Azure".
- Azure Active Directory (Azure AD). Выполняйте аутентификацию при помощи Azure AD или другого поставщика удостоверений. Azure AD обеспечивает проверку подлинности для доступа к конечным точкам API (путем передачи JSON Web Token для службы "Управление API" на проверку) и может обеспечить доступ к порталу разработчиков службы "Управление API" (только для уровней "Стандартный" и "Премиум").

В этой архитектуре предусмотрены некоторые основные шаблоны ее работы:

1. Существующие серверные API-интерфейсы HTTP публикуются на портале разработчика службы "Управление API", что позволяет разработчикам (либо внутренним разработчикам организации, либо внешним) интегрировать вызовы этих API-интерфейсов в приложения.
2. Составные API созданы с помощью Logic Apps. Они оркеструют вызовы к системам SAAS, службам Azure и любым API, опубликованным в службе "Управление API". Кроме того, Logic Apps публикуются через портал разработчика службы "Управление API".
3. Приложения получают маркер безопасности OAuth 2.0, необходимый для доступа к API, с помощью Azure Active Directory.
4. Служба "Управление API Azure" проверяет маркер безопасности и передает запрос серверному API или приложению логики.

## <a name="recommendations"></a>Рекомендации

Описанная здесь архитектура может не соответствовать вашим требованиям. Используйте рекомендации из этого раздела в качестве отправной точки.

### <a name="azure-api-management-tier"></a>Уровень службы "Управление API Azure"

Используйте уровни "Базовый", "Стандартный" и "Премиум", так как они предлагают производственное SLA и поддержку масштабирования в регионе Azure (количество единиц зависит от уровня). Уровень "Премиум" также поддерживает масштабирование по нескольким регионам Azure. Используйте уровень, исходя из требуемой пропускной способности и набора функций. Дополнительные сведения см. в статье [о ценах службы "Управление API"](https://azure.microsoft.com/pricing/details/api-management/).

При выполнении вы платите за все экземпляры службы "Управление API". Если вы увеличиваете масштаб, но вам не нужен такой уровень производительности постоянно, рассмотрите возможность использования преимуществ почасовой оплаты и уменьшения масштаба службы "Управление API".

### <a name="logic-apps-pricing"></a>Цены на Logic Apps

Logic Apps работает в качестве [независимой от сервера](logic-apps-serverless-overview.md) модели. Cчета выставляются на основе действий и выполнения соединителей. Дополнительные сведения см. на странице с [ценами на Logic Apps](https://azure.microsoft.com/pricing/details/logic-apps/). В Logic Apps в настоящее время нет требований по уровню.

### <a name="logic-apps-for-asynchronous-api-calls"></a>Logic Apps для асинхронных вызовов API

Logic Apps лучше всего работает в сценариях, не требующих низкой задержки, например в асинхронных вызовах API или в вызовах API средней продолжительности. Если требуется низкая задержка (например, вызов, который блокирует пользовательский интерфейс), мы рекомендуем реализовать этот API или работать с использованием другой технологии, например службы "Функции Azure" или веб-API, развернутый с помощью App Service. Мы по-прежнему рекомендуем использовать этот API в качестве интерфейсного с помощью службы "Управление API" для пользователей API.

### <a name="region"></a>Регион

Подготовьте службу "Управление API" и Logic Apps в одном регионе, чтобы свести к минимуму задержки в сети. Обычно лучше выбирать регион, ближайший к пользователям приложения.

Группа ресурсов также привязана к региону, в котором хранятся метаданные развертывания и из которого выполняются шаблоны использования. Поместите группу ресурсов и все ее ресурсы в один регион. Это повысит доступность во время развертывания.

## <a name="scalability-considerations"></a>Вопросы масштабируемости

Администраторы службы "Управление API" должны добавить [политики кэширования](../api-management/api-management-howto-cache.md), где это необходимо, для повышения масштабируемости службы и снижения нагрузки на серверные службы.

Уровни службы "Управление API" "Базовый", "Стандартный" и "Премиум" можно масштабировать в рамках региона Azure, чтобы предоставлять большую емкость. Администраторы могут использовать метрики емкости в меню "Метрики" для анализа использования службы и увеличения или уменьшения масштаба в случае необходимости.

Рекомендации по масштабированию службы "Управление API":

- Масштабирование должно учитывать шаблоны трафика. Клиенты с более изменчивыми шаблонами трафика будут иметь большую потребность в увеличении пропускной способности.
- Согласованная емкость выше 66 % может указывать на необходимость увеличения масштаба.
- Согласованная емкость ниже 20 % может указывать на возможность уменьшения масштаба.
- Рекомендуется всегда выполнять нагрузочный тест службы "Управление API" с использованием репрезентативной нагрузки перед включением в рабочую среду.

Службы уровня "Премиум" можно всегда развернуть в нескольких регионах Azure. Клиенты, выполняющие развертывание таким образом, получат более высокий уровень SLA (99,95 % против 99,9 %) и могут предоставлять услуги рядом с пользователями в нескольких регионах.

В рамках независимой от сервера модели Logic Apps администраторам не нужно уделять больше внимания масштабируемости службы. Служба автоматически масштабируется для удовлетворения спроса.

## <a name="availability-considerations"></a>Вопросы доступности

На момент написания статьи для службы управления API Azure действует соглашение об уровне обслуживания с доступностью 99,9 % для уровней "Базовый", "Стандартный" и "Премиум". Конфигурации уровня "Премиум" с развертыванием по крайне мере одной единицы в двух и более регионах имеют соглашение об уровне обслуживания с доступностью 99,95 %.

На момент написания статьи для Azure Logic Apps предоставляется соглашение об уровне обслуживания (SLA) на уровне 99,9 %.

### <a name="backups"></a>Резервные копии

Необходимо регулярно [создавать резервную копию](../api-management/api-management-howto-disaster-recovery-backup-restore.md) (основываясь на частоте изменений) конфигурации службы "Управление API", а резервные файлы следует хранить в расположении или регионе Azure, который отличается от того, где расположена служба. Затем клиенты могут выбрать один из двух вариантов стратегии аварийного восстановления:

1. При аварийном восстановлении подготавливается новый экземпляр службы "Управление API", в него восстанавливается резервная копия и перенаправляются DNS-записи.
2. Клиенты оставляют пассивную копию своей службы в другом регионе Azure (неся дополнительные затраты), в него регулярно восстанавливаются резервные копии. При аварийном восстановлении, чтобы восстановить службу, необходимо перенаправить только DNS-записи.

Так как Logic Apps можно быстро воссоздавать и эта служба независима от сервера, резервная копия создается путем сохранения копии, связанной с шаблоном Azure Resource Manager. Копию можно сохранить в системе управления версиями, при клиентской непрерывной интеграции или в процессе непрерывного развертывания (CI/CD).

При перемещении в другой центр обработки данных экземпляры Logic Apps, опубликованные через службу "Управление API", нуждаются в обновлении расположения. Это можно сделать с помощью простого скрипта PowerShell для обновления свойств резервного копирования API.

## <a name="manageability-considerations"></a>Вопросы управляемости

Создайте отдельные группы ресурсов для рабочей среды, сред разработки и тестирования. Так будет проще управлять развертыванием, удалять тестовые развертывания и назначать права доступа.
При назначении ресурсов в группы ресурсов учитывайте следующие факторы:

- Жизненный цикл. Обычно в группу ресурсов лучше объединять ресурсы с одинаковым жизненным циклом.
- Доступ. С помощью [управления доступом на основе ролей](../role-based-access-control/overview.md) (RBAC) вы можете применить политики доступа к ресурсам в группе.
- Выставление счетов. Вы сможете просматривать сведенные затраты для группы ресурсов.
- Ценовая категория для службы "Управление API". Мы рекомендуем использовать уровень разработки для сред разработки и тестирования. В подготовительной среде мы рекомендуем развернуть реплику производственной среды, выполнить тесты, а затем завершить работу, чтобы минимизировать затраты.

Дополнительные сведения см. в статье [Общие сведения о диспетчере ресурсов Azure](../azure-resource-manager/resource-group-overview.md).

### <a name="deployment"></a>Развертывание

Мы рекомендуем использовать [шаблоны Azure Resource Manager](../azure-resource-manager/resource-group-authoring-templates.md) для развертывания службы "Управление API Azure" и Azure Logic Apps. Шаблоны облегчают автоматическое развертывание с помощью PowerShell или интерфейса командной строки Azure.

Корпорация Майкрософт рекомендует размещать службу "Управление API" и любые отдельные Logic Apps в собственных шаблонах Resource Manager. Это позволит хранить их в системах управления версиями. Затем эти шаблоны можно развернуть вместе или по отдельности в рамках непрерывной интеграции и непрерывного развертывания (CI/CD).

### <a name="versions"></a>Версии

Каждый раз, когда вы вносите изменения конфигурации в приложение логики (или развертываете обновление через шаблон Resource Manager), для вашего удобства сохраняется копия этой версии (будут сохранены все версии, у которых есть история выполнения). Вы можете использовать эти версии для отслеживания изменений в журнале, а также повысить уровень версии до текущей конфигурации приложения логики; это означает, например, что вы можете эффективно откатить приложение логики.

Служба "Управление API" имеет два различных дополняющих друг друга [метода управления версиями](https://blogs.msdn.microsoft.com/apimanagement/2018/01/11/versions-revisions-general-availibility/):

- Версии, используемые для предоставления вашим потребителям API набора API, которые они могут использовать, исходя из своих потребностей (например, версия 1, 2, бета-версия или производственная версия).
- Редакции, позволяющие администраторам API безопасно вносить изменения в API и развертывать их для пользователей с дополнительным комментарием.

В контексте развертывания редакции службы "Управление API" должны рассматриваться в качестве способа безопасного изменения, сохранения истории изменений и сообщения пользователям API об этих изменениях. Редакцию можно создать в среде разработки и развернуть в других средах с использованием шаблонов Resource Manager.

Несмотря на то, что с помощью редакций можно протестировать API до выпуска его рабочей версии и предоставления к нему доступа пользователям, мы не рекомендуем использовать этот механизм для тестирования загрузки или интеграции. Вместо этого нужно использовать отдельные среды тестирования или предварительной среды.

### <a name="configuration"></a>Параметр Configuration

Ни в коем случае не помещайте пароли, ключи доступа или строки подключения в систему управления версиями. Если они необходимы, используйте соответствующий метод для развертывания и защиты этих значений. 

В Logic Apps любые конфиденциальные значения, необходимые в приложении логики (которые невозможно создать в форме подключения), должны храниться в Azure Key Vault и ссылаться на шаблон Resource Manager. Кроме того, мы рекомендуем вам использовать параметры шаблона развертывания вместе с файлами параметров для каждой среды. Ознакомьтесь с руководством по [параметрам безопасности и входным данным в рабочем процессе](logic-apps-securing-a-logic-app.md#secure-parameters-and-inputs-within-a-workflow).

В службе "Управление API" управление секретами осуществляется с помощью объектов под названием "Именованные значения" или "Свойства". Они надежно сохраняют значения, которые могут быть доступны в политиках службы "Управление API". Узнайте, как [управлять секретами в службе "Управление API"](../api-management/api-management-howto-properties.md).

### <a name="diagnostics-and-monitoring"></a>Диагностика и мониторинг

И [Управление API](../api-management/api-management-howto-use-azure-monitor.md), и [Logic Apps](logic-apps-monitor-your-logic-apps.md) поддерживают оперативный мониторинг через [Azure Monitor](../monitoring-and-diagnostics/monitoring-overview-azure-monitor.md). Azure Monitor включен по умолчанию и предоставляет сведения с учетом различных метрик, настроенных для каждой службы.

Кроме того, существуют дополнительные параметры для каждой службы:

- Журналы Logic Apps можно передать в [Log Analytics](logic-apps-monitor-your-logic-apps-oms.md) для более глубокого анализа и отображения данных на панелях мониторинга.
- Служба "Управление API" поддерживает настройку Application Insights для мониторинга DevOps.
- Служба "Управление API" поддерживает [шаблон решения Power BI для пользовательской аналитики API](http://aka.ms/apimpbi). Этот шаблон решения позволяет клиентам создавать собственные решения анализа с отчетами, доступными бизнес-пользователям в Power BI.

## <a name="security-considerations"></a>Вопросы безопасности

В этом разделе перечислены рекомендации по безопасности, относящиеся к службам Azure, описанным в этой статье, которые были развернуты в архитектуре, как описано. Это не полный список рекомендаций по обеспечению безопасности.

- Используйте управление доступом на основе ролей (RBAC) для обеспечения соответствующих уровней доступа для пользователей.
- Обеспечьте безопасность конечным точкам API в службе "Управление API" с использованием OAuth или Open IDConnect. Это можно сделать, настроив поставщик удостоверений и добавив политики проверки JWT.
- Подключитесь к серверным службам из службы "Управление API" с помощью взаимных сертификатов.
- Защитите Logic Apps на основе триггера HTTP, создав список разрешений IP-адресов, который указывает IP-адрес службы "Управление API". Это предотвращает вызов приложения логики из общедоступного Интернета без применения службы "Управление API".

В этой эталонной архитектуре показано, как создать простую корпоративную платформу интеграции с помощью Azure Integration Services.

## <a name="next-steps"></a>Дополнительная информация

* [Эталонная архитектура корпоративной интеграции с использованием очередей и событий](logic-apps-architectures-enterprise-integration-with-queues-events.md)
