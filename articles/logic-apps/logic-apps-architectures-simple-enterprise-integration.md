---
title: Эталонная архитектура простой корпоративной интеграции Azure Integration Services
description: Описывается эталонная архитектура, показывающая, как реализовать шаблон простой корпоративной интеграции с помощью Azure Logic Apps и управления API Azure.
author: mattfarm
manager: jonfan
editor: ''
services: logic-apps api-management
documentationcenter: ''
ms.assetid: ''
ms.service: logic-apps
ms.workload: logic-apps
ms.tgt_pltfrm: ''
ms.devlang: ''
ms.topic: article
ms.date: 06/15/2018
ms.author: LADocs; estfan
ms.openlocfilehash: 982a5eabf8c6c3012a9b3e8fdbe2ff32ba439972
ms.sourcegitcommit: 7827d434ae8e904af9b573fb7c4f4799137f9d9b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/18/2018
ms.locfileid: "39113598"
---
# <a name="reference-architecture-simple-enterprise-integration"></a>Эталонная архитектура: простая корпоративная интеграция

В приведенной ниже эталонной архитектуре показан набор проверенных практик, которые можно применить для приложения интеграции, использующего Azure Integration Services. Эта архитектура может служить основой для многих шаблонов приложений, требующих интерфейсов API HTTP, рабочего процесса и оркестрации.

![Схема архитектуры: простая корпоративная интеграция](./media/logic-apps-architectures-simple-enterprise-integration/simple_arch_diagram.png)

*Существует много потенциальных приложений для применения технологии интеграции. Это могут быть самые разные приложения, от простого приложения, использующего подключение типа "точка — точка", до полноценного корпоративного приложения служебной шины Azure. В цикле статей об архитектуре описываются многократно используемые компоненты, с помощью которых можно создать универсальное приложение интеграции. Архитекторам следует рассмотреть компоненты, необходимые для реализации приложения и инфраструктуры.*

## <a name="architecture"></a>Архитектура

Архитектура состоит из следующих компонентов.

- **Группа ресурсов**. [Группа ресурсов](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-overview) — это логический контейнер для ресурсов Azure.
- **Служба управления Azure API.** [Управление API](https://docs.microsoft.com/azure/api-management/) — это полностью управляемая платформа, которая используется для публикации, защиты и преобразования интерфейсов API HTTP.
- **Портал разработчика для службы управления API**. Каждому экземпляру службы управления API Azure представляется доступ к [порталу разработчика](https://docs.microsoft.com/azure/api-management/api-management-customize-styles). На портале разработчика для службы управления API можно получить доступ к документации и примерам кода. Кроме того, на портале разработчика можно протестировать интерфейсы API.
- **Azure Logic Apps**. [Logic Apps](https://docs.microsoft.com/azure/logic-apps/logic-apps-overview) — это бессерверная платформа, используемая для создания корпоративных рабочих процессов и интеграции.
- **Соединители**. [Соединители](https://docs.microsoft.com/azure/connectors/apis-list) используются в Logic Apps для подключения к часто используемым службам. В Logic Apps уже имеются сотни различных соединителей, также можно создать пользовательский соединитель.
- **IP-адрес.** Служба управления API Azure имеет фиксированный общедоступный [IP-адрес](https://docs.microsoft.com/azure/virtual-network/virtual-network-ip-addresses-overview-arm) и доменное имя. Имя домена представляет собой поддомен azure-api.net, например contoso.azure-api.net. У Logic Apps и служебной шины также есть общедоступный IP-адрес. Однако в этой архитектуре мы ограничиваем доступ к конечным точкам Logic Apps только IP-адресом управления API (для обеспечения безопасности). Вызовы к служебной шине защищены с помощью подписанного URL-адреса (SAS).
- **Azure DNS**. [Azure DNS](https://docs.microsoft.com/azure/dns/) — это служба размещения для доменов DNS. Azure DNS осуществляет разрешение имен на базе инфраструктуры Microsoft Azure. Размещая домены в Azure, вы можете управлять своими записями DNS с помощью тех же учетных данных, интерфейсов API и инструментов и оплачивать использование, как и другие службы Azure. Чтобы использовать пользовательское доменное имя (например, contoso.com), создайте записи DNS, которые позволяют сопоставить это доменное имя с IP-адресом. Дополнительные сведения см. в разделе [Настройка пользовательского имени домена](https://docs.microsoft.com/en-us/azure/api-management/configure-custom-domain).
- **Azure Active Directory (Azure AD).** Выполняйте аутентификацию при помощи [Azure AD](https://docs.microsoft.com/azure/active-directory/) или другого поставщика удостоверений. Azure AD обеспечивает аутентификацию доступа к конечным точкам API, передавая [JSON Web Token в службу управления API](https://docs.microsoft.com/azure/api-management/policies/authorize-request-based-on-jwt-claims) для проверки. Azure AD может защитить доступ к порталу разработчика для службы управления API (только для уровней "Стандартный" и "Премиум").

В этой архитектуре предусмотрены некоторые шаблоны, являющиеся основой ее работы.

- В нее встроены составные интерфейсы API с использованием приложений логики. Они координируют вызовы к системам SaaS (программное обеспечение как услуга), службам Azure и любым интерфейсам API, публикуемым в службе управления API. [Кроме того, приложения логики публикуются](https://docs.microsoft.com/azure/api-management/import-logic-app-as-api) через портал разработчика для службы управления API.
- Приложения используют Azure AD для [получения маркера безопасности OAuth 2.0](https://docs.microsoft.com/azure/api-management/api-management-howto-protect-backend-with-aad), необходимого для получения доступа к API.
- Служба управления API Azure [проверяет маркер безопасности](https://docs.microsoft.com/azure/api-management/api-management-howto-protect-backend-with-aad) и передает запрос в API серверной части или приложение логики.

## <a name="recommendations"></a>Рекомендации

Ваши требования могут не вполне соответствовать универсальной архитектуре, описанной в этой статье. Используйте рекомендации из этого раздела в качестве отправной точки.

### <a name="azure-api-management-tier"></a>Уровень службы "Управление API Azure"

Используйте следующие уровни управления API: "Базовый", "Стандартный", "Премиум". Эти уровни предлагают соглашение об уровне обслуживания для рабочей среды и поддержку масштабирования в регионе Azure (количество единиц зависит от уровня). Уровень "Премиум" также поддерживает масштабирование в нескольких регионах Azure. Используйте уровень, исходя из требуемой пропускной способности и набора функций. Дополнительные сведения см. в статье [о ценах службы "Управление API"](https://azure.microsoft.com/pricing/details/api-management/).

При выполнении вы платите за все экземпляры службы "Управление API". Если вы увеличиваете масштаб, но вам не нужен такой уровень производительности постоянно, рассмотрите возможность использования преимуществ почасовой оплаты и уменьшения масштаба службы управления API.

### <a name="logic-apps-pricing"></a>Цены на Logic Apps

Logic Apps использует [бессерверную](logic-apps-serverless-overview.md) модель. Cчета выставляются на основе действий и выполнения соединителей. Дополнительные сведения см. на странице с [ценами на Logic Apps](https://azure.microsoft.com/pricing/details/logic-apps/). В настоящее время нет каких-либо рекомендаций по уровню для Logic Apps.

### <a name="logic-apps-for-asynchronous-api-calls"></a>Logic Apps для асинхронных вызовов API

Служба Logic Apps лучше всего работает в сценариях, не требующих низкой задержки. Например, она лучше всего работает для асинхронных и полусинхронных длительных вызовов API. Если требуется низкая задержка (например, вызов, который блокирует пользовательский интерфейс), мы рекомендуем реализовать этот API или операцию с использованием другой технологии. Например, используйте службу "Функции Azure" или веб-API, развернутый с помощью Службы приложений Azure. Мы по-прежнему рекомендуем предоставлять пользователям этот API в качестве интерфейсного с помощью службы управления API.

### <a name="region"></a>Регион

Подготовьте службу "Управление API" и Logic Apps в одном регионе, чтобы свести к минимуму задержки в сети. Обычно лучше выбирать регион, ближайший к пользователям.

Группа ресурсов также привязана к региону. Регион определяет, где хранятся метаданные развертывания и откуда выполняется шаблон развертывания. Поместите группу ресурсов и ее ресурсы в один регион, чтобы увеличить доступность во время развертывания.

## <a name="scalability"></a>Масштабируемость

Администраторы службы управления API должны добавить [политики кэширования](../api-management/api-management-howto-cache.md), где это необходимо, для повышения масштабируемости службы. Кэширование также помогает уменьшить нагрузку на внутренние службы.

Уровни службы управления API "Базовый", "Стандартный" и "Премиум" позволяют масштабирование в рамках региона Azure для увеличения доступной емкости. Администраторы могут использовать параметр **Capacity Metric** (Метрика емкости) в меню **Метрики** для анализа использования службы и увеличения или уменьшения масштаба в случае необходимости.

Рекомендации по масштабированию службы "Управление API":

- При масштабировании необходимо учитывать шаблоны трафика. Клиенты с более переменными шаблонами трафика больше нуждаются в увеличенной емкости.
- Если использование емкости постоянно превышает 66 %, это может указывать на необходимость увеличения масштаба.
- Если использование емкости постоянно не превышает 20 %, это может указывать на то, что масштаб можно уменьшить.
- Рекомендуется всегда выполнять нагрузочный тест службы управления API с использованием репрезентативной нагрузки перед включением в рабочую среду.

Службы уровня "Премиум" можно всегда развернуть в нескольких регионах Azure. Клиенты, которые при развертывании масштабируют службы в нескольких регионах Azure, достигают более высокого уровня доступности в соответствии с соглашением об уровне обслуживания (99,95 % по сравнению с 99,9 %) и могут предоставлять службы расположенным рядом пользователям в нескольких регионах.

Бессерверная модель Logic Apps означает, что администраторам не требуется планирование масштабируемости служб. Служба автоматически масштабируется в соответствии с потребностями.

## <a name="availability"></a>Доступность

В настоящее время соглашение об уровне обслуживания для службы управления API Azure обеспечивает уровень доступности 99,9 % для уровней "Базовый", "Стандартный" и "Премиум". Конфигурации уровня "Премиум" с развертыванием по крайне мере одной единицы в двух и более регионах имеют соглашение об уровне обслуживания с доступностью 99,95 %.

В настоящее время соглашение об уровне обслуживания для Azure Logic Apps обеспечивает уровень доступности 99,9 %.

### <a name="backups"></a>Резервные копии

Для конфигурации управления API Azure необходимо [регулярно выполнять резервное копирование](../api-management/api-management-howto-disaster-recovery-backup-restore.md) (с учетом регулярности изменений). Файлы резервных копий должны храниться в расположении или регионе Azure, который отличается от расположения или региона размещения службы. Клиенты могут выбрать один из двух вариантов стратегии аварийного восстановления:

- При аварийном восстановлении подготавливается новый экземпляр службы управления API, в него восстанавливается резервная копия и перенаправляются записи DNS.
- Клиенты оставляют пассивную копию своей службы в другом регионе Azure (неся дополнительные затраты). В эту копию регулярно восстанавливаются резервные копии. При аварийном восстановлении, чтобы восстановить службу, необходимо перенаправить только записи DNS.

Так как приложения логики можно быстро воссоздавать и они являются бессерверными, резервная копия создается путем сохранения копии связанного шаблона Azure Resource Manager. Шаблоны можно сохранить в системе управления версиями, и их можно интегрировать в процесс непрерывной интеграции и непрерывного развертывания (CI/CD) клиента.

Если приложение логики, которое было опубликовано посредством службы управления API, перемещается в другой центр обработки данных, обновите расположение этого приложения. Это можно сделать с помощью простого сценария PowerShell, который обновляет свойство **Backend** API.

## <a name="manageability"></a>Управляемость

Создайте отдельные группы ресурсов для рабочей среды, сред разработки и тестирования. Так будет проще управлять развертываниями, удалять тестовые развертывания и назначать права доступа.

При назначении ресурсов в группы ресурсов учитывайте следующие факторы.

- **Жизненный цикл**. Обычно в группу ресурсов лучше объединять ресурсы с одинаковым жизненным циклом.
- **Доступ**. С помощью [управления доступом на основе ролей](../role-based-access-control/overview.md) (RBAC) вы можете применить политики доступа к ресурсам в группе.
- **Выставление счетов**. Вы сможете просматривать сведенные затраты для группы ресурсов.
- **Ценовая категория для службы управления API**. Мы рекомендуем использовать уровень "Разработка" для сред разработки и тестирования. В подготовительной среде мы рекомендуем развернуть реплику рабочей среды, выполнить тесты, а затем завершить работу, чтобы минимизировать затраты.

Дополнительные сведения см. в [обзоре Azure Resource Manager](../azure-resource-manager/resource-group-overview.md).

### <a name="deployment"></a>Развертывание

Мы рекомендуем использовать [шаблоны Azure Resource Manager](../azure-resource-manager/resource-group-authoring-templates.md) для развертывания службы управления API и Logic Apps. Шаблоны упрощают автоматическое развертывание с помощью PowerShell или Azure CLI.

Мы рекомендуем размещать службу управления API и любые отдельные приложения логики в собственных шаблонах Resource Manager. При использовании отдельных шаблонов можно сохранять ресурсы в системе управления версиями. Кроме того, можно развернуть ресурсы вместе или по отдельности в процессе непрерывной интеграции и непрерывного развертывания.

### <a name="versions"></a>Версии

Каждый раз, когда вы вносите изменения конфигурации в приложение логики (или развертываете обновление посредством шаблона Resource Manager), для вашего удобства сохраняется копия этой версии (будут сохранены все версии, у которых есть журнал выполнения). Вы можете использовать эти версии для отслеживания изменений в журнале, а также повысить уровень версии до текущей конфигурации приложения логики. Это означает, например, что вы можете эффективно откатить приложение логики.

Служба "Управление API" имеет два различных дополняющих друг друга [метода управления версиями](https://blogs.msdn.microsoft.com/apimanagement/2018/01/11/versions-revisions-general-availibility/):

- С помощью версий можно предоставлять клиентам набор API, которые они могут использовать, исходя из своих потребностей (например, версия 1, 2, бета-версия или рабочая версия).
- С помощью редакций администраторы API могут безопасно вносить изменения в API и развертывать их для пользователей с дополнительным комментарием.

В контексте развертывания следует рассмотреть редакции службы управления API как удобный способ безопасного изменения, сохранения журнала изменений и сообщения клиентам API об этих изменениях. Редакцию можно создать в среде разработки и развернуть в других средах с использованием шаблонов Resource Manager.

Хотя с помощью редакций можно тестировать API перед публикацией в рабочей среде и предоставлением пользователям, мы не рекомендуем использовать этот механизм для нагрузочного тестирования или тестирования интеграции. Вместо этого используйте отдельную тестовую или подготовительную среду.

### <a name="configuration"></a>Параметр Configuration

Ни в коем случае не записывайте пароли, ключи доступа или строки подключения в систему управления версиями. Если они необходимы, используйте соответствующий метод для развертывания и защиты этих значений. 

В Logic Apps любые конфиденциальные значения, необходимые в приложении логики (которые невозможно создать в форме подключения), должны храниться в Azure Key Vault и ссылаться на шаблон Resource Manager. Кроме того, мы рекомендуем использовать параметры шаблона развертывания вместе с файлами параметров для каждой среды. Чтобы получить дополнительные сведения, ознакомьтесь с разделом [Параметры безопасности и входные данные в рабочем процессе](logic-apps-securing-a-logic-app.md#secure-parameters-and-inputs-within-a-workflow).

В службе управления API управление секретами осуществляется с помощью объектов, которые называются *именованными значениями* или *свойствами*. Они надежно сохраняют значения, которые могут быть доступны в политиках управления API. Дополнительные сведения см. в разделе [Использование именованных значений в политиках управления API Azure](../api-management/api-management-howto-properties.md).

### <a name="diagnostics-and-monitoring"></a>Диагностика и мониторинг

И [служба управления API](../api-management/api-management-howto-use-azure-monitor.md), и [Logic Apps](logic-apps-monitor-your-logic-apps.md) поддерживают оперативный мониторинг с помощью [Azure Monitor](../monitoring-and-diagnostics/monitoring-overview-azure-monitor.md). Azure Monitor предоставляет сведения на основе метрик, настроенных для каждой службы. Azure Monitor включен по умолчанию.

Для каждой службы доступны следующие возможности.

- Журналы Logic Apps можно передавать в [Azure Logic Apps](logic-apps-monitor-your-logic-apps-oms.md) для более глубокого анализа и отображения на панелях мониторинга.
- Служба управления API поддерживает настройку Application Insights для мониторинга DevOps.
- Служба управления API поддерживает [шаблон решения Power BI для пользовательской аналитики API](http://aka.ms/apimpbi). Клиенты могут использовать этот шаблон решения для создания собственного решения аналитики. Отчеты доступны в Power BI для бизнес-пользователей.

## <a name="security"></a>Безопасность

В этом разделе перечислены рекомендации по безопасности, относящиеся к службам Azure, описанным в этой статье, которые были развернуты в архитектуре, как описано выше. Это не полный список рекомендаций по обеспечению безопасности.

- Используйте управление доступом на основе ролей (RBAC) для обеспечения соответствующих уровней доступа для пользователей.
- Обеспечьте безопасность конечных точек API в службе управления API с использованием OAuth или Open IDConnect. Чтобы защитить общедоступные конечные точки API, настройте поставщик удостоверений и добавьте политику проверки JSON Web Token (JWT).
- Подключитесь ко внутренним службам из службы управления API с помощью взаимных сертификатов.
- Защитите приложения логики на основе триггеров HTTP, создав список разрешений IP-адресов, содержащий IP-адрес службы управления API. Это предотвратит вызов приложения логики из общедоступного Интернета без участия службы управления API.

## <a name="next-steps"></a>Дополнительная информация

- Узнайте об [эталонной архитектуре корпоративной интеграции с использованием очередей и событий](logic-apps-architectures-enterprise-integration-with-queues-events.md).
