---
title: Простой шаблон архитектуры корпоративной интеграции в Azure Integration Services
description: В этой эталонной архитектуре показано, как реализовать простой шаблон корпоративной интеграции с помощью Azure Logic Apps и службы управления API Azure.
services: logic-apps
ms.service: logic-apps
ms.suite: integration
author: mattfarm
ms.author: mattfarm
ms.reviewer: jonfan, estfan, LADocs
ms.topic: article
ms.date: 06/15/2018
ms.openlocfilehash: 7081c9e4f6e6deee196255f04180a8f2cc792876
ms.sourcegitcommit: 2ad510772e28f5eddd15ba265746c368356244ae
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/28/2018
ms.locfileid: "43122501"
---
# <a name="simple-enterprise-integration-architecture"></a>Простая архитектура корпоративной интеграции

В этой статье описывается архитектура корпоративной интеграции, где используются проверенные методы, которые можно применить к приложению интеграции при использовании Azure Integration Services. Вы можете использовать эту архитектуру в качестве основы для множества различных шаблонов приложений, для которых требуются API-интерфейсы HTTP, рабочий процесс и оркестрация.

![Схема архитектуры: простая корпоративная интеграция](./media/logic-apps-architectures-simple-enterprise-integration/simple_arch_diagram.png)

В цикле статей об архитектуре описываются многократно используемые компоненты, с помощью которых можно создать универсальное приложение интеграции. Так как технология интеграции включает множество возможных приложений, начиная от простых приложений типа "точка — точка" и заканчивая полнофункциональными корпоративными приложениями Служебной шины Azure, изучите, какие компоненты вам нужно реализовать для своих приложений и инфраструктуры.

## <a name="architecture-components"></a>Компоненты архитектуры

Эта архитектура корпоративной интеграции включает в себя следующие компоненты:

- **Группа ресурсов** — [это](../azure-resource-manager/resource-group-overview.md) логический контейнер для ресурсов Azure.

- **Управление API Azure**. Служба [управления API](https://docs.microsoft.com/azure/api-management/) — это полностью управляемая платформа для публикации, обеспечения безопасности и преобразования API HTTP.

- **Портал разработчика для службы управления API**. Каждый экземпляр службы управления API Azure обеспечивает доступ к [порталу разработки](../api-management/api-management-customize-styles.md). Этот портал предоставляет вам доступ к документации и примерам кода. На портале разработки вы также можете тестировать API-интерфейсы.

- **Azure Logic Apps**. [Logic Apps](../logic-apps/logic-apps-overview.md) — это независимая от сервера платформа для создания корпоративных рабочих процессов и интеграции.

- **Соединители** [используются](../connectors/apis-list.md) в Logic Apps для подключения к часто используемым службам. Logic Apps предлагает сотни соединителей, но вы также можете создать настраиваемый соединитель.

- **IP-адрес**. Служба управления API Azure имеет фиксированный общедоступный [IP-адрес](../virtual-network/virtual-network-ip-addresses-overview-arm.md) и доменное имя. Доменное имя по умолчанию является поддоменом azure-api.net, например contoso.azure api.net, но также можно настроить [личные домены](../api-management/configure-custom-domain.md). У Logic Apps и служебной шины также есть общедоступный IP-адрес. Однако в этой архитектуре для обеспечения безопасности мы ограничиваем доступ к вызовам конечных точек Logic Apps только IP-адресом управления API. Вызовы к служебной шине защищены с помощью подписанного URL-адреса (SAS).

- **Azure DNS** — [это](https://docs.microsoft.com/azure/dns/) служба размещения для доменов DNS. Azure DNS осуществляет разрешение имен на базе инфраструктуры Microsoft Azure. Размещая домены в Azure, вы можете управлять своими записями DNS с помощью тех же учетных данных, интерфейсов API и инструментов и оплачивать использование, как и другие службы Azure. Чтобы использовать имя личного домена, например contoso.com, создайте записи DNS, которые позволяют сопоставить это доменное имя с IP-адресом. Дополнительные сведения см. в разделе [Настройка пользовательского имени домена](../api-management/configure-custom-domain.md).

- **Azure Active Directory (Azure AD)**. Вы можете использовать [Azure AD](https://docs.microsoft.com/azure/active-directory/) или другой поставщик удостоверений для проверки подлинности. Azure AD обеспечивает аутентификацию доступа к конечным точкам API, передавая [JSON Web Token в службу управления API](../api-management/policies/authorize-request-based-on-jwt-claims.md) для проверки. Azure AD может защитить доступ к порталу разработки для службы управления API на уровнях "Стандартный" и "Премиум".

## <a name="patterns"></a>Шаблоны 

Эта архитектура использует некоторые шаблоны работы, которые имеют основополагающее значение для ее функционирования.

* Составные API создаются с помощью приложений логики. Они оркеструют вызовы к системам SaaS (программное обеспечение как услуга), службам Azure и любым API, опубликованным в службе управления API. Кроме того, приложения логики [публикуются через портал разработки для службы управления API](../api-management/import-logic-app-as-api.md).

* Приложения используют Azure AD для [получения маркера безопасности OAuth 2.0](../api-management/api-management-howto-protect-backend-with-aad.md), необходимого для получения доступа к API.

* Служба управления API Azure [проверяет маркер безопасности](../api-management/api-management-howto-protect-backend-with-aad.md) и передает запрос в API серверной части или приложение логики.

## <a name="recommendations"></a>Рекомендации

Ваши требования могут не соответствовать универсальной архитектуре, описанной в этой статье. Используйте рекомендации из этого раздела в качестве отправной точки.

### <a name="azure-api-management-tier"></a>Уровень службы "Управление API Azure"

Используйте следующие уровни управления API: "Базовый", "Стандартный", "Премиум". Эти уровни предлагают соглашение об уровне обслуживания для рабочей среды и поддержку масштабирования в регионе Azure. Количество единиц зависит от уровня. Уровень "Премиум" также поддерживает масштабирование в нескольких регионах Azure. Выберите уровень на основе набора функций и требуемой пропускной способности. Дополнительные сведения см. в статье [о ценах службы "Управление API"](https://azure.microsoft.com/pricing/details/api-management/).

При выполнении вы платите за все экземпляры службы "Управление API". Если вы увеличиваете масштаб, но вам не нужен такой уровень производительности постоянно, рассмотрите возможность использования преимуществ почасовой оплаты и уменьшения масштаба службы управления API.

### <a name="logic-apps-pricing"></a>Цены на Logic Apps

Logic Apps использует [бессерверную](../logic-apps/logic-apps-serverless-overview.md) модель. Cчета выставляются на основе действий и выполнения соединителей. Дополнительные сведения см. на странице с [ценами на Logic Apps](https://azure.microsoft.com/pricing/details/logic-apps/). В настоящее время нет каких-либо рекомендаций по уровню для Logic Apps.

### <a name="logic-apps-for-asynchronous-api-calls"></a>Logic Apps для асинхронных вызовов API

Служба Logic Apps лучше всего работает в сценариях, не требующих низкой задержки. Например, она лучше всего работает для асинхронных и полусинхронных длительных вызовов API. Если требуется низкая задержка (например, вызов, который блокирует пользовательский интерфейс), реализуйте этот API или операцию с использованием другой технологии. Например, используйте службу "Функции Azure" или веб-API, развернутый с помощью Службы приложений Azure. Используйте службу управления API, чтобы предоставить пользователям этот API в качестве интерфейсного.

### <a name="region"></a>Регион

Чтобы свести к минимуму задержки в сети, подготовьте службу управления API, Logic Apps и служебную шину в одном регионе. Обычно лучше выбирать регион, ближайший к пользователям.

Группа ресурсов также привязана к региону. Регион определяет, где хранить метаданные развертывания и где выполнить шаблон развертывания. Чтобы увеличить доступность во время развертывания, поместите группу ресурсов и ее ресурсы в один регион.

## <a name="scalability"></a>Масштабируемость

Чтобы повысить масштабируемость при администрировании службы управления API, добавьте [политики кэширования](../api-management/api-management-howto-cache.md), где необходимо. Кэширование также помогает уменьшить нагрузку на внутренние службы.

Уровни службы управления API "Базовый", "Стандартный" и "Премиум" позволяют масштабирование в рамках региона Azure для увеличения доступной емкости. Чтобы проанализировать использование службы, в меню **метрик** выберите параметр **Capacity Metric** (Метрики емкости), а затем при необходимости увеличьте или уменьшите масштаб.

Рекомендации по масштабированию службы "Управление API":

- Изучите шаблоны трафика при масштабировании. Клиентам с более изменчивыми шаблонами трафика требуется большая емкость.

- Если использование емкости постоянно превышает 66 %, это может указывать на необходимость увеличения масштаба.

- Если использование емкости постоянно не превышает 20 %, это может указывать на то, что масштаб можно уменьшить.

- Всегда выполняйте тестирование нагрузки службы управления API с использованием репрезентативной нагрузки перед включением в рабочую среду.

Службы уровня "Премиум" можно всегда развернуть в нескольких регионах Azure. Если вы при развертывании масштабируете службы в нескольких регионах Azure, вы достигнете более высокого уровня доступности в соответствии с соглашением об уровне обслуживания (99,95 % по сравнению с 99,9 %) и подготовите службы рядом с пользователями в нескольких регионах.

Бессерверная модель Logic Apps означает, что администраторам не требуется планирование масштабируемости служб. Служба автоматически масштабируется в соответствии с потребностями.

## <a name="availability"></a>Доступность

* На данный момент для службы управления API Azure действует соглашение об уровне обслуживания с доступностью 99,9 % для уровней "Базовый", "Стандартный" и "Премиум". Конфигурации уровня "Премиум" с развертыванием по крайней мере одной единицы в двух и более регионах имеют соглашение об уровне обслуживания с доступностью 99,95 %.

* В настоящее время соглашение об уровне обслуживания для Azure Logic Apps обеспечивает уровень доступности 99,9 %.

### <a name="backups"></a>Резервные копии

На основе регулярности изменений [регулярно создавайте резервную копию](../api-management/api-management-howto-disaster-recovery-backup-restore.md) своей конфигурации управления API Azure. Храните резервные копии в расположении или регионе Azure, который отличается от размещения службы. Затем можно выбрать любой из вариантов как стратегию аварийного восстановления:

* При аварийном восстановлении подготовьте новый экземпляр службы управления API, восстановите в него резервную копию и перенаправьте записи DNS.

* Сохраните пассивную копию своей службы в другом регионе Azure, что требует дополнительных затрат. Регулярно восстанавливайте в эту копию резервные копии. Чтобы восстановить службу во время события аварийного восстановления, вам нужно только повторно указать записи DNS.

Так как приложения логики можно быстро воссоздавать и они являются бессерверными, выполните их резервное копирование, сохранив копию связанного шаблона Azure Resource Manager. Вы можете сохранить шаблоны в системе управления версиями и интегрировать их с помощью процесса непрерывной интеграции или непрерывного развертывания (CI/CD).

Если приложение логики опубликовано с помощью службы управления API и перемещено в другой центр обработки данных, обновите расположение этого приложения. Вы можете обновить свойство **серверной части** API с помощью базового сценария PowerShell.

## <a name="manageability"></a>Управляемость

Создайте отдельные группы ресурсов для рабочей среды, сред разработки и тестирования. Так будет проще управлять развертываниями, удалять тестовые развертывания и назначать права доступа.

При назначении ресурсов группам ресурсов учитывайте следующие факторы.

* **Жизненный цикл**. Обычно в группу ресурсов лучше объединять ресурсы с одинаковым жизненным циклом.

* **Доступ**. С помощью [управления доступом на основе ролей (RBAC)](../role-based-access-control/overview.md) вы можете применить политики доступа к ресурсам в группе.

* **Выставление счетов**. Вы сможете просматривать сведенные затраты для группы ресурсов.

* **Ценовая категория для службы "Управление API"**. Используйте уровень разработки для сред разработки и тестирования. Чтобы свести к минимуму затраты во время предварительной подготовки, разверните реплику рабочей среды, запустите тесты, а затем завершите работу.

Дополнительные сведения см. в [обзоре Azure Resource Manager](../azure-resource-manager/resource-group-overview.md).

## <a name="deployment"></a>Развертывание

* Используйте [шаблоны Azure Resource Manager](../azure-resource-manager/resource-group-authoring-templates.md) для развертывания службы управления API и Logic Apps. Шаблоны упрощают автоматическое развертывание с помощью PowerShell или Azure CLI.

* Разместите службу управления API и любые отдельные приложения логики в собственных шаблонах Resource Manager. При использовании отдельных шаблонов можно сохранять ресурсы в системе управления версиями. Затем эти шаблоны можно развернуть вместе или по отдельности в рамках непрерывной интеграции и непрерывного развертывания (CI/CD).

### <a name="versions"></a>Версии

Каждый раз, когда вы изменяете конфигурацию приложения логики или развертываете обновление с помощью шаблона Resource Manager, для вашего удобства сохраняется копия этой версии, а также все версии, у которых есть журнал выполнения. Вы можете использовать эти версии для отслеживания изменений в журнале или повышения уровня версии до текущей конфигурации приложения логики. Это означает, например, что вы можете эффективно откатить приложение логики.

Служба управления API Azure содержит два различных дополняющих друг друга [метода управления версиями](https://blogs.msdn.microsoft.com/apimanagement/2018/01/11/versions-revisions-general-availibility/):

* Версии, которые предоставляют вашим пользователям API возможность выбрать версию API на основе своих потребностей, например версию 1, 2, бета-версию или версию для рабочей среды.

* С помощью редакций администраторы API могут безопасно вносить изменения в API и развертывать их для пользователей с дополнительным комментарием.

Для развертывания рассмотрите редакции управления API как способ безопасного внесения изменений, сохранения истории изменений и передачи этих изменений пользователям API. Редакцию можно создать в среде разработки и развернуть в других средах с помощью шаблонов Resource Manager.

Хотя с помощью редакций можно тестировать API перед публикацией в рабочей среде и предоставлением пользователям, мы не рекомендуем использовать этот метод для тестирования интеграции или нагрузки. Вместо этого используйте отдельную тестовую или подготовительную среду.

### <a name="configuration-and-sensitive-information"></a>Конфигурация и конфиденциальные сведения

Ни в коем случае не помещайте пароли, ключи доступа или строки подключения в систему управления версиями. Если они необходимы, используйте соответствующие методы для развертывания и защиты этих значений. 

Если для приложения логики в Logic Apps требуются какие-либо конфиденциальные значения, которые невозможно создать в рамках подключения, сохраните эти значения в Azure Key Vault и получите к ним доступ из шаблона Resource Manager. Используйте параметры шаблона развертывания вместе с файлами параметров для каждой среды. Чтобы получить дополнительные сведения, ознакомьтесь с разделом [Параметры безопасности и входные данные в рабочем процессе](../logic-apps/logic-apps-securing-a-logic-app.md#secure-parameters-and-inputs-within-a-workflow).

В службе управления API управление секретами осуществляется с помощью объектов, которые называются *именованными значениями* или *свойствами*. Они надежно сохраняют значения, к которым можно получить доступ с помощью политик управления API. Дополнительные сведения см. в разделе [Использование именованных значений в политиках управления API Azure](../api-management/api-management-howto-properties.md).

## <a name="diagnostics-and-monitoring"></a>Диагностика и мониторинг

Вы можете использовать [Azure Monitor](../monitoring-and-diagnostics/monitoring-overview-azure-monitor.md) для оперативного мониторинга в службе [управления API](../api-management/api-management-howto-use-azure-monitor.md) и [Logic Apps](../logic-apps/logic-apps-monitor-your-logic-apps.md). Azure Monitor предоставляет сведения на основе метрик, настроенных для каждой службы и включенных по умолчанию.

Каждая служба также содержит следующие параметры:

* Журналы Logic Apps можно передавать в [Azure Logic Apps](logic-apps-monitor-your-logic-apps-oms.md) для более глубокого анализа и отображения на панелях мониторинга.

* Служба управления API поддерживает настройку Azure Application Insights для мониторинга DevOps.

* Служба управления API поддерживает [шаблон решения Power BI для пользовательской аналитики API](http://aka.ms/apimpbi). Вы можете использовать этот шаблон решения для создания собственного решения аналитики. Отчеты доступны в Power BI для бизнес-пользователей.

## <a name="security"></a>Безопасность

Хотя в этом списке не полностью описываются рекомендации по безопасности, все же здесь приведены некоторые аспекты обеспечения безопасности, применимые именно к службам Azure, развернутым в архитектуре, описанной в этой статье:

* Используйте управление доступом на основе ролей, чтобы у пользователей были соответствующие уровни доступа.

* Обеспечьте безопасность общедоступных конечных точек API в службе управления API с помощью OAuth или OpenID Connect. Чтобы защитить общедоступные конечные точки API, настройте поставщик удостоверений и добавьте политику проверки JSON Web Token (JWT).

* Подключитесь ко внутренним службам из службы управления API с помощью взаимных сертификатов.

* Защитите приложения логики на основе триггеров HTTP, создав список разрешений IP-адресов, содержащий IP-адрес службы управления API. Это предотвратит вызов приложения логики из общедоступного Интернета без участия службы управления API.

## <a name="next-steps"></a>Дополнительная информация

* Узнайте об [эталонной архитектуре корпоративной интеграции с использованием очередей и событий](../logic-apps/logic-apps-architectures-enterprise-integration-with-queues-events.md).
