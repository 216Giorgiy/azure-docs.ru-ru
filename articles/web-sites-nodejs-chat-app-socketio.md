<properties linkid="dev-nodejs-website-with-socketio" urlDisplayName="Веб-сайт с использованием Socket.IO" pageTitle="Веб-сайт Node.js с использованием Socket.io — учебный курс по Azure" metaKeywords="Учебный курс по Azure с Node.js и socket.io, socket.io Azure Node.js, учебный курс по Azure Node.js" description="Учебный курс, в котором демонстрируется использование socket.io на веб-сайте node.js, размещенном в Azure." metaCanonical="" services="web-sites" documentationCenter="Node.js" title="Построение приложения для разговора Node.js с Socket.IO на веб-сайте Azure" authors="larryfr" solutions="" videoId="" scriptId="" manager="paulettm" editor="mollybos" />




#Создание приложения для разговора Node.js с Socket.IO на веб-сайте Azure

Socket.IO обеспечивает связь в режиме реального времени между сервером Node.js и клиентами. Этот учебный курс поможет выполнить размещение приложения разговора на основе Socket.IO в качестве веб-сайта Azure. Дополнительные сведения о Socket.IO см. в разделе [http://socket.io/][socketio]

<div class="dev-callout"> 
<b>Примечание</b> 
	<p>Процедуры в этом задании применяются для веб-сайтов Azure; сведения по облачным службам см. в разделе <a href="http://www.windowsazure.com/ru-ru/develop/nodejs/tutorials/app-using-socketio/">Cоздание приложения разговора Node.js с Socket.IO в облачной службе Azure</a>.</p> 
</div>

Снимок экрана завершенного приложения приведен ниже:

![Браузер с отображением приложения разговора][completed-app]

## <a id="Download"></a>Загрузка примера разговора

Для этого проекта будет использоваться пример разговора из [репозитория Socket.IO в GitHub] Чтобы загрузить пример и добавить его в созданный ранее проект, выполните перечисленные ниже действия.

1.  Создайте локальную копию репозитория с помощью кнопки **Создать**. Можно также загрузить проект при помощи кнопки **ZIP**.

    ![Окно браузера со страницей https://github.com/LearnBoost/socket.io/tree/master/examples/chat с подсвеченным значком загрузки ZIP.][chat-example-view]

3.  Перейдите в структуре каталогов локального репозитория до каталога **examples\\chat**. Скопируйте содержимое этого каталога в отдельную папку, например
    **\\node\\chat**

## <a id="Modify"></a>Изменение App.js и установка модулей

Перед развертыванием приложения в Azure необходимо внести несколько незначительных изменений. Выполните следующие действия для файла app.js:

1.  Откройте файл app.js в Блокноте или другом текстовом редакторе.

2.  Найдите раздел **Зависимости модуля** в начале файла app.js и измените строку **sio = require('..//..//lib//socket.io'** на **sio = require('socket.io')**, как показано ниже:

		var express = require('express')
  		, stylus = require('stylus')
  		, nib = require('nib')
		//, sio = require('..//..//lib//socket.io'); //Original
  		, sio = require('socket.io');                //Updated


3.  Чтобы приложение прослушивало нужный порт, откройте app.js в блокноте или своем любимом редакторе, а затем измените следующую строку, заменив **3000** на **process.env.PORT**, как показано ниже:

        //app.listen(3000, function () {            //Original
		app.listen(process.env.PORT, function () {  //Updated
		  var addr = app.address();
		  console.log('   app listening on http://' + addr.address + ':' + addr.port);
		});

После сохранения изменений app.js, выполните следующие действия, чтобы установить необходимые модули::

1.  В командной строке измените каталоги на каталог **\\node\\chat**, а затем выполните следующую команду, чтобы установить модули, необходимые для этого приложения:

        npm install

    Будет выполнена установка модулей, перечисленных в файле package.json. Результат выполнения команды должен иметь примерно следующий вид:

    ![Вывод команды "npm install".][npm-output]

2.  Так как этот пример изначально был частью репозитория Socket.IO в GitHub и на него прямо указывает ссылка библиотеки Socket.IO по относительному пути, Socket.IO не указана в файле package.json, поэтому необходимо установить ее, выполнив следующую команду:

        npm install socket.io -save

## <a id="Publish"></a>Создание веб-сайта Azure и включение публикации Git

Выполните следующие действия, чтобы создать веб-сайт Azure, а затем включить публикацию Git для этого веб-сайта.

<div class="dev-callout"><strong>Примечание.</strong>
<p>Для работы с этим учебным курсом потребуется учетная запись Azure. Если ее нет, можно создать бесплатную пробную учетную запись всего за несколько минут. Дополнительные сведения см. в разделе <a href="http://www.windowsazure.com/ru-ru/pricing/free-trial/?WT.mc_id=A7171371E" target="_blank">Бесплатная пробная версия  Azure</a>.</p>
</div>

1. В командной строке измените каталоги на каталог **\\node\chat** и при помощи следующей команды создайте новый веб-сайт Azure, а затем включите Git-репозиторий для этого веб-сайта и локального каталога. Будет также создан удаленный Git-репозиторий с именем "azure".

		azure site create mysitename --git

	Замените "mysitename" уникальным именем созданного веб-сайта.

2. Поместите существующие файлы в локальный репозиторий с помощью следующих команд:

		git add .
		git commit -m "Initial commit"

3. Передайте файлы в репозиторий веб-сайта Azure с помощью следующей команды:

		git push azure master

	Вы будете получать сообщения о статусе по мере импорта модулей на сервере. После завершения этого процесса приложение будет размещаться на вашем веб-сайте Azure.

 	<div class="dev-callout">
	<b>Примечание.</b>
	<p>Во время установки модуля могут возникнуть ошибки "Импортированный проект ... не найден". Эти сообщения можно спокойно проигнорировать.</p>
	</div>

4. В Socket.IO используются сокеты WebSockets, которые по умолчанию не включены в Azure. Для включения веб-сокетов воспользуйтесь следующей командой:

		azure site set -w

	При выводе запроса введите имя веб-сайта.

	>[WACOM.NOTE]
	>Команда "azure site set -w" действует только в межплатформенном интерфейсе командной строки Azure версии 0.7.4 или более поздней. Можно также включить поддержку WebSocket с помощью портала управления Azure.
	>
	>Чтобы включить WebSockets с помощью [портала управления Azure](https://manage.windowsazure.com), перейдите на страницу настройки веб-сайта, выберите "ВКЛ" для записи "Подключения Web Sockets", затем нажмите кнопку "Сохранить".
	>	
	>![websockets](./media/web-sites-nodejs-chat-app-socketio/websockets.png)
	
5. Для просмотра веб-сайта на платформе Azure выполните следующую команду, чтобы запустить веб-браузер и перейти к размещенному веб-сайту:

		azure site browse

Теперь ваше приложение выполняется на платформе Azure и может передавать сообщения разговора между различными клиентами с использованием Socket.IO.

<div class="dev-callout">
<strong>Примечание.</strong>
<p>Для простоты в этом примере разговор ограничен пользователями, подключенными к одному экземпляру. Это означает, что если облачная служба создает два экземпляра роли обработчика, пользователи смогут общаться только с другими пользователями, подключенными к тому же экземпляру роли обработчика. Чтобы масштабировать приложение для работы с несколькими экземплярами роли, можно использовать такую технологию как Service Bus, которая позволяет передавать состояние хранилища Socket.IO между несколькими экземплярами. Примеры см. в примерах использования очередей и разделов Service Bus в <a href="https://github.com/WindowsAzure/azure-sdk-for-node">репозитории пакета Azure SDK для Node.js на GitHub</a>.</p>
</div>

##Дальнейшие действия

В данном учебном курсе было рассмотрено создание приложения разговора, размещенного на веб-сайте в Azure. Это приложение также можно разместить в качестве облачной службы Azure. Инструкции о том, как это сделать, см. в разделе [Создание приложения разговора Node.js с Socket.IO на основе облачной службы Azure][cloudservice]

[socketio]: http://socket.io/
[completed-app]: ./media/web-sites-nodejs-chat-app-socketio/websitesocketcomplete.png
[репозитория Socket.IO в GitHub]: https://github.com/LearnBoost/socket.io/tree/0.9.14
[cloudservice]: /ru-ru/develop/nodejs/tutorials/app-using-socketio/

[chat-example-view]: ./media/web-sites-nodejs-chat-app-socketio/socketio-2.png
[npm-output]: ./media/web-sites-nodejs-chat-app-socketio/socketio-7.png

