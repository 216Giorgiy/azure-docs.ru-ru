---
title: "Использование среды службы приложений Azure"
description: "Узнайте, как создавать, публиковать и масштабировать приложения в среде службы приложений Azure"
services: app-service
documentationcenter: na
author: ccompy
manager: stefsch
ms.assetid: a22450c4-9b8b-41d4-9568-c4646f4cf66b
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/13/2017
ms.author: ccompy
ms.translationtype: Human Translation
ms.sourcegitcommit: cb4d075d283059d613e3e9d8f0a6f9448310d96b
ms.openlocfilehash: c24f716d58f534d1439377234fa1263269961db7
ms.contentlocale: ru-ru
ms.lasthandoff: 06/26/2017

---
# <a name="using-an-app-service-environment"></a>Использование среды службы приложений #

## <a name="overview"></a>Обзор ##

Среда службы приложений (ASE) — это развертывание службы приложений Azure в подсети виртуальной сети Azure клиента. В ее состав входит:

- Внешние интерфейсы — это место, где протокол HTTP/HTTPS переходит в среду ASE.
- Рабочие роли — это ресурсы, в которых размещаются приложения.
- База данных — содержит сведения, определяющие среду.
- Хранилище — используется для размещения опубликованных приложений клиента.

> [!NOTE]
> Существует две версии среды службы приложений: ASEv1 и ASEv2. В ASEv1 необходимо выполнить управление ресурсами, прежде чем их можно использовать. Чтобы научиться настраивать и управлять ASEv1, см. статью [Настройка среды службы приложений][ConfigureASEv1]. В оставшейся части этого документа основное внимание уделяется версии ASEv2.
>
>

Чтобы развернуть ASE (ASEv1 и ASEv2), можно использовать внешний или внутренний виртуальный IP-адрес для доступа к приложениям. Развертывание с помощью внешнего виртуального IP-адреса обычно называют внешней средой ASE, а внутреннюю версию — средой ILB ASE, так как она использует внутреннюю подсистему балансировки нагрузки (ILB). Дополнительные сведения об ILB ASE см. в статье [Создание и использование внутренней подсистемы балансировки нагрузки со средой службы приложений][MakeILBASE].

## <a name="create-a-web-app-in-an-ase"></a>Создание веб-приложения в среде ASE ##

Создание веб-приложения в среде ASE аналогично процессу его создания в обычных условиях с несколькими небольшими отличиями. При создании плана службы приложений:

- вместо выбора географического региона для развертывания приложения необходимо выбрать среду ASE в качестве своего расположения;
- все планы службы приложений, создаваемые в ASE, должны находиться в ценовой категории Isolated.

Если у вас нет среды ASE, то ее можно создать, следуя инструкциям в статье [Создание внешней среды службы приложений][MakeExternalASE].

Для создание веб-приложения в среде ASE выполните следующие действия:

1. Щелкните **Создать &gt; Интернет и мобильные устройства**, выберите **Веб-приложения**.
2. Укажите имя для веб-приложения. Если вы уже выбрали план службы приложений в среде ASE, то доменное имя приложения будет отражать доменное имя среды ASE.

    ![][1]

1. Выберите подписку.
2. Укажите имя для новой группы ресурсов или щелкните **Использовать существующий** и выберите вариант имени из раскрывающегося списка.
3. Выберите существующий план службы приложений в своей среде ASE или создайте его, выполнив следующие действия:
    1. Выберите **Создать**.
    2. Укажите имя для своего плана службы приложений.
    3. В раскрывающемся списке **Расположение** выберите свою среду ASE.
    4. Выберите ценовую категорию **Isolated**. Нажмите кнопку **Выбрать**.
    5. Нажмите кнопку **ОК**.
    
    ![][2]
1. Щелкните **Создать**.

## <a name="how-scale-works"></a>Как работает масштабирование ##

Каждая служба приложений выполняется в плане службы приложений. Модель контейнера имеет такой вид: среды содержат планы служб приложений, а планы служб приложений содержат приложения. При масштабировании приложения выполняется масштабирование плана службы приложений, поэтому масштабируются все приложения в этом плане.

В версии ASEv2 при масштабировании плана службы приложений необходимая инфраструктура добавляется автоматически. Этим она отличается от версии ASEv1, где необходимую инфраструктуру требуется добавить перед созданием или масштабированием плана службы приложений. В ASEv2 это означает, что операции масштабирования выполняются с некоторой временной задержкой, вызванной добавлением инфраструктуры.

В мультитенантной службе приложений масштабирование, как правило, выполняется без задержки, так как для поддержки масштабирования доступен уже готовый пул ресурсов. В среде ASE такого буфера нет, поэтому ресурсы выделяются по мере необходимости.

ASE позволяет масштабировать до 100 экземпляров. Эти 100 экземпляров могут находиться в одном плане службы приложений или распределяться по разным планам.

## <a name="ip-addresses"></a>IP-адреса; ##

Служба приложений имеет возможность предоставлять приложениям выделенные IP-адреса. Это реализуется методом привязки существующего настраиваемого SSL-сертификата к веб-приложениям Azure. Для этого настройте SSL на основе IP-адреса, как описано в статье [Приобретение и настройка сертификата SSL для службы приложений Azure][ConfigureSSL]. Однако в ASE существует одно важное исключение: невозможно добавить дополнительные IP-адреса для использования в SSL на основе IP-адреса в среде ILB ASE.

В версии ASEv1 IP-адреса необходимо выделить в качестве ресурсов, чтобы их можно было использовать. В версии ASEv2 они просто используются из приложения, как и в мультитенантной службе приложений. В ASEv2 всегда имеется один запасной адрес (до 30 IP-адресов). Каждый раз при использовании одного адреса добавляется еще один, чтобы всегда был доступный адрес. При выделении следующего IP-адреса возникает временная задержка, которая влияет на процесс быстрого добавления IP-адресов.

## <a name="front-end-scaling"></a>Масштабирование внешних интерфейсов ##

В среде ASEv2 при масштабировании планов службы приложений для их поддержки автоматически добавляются рабочие роли. Помимо двух внешних интерфейсов, которые создаются для каждой среды ASE, внешние интерфейсы также автоматически добавляются по принципу "один внешний интерфейс на каждые 15 экземпляров в планах службы приложений". Таким образом, если у вас 15 экземпляров, то вы имеете три внешних интерфейса. При масштабировании до 30 экземпляров у вас будет четыре внешних интерфейса, и так далее.

Этого должно быть более чем достаточно для большинства сценариев, но если требуется масштабировать быстрее, то можно изменить соотношение до значения "один внешний интерфейс на каждые 5 экземпляров в планах службы приложений". При изменении этого соотношения взимается плата, как описано на странице [цен на службу приложений Azure][Pricing].

Ресурсы внешних интерфейсов являются конечной точкой HTTP/HTTPS для среды ASE. При сохранении конфигурации внешних интерфейсов по умолчанию показатель использования памяти на каждый внешний интерфейс обычно составляет примерно 60 %. Рабочие нагрузки клиентов не выполняются во внешнем интерфейсе. Ключевым фактором, влияющим на внешний интерфейс в части масштабирования, является использование ЦП, которое определяется, в первую очередь, HTTPS-трафиком.

## <a name="app-access"></a>Доступ к приложениям ##

Во внешней среде ASE домен, используемый при создании приложений, отличается от мультитенантной службы приложений и включает в себя имя среды ASE. Дополнительные сведения о создании внешней среды ASE см. в статье [Создание внешней среды службы приложений][MakeExternalASE]. Доменное имя во внешней среде ASE имеет формат *.&lt;asename&gt;.p.azurewebsites.net*. Это значит, что если имя вашей среды ASE — _external-ase_, а имя размещаемого в этой среде приложения — _contoso_, то получить к нему доступ можно по следующим URL-адресам:

- contoso.external-ase.p.azurewebsites.net
- contoso.scm.external-ase.p.azurewebsites.net

URL-адрес *contoso.scm.external-ase.p.azurewebsites.net* используется для доступа к консоли Kudu или для публикации приложения с помощью веб-развертывания. Сведения о консоли Kudu см. на странице [Kudu console for Azure App Service][Kudu] (Консоль Kudu для службы приложений Azure). Консоль Kudu предоставляет веб-интерфейс для отладки, передачи и редактирования файлов, а также многих других возможностей.

В среде ASE ILB домен определяется во время развертывания. Дополнительные сведения о создании среды ILB ASE см. в статье [Создание и использование внутренней подсистемы балансировки нагрузки со средой службы приложений][MakeILBASE]. Если указать доменное имя _ilb-ase.info_, то приложения в данной среде ASE будут использовать этот домен при создании приложений. Если имя приложения — _contoso_, то URL-адреса будут следующими:

- contoso.ilb-ase.info
- contoso.scm.ilb-ase.info

## <a name="publishing"></a>Публикация ##

По аналогии с мультитенантной службой приложений в среде ASE для публикации можно использовать следующие средства:

- веб-развертывание;
- FTP
- Непрерывная интеграция
- функция перетаскивания в консоли Kudu;
- интегрированная среда разработки (IDE), например Visual Studio, Eclipse или IntelliJ IDEA.

При использовании внешней среды ASE все они работают одинаково. Дополнительные сведения см. в статье [Развертывание приложения в службе приложений Azure][AppDeploy]. 

Публикация с помощью среды ILB ASE существенно отличается. При использовании среды ILB ASE все конечные точки публикации доступны только через внутреннюю подсистему балансировки нагрузки (ILB). Внутренняя подсистема балансировки нагрузки расположена на частном IP-адресе в подсети ASE в виртуальной сети. Без сетевого доступа к внутренней подсистеме балансировки нагрузки в среде ASE не удастся опубликовать ни одного приложения. Как показано в статье [Создание и использование внутренней подсистемы балансировки нагрузки со средой службы приложений][MakeILBASE], для приложений в системе необходимо настроить DNS. В эти настройки входит конечная точка SCM. Если их не задать надлежащим образом, то публикация будет невозможна. В интегрированных средах разработки также требуется сетевой доступ к внутренней подсистеме балансировки нагрузки для публикации напрямую.

Веб-системы непрерывной интеграции, такие как Github и VSTS, не работают со средой ILB ASE, поскольку конечная точка публикации недоступна через Интернет. Вместо этого необходимо использовать систему непрерывной интеграции, которая использует модель полного извлечения, например Dropbox.

Для конечных точек публикации приложений в среде ILB ASE используется домен, с помощью которого была создана эта среда. Это можно увидеть в профиле публикации приложения и в колонке приложения на портале (в разделе **Обзор** > **Основное** и в разделе **Свойства**). 

## <a name="pricing"></a>Цены ##

В версии ASEv2 доступна новая ценовая категория (номер SKU), которая применяется только к ASEv2. Она называется **Isolated**. Все планы службы приложений, размещенные в ASEv2, относятся к ценовой категории (SKU) Isolated. Помимо цены плана службы приложений существует фиксированная плата за саму среду ASE. Эта плата не изменяется в зависимости от размера вашей среды ASE. 

Другие платежи могут быть вызваны изменением коэффициента масштабирования внешних интерфейсов или размера внешнего интерфейса. Если настроить коэффициент масштабирования таким образом, что внешние интерфейсы будут добавляться быстрее, то вам придется оплатить все дополнительные ядра, которые автоматически добавятся в систему. Аналогичным образом, если выбрать больший размер внешних интерфейсов, то с вас будет снята плата за все ядра, которые не были выделены автоматически. Например, если установить значение коэффициента масштабирования 10, то внешний интерфейс будет добавляться для каждых 10 экземпляров в планах службы приложений. Фиксированная плата охватывает масштаб "1 внешний интерфейс на каждые 15 экземпляров". При значении коэффициента масштабирования 10 вам придется заплатить за третий внешний интерфейс, который добавляется при 10 экземплярах плана службы приложений. Но когда число дойдет до 15 экземпляров, вам не нужно будет ничего доплачивать, так как интерфейс был бы добавлен автоматически.

Дополнительные сведения см. на странице [цен на службу приложений Azure][Pricing].

## <a name="deleting-an-ase"></a>Удаление ASE ##

Если нужно удалить среду службы приложений, просто воспользуйтесь действием **Удалить** в верхней части колонки среды. После этого появится запрос на ввод имени среды ASE, чтобы вы могли подтвердить удаление. Обратите внимание, что при удалении среды ASE также удаляется все ее содержимое. 

![][3]

<!--Image references-->
[1]: ./media/using_an_app_service_environment/usingase-appcreate.png
[2]: ./media/using_an_app_service_environment/usingase-pricingtiers.png
[3]: ./media/using_an_app_service_environment/usingase-delete.png


<!--Links-->
[Intro]: ./intro.md
[MakeExternalASE]: ./create-external-ase.md
[MakeASEfromTemplate]: ./create-from-template.md
[MakeILBASE]: ./create-ilb-ase.md
[ASENetwork]: ./network-info.md
[ASEReadme]: ./readme.md
[UsingASE]: ./using-an-ase.md
[UDRs]: ../../virtual-network/virtual-networks-udr-overview.md
[NSGs]: ../../virtual-network/virtual-networks-nsg.md
[ConfigureASEv1]: ../../app-service-web/app-service-web-configure-an-app-service-environment.md
[ASEv1Intro]: ../../app-service-web/app-service-app-service-environment-intro.md
[webapps]: ../../app-service-web/app-service-web-overview.md
[mobileapps]: ../../app-service-mobile/app-service-mobile-value-prop.md
[APIapps]: ../../app-service-api/app-service-api-apps-why-best-platform.md
[Functions]: ../../azure-functions/index.yml
[Pricing]: http://azure.microsoft.com/pricing/details/app-service/
[ARMOverview]: ../../azure-resource-manager/resource-group-overview.md
[ConfigureSSL]: ../../app-service-web/web-sites-purchase-ssl-web-site.md
[Kudu]: http://azure.microsoft.com/resources/videos/super-secret-kudu-debug-console-for-azure-web-sites/
[AppDeploy]: ../../app-service-web/web-sites-deploy.md
[ASEWAF]: ../../app-service-web/app-service-app-service-environment-web-application-firewall.md
[AppGW]: ../../application-gateway/application-gateway-web-application-firewall-overview.md

