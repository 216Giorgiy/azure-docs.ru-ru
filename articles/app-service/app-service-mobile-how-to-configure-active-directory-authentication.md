---
title: "Настройка проверки подлинности Azure Active Directory для приложения служб приложений"
description: "Узнайте, как настроить проверку подлинности Azure Active Directory для приложения служб приложений."
author: mattchenderson
services: app-service
documentationcenter: 
manager: syntaxc4
editor: 
ms.assetid: 6ec6a46c-bce4-47aa-b8a3-e133baef22eb
ms.service: app-service-mobile
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 10/01/2016
ms.author: mahender
ms.openlocfilehash: 25f0578a9e273c30ecc98af5b66c6dd43305aa03
ms.sourcegitcommit: 51ea178c8205726e8772f8c6f53637b0d43259c6
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2017
---
# <a name="how-to-configure-your-app-service-application-to-use-azure-active-directory-login"></a>Настройка приложения службы приложений для использования службы входа Azure Active Directory
[!INCLUDE [app-service-mobile-selector-authentication](../../includes/app-service-mobile-selector-authentication.md)]

В этом разделе показано, как настроить службы приложений Azure для использования Azure Active Directory в качестве поставщика проверки подлинности.

## <a name="express"> </a>Настройка Azure Active Directory с помощью стандартных параметров
1. На [портал Azure]перейдите к своему приложению. Щелкните **Параметры**, а затем — **Аутентификация или авторизация**.
2. Если функция аутентификации или авторизации не включена, установите переключатель в положение **Вкл**.
3. Щелкните **Azure Active Directory**, а затем в разделе **Режим управления** выберите **Экспресс**.
4. Нажмите кнопку **ОК** , чтобы зарегистрировать приложение в Azure Active Directory. При этом будет создана новая регистрация. Чтобы выбрать имеющуюся регистрацию, щелкните **Выбрать существующее приложение** и найдите имя ранее созданной регистрации в вашем клиенте.
   Щелкните регистрацию, чтобы ее выбрать, и нажмите кнопку **ОК**. Затем нажмите кнопку **ОК** в колонке параметров Azure Active Directory.
   По умолчанию служба приложений обеспечивает проверку подлинности, но не ограничивает авторизованный доступ к содержимому сайта и API. Авторизация пользователей должна быть включена в код приложения.
5. (Необязательно.) Чтобы предоставить доступ к сайту только пользователям, прошедшим проверку подлинности в Azure Active Directory, установите для параметра **Предпринимаемое действие, если проверка подлинности для запроса не выполнена** значение **Войти с использованием Azure Active Directory**. В этом случае все запросы, не прошедшие проверку подлинности, направляются для проверки подлинности с помощью Azure Active Directory.
6. Щелкните **Сохранить**.

Теперь вы можете использовать Azure Active Directory для проверки подлинности в приложении.

## <a name="advanced"> </a>(Альтернативный способ) Ручная настройка расширенных параметров Azure Active Directory
Можно также указать параметры конфигурации вручную. Этот способ рекомендуется, если клиент AAD, который вы хотите использовать, отличается от клиента, с которого вы выполняете вход в Azure. Чтобы выполнить настройку, сначала необходимо создать регистрацию в Azure Active Directory, а затем предоставить некоторые сведения о регистрации службе приложений.

### <a name="register"> </a>Регистрация приложения в Azure Active Directory
1. Войдите на [портал Azure]и перейдите к своему приложению. Скопируйте **URL-адрес** приложения. Он будет использоваться для настройки приложения Azure Active Directory.
2. Чтобы зарегистрировать новое приложение, перейдите к **Active Directory**, а затем выберите **Регистрации приложений** и в верхней части нажмите кнопку **Регистрация нового приложения**. 
3. В диалоговом окне Create application registration (Создать регистрацию приложения) введите **имя** приложения, выберите тип **API веб-приложения** и в поле **URL-адрес входа** вставьте URL-адрес приложения (из шага 1). Затем щелкните **Создать**.
4. Через несколько секунд отобразится только что созданное приложение регистрации.
5. После добавления приложения щелкните имя регистрации приложения, а затем выберите **Параметры** и **Свойства**. 
6. В диалоговом окне **URI кода приложения** вставьте URL-адрес приложения (из шага 1), а также в поле **URL-адрес домашней страницы** вставьте URL-адрес приложения (из шага 1), затем щелкните **Сохранить**.
7. Теперь щелкните **URL-адрес ответа** и замените **URL-адрес ответа**, вставив URL-адрес приложения (из шага 1), измените протокол, чтобы убедиться, что у вас есть протокол **https://** (не http://), и в конце добавьте URL-адрес */.auth/login/aad/callback*. (Например, `https://contoso.azurewebsites.net/.auth/login/aad/callback`). Щелкните **Сохранить**.   
8.  На этом этапе скопируйте **идентификатор** для приложения. Сохраните его для последующего использования. Он потребуется для настройки веб-приложения.
9. Закройте колонку Application Registration details (Сведения о регистрации приложения). Верните сводку регистрации приложения в Azure Active Directory, в верху щелкните кнопку **Конечные точки**, скопируйте URL-адрес**документа метаданных федерации**. 
10. Откройте новое окно браузера и перейдите по URL-адресу, вставив его и перейдя на страницу XML. В верху документа должен быть элемент **EntityDescriptor** с указанным атрибутом **entityID** в формате `https://sts.windows.net/`, за которым следует идентификатор GUID вашего клиента (идентификатор клиента). Скопируйте это значение — оно будет использоваться в качестве вашего **URL-адреса издателя**. Вы настроите его позднее.

### <a name="secrets"> </a>Добавление сведений об Azure Active Directory в приложение
1. Снова вернитесь на [портал Azure]и перейдите к своему приложению. Щелкните **Аутентификация или авторизация**. Если функция аутентификации или авторизации не включена, установите переключатель в положение **Вкл**. Чтобы настроить приложение, щелкните **Azure Active Directory** в списке поставщиков аутентификации. (Необязательно.) По умолчанию служба приложений обеспечивает проверку подлинности, но не ограничивает авторизованный доступ к содержимому сайта и API. Авторизация пользователей должна быть включена в код приложения. Выберите **Предпринимаемое действие, если проверка подлинности для запроса не выполнена** и задайте для него значение **Войти с использованием Azure Active Directory**. В этом случае все запросы, не прошедшие проверку подлинности, направляются для проверки подлинности с помощью Azure Active Directory.
2. В конфигурации аутентификации Active Directory щелкните **Дополнительно** в разделе **Режим управления**. Вставьте идентификатор приложения в поле идентификатора клиента (из шага 8) и вставьте значение entityId (из шага 10) для URL-адреса издателя. Нажмите кнопку **ОК**.
3. В колонке Active Directory Authentication configuration (Конфигурация аутентификации Active Directory) щелкните **Сохранить**.

Теперь вы можете использовать Azure Active Directory для проверки подлинности в приложении.

## <a name="optional-configure-a-native-client-application"></a>(Необязательно.) Настройка собственного клиентского приложения
Azure Active Directory также позволяет регистрировать собственные клиенты, что обеспечивает больший контроль над сопоставлением разрешений. Это необходимо, если вы хотите выполнять вход с помощью библиотеки, например **библиотеки аутентификации Active Directory**.

1. Перейдите в раздел **Active Directory** на [классическом портале Azure].
2. Выберите свой каталог, а затем откройте вкладку **Приложения** в верхней части окна. Щелкните **Добавить** в нижней части окна, чтобы зарегистрировать новое приложение.
3. Выберите команду **Добавить приложение, разрабатываемое моей организацией**.
4. В мастере добавления приложения введите **имя** приложения и выберите тип **Собственное клиентское приложение**. Затем щелкните "Далее".
5. В поле **URI перенаправления** введите конечную точку */.auth/login/done* веб-сайта в формате HTTPS. Это значение должно быть похоже на *https://contoso.azurewebsites.net/.auth/login/done*. При создании приложения Windows в качестве URI используйте [идентификатор безопасности пакета](../app-service-mobile/app-service-mobile-dotnet-how-to-use-client-library.md#package-sid) .
6. После добавления собственного приложения щелкните вкладку **Настройка** . Найдите **идентификатор клиента** и запишите его.
7. Прокрутите страницу вниз до раздела **Разрешения для других приложений** и щелкните **Добавить приложение**.
8. Найдите ранее зарегистрированное веб-приложение и щелкните значок со знаком плюс. Затем установите флажок, чтобы закрыть диалоговое окно. Если веб-приложение не удается найти, перейдите к его регистрации и добавьте новый URL-адрес ответа (например, версию HTTP текущего URL-адреса), нажмите кнопку "Сохранить", а затем повторите эти шаги. Приложение должно появиться в списке.
9. Для только что добавленной записи откройте раскрывающийся список **Делегированные разрешения** и выберите пункт **Access (appName)** (Доступ к (имя_приложения)). Нажмите кнопку **Сохранить**.

Теперь вы настроили собственное клиентское приложение, у которого есть доступ к вашему приложению службы приложений.

## <a name="related-content"> </a>Связанная информация
[!INCLUDE [app-service-mobile-related-content-get-started-users](../../includes/app-service-mobile-related-content-get-started-users.md)]

<!-- Images. -->

[0]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-webapp-url.png
[1]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app_registration.png
[2]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app-registration-create.png
[3]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app-registration-config-appidurl.png
[4]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-app-registration-config-replyurl.png
[5]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-endpoints.png
[6]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-aad-endpoints-fedmetadataxml.png
[7]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-webapp-auth.png
[8]: ./media/app-service-mobile-how-to-configure-active-directory-authentication/app-service-webapp-auth-config.png



<!-- URLs. -->

[портал Azure]: https://portal.azure.com/
[классическом портале Azure]: https://manage.windowsazure.com/
[alternative method]:#advanced
