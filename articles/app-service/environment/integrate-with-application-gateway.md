---
title: "Интеграция ASE с внутренней подсистемой балансировки нагрузки со шлюзом приложений Azure"
description: "Пошаговое руководство по интеграции приложения в ASE с внутренней подсистемой балансировки нагрузки со шлюзом приложений Azure."
services: app-service
documentationcenter: na
author: ccompy
manager: stefsch
ms.assetid: a6a74f17-bb57-40dd-8113-a20b50ba3050
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/17/2017
ms.author: ccompy
ms.openlocfilehash: eedad8824add7fe425d34975dab640fbee82c2bc
ms.sourcegitcommit: b723436807176e17e54f226fe00e7e977aba36d5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2017
---
# <a name="integrating-your-ilb-ase-with-an-application-gateway"></a>Интеграция ASE с внутренней подсистемой балансировки нагрузки со шлюзом приложений #

[Среда службы приложений (ASE)](./intro.md) — это развернутая служба приложений Azure в подсети виртуальной сети Azure клиента. Ее можно развернуть с использованием общедоступной или частной конечной точки для доступа к приложениям. Развертывание ASE с частной конечной точкой называется ASE с внутренней подсистемой балансировки нагрузки.  
Шлюз приложений Azure — это виртуальный модуль, обеспечивающий балансировку нагрузки уровня 7, разгрузку SSL и защиту WAF. Он может ожидать передачи данных через общедоступный IP-адрес и направлять трафик к конечной точке приложения. Ниже описано, как интегрировать шлюз приложений с настроенным WAF с приложением в ASE с внутренней подсистемой балансировки нагрузки.  

Интеграция шлюза приложений и ASE с внутренней подсистемой балансировки нагрузки осуществляется на уровне приложения.  Настройка шлюза приложений для работы с ASE с внутренней подсистемой балансировки нагрузки выполняется для конкретных приложений в этой среде ASE. Это позволяет размещать в одной среде ASE с внутренней подсистемой балансировки нагрузки защищенные мультитенантные приложения.  

![Шлюз приложений, указывающий на приложение в ASE с внутренней подсистемой балансировки нагрузки][1]

В этом пошаговом руководстве описаны следующие операции.

* Создание шлюза приложений.
* Настройка шлюза приложения для указания на приложение в ASE с внутренней подсистемой балансировки нагрузки.
* Настройка приложения для использования имени личного домена.
* Изменение общедоступного имени узла DNS, указывающего на шлюз приложений.

Чтобы интегрировать шлюз приложений с ASE с внутренней подсистемой балансировки нагрузки, требуется:

* ASE с внутренней подсистемой балансировки нагрузки;
* приложение, запущенное в ASE с внутренней подсистемой балансировки нагрузки;
* доменное имя с маршрутизацией через Интернет для приложения в ASE с внутренней подсистемой балансировки нагрузки;
* адрес внутренней подсистемы балансировки нагрузки, используемый ASE с внутренней подсистемой балансировки нагрузки (указан на портале ASE в разделе **Параметры > IP-адреса**);

    ![IP-адреса, используемые ASE с внутренней подсистемой балансировки нагрузки;][9]
    
* общедоступное DNS-имя, которое будет использоваться позднее для указания на шлюз приложений. 

Дополнительные сведения о создании ASE с внутренней подсистемой балансировки нагрузки приведены в документе [Создание и использование внутреннего балансировщика нагрузки со средой службы приложений][ilbase].

В этом руководстве предполагается, что требуется развернуть шлюз приложений в той же виртуальной сети Azure, в которой развернута среда ASE. Перед началом создания шлюза приложений выберите или создайте подсеть для его размещения. Для этого не следует выбирать подсеть GatewaySubnet или подсеть, используемую ASE с внутренней подсистемой балансировки нагрузки.
Если разместить шлюз приложений в подсети GatewaySubnet, то позже будет невозможно создать шлюз виртуальной сети. Также нельзя размещать его в подсети, используемой ASE с внутренней подсистемой балансировки нагрузки, так как в этой подсети может находиться только среда ASE.

## <a name="steps-to-configure"></a>Инструкции по настройке ##

1. На портале Azure выберите **Создать > Сеть > Шлюз приложений**. 
    1. Сделайте следующее:
        1. Укажите имя шлюза приложений.
        1. Выберите WAF.
        1. Выберите подписку, используемую для виртуальной сети ASE.
        1. Создайте или выберите группу ресурсов.
        1. Выберите расположение виртуальной сети ASE.

    ![Основные параметры нового шлюза приложений][2]   
    1. В области "Параметры":
        1. Укажите виртуальную сеть ASE.
        1. Укажите подсеть для развертывания шлюза приложений. Не указывайте подсеть GatewaySubnet, иначе будет невозможно создание VPN-шлюзов.
        1. Щелкните "Общедоступный".
        1. Выберите общедоступный IP-адрес. Если его у вас нет, то создайте его сейчас.
        1. Настройте протокол HTTP или HTTPS. При настройке протокола HTTPS необходимо предоставить PFX-файл сертификата.
        1. Выберите параметры брандмауэра веб-приложения. Вы можете включить брандмауэр и настроить его для обнаружения или предотвращения, в соответствии с вашими требованиями.

    ![Параметры нового шлюза приложений][3]
    
    1. В разделе сводки нажмите кнопку **ОК**. Установка шлюза приложений длится чуть более 30 минут.  

2. После завершения установки шлюза приложений вернитесь на портал шлюза приложений. Выберите **Внутренний пул**.  Добавьте адрес внутренней подсистемы балансировки нагрузки для ASE с внутренней подсистемой балансировки нагрузки.

    ![Настройка внутреннего пула][4]

3. После завершения настройки внутреннего пула выберите **Зонды работоспособности**. Создайте пробу работоспособности для доменного имени, которое необходимо использовать для приложения. 

    ![Настройка проб работоспособности][5]
    
4. После завершения настройки проб работоспособности выберите **Параметры HTTP**.  Измените существующий параметр, щелкните **Использовать пользовательский зонд** и выберите настроенную вами пробу.

    ![Настройка параметров HTTP][6]
    
5. Перейдите на страницу **Обзор** шлюза приложений и скопируйте общедоступный IP-адрес, используемый для шлюза приложений.  Назначьте этот IP-адрес в качестве записи A для доменного имени приложения или используйте DNS-имя для этого адреса в записи CNAME.  Проще выбрать общедоступный IP-адрес и скопировать его из раздела общедоступного IP-адреса в пользовательском интерфейсе, чем скопировать его из ссылки в разделе "Обзор" шлюза приложения. 

    ![Портал шлюза приложений][7]

6. Укажите имя личного домена для приложения в ASE с внутренней подсистемой балансировки нагрузки.  Перейдите к своему приложению на портале и в списке "Параметры" выберите **Пользовательские домены**.

![Указание имени личного домена для приложения][8]

Сведения о настройке имен личных доменов для веб-приложений приведены в разделе [Сопоставление существующего настраиваемого DNS-имени с веб-приложениями Azure][custom-domain]. Разница между приложением в ASE с внутренней подсистемой балансировки нагрузки и этим документом состоит в отсутствии какой-либо проверки доменного имени.  Так как вам принадлежит служба DNS, которая управляет конечными точками приложения, вы можете добавить все, что посчитаете нужным. Добавляемое в этом случае имя личного домена не обязательно должно находиться в вашей службе DNS, но его все равно нужно настроить для вашего приложения. 

После того, как установка будет завершена и вы подождете некоторое время, чтобы изменения DNS распространились, вы сможете обращаться к приложению с помощью созданного имени личного домена. 


<!--IMAGES-->
[1]: ./media/integrate-with-application-gateway/appgw-highlevel.png
[2]: ./media/integrate-with-application-gateway/appgw-createbasics.png
[3]: ./media/integrate-with-application-gateway/appgw-createsettings.png
[4]: ./media/integrate-with-application-gateway/appgw-backendpool.png
[5]: ./media/integrate-with-application-gateway/appgw-healthprobe.png
[6]: ./media/integrate-with-application-gateway/appgw-httpsettings.png
[7]: ./media/integrate-with-application-gateway/appgw-publicip.png
[8]: ./media/integrate-with-application-gateway/appgw-customdomainname.png
[9]: ./media/integrate-with-application-gateway/appgw-iplist.png

<!--LINKS-->
[appgw]: http://docs.microsoft.com/azure/application-gateway/application-gateway-introduction
[custom-domain]: ../app-service-web-tutorial-custom-domain.md
[ilbase]: ./create-ilb-ase.md
