---
title: Устранение проблем доменов и SSL-сертификата в веб-приложениях Azure | Документация Майкрософт
description: Устранение проблем доменов и SSL-сертификата в веб-приложениях Azure
services: app-service\web
documentationcenter: ''
author: genlin
manager: cshepard
editor: ''
tags: top-support-issue
ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/18/2018
ms.author: genli
ms.openlocfilehash: ba21475b771f1688c0a3f2f34c8d961fba5cd182
ms.sourcegitcommit: e2adef58c03b0a780173df2d988907b5cb809c82
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/28/2018
---
# <a name="troubleshoot-domain-and-ssl-certificate-problems-in-azure-web-apps"></a>Устранение проблем доменов и SSL-сертификата в веб-приложениях Azure

Эта статья содержит сведения о распространенных проблемах, которые могут возникнуть при настройке домена или SSL-сертификата для веб-приложений Azure. Кроме того, здесь описаны возможные причины этих проблем и способы их устранения.

Если вам потребуется дополнительная помощь по любому из вопросов, рассматриваемых в статье, вы можете обратиться к экспертам по Azure на [форумах MSDN Azure и Stack Overflow](https://azure.microsoft.com/support/forums/). Кроме того, можно зарегистрировать обращение в службу поддержки Azure. Перейдите на [сайт службы поддержки Azure](https://azure.microsoft.com/support/options/) и щелкните **Поддержка**.

## <a name="certificate-problems"></a>Проблемы сертификата

### <a name="unable-to-add-bind-ssl-certificate-to-a-web-app"></a>Не удается добавить привязку SSL-сертификата в веб-приложение 

### <a name="symptom"></a>Симптом

При добавлении привязки SSL появляется следующее сообщение об ошибке:

**Не удалось добавить привязку SSL. Не удалось назначить сертификат для существующего виртуального IP-адреса, так как этот сертификат уже используется для другого виртуального IP-адреса.**

### <a name="cause"></a>Причина:

Эта проблема может возникнуть, если у вас есть несколько привязок SSL на основе IP-адреса для одного IP-адреса в нескольких веб-приложениях. Например, веб-приложение A имеет SSL на основе IP-адреса со старым сертификатом. Веб-приложение B имеет SSL на основе IP-адреса с новым сертификатом для того же IP-адреса. При обновлении привязки SSL веб-приложения с помощью нового сертификата отобразится указанное выше сообщение об ошибке, так как IP-адрес уже используется для другого приложения. 

### <a name="solution"></a>Решение 

Чтобы устранить эту проблему, используйте один из следующих способов:

- Удалите привязку SSL на основе IP-адреса в веб-приложении, где используется старый сертификат. 
- Создайте привязку SSL на основе IP-адреса, которая использует новый сертификат.

### <a name="unable-to-delete-a-certificate"></a>Не удается удалить сертификат 

### <a name="symptom"></a>Симптом

При попытке удалить сертификат, появляется следующее сообщение об ошибке:

**Невозможно удалить сертификат, так как он сейчас используется в SSL-привязке. Ее необходимо удалить, чтобы можно было удалить сертификат.**

### <a name="cause"></a>Причина:

Эта проблема может возникнуть, если сертификат используется другим веб-приложением.

### <a name="solution"></a>Решение

Удалите привязку SSL для этого сертификата из веб-приложений. Затем попробуйте удалить сертификат. Если сертификат по-прежнему не удается удалить, очистите кэш веб-браузера, повторно откройте портал Azure в новом окне браузера и затем снова попробуйте удалить сертификат.

### <a name="unable-to-purchase-an-app-service-certificate"></a>Не удается приобрести сертификат службы приложений 

### <a name="symptom"></a>Симптом
Приобрести [сертификат службы приложений](./web-sites-purchase-ssl-web-site.md) на портале Azure нельзя.

### <a name="cause-and-solution"></a>Причина и решение
Эта проблема может возникать из-за любой из следующих причин:

- Служба приложений имеет план уровня "Бесплатный" или "Общий". SSL для этой ценовой категории не поддерживается. 

    **Решение.** Обновите план службы приложений для веб-приложения до уровня "Стандартный".

- Подписка не имеет действительной кредитной карты.

    **Решение.** Добавьте действительную кредитную карту в подписку. 

- Предложение подписки не поддерживает покупку сертификата службы приложений, такого как Microsoft Student.  

    **Решение.** Обновите подписку. 

- Достигнуто максимальное количество покупок, предусмотренных для подписки.

    **Решение.** Для типов подписок с оплатой по мере использования и с Соглашением Enterprise предусмотрено не больше 10 покупок сертификатов службы приложений. Для других типов подписок ограничение равно 3. Чтобы увеличить это количество, обратитесь в [службу поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).
- Сертификат службы приложений помечен как мошеннический. Отображается следующее сообщение об ошибке: "Ваш сертификат отмечен как потенциально мошеннический." Запрос находится на рассмотрении. Если сертификат не станет доступен в течение 24 часов, обратитесь в службу поддержки Azure.

    **Решение.** Если сертификат помечен как мошеннический и проблема не будет устранена по прошествии 24 часов, сделайте следующее:

    1. Войдите на [портал Azure](https://portal.azure.com).
    2. Перейдите к области **Сертификаты службы приложений**, а затем выберите сертификат.
    3. Выберите **Конфигурация сертификата** > **Step 2 : Verify** (Шаг 2. Проверка)  > **Проверка домена**. В результате будет отправлено электронное уведомление поставщику сертификата Azure для устранения проблемы.

## <a name="domain-problems"></a>Проблемы домена

### <a name="purchased-ssl-certificate-for-wrong-domain"></a>Приобретен SSL-сертификат для неверного домена

### <a name="symptom"></a>Симптом

Вы приобрели сертификат службы приложений для неверного домена и не удается обновить сертификат для использования правильного домена.

### <a name="solution"></a>Решение

- Удалите этот сертификат, а затем приобретите новый.
- Если текущий сертификат, который использует неверный домен, имеет состояние "Выдан", за него также выставляется счет. Плата за сертификаты службы приложений не возвращается, но вы можете обратиться в [службу поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade), чтобы рассмотреть другие варианты. 

### <a name="app-service-certificate-was-renewed-but-still-shows-the-old-certificate"></a>Сертификат службы приложений был обновлен, но по-прежнему отображается старый сертификат 

### <a name="symptom"></a>Симптом

Сертификат службы приложений обновлен, но веб-приложение, использующее сертификат службы приложений, по-прежнему использует старый сертификат. Кроме того, вы получили предупреждение о том, что необходим протокол HTTP.

### <a name="cause"></a>Причина: 
Служба веб-приложений запускает фоновое задание каждые восемь часов и в случае изменений синхронизирует ресурсы сертификата. Таким образом, если вы изменяете или обновляете сертификат, иногда приложение по-прежнему извлекает старый сертификат, а не только что обновленный. Это связано с тем, что задание для синхронизации ресурсов сертификата еще не запущено. 
 
### <a name="solution"></a>Решение

Вы можете принудительно выполнить синхронизацию сертификата. Для этого сделайте следующее:

1. Войдите на [портал Azure](https://portal.azure.com). Выберите **Сертификаты службы приложений**, а затем — сертификат.
2. Щелкните **Повторное создание ключей и синхронизация**, а затем — **Синхронизировать**. Этот процесс занимает некоторое время. 
3. После завершения синхронизации отобразится следующее уведомление: "Все ресурсы обновлены с использованием нового сертификата".

### <a name="domain-verification-is-not-working"></a>Проверка домена не работает 

### <a name="symptom"></a>Симптом 
Прежде чем использовать сертификат службы приложений, необходимо выполнить проверку домена. Если щелкнуть **Проверить**, процесс завершится ошибкой.

### <a name="solution"></a>Решение
Проверьте домен вручную, добавив запись типа TXT:
 
1.  Перейдите к поставщику службы доменных имен (DNS), на котором размещено доменное имя.
2.  Добавьте запись типа TXT для домена, использующего значение токена домена, показанного на портале Azure. 

Подождите несколько минут до запуска распространения данных в DNS, а затем нажмите кнопку **Обновить** для запуска проверки. 

Альтернативным методом для проверки вручную является метод веб-страницы HTML, который позволяет разрешить центру сертификации подтвердить права на владение доменом, для которого выдан сертификат.

1.  Создайте HTML-файл с именем {токен проверки домена}.html. 
2.  Содержимым этого файла должно быть значение токена проверки домена.
3.  Отправьте этот файл в корень веб-сервера, на котором размещается ваш домен.
4.  Щелкните **Обновить**, чтобы проверить состояние сертификата. Проверка может занять несколько минут.

Например, если вы приобретаете стандартный сертификат для azure.com с токеном проверки домена 1234abcd, то веб-запрос, направленный по адресу http://azure.com/1234abcd.html, должен возвратить 1234abcd. 

> [!IMPORTANT]
> При заказе сертификата на проверку домена отводится всего 15 дней, по истечении которых сертификат отклоняется центром сертификации, а счет за этот сертификат не выставляется. В такой ситуации удалите этот сертификат и повторите попытку.
>
> 

### <a name="unable-to-purchase-a-domain"></a>Не удается приобрести домен

### <a name="symptom"></a>Симптом
Вы не можете приобрести домен из веб-приложения или домен службы приложений на портале Azure.

### <a name="cause-and-solution"></a>Причина и решение

Эта ошибка возникает по одной из следующих причин:

- Кредитная карта для подписки Azure отсутствует или недействительная.

    **Решение.** Добавьте действительную кредитную карту в подписку, если она отсутствует.

- Если вы не являетесь владельцем подписки, у вас может не быть разрешения для приобретения домена.

    **Решение.** [Добавьте роль владельца](../billing/billing-add-change-azure-subscription-administrator.md) для учетной записи или обратитесь к администратору подписки, чтобы получить права на приобретения домена.
- Вы достигли предельного числа приобретений доменов для подписки. Текущее ограничение — 20.

    **Решение.** Чтобы отправить запрос на увеличение ограничения, обратитесь в [службу поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).
- Тип подписки Azure не поддерживает покупку домена службы приложений.

    **Решение.** Обновите подписку Azure до других типов подписки, например до подписки с оплатой по мере использования.

### <a name="unable-to-add-a-hostname-to-web-app"></a>Не удается добавить имя узла в веб-приложение 

### <a name="symptom"></a>Симптом

При добавлении имени узла процесс проверки и утверждения домена завершается ошибкой.

### <a name="cause"></a>Причина: 

Эта ошибка возникает по одной из следующих причин:

- У вас нет разрешения на добавление имени узла.

    **Решение.** Обратитесь к администратору подписки, чтобы убедиться, что у вас есть разрешение на добавление имени узла.
- Не удается выполнить проверку владельца домена.

    **Решение.** Убедитесь, что запись CNAME или A настроены правильно. Чтобы сопоставить личный домен с веб-приложением, создайте запись CNAME или A. Если вы хотите использовать корневой домен, необходимо воспользоваться записями типа A и TXT.

    |Тип записи|Узел|На что указывает|
    |------|------|-----|
    |A|@|IP-адрес для веб-приложения|
    |TXT|@|<app-name>.azurewebsites.net|
    |CNAME|www|<app-name>.azurewebsites.net|

### <a name="dns-cannot-be-resolved"></a>Не удается распознать службу доменных имен

### <a name="symptom"></a>Симптом

Отображается сообщение об ошибке The DNS record could not be located (Не удается найти запись DNS).

### <a name="cause"></a>Причина:
Эта ошибка возникает по одной из следующих причин:

- Срок жизни не истек. Проверьте конфигурацию DNS своего домена, чтобы определить значение срока жизни, а затем подождите его окончания.
- Недопустимая конфигурация DNS.

### <a name="solution"></a>Решение
- Подождите 48 часов. Спустя это время проблема устранится самостоятельно.
- Если вы можете изменить параметры срока жизни в конфигурации DNS, измените значение на 5 минут, чтобы увидеть, устранена ли проблема.
- С помощью [WhatsmyDNS.net](https://www.whatsmydns.net/) можно проверить, указывает ли домен на IP-адрес веб-приложения. Если нет, настройте для записи A правильный IP-адрес веб-приложения.

### <a name="restore-a-deleted-domain"></a>Восстановление удаленного домена 

### <a name="symptom"></a>Симптом
Домен больше не отображается на портале Azure.

### <a name="cause"></a>Причина: 
Возможно, домен случайно удален владельцем подписки.

### <a name="solution"></a>Решение
Если домен удален меньше семи дней назад, процесс удаления не был запущен. В этом случае можно приобрести тот же домен снова на портале Azure в рамках одной подписки (убедитесь, что в поле поиска введено точное доменное имя). Плата за этот домен повторно не взимается. Если домен удален больше семи дней назад, обратитесь в [службу поддержки Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade), чтобы получить справку для его восстановления.

### <a name="custom-domain-returns-404-or-site-inaccessible"></a>Личный домен возвращает ошибку 404 или сайт недоступный 

### <a name="symptom"></a>Симптом

При переходе на сайт с помощью имени личного домена отображается следующее сообщение об ошибке:

**Error 404-Web app not found** (Ошибка 404 — веб-приложение не найдено).


### <a name="cause-and-solution"></a>Причина и решение

**Причина 1** 

На настроенном личном домене отсутствует запись A или CNAME. 

**Решение для причины 1**

- Если вы добавили запись A, убедитесь, что запись типа TXT также добавлена. Дополнительные сведения см. в разделе [Создание записи A](./app-service-web-tutorial-custom-domain.md#create-the-a-record).
- Если вам не нужно использовать корневой домен для веб-приложения, рекомендуется использовать запись CNAME вместо записи A.
- Не используйте обе записи CNAME и A для одного домена. Это может вызвать конфликт или препятствовать разрешению домена. 

**Причина 2** 

Веб-браузер может по-прежнему кэшировать старый IP-адрес для домена. 

**Решение для причины 2**

Очистите браузер. Для устройств Windows можно выполнить команду `ipconfig /flushdns`. С помощью [WhatsmyDNS.net](https://www.whatsmydns.net/) можно проверить, указывает ли домен на IP-адрес веб-приложения. 

### <a name="unable-to-add-subdomain"></a>Не удается добавить поддомен 

### <a name="symptom"></a>Симптом

Вы не можете добавить новое имя узла в веб-приложение, чтобы присвоить поддомен.

### <a name="solution"></a>Решение

- Обратитесь к администратору подписки, чтобы убедиться, что у вас есть разрешение на добавление имени узла в веб-приложение.
- Если требуется несколько поддоменов, рекомендуется изменить размещение домена на Azure DNS. С помощью Azure DNS можно добавить 500 имен узлов в веб-приложение. Дополнительные сведения см. в статье [Mapping a custom subdomain to an Azure Website](https://blogs.msdn.microsoft.com/waws/2014/10/01/mapping-a-custom-subdomain-to-an-azure-website/) (Сопоставление личного поддомена с веб-сайтом Azure).











 


















