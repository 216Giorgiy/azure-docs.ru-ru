---
title: Создание рабочих процессов с помощью соединителя Azure IoT Central в Microsoft Flow | Документация Майкрософт
description: Использование соединителя IoT Central в Microsoft Flow для запуска рабочих процессов, а также создания, обновления и удаления устройств в этих процессах.
services: iot-central
author: viv-liu
ms.author: viviali
ms.date: 02/20/2019
ms.topic: conceptual
ms.service: iot-central
manager: peterpr
ms.openlocfilehash: 555fe54174c9e13319af676cab3a5d3dcfaf2fe5
ms.sourcegitcommit: 5fbca3354f47d936e46582e76ff49b77a989f299
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2019
ms.locfileid: "57770255"
---
# <a name="build-workflows-with-the-iot-central-connector-in-microsoft-flow"></a>Создание рабочих процессов с помощью соединителя IoT Central в Microsoft Flow

*Этот раздел предназначен для разработчиков и администраторов.*

Microsoft Flow позволяет автоматизировать рабочие процессы во многих приложениях и службах, которые используют бизнес-пользователи. С помощью соединителя IoT Central в Microsoft Flow можно настроить запуск рабочих процессов при срабатывании правила в IoT Central. В рабочем процессе, инициированном IoT Central или любым другим приложением, можно использовать действия соединителя IoT Central для создания или удаления устройства, а также обновления его свойств и параметров. Ознакомьтесь с [этими шаблонами Microsoft Flow](https://aka.ms/iotcentralflowtemplates), которые подключают IoT Central к другим службам, таким как мобильные уведомления и Microsoft Teams.

## <a name="prerequisites"></a>Технические условия

- приложение с оплатой по мере использования;
- личная, рабочая или учебная учетная запись Майкрософт для входа в Microsoft Flow ([подробнее о планах подписки на Microsoft Flow](https://aka.ms/microsoftflowplans)).

## <a name="trigger-a-workflow"></a>Триггер рабочего процесса

В этом разделе показано, как активировать мобильное уведомление в мобильное приложение Flow при активации правила в IoT Central.

1. Начнем с [создавая правила в IoT Central](howto-create-telemetry-rules.md). После сохранения условия правила, выберите **действия Microsoft Flow** как новое действие. В вашем браузере должна открыться новая вкладка или окно, которое перенаправит вас в Microsoft Flow.

    ![Создание действия Microsoft Flow](media/howto-add-microsoft-flow/createflowaction.png)

1. Войдите в Microsoft Flow. Не обязательно использовать ту же учетную запись, что и в IoT Central. Вы будете перенаправлены на страницу обзора со сведениями о подключении соединителя IoT Central к настраиваемому действию.

1. Войдите в центр Интернета вещей соединитель и выберите **Продолжить**. Затем откроется конструктор Microsoft Flow для создания рабочего процесса. Рабочий процесс имеет триггер IoT Central, для которого уже указаны ваше приложение и правило.

1. Выберите **+ Новый шаг** и **Добавить действие**. На этом этапе вы можете добавить любое действие для своего рабочего процесса. В качестве примера давайте отправим мобильное уведомление. Найдите **уведомление** и выберите **Notifications - Send me a mobile notification** (Уведомления — Отправить мобильное уведомление).

1. В действии в поле "Текст" укажите содержание уведомления. Вы можете добавить *динамическое содержимое* из своего правила IoT Central, передав важные сведения, например имя устройства и метку времени для вашего уведомления.

    > [!NOTE]
    > Выберите **увеличить** текста в окне динамического содержимого для получения измерения и значения свойств, которые происходят в правило.

    ![Действие редактирования с открытой динамической панелью в приложение Flow](./media/howto-add-microsoft-flow/flowdynamicpane.png)

1. После завершения редактирования действия, выберите **Сохранить**. Вы будете перенаправлены на страницу обзора рабочего процесса. Здесь вы можете просмотреть журнал выполнения и предоставить к нему доступ коллегам.

    > [!NOTE]
    > Если вы хотите, чтобы другие пользователи в вашем приложении IoT Central имели возможность редактировать это правило, нужно предоставить им доступ к нему в Microsoft Flow. Добавьте их учетные записи Microsoft Flow в качестве владельцев в рабочий процесс.

1. Если вы вернетесь в свое приложение IoT Central, вы увидите, что в области "Действия" этого правила находится действие Microsoft Flow.

Вы всегда можете начать создание рабочего процесса с использованием соединителя IoT Central в Microsoft Flow. Затем вы можете выбрать приложение IoT Central и правило для подключения.

## <a name="create-a-device-in-a-workflow"></a>Создание устройства в рабочем процессе

В этом разделе показано, как создать новое устройство в IoT Central с помощью кнопки на мобильном устройстве, используя мобильное приложение Microsoft Flow. Вы можете использовать это действие в Flow для интеграции ERP-систем, таких как Dynamics, с IoT Central путем создания нового устройства, когда устройство добавлено в другое расположение.

1. Начните с создания пустого рабочего процесса в Microsoft Flow.

1. В качестве триггера найдите **кнопку потока для мобильных устройств**.

1. В этом триггере добавьте текстовое поле с именем **Имя устройства**. Измените текст описания на **Введите имя нового устройства**.

1. Добавьте новое действие. Найдите действие **Azure IoT Central - Create a device** (Azure IoT Central — Создать устройство).

1. Выберите приложение и шаблон устройства, чтобы создать устройство в раскрывающихся списках. Развернется действие, в котором будут указаны все свойства и параметры устройства.

1. Выберите поле "Имя устройства". На панели динамического содержимого выберите **Имя устройства**. Это значение передается из входных данных, пользователь вводит через мобильное приложение и имя нового устройства в центр Интернета вещей. В этом примере единственным обязательным полем является "Имя устройства", обозначенное красной звездочкой. Другой шаблон устройства может содержать несколько обязательных полей, которые необходимо заполнить для создания нового устройства.

    ![Динамическая панель действия создания устройства в приложении Flow](./media/howto-add-microsoft-flow/flowcreatedevice.png)

1. (Необязательно.) Заполните другие поля, которые, по вашему мнению, необходимы для создания новых устройств.

1. Наконец, сохраните рабочий процесс.

1. Попробуйте запустить свой рабочий процесс в мобильном приложении Microsoft Flow. Перейдите на вкладку **Кнопки** в приложении. Вы должны увидеть область Button -> Create a new device workflow (Кнопка -> Создать рабочий процесс нового устройства). Введите имя своего нового устройства и проверьте, отображается ли оно в IoT Central.

    ![Снимок экрана создания мобильного устройства в приложении Flow](./media/howto-add-microsoft-flow/flowmobilescreenshot.png)

## <a name="update-a-device-in-a-workflow"></a>Обновление устройства в рабочем процессе

В этом разделе показано, как обновить параметры и свойства устройства в IoT Central с помощью кнопки на мобильном устройстве в мобильном приложении Microsoft Flow.

1. Начните с создания пустого рабочего процесса в Microsoft Flow.

1. В качестве триггера найдите **кнопку потока для мобильных устройств**.

1. В этом триггере добавьте входные данные, например **расположение**, которое соответствует параметру или свойству, которое вы хотите изменить. Измените описание.

1. Добавьте новое действие. Найдите действие **Azure IoT Central - Update a device** (Azure IoT Central — Обновить устройство).

1. Выберите свое приложение из раскрывающегося списка. Теперь вам потребуется идентификатор имеющегося устройства, которое вы хотите обновить. Идентификатор устройства IoT Central можно получить в **Device Explorer**.

    ![Идентификатор устройства в Device Explorer в IoT Central](./media/howto-add-microsoft-flow/iotcdeviceid.png)

1. Вы можете обновить имя устройства. Чтобы обновить любые свойства и параметры устройства, выберите шаблон устройства, которое вы хотите обновить, в раскрывающемся списке **Device Template** (Шаблон устройства). Развернется плитка действия, на которой будут показаны все свойства и параметры, которые вы можете обновить.

    ![Обновление рабочего процесса устройства в Flow](./media/howto-add-microsoft-flow/flowupdatedevice.png)

1. Выберите свойства и параметры, которые нужно обновить. На панели динамического содержимого выберите соответствующие входные данные из триггера. В этом примере значение "Расположение" перемещено вниз для обновления свойства расположения устройства.

1. Наконец, сохраните рабочий процесс.

1. Попробуйте запустить свой рабочий процесс в мобильном приложении Microsoft Flow. Перейдите на вкладку **Кнопки** в приложении. Вы должны увидеть область Button -> Update a device workflow (Кнопка -> Обновить рабочий процесс устройства). Введите входные данные и посмотрите, как устройство обновляется в IoT Central.

## <a name="delete-a-device-in-a-workflow"></a>Удаление устройства в рабочем процессе

Вы можете удалить устройство по его идентификатору с помощью действия **Azure IoT Central - Delete a device** (Azure IoT Central — Удалить устройство). Ниже приведен пример рабочего процесса, который позволяет удалить устройство с помощью кнопки в мобильном приложении Microsoft Flow.

   ![Удаление рабочего процесса в приложении Flow](./media/howto-add-microsoft-flow/flowdeletedevice.png)

## <a name="troubleshooting"></a>Устранение неполадок

Ниже приведены несколько советов на случай, если вам не удается подключиться к соединителю Azure IoT Central.

1. Личные учетные записи Майкрософт (например, домены @hotmail.com, @live.com, @outlook.com) в настоящее время не поддерживаются. Необходимо использовать Azure Active Directory (AD) рабочую или учебную учетную запись.

2. Чтобы использовать соединитель IoT Central в Microsoft Flow, необходимо по крайней мере один раз войти в приложение IoT Central. В противном случае приложение не будет отображаться в раскрывающихся списках приложения.

3. Если ошибка возникает при использовании учетной записи Azure AD, попробуйте открыть Windows PowerShell и выполните следующие командлеты с правами администратора.

    ``` PowerShell
    Install-Module AzureAD
    Connect-AzureAD
    New-AzureADServicePrincipal -AppId 9edfcdd9-0bc5-4bd4-b287-c3afc716aac7 -DisplayName "Azure IoT Central"
    ```

## <a name="next-steps"></a>Дальнейшие действия

Теперь, когда вы узнали, как использовать Microsoft Flow для создания рабочих процессов, мы предлагаем — [управления устройствами](howto-manage-devices.md).

