---
title: Создание правил телеметрии и управление ими в приложении Azure IoT Central | Документация Майкрософт
description: Правила телеметрии Azure IoT Central позволяют отслеживать устройства практически в реальном времени и автоматически вызывать действия (например, отправлять сообщение электронной почты) при срабатывании правила.
author: ankitgupta
ms.author: ankitgup
ms.date: 02/02/2019
ms.topic: conceptual
ms.service: iot-central
services: iot-central
manager: peterpr
ms.openlocfilehash: 1d6f43b23bddf2d1ff7a2a41a11b4a2c8623d372
ms.sourcegitcommit: 415742227ba5c3b089f7909aa16e0d8d5418f7fd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2019
ms.locfileid: "55768630"
---
# <a name="create-a-telemetry-rule-and-set-up-notifications-in-your-azure-iot-central-application"></a>Создание правила телеметрии и настройка уведомлений в приложении Azure IoT Central

*Эта статья предназначена для операторов, разработчиков и администраторов.*

Вы можете использовать Azure IoT Central для удаленного мониторинга подключенных устройств. Правила Azure IoT Central позволяют вам отслеживать устройства практически в реальном времени и автоматически вызывать действия, например, отправлять сообщение электронной почты или активировать Microsoft Flow. Всего в несколько щелчков вы можете определить условие для отслеживания данных устройства и настроить соответствующее действие. В этой статье объясняется, как создать правила для отслеживания телеметрии, отправляемой устройством.

Устройства могут использовать измерение телеметрии для отправки числовых данных с устройства. Правило телеметрии срабатывает, когда данные телеметрии выбранного устройства превышают указанное пороговое значение.

## <a name="create-a-telemetry-rule"></a>Создание правила телеметрии

Чтобы создать правило телеметрии, шаблон устройства должен иметь по крайней мере одно определенное измерение телеметрии. В этом примере используется охлаждаемый торговый автомат, который отправляет данные телеметрии о температуре и влажности. Правило отслеживает передаваемые устройством данные температуры и отправляет сообщение электронной почты, когда температура превышает 80 градусов.

1. Используя Device Explorer, откройте шаблон устройства, для которого вы добавляете правило.

1. В выбранном шаблоне щелкните существующее устройство. 

    >[!TIP]
    >Если в шаблоне нет каких-либо устройств, сначала добавьте новое устройство.

1. Если вы еще не создали правило, появится следующий экран:

    ![Правила отсутствуют](media/howto-create-telemetry-rules-experimental/Rules_Landing_Page.png)

1. На вкладке **Правила** щелкните **+ Новое правило**, чтобы просмотреть доступные для создания типы правил.

1. Щелкните **Телеметрия**, чтобы создать правило для мониторинга телеметрии устройства.

    ![Типы правил](media/howto-create-telemetry-rules-experimental/Rule_Types.png)

1. Введите имя, определяющее правило в этом шаблоне устройства.

1. Чтобы немедленно включить правило для всех устройств, созданных на основе этого шаблона, переведите переключатель **Включить правило** в положение "Вкл." для всех устройств в этом шаблоне.

   ![Сведения о правиле](media/howto-create-telemetry-rules-experimental/Rule_Detail.png)

    Правило автоматически применяется ко всем устройствам в шаблоне устройств.

### <a name="configure-the-rule-conditions"></a>Настройка условий правила

Условие определяет критерии, которые отслеживаются этим правилом.

1. Щелкните **+** рядом с полем **Условия**, чтобы добавить новое условие.

1. Выберите телеметрию, которую нужно отслеживать, в раскрывающемся списке **Измерение**.

   ![Условие](media/howto-create-telemetry-rules-experimental/Aggregate_Condition_Filled_Out.png)

1. Затем выберите **Агрегирование**, **Оператор** и введите **пороговое значение**.
    - Агрегирование не является обязательным. Без агрегирования правило запускается для каждой точки данных телеметрии, которая соответствует условию. Например, если правило настроено на активацию, когда температура превышает 80, то правило будет активироваться почти мгновенно, когда устройство сообщит о температуре больше 80.
    - Если выбрана такая агрегатная функция, как Average, Min, Max, Count, тогда вам необходимо предоставить **окно времени агрегирования**, в котором необходимо оценить условие. Например, если задать период "5 минут" и правило ищет среднюю температуру выше 80, оно сработает, если средняя температура превышает 80 в течение как минимум 5 минут. Частота оценки правила такая же, как и **период времени агрегирования**. Это означает, что в этом примере правило оценивается один раз каждые 5 минут.

    >[!NOTE]
    >В поле **Условие** можно добавить несколько измерений телеметрии. Если задано несколько условий, для срабатывания правила необходимо, чтобы были соблюдены все условия. Каждое условие неявно присоединяется с использованием предложения AND. При использовании агрегирования каждое измерение должно быть агрегировано.

### <a name="configure-actions"></a>Настройка действий

В этом разделе показано, как настроить действия, предпринимаемые при запуске правила. Действия вызываются в том случае, если соблюдаются все условия, указанные в правиле.

1. Выберите **+** рядом с разделом **Действия**. Здесь отобразится список доступных действий.  

    ![Добавление действия](media/howto-create-telemetry-rules-experimental/Add_Action.png)

1. Выберите действие **Электронное письмо**, введите допустимый адрес электронной почты в поле **Кому** и укажите примечание, отображаемое в тексте сообщения при срабатывании правила.

    > [!NOTE]
    > Письма отправляются только пользователям, которые были добавлены в приложение и входили в систему минимум один раз. Узнайте больше об [управлении пользователями](howto-administer-experimental.md?toc=/azure/iot-central-experimental/toc.json&bc=/azure/iot-central-experimental/breadcrumb/toc.json) в Azure IoT Central.

   ![Настройка действия](media/howto-create-telemetry-rules-experimental/Configure_Action.png)

1. Чтобы сохранить правило, нажмите кнопку **Сохранить**. Правило станет активным в течение нескольких минут и начнет выполнять мониторинг данных телеметрии, отправляемых в приложение. Если указанное в правиле условие соблюдается, правило активирует настроенное действие отправки электронной почты.

Вы можете добавить другие действия в правило, например действия Microsoft Flow и веб-перехватчики. Для каждого правила можно добавить до 5 действий.

- [действие Microsoft Flow](howto-add-microsoft-flow-experimental.md?toc=/azure/iot-central-experimental/toc.json&bc=/azure/iot-central-experimental/breadcrumb/toc.json) для запуска рабочего процесса в Microsoft Flow при срабатывании правила; 
- [действие веб-перехватчика](howto-create-webhooks-experimental.md?toc=/azure/iot-central-experimental/toc.json&bc=/azure/iot-central-experimental/breadcrumb/toc.json) для уведомления других служб при срабатывании правила.

## <a name="parameterize-the-rule"></a>Параметризация правила

Для правила можно задать определенные значения **свойств устройства** в качестве параметров. Параметры можно использовать в сценариях, когда пороговые значения телеметрии отличаются для различных устройств. При создании правила выберите свойство устройства, определяющее пороговое значение (например, **Maximum Ideal Threshold** (Максимальное идеальное пороговое значение)), вместо предоставления абсолютного значения (например 80 градусов). Когда правило выполняется, оно сопоставляет данные телеметрии устройства с набором значений, указанным в свойстве устройства.

За счет использования параметров можно уменьшить количество управляемых правил в шаблоне устройства.

Действия также можно настроить, используя **свойство устройства** в качестве параметра. Если адрес электронной почты хранится в виде свойстве, его можно использовать при определении адреса **Кому**.

## <a name="delete-a-rule"></a>Удаление правила

Если вам больше не нужно правило, удалите его. Для этого откройте правило и щелкните **Удалить**. Удаление правила приводит к его удалению из шаблона устройства и всех связанных устройств.

## <a name="enable-or-disable-a-rule-for-a-device-template"></a>Включение или отключение правила для шаблона устройства

Перейдите к устройству и выберите правило, которое требуется включить или отключить. Переведите переключатель **Enable rule for all devices of this template** (Включить правило для всех устройств в шаблоне) в правиле, чтобы включить или отключить правило для всех устройств, связанных с определенным шаблоном.

## <a name="enable-or-disable-a-rule-for-a-device"></a>Включение или отключение правила для устройства

Перейдите к устройству и выберите правило, которое требуется включить или отключить. Переведите переключатель **Enable rule for this device** (Включить правило для этого устройства), чтобы включить или отключить правило для этого устройства.

## <a name="next-steps"></a>Дополнительная информация

Вы узнали, как создавать правила в приложении Azure IoT Central, а значит вы готовы к следующему шагу:

- [Добавление действия Microsoft Flow в правилах](howto-add-microsoft-flow-experimental.md?toc=/azure/iot-central-experimental/toc.json&bc=/azure/iot-central-experimental/breadcrumb/toc.json)
- [Добавление действия веб-перехватчика в правилах](howto-create-webhooks-experimental.md?toc=/azure/iot-central-experimental/toc.json&bc=/azure/iot-central-experimental/breadcrumb/toc.json)
- [Управление устройствами](howto-manage-devices-experimental.md?toc=/azure/iot-central-experimental/toc.json&bc=/azure/iot-central-experimental/breadcrumb/toc.json)
