<properties 
	pageTitle="Настройка кэша Redis для Azure"
	description="Обзор конфигурации Redis по умолчанию для кэша Redis для Azure и описание способов настройки экземпляров кэша Redis для Azure"
	services="redis-cache"
	documentationCenter="na"
	authors="steved0x"
	manager="erikre"
	editor="tysonn" />
<tags 
	ms.service="cache"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="cache-redis"
	ms.workload="tbd"
	ms.date="03/10/2016"
	ms.author="sdanie" />

# Настройка кэша Redis для Azure

В этом разделе рассказывается, как просмотреть и обновить конфигурацию экземпляров кэша Redis для Azure, и приводится конфигурация сервера Redis по умолчанию для экземпляров кэша Redis для Azure.

>[AZURE.NOTE] Дополнительные сведения о настройке и использовании функций кэша категории «Премиум» см. в статьях [Настройка постоянного хранения для кэша Redis для Azure уровня Премиум](cache-how-to-premium-persistence.md), [Настройка кластеризации для кэша Redis для Azure уровня Премиум](cache-how-to-premium-clustering.md) и [Настройка поддержки виртуальной сети для кэша Redis для Azure уровня Премиум](cache-how-to-premium-vnet.md).

## Настройка параметров кэша Redis

Доступ к кэшу можно получить на [портале Azure](https://portal.azure.com) с помощью колонки **Обзор**.

![Колонка обзора кэша Redis для Azure](./media/cache-configure/redis-cache-browse.png)

Щелкните **Кэши Redis**, чтобы просмотреть свои экземпляры кэша. Если вы недавно открывали кэш Redis, можете выбрать **Кэши Redis** прямо из списка, не выбирая **Обзор**.

![Список кэшей в обзоре кэша Redis для Azure](./media/cache-configure/redis-caches.png)

Выберите необходимый кэш для просмотра его свойств.

![Все параметры кэша Redis](./media/cache-configure/redis-cache-blade.png)

Для отображения и настройки кэша щелкните **Параметры** или **Все параметры**.

![Параметры кэша Redis](./media/cache-configure/redis-cache-settings.png)

В колонке **Настройки** содержатся следующие настройки кэша Redis для Azure.

-	[Настройки поддержки и устранения неполадок](#support-amp-troubleshooting-settings)
-	[Общие параметры](#general-settings)
	-	[Свойства](#properties)
	-	[Ключи доступа](#access-keys)
	-	[Порты доступа](#access-ports)
	-	[Политика максимальной памяти](#maxmemory-policy-and-maxmemory-reserved)
	-	[Дополнительные параметры (уведомления пространства ключей)](#keyspace-notifications-advanced-settings)
	-	[Рекомендации](#recommendations)
-	[Настройки управления данными](#data-management-settings)
	-	[Сохраняемость данных Redis](#redis-data-persistence)
-	[Параметры сети](#network-settings)
-	[Параметры диагностики](#diagnostics-settings)
-	[Параметры масштабирования](#scale-settings)
	-	[Ценовой уровень](#pricing-tier)
	-	[Размер кластера Redis](#cluster-size)
-	[Настройки управления ресурсами](#resource-management-settings)

## Настройки поддержки и устранения неполадок

Щелкните **Журналы аудита** для просмотра действий, выполняемых с вашим кэшем. Также можно использовать фильтрацию, чтобы развернуть это представление, включив в него другие ресурсы. Дополнительные сведения о работе с журналами аудита см. в разделах [Просмотр журналов событий и аудита](../azure-portal/insights-debugging-with-events.md) и [Операции аудита с помощью диспетчера ресурсов](../resource-group-audit.md). Дополнительные сведения о мониторинге событий кэша Redis для Azure см. в разделе [Операции и оповещения](cache-how-to-monitor.md#operations-and-alerts).

## Общие параметры

Настройки в разделе **Общие** позволяют открыть и настроить следующие параметры кэша.

![Общие параметры](./media/cache-configure/redis-cache-general-settings.png)

### Свойства

Щелкните **Свойства**, чтобы отобразить сведения о кэше, включая конечную точку и порты кэша.

![Свойства кэша Redis](./media/cache-configure/redis-cache-properties.png)

### Ключи доступа

Щелкните **Ключи доступа** для отображения или повторного создания ключей доступа для кэша. Клиенты, подключающиеся к вашему кэшу, используют эти ключи наряду с именем узла и портами из колонки **Свойства**.

![Ключи доступа кэша Redis](./media/cache-configure/redis-cache-manage-keys.png)

### Порты доступа

Для новых кэшей без SSL порт по умолчанию отключен. Чтобы включить порт без SSL, щелкните колонку **Порты доступа**, а затем — **Нет**.

![Порты доступа кэша Redis](./media/cache-configure/redis-cache-access-ports.png)

### Политика максимальной памяти и зарезервированная максимальная память

Щелкните **Политика максимальной памяти**, чтобы настроить политики памяти для кэша. Параметр **maxmemory-policy** определяет политику вытеснения данных для кэша, а параметр **maxmemory-reserved** — объем памяти, зарезервированный для процессов, не связанных с кэшем.

![Политика максимальной памяти кэша Redis](./media/cache-configure/redis-cache-maxmemory-policy.png)

**Политика максимальной памяти** позволяет выбрать одну из указанных ниже политик вытеснения данных.

-	volatile-lru — задано по умолчанию.
-	allkeys-lru
-	volatile-random
-	allkeys-random
-	volatile-ttl
-	noeviction

Дополнительные сведения о политиках максимальной памяти см. в разделе [Политики вытеснения данных](http://redis.io/topics/lru-cache#eviction-policies).

Параметр **maxmemory-reserved** определяет объем памяти в мегабайтах, зарезервированный для операций, не связанных с кэшем, например для репликации при отработке отказов. Его можно использовать при высоком уровне фрагментации. Установка этого значения обеспечивает более согласованную работу сервера Redis при изменении нагрузки. Это значение должно быть выше при рабочих нагрузках с преобладанием записи. При резервировании памяти для таких операций она недоступна для хранения кэшированных данных.

>[AZURE.IMPORTANT] Параметр **maxmemory-reserved** доступен только для кэшей уровней Standard и Premium.

### Уведомления пространства ключей (дополнительные параметры)

Щелкните **Дополнительные параметры**, чтобы настроить уведомления пространства ключей Redis. Уведомления пространства ключей позволяют клиентам получать уведомления при возникновении определенных событий.

![Дополнительные параметры кэша Redis](./media/cache-configure/redis-cache-advanced-settings.png)

>[AZURE.IMPORTANT] Уведомления пространства ключей и параметр **notify-keyspace-events** доступны только для кэшей уровней Standard и Premium.

Дополнительные сведения см. в разделе [Уведомления пространства ключей Redis](http://redis.io/topics/notifications). Пример кода см. в файле [KeySpaceNotifications.cs](https://github.com/rustd/RedisSamples/blob/master/HelloWorld/KeySpaceNotifications.cs) в примере [Hello world](https://github.com/rustd/RedisSamples/tree/master/HelloWorld).

### Рекомендации

В колонке **Рекомендации** отображаются рекомендации для кэша. Во время обычной работы не отображается никаких рекомендаций.

![Рекомендации](./media/cache-configure/redis-cache-no-recommendations.png)

При возникновении во время работы кэша любого из условий, таких как использование большого объема памяти, большой пропускной способности сети или высокая загрузка сервера, в колонке **Кэш Redis** отображается предупреждение.

![Рекомендации](./media/cache-configure/redis-cache-recommendations-alert.png)

Дополнительные сведения можно найти в колонке **Рекомендации**.

![Рекомендации](./media/cache-configure/redis-cache-recommendations.png)

Эти показатели можно отслеживать в разделах [Диаграммы мониторинга](cache-how-to-monitor.md#monitoring-charts) и [Диаграммы использования](cache-how-to-monitor.md#usage-charts) в колонке **Кэш Redis**.

Каждая ценовая категория имеет различные ограничения для количества клиентских подключений, памяти и пропускной способности. Если в течение продолжительного периода времени кэш приближается к максимальной емкости для этих метрик, создается рекомендация. Дополнительные сведения о метриках и ограничениях, используемых инструментом **Рекомендации**, см. в следующей таблице.

| Метрика "Кэш Redis" | Дополнительные сведения см. в следующих статьях: |
|-------------------------|---------------------------------------------------------------------------|
| Пропускная способность сети | [Производительность кэша — доступная пропускная способность](cache-faq.md#cache-performance) |
| Подключенные клиенты | [Конфигурация сервера Redis по умолчанию — максимальное количество клиентов](#maxclients) |
| Загрузка сервера | [Диаграммы использования — загрузка сервера Redis](cache-how-to-monitor.md#usage-charts) |
| Использование памяти | [Производительность кэша — размер](cache-faq.md#cache-performance) |

Для обновления кэша нажмите кнопку **Обновить сейчас**. При этом будут изменены [ценовая категория](#pricing-tier) и размер кэша. Дополнительные сведения о выборе ценовой категории кэша см. в разделе [Какое предложение и размер кэша Redis мне следует использовать?](cache-faq.md#what-redis-cache-offering-and-size-should-i-use).

## Настройки управления данными

Настройки в разделе **Управление данными** позволяют открыть и настроить следующие параметры кэша.

![Управление данными](./media/cache-configure/redis-cache-data-management.png)

### Сохраняемость данных Redis

Щелкните **Сохраняемость данных Redis**, чтобы включить, отключить или настроить сохраняемость данных кэша категории «Премиум».

![Сохраняемость данных Redis](./media/cache-configure/redis-cache-persistence-settings.png)

Чтобы включить сохраняемость Redis, активируйте архивацию базы данных Redis, выбрав параметр **Включено**. Чтобы отключить сохраняемость Redis, щелкните **Отключено**.

Чтобы настроить интервал архивации, выберите **частоту резервного копирования** из раскрывающегося списка. Можно выбрать **15 минут**, **30 минут**, **60 минут**, **6 часов**, **12 часов** или **24 часа**. Отсчет этого интервала начинается после успешного завершения предыдущей операции резервного копирования. По истечении этого интервала запускается новое резервное копирование.

Щелкните нужную **Учетная запись хранения**, чтобы выбрать нужную учетную запись хранения. Выберите **Первичный ключ** или **Вторичный ключ** из раскрывающегося списка **Ключ к хранилищу данных**. Учетную запись хранения необходимо выбрать в том же регионе, где находится кэш. Рекомендуется учетная запись хранения категории **Премиум**, так как хранилище категории «Премиум» отличается более высокой пропускной способностью. Если ключ к хранилищу данных для учетной записи сохраняемости создается заново, необходимо повторно выбрать желаемый ключ из раскрывающегося списка **Ключ к хранилищу данных**.

Щелкните **ОК** для сохранения конфигурации сохраняемости.

>[AZURE.IMPORTANT] Сохраняемость данных Redis доступна только для кэшей категории «Премиум». Дополнительные сведения см. в разделе [Настройка постоянного хранения для кэша Redis для Azure уровня Премиум](cache-how-to-premium-persistence.md).

## Параметры сети

Настройки в разделе **Сеть** позволяют открыть и настроить следующие параметры кэша.

![Сеть](./media/cache-configure/redis-cache-network.png)

>[AZURE.IMPORTANT] Параметры виртуальной сети доступны только для кэшей уровня Премиум, которые были настроены с поддержкой виртуальной сети во время создания кэша. Дополнительные сведения о создании кэша уровня Премиум с поддержкой виртуальной сети и обновлением ее параметров см. в разделе [Настройка поддержки виртуальной сети для кэша Redis для Azure уровня Премиум](cache-how-to-premium-vnet.md).

## Параметры диагностики

В разделе **Диагностика** можно настроить диагностику для кэша Redis.

![Диагностика](./media/cache-configure/redis-cache-diagnostics.png)

Щелкните **Диагностика** для настройки учетной записи хранения, используемой для хранения диагностических данных кэша.

![Диагностика кэша Redis](./media/cache-configure/redis-cache-diagnostics-settings.png)

Дополнительные сведения см. в статье [Как отслеживать кэш Redis для Azure](cache-how-to-monitor.md).

## Параметры масштабирования

Настройки в разделе **Масштабирование** позволяют открыть и настроить следующие параметры кэша.

![Сеть](./media/cache-configure/redis-cache-scale.png)

### Ценовая категория

Щелкните **Ценовая категория**, чтобы просмотреть или изменить ценовую категорию для кэша. Дополнительные сведения о масштабировании см. в статье [Масштабирование кэша Redis для Azure](cache-how-to-scale.md).

![Ценовая категория кэша Redis](./media/cache-configure/pricing-tier.png)

<a name="cluster-size"></a>
### Размер кластера Redis

Щелкните **Размер кластера Redis (предварительная версия)**, чтобы добавить или удалить сегменты работающего кэша категории "Премиум" с включенной кластеризацией.

>[AZURE.NOTE] Обратите внимание, что хотя кэш Redis для Azure категории «Премиум» выпущен для общего доступа, сейчас функция изменения размера кластера Redis находится на этапе предварительной версии.

![Размер кластера Redis](./media/cache-configure/redis-cache-redis-cluster-size.png)

Чтобы изменить размер кластера, воспользуйтесь ползунком или введите число от 1 до 10 в текстовом поле **Количество сегментов**, затем нажмите кнопку **ОК** для сохранения изменений.

>[AZURE.IMPORTANT] Кластеризация Redis доступна только для кэша категории «Премиум». Дополнительные сведения см. в разделе [Настройка кластеризации для кэша Redis для Azure уровня Премиум](cache-how-to-premium-clustering.md).


## Настройки управления ресурсами

![Пользователи и теги кэша Redis](./media/cache-configure/redis-cache-resource-management.png)

В разделе **Пользователи** предусматривается поддержка управления доступом на основе ролей (RBAC) на портале Azure, чтобы помочь организациям просто и точно выполнять требования контроля доступа. Дополнительные сведения см. в статье [Контроль доступа на основе ролей на портале Azure](http://go.microsoft.com/fwlink/?LinkId=512803).

В разделе **Теги** вы можете упорядочить свои ресурсы. Дополнительные сведения см. в статье [Использование тегов для организации ресурсов в Azure](../resource-group-using-tags.md).

## Конфигурация сервера Redis по умолчанию

Новые экземпляры кэша Redis для Azure имеют следующие значения конфигурации Redis по умолчанию.

>[AZURE.NOTE] Параметры в этом разделе не удастся изменить с помощью метода `StackExchange.Redis.IServer.ConfigSet`. При вызове этого метода одной из команд в данном разделе, выдается исключение, аналогичное приведенным ниже:
>
>`StackExchange.Redis.RedisServerException: ERR unknown command 'CONFIG'`
>  
>Все настраиваемые значения, такие как **max-memory-policy**, настраиваются на портале Azure или с помощью инструментов командной строки, таких как интерфейс командной строки Azure или PowerShell.

|Настройка|Значение по умолчанию|Описание|
|---|---|---|
|databases|16|База данных по умолчанию — DB 0. Можно выбрать другую отдельно для каждого подключения с помощью connection.GetDataBase(dbid), где dbid — это число от 0 до 15.|
|maxclients|Зависит от ценовой категории <sup>1</sup>.|Это максимально допустимое количество одновременно подключенных клиентов. После достижения предела Redis закроет все новые подключения, отправив сообщение об ошибке "достигнуто максимальное количество клиентов".|
|maxmemory-policy|volatile-lru|Политика максимальной памяти — это параметр, определяющий то, как Redis будет выбирать, что следует удалить при достижении максимальной памяти (размер кэша, который предлагается задать при создании кэша). В случае с кэшем Redis для Azure значением по умолчанию является volatile-lru, когда удаляются ключи со сроком действия, устанавливаемым посредством алгоритма LRU. Этот параметр можно настроить на портале Azure. Дополнительные сведения см. в разделе [Политика максимальной памяти и зарезервированная максимальная память](#maxmemory-policy-and-maxmemory-reserved).|
|maxmemory-samples|3|Алгоритмы LRU и минимальный TTL являются не точными, а аппроксимированными алгоритмами (в целях сохранения памяти), поэтому для проверки можно также выбрать размер образца. Например, по умолчанию Redis проверит три ключа и выберет один, использовавшийся наиболее давно.|
|lua-time-limit|5 000|Максимальное время выполнения сценария Lua в миллисекундах. При достижении максимального времени выполнения Redis сделает запись в журнале о нахождении данного сценария в процессе выполнения по истечении максимально допустимого времени и начнет отвечать на запросы ошибкой.|
|lua-event-limit|500|Это максимальный размер очереди событий сценариев.|
|client-output-buffer-limit normalclient-output-buffer-limit pubsub|0 0 032mb 8mb 60|Ограничения буферов вывода клиентов можно использовать для принудительного отключения клиентов, по каким-либо причинам недостаточно быстро считывающим данные с сервера (распространенной причиной является неспособность клиента Pub/Sub поглощать сообщения так же быстро, как их производит издатель). Дополнительные сведения см. по ссылке [http://redis.io/topics/clients](http://redis.io/topics/clients).|

<a name="maxclients"></a> <sup>1</sup>`maxclients` отличается для каждой ценовой категории кэша Redis для Azure.

-	Кэши уровней Basic и Standard
	-	кэш C0 (250 МБ) — до 256 подключений;
	-	кэш C1 (1 ГБ) — до 1000 подключений;
	-	кэш C2 (2.5 ГБ) — до 2000 подключений;
	-	кэш C3 (6 ГБ) — до 5000 подключений;
	-	кэш C4 (13 ГБ) — до 10 000 подключений;
	-	кэш C5 (26 ГБ) — до 15 000 подключений;
	-	кэш C6 (53 ГБ) — до 20 000 подключений.
-	Кэши уровня Premium
	-	P1 (6–60 ГБ): до 7500 подключений
	-	P2 (13–130 ГБ): до 15 000 подключений
	-	P3 (26–260 ГБ): до 30 000 подключений
	-	P4 (53–530 ГБ): до 40 000 подключений

## Команды Redis не поддерживаются в кэше Redis для Azure

>[AZURE.IMPORTANT] Поскольку настройка и управление экземплярами кэша Redis для Azure осуществляется Майкрософт, следующие команды отключены. При попытке их вызвать появится сообщение об ошибке примерно следующего содержания: `"(error) ERR unknown command"`.
>
>-	BGREWRITEAOF
>-	BGSAVE
>-	CONFIG
>-	DEBUG
>-	MIGRATE
>-	СОХРАНИТЬ
>-	SHUTDOWN
>-	SLAVEOF

Дополнительные сведения о командах Redis см. по ссылке [http://redis.io/commands](http://redis.io/commands).

## Консоль Redis

В экземплярах кэша Redis для Azure можно безопасно выполнять команды с помощью **консоли Redis**, доступной для кэшей категорий «Стандартный» и «Премиум».

>[AZURE.IMPORTANT] Консоль Redis не работает с виртуальной сетью или кластеризацией.
>
>-	[Виртуальная сеть.](cache-how-to-premium-vnet.md) Если кэш является частью виртуальной сети, к нему могут обращаться только клиенты в этой виртуальной сети. Так как консоль Redis использует клиент redis-cli.exe, размещенный на виртуальных машинах, которые не являются частью виртуальной сети, она не может подключиться к кэшу.
>-	[Кластеризация.](cache-how-to-premium-clustering.md) Консоль Redis использует клиент redis-cli.exe, который сейчас не поддерживает кластеризацию. Служебная программа redis-cli в ветви [нестабильных версий](http://redis.io/download) репозитория Redis в GitHub реализует базовую поддержку, если ее запустить с параметром `-c`. Дополнительные сведения см. в разделе [Эксперименты с кластером](http://redis.io/topics/cluster-tutorial#playing-with-the-cluster) [учебника по кластерам Redis](http://redis.io/topics/cluster-tutorial) на сайте [http://redis.io](http://redis.io).

Для доступа к консоли Redis в колонке **Кэш Redis** щелкните **Консоль**.

![Консоль Redis](./media/cache-configure/redis-console-menu.png)

Чтобы выполнить команду в своем экземпляре кэша, просто введите нужную команду в консоль.

![Консоль Redis](./media/cache-configure/redis-console.png)

Список команд Redis, отключенных в кэше Redis для Azure, см. в предыдущем разделе, [Команды Redis не поддерживаются в кэше Redis для Azure](#redis-commands-not-supported-in-azure-redis-cache). Дополнительные сведения о командах Redis см. по ссылке [http://redis.io/commands](http://redis.io/commands).

## Перемещение кэша в новую подписку

Для перемещения кэша в новую подписку щелкните **Перемещение**.

![Перемещение кэша Redis](./media/cache-configure/redis-cache-move.png)

Сведения о перемещении ресурсов из одной группы ресурсов в другую, а также из одной подписки в другую см. в разделе [Перемещение ресурсов в новую группу ресурсов или подписку](../resource-group-move-resources.md).

## Дальнейшие действия
-	Дополнительные сведения о работе с командами Redis см. в разделе [Как выполнять команды Redis?](cache-faq.md#how-can-i-run-redis-commands).

<!---HONumber=AcomDC_0316_2016-->