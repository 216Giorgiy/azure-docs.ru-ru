<properties 
   pageTitle="Настройка кэша Redis для Azure"
   description="Обзор конфигурации Redis по умолчанию для кэша Redis для Azure и описание способов настройки экземпляров кэша Redis для Azure"
   services="redis-cache"
   documentationCenter="na"
   authors="steved0x"
   manager="dwrede"
   editor="tysonn" />
<tags 
   ms.service="cache"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="cache-redis"
   ms.workload="tbd"
   ms.date="12/01/2015"
   ms.author="sdanie" />

# Настройка кэша Redis для Azure

В этом разделе рассказывается, как просмотреть и обновить конфигурацию экземпляров кэша Redis для Azure, и приводится конфигурация сервера Redis по умолчанию для экземпляров кэша Redis для Azure.

>[AZURE.NOTE]Дополнительные сведения о настройке и использовании функций кэша категории «Премиум» см. в статьях [Настройка постоянного хранения для кэша Redis для Azure уровня Премиум](cache-how-to-premium-persistence.md), [Настройка кластеризации для кэша Redis для Azure уровня Премиум](cache-how-to-premium-clustering.md) и [Настройка поддержки виртуальной сети для кэша Redis для Azure уровня Премиум](cache-how-to-premium-vnet.md).

## Настройка параметров кэша Redis

Доступ к кэшу можно получить на [портале предварительной версии Azure](https://portal.azure.com) с помощью колонки **Обзор**.

![Колонка обзора кэша Redis для Azure](./media/cache-configure/IC796920.png)

Щелкните **Кэши Redis**, чтобы просмотреть свои экземпляры кэша.

![Список кэшей в обзоре кэша Redis для Azure](./media/cache-configure/IC796921.png)

Выберите необходимый кэш для просмотра его свойств.

![Все параметры кэша Redis](./media/cache-configure/IC808312.png)

Для отображения и настройки кэша щелкните **Параметры** или **Все параметры**.

![Параметры кэша Redis](./media/cache-configure/IC808313.png)

## Свойства

Щелкните **Свойства**, чтобы отобразить сведения о кэше, включая конечную точку и порты кэша.

![Свойства кэша Redis](./media/cache-configure/IC808314.png)

## Ключи доступа

Щелкните **Ключи доступа** для отображения или повторного создания ключей доступа для кэша. Клиенты, подключающиеся к вашему кэшу, используют эти ключи наряду с именем узла и портами из колонки **Свойства**.

![Ключи доступа кэша Redis](./media/cache-configure/IC808315.png)

## Порты доступа

Для новых кэшей без SSL порт по умолчанию отключен. Чтобы включить порт без SSL, щелкните колонку **Порты доступа**, а затем — **Нет**.

![Порты доступа кэша Redis](./media/cache-configure/IC808316.png)

## Ценовая категория

Щелкните **Ценовая категория**, чтобы просмотреть или изменить ценовую категорию для кэша. Дополнительные сведения о масштабировании см. в статье [Масштабирование кэша Redis для Azure](cache-how-to-scale.md).

![Ценовая категория кэша Redis](./media/cache-configure/pricing-tier.png)

## Диагностика

Щелкните **Диагностика** для настройки учетной записи хранения, используемой для хранения диагностических данных кэша.

![Диагностика кэша Redis](./media/cache-configure/IC808317.png)

Дополнительные сведения см. в статье [Как отслеживать кэш Redis для Azure](cache-how-to-monitor.md).

## Политика максимальной памяти и зарезервированная максимальная память

Щелкните **Политика максимальной памяти**, чтобы настроить политики памяти для кэша. Параметр **maxmemory-policy** определяет политику вытеснения данных для кэша, а параметр **maxmemory-reserved** — объем памяти, зарезервированный для процессов, не связанных с кэшем.

![Политика максимальной памяти кэша Redis](./media/cache-configure/IC808318.png)

**Политика максимальной памяти** позволяет выбрать одну из указанных ниже политик вытеснения данных.

-	volatile-lru — задано по умолчанию.
-	allkeys-lru
-	volatile-random
-	allkeys-random
-	volatile-ttl
-	noeviction

Дополнительные сведения о политиках максимальной памяти см. в разделе [Политики вытеснения данных](http://redis.io/topics/lru-cache#eviction-policies).

Параметр **maxmemory-reserved** определяет объем памяти в мегабайтах, зарезервированный для операций, не связанных с кэшем, например для репликации при отработке отказов. Его можно использовать при высоком уровне фрагментации. Установка этого значения обеспечивает более согласованную работу сервера Redis при изменении нагрузки. Это значение должно быть выше при рабочих нагрузках с преобладанием записи. При резервировании памяти для таких операций она недоступна для хранения кэшированных данных.

>[AZURE.IMPORTANT]Параметр **maxmemory-reserved** доступен только для кэшей уровней Standard и Premium.

## Уведомления пространства ключей (дополнительные параметры)

Щелкните **Дополнительные параметры**, чтобы настроить уведомления пространства ключей Redis. Уведомления пространства ключей позволяют клиентам получать уведомления при возникновении определенных событий.

![Дополнительные параметры кэша Redis](./media/cache-configure/IC808319.png)

>[AZURE.IMPORTANT]Уведомления пространства ключей и параметр **notify-keyspace-events** доступны только для кэшей уровней Standard и Premium.

Дополнительные сведения см. в разделе [Уведомления пространства ключей Redis](http://redis.io/topics/notifications). Пример кода см. в файле [KeySpaceNotifications.cs](https://github.com/rustd/RedisSamples/blob/master/HelloWorld/KeySpaceNotifications.cs) в примере [Hello world](https://github.com/rustd/RedisSamples/tree/master/HelloWorld).

## Сохраняемость данных Redis

Щелкните **Сохраняемость данных Redis**, чтобы включить, отключить или настроить сохраняемость данных кэша категории «Премиум».

![Сохраняемость данных Redis](./media/cache-configure/redis-cache-persistence-settings.png)

Чтобы включить сохраняемость Redis, активируйте архивацию базы данных Redis, выбрав параметр **Включено**. Чтобы отключить сохраняемость Redis, щелкните **Отключено**.

Чтобы настроить интервал архивации, выберите **частоту резервного копирования** из раскрывающегося списка. Можно выбрать **15 минут**, **30 минут**, **60 минут**, **6 часов**, **12 часов** или **24 часа**. Отсчет этого интервала начинается после успешного завершения предыдущей операции резервного копирования. По истечении этого интервала запускается новое резервное копирование.

Щелкните нужную **Учетная запись хранения**, чтобы выбрать нужную учетную запись хранения. Выберите **Первичный ключ** или **Вторичный ключ** из раскрывающегося списка **Ключ к хранилищу данных**. Учетную запись хранения необходимо выбрать в том же регионе, где находится кэш. Рекомендуется учетная запись хранения категории **Премиум**, так как хранилище категории «Премиум» отличается более высокой пропускной способностью. Если ключ к хранилищу данных для учетной записи сохраняемости создается заново, необходимо повторно выбрать желаемый ключ из раскрывающегося списка **Ключ к хранилищу данных**.

Щелкните **ОК** для сохранения конфигурации сохраняемости.

>[AZURE.IMPORTANT]Сохраняемость данных Redis доступна только для кэшей категории «Премиум».

## Пользователи и теги

![Пользователи и теги кэша Redis](./media/cache-configure/IC808320.png)

В разделе **Пользователи** предусмотрена поддержка управления доступом на основе ролей (RBAC) на портале предварительной версии, чтобы организации могли просто и точно соблюдать свои требования к управлению доступом. Дополнительные сведения см. в статье [Управление доступом на основе ролей на портале предварительной версии Azure](http://go.microsoft.com/fwlink/?LinkId=512803).

В разделе **Теги** вы можете упорядочить свои ресурсы. Дополнительные сведения см. в статье [Использование тегов для организации ресурсов в Azure](../resource-group-using-tags.md).

## Конфигурация сервера Redis по умолчанию

Новые экземпляры кэша Redis для Azure имеют следующие значения конфигурации Redis по умолчанию.

>[AZURE.NOTE]Параметры в этом разделе не удастся изменить с помощью метода `StackExchange.Redis.IServer.ConfigSet`. При вызове этого метода одной из команд в данном разделе, выдается исключение, аналогичное приведенным ниже:
>
>`StackExchange.Redis.RedisServerException: ERR unknown command 'CONFIG'`
>  
>Все настраиваемые значения, например **max-memory-policy**, можно настроить на портале предварительной версии.

|Настройка|Значение по умолчанию|Описание|
|---|---|---|
|databases|16|База данных по умолчанию — DB 0. Можно выбрать другую отдельно для каждого подключения с помощью connection.GetDataBase(dbid), где dbid — это число от 0 до 15.|
|maxclients|Зависит от ценовой категории <sup>1</sup>.|Это максимально допустимое количество одновременно подключенных клиентов. После достижения предела Redis закроет все новые подключения, отправив сообщение об ошибке "достигнуто максимальное количество клиентов".|
|maxmemory-policy|volatile-lru|Политика максимальной памяти — это параметр, определяющий то, как Redis будет выбирать, что следует удалить при достижении максимальной памяти (размер кэша, который предлагается задать при создании кэша). В случае с кэшем Redis для Azure значением по умолчанию является volatile-lru, когда удаляются ключи со сроком действия, устанавливаемым посредством алгоритма LRU. Этот параметр можно настроить на портале предварительной версии. Дополнительные сведения см. в разделе [Политика максимальной памяти и зарезервированная максимальная память](#maxmemory-policy-and-maxmemory-reserved).|
|maxmemory-samples|3|Алгоритмы LRU и минимальный TTL являются не точными, а аппроксимированными алгоритмами (в целях сохранения памяти), поэтому для проверки можно также выбрать размер образца. Например, по умолчанию Redis проверит три ключа и выберет один, использовавшийся наиболее давно.|
|lua-time-limit|5 000|Максимальное время выполнения сценария Lua в миллисекундах. При достижении максимального времени выполнения Redis сделает запись в журнале о нахождении данного сценария в процессе выполнения по истечении максимально допустимого времени и начнет отвечать на запросы ошибкой.|
|lua-event-limit|500|Это максимальный размер очереди событий сценариев.|
|client-output-buffer-limit normalclient-output-buffer-limit pubsub|0 0 032mb 8mb 60|Ограничения буферов вывода клиентов можно использовать для принудительного отключения клиентов, по каким-либо причинам недостаточно быстро считывающим данные с сервера (распространенной причиной является неспособность клиента Pub/Sub поглощать сообщения так же быстро, как их производит издатель). Дополнительные сведения см. по ссылке [http://redis.io/topics/clients](http://redis.io/topics/clients).|

<sup>1</sup>`maxclients` отличается для каждой ценовой категории кэша Redis для Azure.

-	Кэши уровней Basic и Standard
	-	кэш C0 (250 МБ) — до 256 подключений;
	-	кэш C1 (1 ГБ) — до 1000 подключений;
	-	кэш C2 (2.5 ГБ) — до 2000 подключений;
	-	кэш C3 (6 ГБ) — до 5000 подключений;
	-	кэш C4 (13 ГБ) — до 10 000 подключений;
	-	кэш C5 (26 ГБ) — до 15 000 подключений;
	-	кэш C6 (53 ГБ) — до 20 000 подключений.
-	Кэши уровня Premium
	-	P1 (6–60 ГБ): до 7500 подключений
	-	P2 (13–130 ГБ): до 15 000 подключений
	-	P3 (26–260 ГБ): до 30 000 подключений
	-	P4 (53–530 ГБ): до 40 000 подключений

## Команды Redis не поддерживаются в кэше Redis для Azure

>[AZURE.IMPORTANT]Поскольку настройка и управление экземплярами кэша Redis для Azure осуществляется с помощью портала предварительной версии, следующие команды отключены. При попытке вызвать их отобразится сообщение об ошибке примерно следующего содержания: `"(error) ERR unknown command"`.
>
>-	BGREWRITEAOF
>-	BGSAVE
>-	CONFIG
>-	DEBUG
>-	MIGRATE
>-	СОХРАНИТЬ
>-	SHUTDOWN
>-	SLAVEOF

Дополнительные сведения о командах Redis см. по ссылке [http://redis.io/commands](http://redis.io/commands).

## Консоль Redis

В экземплярах кэша Redis для Azure можно безопасно выполнять команды с помощью **консоли Redis**, доступной для кэшей категорий «Стандартный» и «Премиум».

>[AZURE.IMPORTANT]Консоль Redis не работает с виртуальной сетью или кластеризацией.
>
>-	[Виртуальная сеть.](cache-how-to-premium-vnet.md) Если кэш является частью виртуальной сети, к нему могут обращаться только клиенты в этой виртуальной сети. Так как консоль Redis использует клиент redis-cli.exe, размещенный на виртуальных машинах, которые не являются частью виртуальной сети, она не может подключиться к кэшу.
>-	[Кластеризация.](cache-how-to-premium-clustering.md) Консоль Redis использует клиент redis-cli.exe, который сейчас не поддерживает кластеризацию. Служебная программа redis-cli в ветви [нестабильных версий](http://redis.io/download) репозитория Redis в GitHub реализует базовую поддержку, если ее запустить с параметром `-c`. Дополнительные сведения см. в разделе [Эксперименты с кластером](http://redis.io/topics/cluster-tutorial#playing-with-the-cluster) [учебника по кластерам Redis](http://redis.io/topics/cluster-tutorial) на сайте [http://redis.io](http://redis.io).

Для доступа к консоли Redis в колонке **Кэш Redis** щелкните **Консоль**.

![Консоль Redis](./media/cache-configure/redis-console-menu.png)

Чтобы выполнить команду в своем экземпляре кэша, просто введите нужную команду в консоль.

![Консоль Redis](./media/cache-configure/redis-console.png)

Список команд Redis, отключенных в кэше Redis для Azure, см. в предыдущем разделе, [Команды Redis не поддерживаются в кэше Redis для Azure](#redis-commands-not-supported-in-azure-redis-cache). Дополнительные сведения о командах Redis см. по ссылке [http://redis.io/commands](http://redis.io/commands).

## Дальнейшие действия
-	Дополнительные сведения о работе с командами Redis см. в разделе [Как выполнять команды Redis?](cache-faq.md#how-can-i-run-redis-commands).

<!---HONumber=AcomDC_1203_2015-->