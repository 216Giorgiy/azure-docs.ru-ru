<properties 
	pageTitle="Масштабирование кэша Redis для Azure" 
	description="Узнайте, как масштабировать экземпляры кэша Redis для Azure" 
	services="redis-cache" 
	documentationCenter="" 
	authors="steved0x" 
	manager="dwrede" 
	editor=""/>

<tags 
	ms.service="cache" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="cache-redis" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="12/11/2015" 
	ms.author="sdanie"/>

# Масштабирование кэша Redis для Azure

>[AZURE.NOTE]Функция масштабирования кэша Redis для Azure предоставляется в предварительной версии. В период действия предварительной версии нельзя масштабировать кэш до уровня Premium или с уровня Premium до другого уровня, но можно изменять ценовую категорию в кэше уровня Premium.

Кэш Redis для Azure предлагает разные варианты кэша, которые обеспечивают гибкость в выборе размера и функций кэша. Если требования вашего приложения изменятся после создания кэша, можно масштабировать размер кэша, используя колонку **изменения ценовой категории** на [портале Azure](https://portal.azure.com).

## Выбор времени масштабирования

Можно использовать функции [мониторинга](cache-how-to-monitor.md) кэша Redis для Azure, чтобы отслеживать работоспособность и производительность приложений кэша и определить, есть ли необходимость в масштабировании кэша.

Можно отслеживать следующие метрики для определения необходимости масштабирования.

-	Загрузка сервера Redis
-	Использование памяти
-	Пропускная способность сети
-	Загрузка ЦП

Если выяснилось, что ваш кэш больше не удовлетворяет требованиям приложения, можно перейти в более высокую или низкую ценовую категорию кэша, которая подходит для вашего приложения. Дополнительные сведения о выборе ценовой категории кэша см. в разделе [Выбор варианта и размера кэша Redis](cache-faq.md#what-redis-cache-offering-and-size-should-i-use).

## Масштабирование кэша
Для масштабирования вашего кэша [перейдите к кэшу](cache-configure.md#configure-redis-cache-settings) в [портале Azure](https://portal.azure.com) и выберите **Параметры**, **Ценовая категория**.

Также можно щелкнуть **уровень Standard** или **уровень Basic** в колонке **Кэш Redis**.

![Ценовой уровень][redis-cache-pricing-tier-part]

Выберите нужную ценовую категорию из колонки **Ценовая категория** и нажмите кнопку **Выбрать**.

![Ценовой уровень][redis-cache-pricing-tier-blade]

>[AZURE.NOTE]Вы можете выполнить масштабирование до другой ценовой категории со следующими ограничениями.
>
>-	Вам не удастся выполнить масштабирование кэша до уровня **Premium** или с уровня Premium до другого уровня.
>-	Вам не удастся выполнить масштабирование кэша с уровня **Standard** до уровня **Basic**.
>-	Вы можете выполнить масштабирование кэша с уровня **Basic** до уровня **Standard**, но вам не удастся одновременно с этим изменить размер кэша. Если требуется изменить размер, можно выполнить последующую операцию масштабирования до нужного размера.
>-	Вам не удастся выполнить масштабирование с большего размера до размера **C0 (250 МБ)**.

Во время масштабирования кэша до новой ценовой категории состояние **Масштабирование** отображается в колонке **Кэш Redis**.

![Масштабирование][redis-cache-scaling]

После завершения масштабирования состояние меняется с **Масштабирование** на **Работает**.

## Автоматизация операции масштабирования

Кроме масштабирования вашего экземпляра кэша Redis для Azure на портале Azure существует возможность масштабирования с помощью [библиотек управления Microsoft Azure (MAML)](http://azure.microsoft.com/updates/management-libraries-for-net-release-announcement/). Чтобы масштабировать кэш, вызовите метод `IRedisOperations.CreateOrUpdate` и передайте новый размер для `RedisProperties.SKU.Capacity`.

    static void Main(string[] args)
    {
        // For instructions on getting the access token, see
        // https://azure.microsoft.com/documentation/articles/cache-configure/#access-keys
        string token = GetAuthorizationHeader();

        TokenCloudCredentials creds = new TokenCloudCredentials(subscriptionId,token);

        RedisManagementClient client = new RedisManagementClient(creds);
        var redisProperties = new RedisProperties();

        // To scale, set a new size for the redisSKUCapacity parameter.
        redisProperties.Sku = new Sku(redisSKUName,redisSKUFamily,redisSKUCapacity);
        redisProperties.RedisVersion = redisVersion;
        var redisParams = new RedisCreateOrUpdateParameters(redisProperties, redisCacheRegion);
        client.Redis.CreateOrUpdate(resourceGroupName,cacheName, redisParams);
    }

Подробнее см. в образце [Управление кэшем Redis с помощью MAML](https://github.com/rustd/RedisSamples/tree/master/ManageCacheUsingMAML).

## Масштабирование: часто задаваемые вопросы

Следующий список содержит ответы на часто задаваемые вопросы о масштабировании кэша Redis для Azure.

## Можно ли выполнять масштабирование кэша до уровня Premium, с уровня Premium до другого уровня или в пределах уровня Premium?

-	Нельзя перейти к ценовой категории кэша **Премиум** из ценовой категории **Базовый** или **Стандартный**.
-	Из ценовой категории кэша **Премиум** нельзя перейти к ценовой категории **Базовый** или **Стандартный**.
-	Вы можете переходить от одной ценовой категории кэша **Премиум** к другой.
-	Если при создании вашего кэша категории **Премиум** была включена кластеризация, можно увеличивать или уменьшать число сегментов.

Дополнительные сведения см. в разделе [Настройка кластеризации для кэша Redis для Azure уровня Премиум](cache-how-to-premium-clustering.md).

## Нужно ли менять имя кэша и ключи доступа после масштабирования?

Нет, имя кэша и ключи не изменяются во время операции масштабирования.

## Как работает масштабирование?

При масштабировании кэша уровня **Базовый** до другого размера работа кэша будет завершена. При этом будет выполнена подготовка к работе нового кэша с новым размером. В течение этого времени кэш недоступен и все данные в кэше теряются.

При масштабировании кэша уровня **Базовый** до уровня **Стандартный** выполняется подготовка к работе реплики кэша. При этом данные будут скопированы из основного кэша в реплику кэша. Кэш остается доступным в процессе масштабирования.

При масштабировании кэша уровня **Стандартный** до другого размера одна из реплик завершает работу, а затем выполняется повторная подготовка ее к работе с новым размером. После этого в нее будут переданы данные. Затем другая реплика выполнит отработку отказа перед повторной подготовкой к работе. Процесс отработки отказа аналогичен процессу, выполняемому при сбое одного из узлов кэша.

## Сохранятся ли данные кэша при масштабировании?

При масштабировании кэша категории **Базовый** до другого размера будут утеряны все данные. Во время операции масштабирования кэш недоступен.

При масштабировании кэша категории **Базовый** до категории **Стандартный** данные в кэше обычно сохраняются.

При масштабировании кэша категории **Стандартный** до большего размера все данные обычно сохраняются. При масштабировании кэша **Standard** до меньшего размера данные могут быть потеряны, в зависимости от того, сколько данных находится в кэше при масштабировании относительно нового размера. При потере данных во время масштабирования до меньшего размера ключи вытесняются с помощью политики вытеснения [allkeys-lru](http://redis.io/topics/lru-cache).

Обратите внимание, что, хотя кэш "Стандартный" и "Премиум" имеет соглашение об уровне обслуживания с показателем доступности 99,9 %, для потери данных соглашение об уровне обслуживания отсутствует.

## Будет ли кэш доступен во время масштабирования?

Кэш **Standard** остается доступным во время операции масштабирования.

Во время масштабирования до другого размера кэши категории **Базовый** недоступны. Тем не менее они остаются доступными при масштабировании из категории **Базовый** до категории **Стандартный**.

## Какие операции не поддерживаются?

Вам не удастся выполнить масштабирование кэша до категории **Премиум** или из категории «Премиум» до другой категории.

Вам не удастся выполнить масштабирование кэша из категории **Стандартный** до категории **Базовый**.

Вы можете выполнить масштабирование кэша из категории **Базовый** до категории **Стандартный**, но вам не удастся при этом изменить размер кэша. Если требуется изменить размер, можно выполнить последующую операцию масштабирования до нужного размера.

Можно масштабировать из кэша **C0** (250 МБ) до большего размера, но нельзя масштабировать кэш большего размера до кэша **C0**.

Если операцию масштабирования не удается завершить, служба попытается отменить операцию и кэш вернется к исходному размеру.

## Сколько времени занимает масштабирование?

Масштабирование занимает приблизительно 20 минут в зависимости от объема данных в кэше.

## Как узнать, когда масштабирование завершено?

На портале Azure вы увидите, как выполняется операция масштабирования. После завершения масштабирования состояние кэша изменяется на **Работает**.

## Почему эта функция предоставляется в предварительной версии?

Корпорация Майкрософт выпустила эту функцию для получения отзывов. На основе отзывов мы планируем вскоре выпустить эту функцию для общего доступа.





  
<!-- IMAGES -->
[redis-cache-pricing-tier-part]: ./media/cache-how-to-scale/redis-cache-pricing-tier-part.png

[redis-cache-pricing-tier-blade]: ./media/cache-how-to-scale/redis-cache-pricing-tier-blade.png

[redis-cache-scaling]: ./media/cache-how-to-scale/redis-cache-scaling.png

<!---HONumber=AcomDC_1217_2015-->