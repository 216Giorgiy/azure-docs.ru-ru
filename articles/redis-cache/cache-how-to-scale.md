<properties 
	pageTitle="Масштабирование кэша Redis для Azure"
	description="Узнайте, как масштабировать экземпляры кэша Redis для Azure"
	services="redis-cache"
	documentationCenter=""
	authors="steved0x"
	manager="dwrede"
	editor=""/>

<tags 
	ms.service="cache"
	ms.workload="tbd"
	ms.tgt_pltfrm="cache-redis"
	ms.devlang="na"
	ms.topic="article"
	ms.date="08/25/2015"
	ms.author="sdanie"/>

# Масштабирование кэша Redis для Azure

>[AZURE.NOTE]Функция масштабирования кэша Redis для Azure предоставляется в предварительной версии.

Кэш Redis для Azure предлагает разные варианты кэша, которые обеспечивают гибкость в выборе размера и функций кэша. Если требования вашего приложения изменятся после создания кэша, можно масштабировать размер кэша, используя колонку **изменения ценовой категории** на [портале предварительной версии Azure](https://portal.azure.com).

>[AZURE.NOTE]При масштабировании кэша Redis для Azure можно изменить размер, но нельзя перейти с уровня Standard на Basic и наоборот.

## Выбор времени масштабирования

Можно использовать функции [мониторинга](cache-how-to-monitor.md) кэша Redis для Azure, чтобы отслеживать работоспособность и производительность приложений кэша и определить, есть ли необходимость в масштабировании кэша.

Можно отслеживать следующие метрики для определения необходимости масштабирования.

-	Загрузка сервера Redis
-	Использование памяти
-	Пропускная способность сети
-	Загрузка ЦП

Если выяснилось, что ваш кэш больше не удовлетворяет требованиям приложения, можно перейти в более высокую или низкую ценовую категорию кэша, которая подходит для вашего приложения. Дополнительные сведения о выборе ценовой категории кэша см. в разделе [Выбор варианта и размера кэша Redis](cache-faq.md#what-redis-cache-offering-and-size-should-i-use).

## Масштабирование кэша
Для масштабирования кэша [перейдите к кэшу](cache-configure.md#configure-redis-cache-settings) на [портале предварительной версии](https://portal.azure.com) и выберите уровень **Standard** или **Basic** в колонке **Кэш Redis**.

![Ценовой уровень][redis-cache-pricing-tier-part]

Выберите нужную ценовую категорию из колонки **Ценовая категория** и нажмите кнопку **Выбрать**.

![Ценовой уровень][redis-cache-pricing-tier-blade]

>[AZURE.NOTE]Невозможно изменить план кэша с Basic на Standard или наоборот, а также нельзя уменьшить до 250 МБ кэш большего размера. Можно увеличить кэш размером 250 МБ, но невозможно будет уменьшить его размер до 250 МБ. Если необходимо перейти от плана Basic к Standard или уменьшить размер до 250 МБ, необходимо создать новый кэш.

Во время масштабирования кэша до новой ценовой категории состояние **Масштабирование** отображается в колонке **Кэш Redis**.

![Масштабирование][redis-cache-scaling]

После завершения масштабирования состояние меняется с **Масштабирование** на **Работает**.

>[AZURE.IMPORTANT]Во время операций масштабирования кэш Basic находится в автономном режиме и все данные в кэше теряются. После завершения операции масштабирования кэш Basic возвращается в оперативный режим без данных. Кэш Standard во время масштабирования остается в оперативном режиме, и при увеличении размера кэша Standard данные обычно сохраняются. При масштабировании кэша Standard до меньшего размера некоторые данные могут быть потеряны, если новый размер меньше, чем объем кэшированных данных. Если при масштабировании теряются данные, ключи вытесняются с помощью политики вытеснения [allkeys-lru](http://redis.io/topics/lru-cache). Обратите внимание, что, хотя кэш Standard имеет соглашение об уровне обслуживания с показателем доступности 99,9 %, для потери данных соглашение об уровне обслуживания отсутствует.

## Автоматизация операции масштабирования

Кроме масштабирования вашего экземпляра кэша Redis для Azure, на портале предварительной версии существует возможность масштабирования с помощью [библиотек управления Microsoft Azure (MAML)](http://azure.microsoft.com/updates/management-libraries-for-net-release-announcement/). Чтобы масштабировать кэш, вызовите метод `IRedisOperations.CreateOrUpdate` и передайте новый размер для `RedisProperties.SKU.Capacity`.

    static void Main(string[] args)
    {
        // For instructions on getting the access token, see
        // https://azure.microsoft.com/documentation/articles/cache-configure/#access-keys
        string token = GetAuthorizationHeader();

        TokenCloudCredentials creds = new TokenCloudCredentials(subscriptionId,token);

        RedisManagementClient client = new RedisManagementClient(creds);
        var redisProperties = new RedisProperties();

        // To scale, set a new size for the redisSKUCapacity parameter.
        redisProperties.Sku = new Sku(redisSKUName,redisSKUFamily,redisSKUCapacity);
        redisProperties.RedisVersion = redisVersion;
        var redisParams = new RedisCreateOrUpdateParameters(redisProperties, redisCacheRegion);
        client.Redis.CreateOrUpdate(resourceGroupName,cacheName, redisParams);
    }

Подробнее см. в образце [Управление кэшем Redis с помощью MAML](https://github.com/rustd/RedisSamples/tree/master/ManageCacheUsingMAML).

## Масштабирование: часто задаваемые вопросы

Следующий список содержит ответы на часто задаваемые вопросы о масштабировании кэша Redis для Azure.

## Нужно ли менять имя кэша и ключи доступа после масштабирования?

Нет, имя кэша и ключи не изменяются во время операции масштабирования.

## Как работает масштабирование?

При масштабировании кэша **Basic** кэш отключается и подготавливается новый кэш с новым размером. В течение этого времени кэш недоступен и все данные в кэше теряются.

При масштабировании кэша **Standard** одна из реплик отключается и подготавливается повторно в новом размере, после чего в нее передаются данные. Затем другая реплика перед повторной подготовкой выполняет отработку отказа, процесс которой аналогичен процессу, возникающему при сбое одного из узлов кэша.

## Сохранятся ли данные кэша при масштабировании?

При масштабировании кэша **Basic** теряются все данные, и кэш недоступен во время операции масштабирования.

При масштабировании кэша **Standard** до большего размера обычно сохраняются все данные. При масштабировании кэша **Standard** до меньшего размера данные могут быть потеряны, в зависимости от того, сколько данных находится в кэше при масштабировании относительно нового размера. При потере данных во время масштабирования до меньшего размера ключи вытесняются с помощью политики вытеснения [allkeys-lru](http://redis.io/topics/lru-cache). Обратите внимание, что, хотя кэш Standard имеет соглашение об уровне обслуживания с показателем доступности 99,9 %, для потери данных соглашение об уровне обслуживания отсутствует.

## Будет ли кэш доступен во время масштабирования?

Кэш **Standard** остается доступным во время операции масштабирования.

Кэш **Basic** находится в автономном режиме во время операции масштабирования.

## Какие операции не поддерживаются?

Во время операции масштабирования нельзя изменить план с **Basic** на **Standard** или наоборот.

Можно масштабировать из кэша **C0** (250 МБ) до большего размера, но нельзя масштабировать кэш большего размера до кэша **C0**.

Если операцию масштабирования не удается завершить, служба попытается отменить операцию и кэш вернется к исходному размеру.

## Сколько времени занимает масштабирование?

Масштабирование занимает приблизительно 20 минут в зависимости от объема данных в кэше.

## Как узнать, когда масштабирование завершено?

На портале предварительной версии вы увидите, как выполняется операция масштабирования. После завершения масштабирования состояние кэша изменяется на **Работает**.

## Почему эта функция предоставляется в предварительной версии?

Корпорация Майкрософт выпустила эту функцию для получения отзывов. На основе отзывов мы планируем вскоре выпустить эту функцию для общего доступа.





  
<!-- IMAGES -->
[redis-cache-pricing-tier-part]: ./media/cache-how-to-scale/redis-cache-pricing-tier-part.png

[redis-cache-pricing-tier-blade]: ./media/cache-how-to-scale/redis-cache-pricing-tier-blade.png

[redis-cache-scaling]: ./media/cache-how-to-scale/redis-cache-scaling.png

<!---HONumber=August15_HO9-->