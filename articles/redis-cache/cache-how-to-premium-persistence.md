---
title: "Настройка постоянного хранения для кэша Redis для Azure уровня Премиум"
description: "Узнайте, как настроить постоянное хранение и управлять им для экземпляров кэша Redis для Azure уровня Премиум"
services: redis-cache
documentationcenter: 
author: steved0x
manager: douge
editor: 
ms.assetid: b01cf279-60a0-4711-8c5f-af22d9540d38
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 02/09/2017
ms.author: sdanie
translationtype: Human Translation
ms.sourcegitcommit: 50d8db29ccce1244387f1fe0e3e42e610575e483
ms.openlocfilehash: bc8c54b51f9eee653fbe84351081dcef562e62d4
ms.lasthandoff: 02/09/2017


---
# <a name="how-to-configure-data-persistence-for-a-premium-azure-redis-cache"></a>Настройка постоянного хранения для кэша Redis для Azure уровня Премиум
Кэш Redis для Azure предлагает разные варианты кэша, которые обеспечивают гибкость в выборе размера и функций кэша, включая функции уровня "Премиум", такие как кластеризация, постоянное хранение данных и поддержка виртуальной сети. В этой статье описывается настройка постоянного хранения в экземпляре кэша Redis для Azure уровня Премиум.

Сведения о других функциях кэша уровня "Премиум" см. в статье [Знакомство с кэшем Redis для Azure уровня Премиум](cache-premium-tier-intro.md).

## <a name="what-is-data-persistence"></a>Что такое постоянное хранение?
Постоянное хранение Redis позволяет постоянно хранить данные, размещенные в Redis. Также можно создавать моментальные снимки и архивировать данные, которые можно будет восстановить в случае сбоя оборудования. Это огромное преимущество по сравнению с уровнями Базовый и Стандартный, в которых все данные хранятся в памяти, и при сбое, когда узлы кэша становятся недоступными, может произойти потеря данных. 

Кэш Redis для Azure предлагает использовать сохраняемость Redis по [модели RDB](http://redis.io/topics/persistence), при использовании которой данные хранятся в учетной записи хранения Azure. Если настроено постоянное хранение, кэш Redis для Azure будет сохранять моментальный снимок кэша Redis на диске в двоичном формате Redis в соответствии с настроенной частотой резервного копирования. В случае аварии, при которой становятся недоступными как основной экземпляр кэша, так и реплика кэша, кэш воссоздается на основе последнего моментального снимка.

При создании кэша сохраняемость можно настроить в колонке **Новый кэш Redis**, а для существующего кэша уровня "Премиум" используйте **меню ресурсов**.

[!INCLUDE [redis-cache-create](../../includes/redis-cache-premium-create.md)]

Выбрав ценовую категорию Премиум, щелкните **Сохраняемость Redis**.

![Сохраняемость Redis][redis-cache-persistence]

В следующем разделе описана процедура настройки сохраняемости Redis для нового кэша Премиум. Настроив сохраняемость Redis, нажмите кнопку **Создать** , чтобы создать новый кэш Премиум с сохраняемостью Redis.

## <a name="configure-redis-persistence"></a>Настройка сохраняемости Redis
Сохраняемость Redis настраивается в колонке **Сохраняемость данных Redis** . Для новых кэшей доступ к этой колонке осуществляется при создании кэша, как описано в предыдущем разделе. Колонка **Сохраняемость данных Redis** для существующих кэшей открывается из **меню ресурсов** соответствующего кэша.

![Параметры Redis][redis-cache-settings]

Чтобы включить сохраняемость Redis, активируйте резервное копирование базы данных Redis, выбрав параметр **Включено** . Чтобы отключить сохраняемость Redis во включенном ранее кэше Премиум, выберите параметр **Отключено**.

Чтобы настроить интервал архивации, выберите **частоту архивации** из раскрывающегося списка. Вы можете выбрать **15 минут**, **30 минут**, **60 минут**, **6 часов**, **12 часов** или **24 часа**. Отсчет этого интервала начинается после успешного завершения предыдущей операции резервного копирования. По истечении этого интервала запускается новое резервное копирование.

Выберите нужную **учетную запись хранения** и щелкните **Первичный ключ** или **Вторичный ключ** из раскрывающегося списка **Storage Key** (Ключ к хранилищу данных). Необходимо выбрать учетную запись хранения в том же регионе, где находится кэш. Рекомендуется учетная запись **хранилища класса Premium**, так как указанное хранилище отличается более высокой пропускной способностью. 

> [!IMPORTANT]
> Если ключ к хранилищу данных для учетной записи сохраняемости создается заново, то необходимо повторно настроить желаемый ключ в раскрывающемся списке **Ключ к хранилищу данных**.
> 
> 

![Сохраняемость Redis][redis-cache-persistence-selected]

Щелкните **ОК** для сохранения конфигурации постоянного хранения.

Следующая (а если кэш новый, то первая) резервная копия создается по окончании интервала резервного копирования.

## <a name="persistence-faq"></a>Часто задаваемые вопросы о постоянном хранении
Следующий список содержит ответы на часто задаваемые вопросы о постоянном хранении кэша Redis для Azure.

* [Можно ли включить постоянное хранение для ранее созданного кэша?](#can-i-enable-persistence-on-a-previously-created-cache)
* [Можно ли изменить частоту резервного копирования после создания кэша?](#can-i-change-the-backup-frequency-after-i-create-the-cache)
* [Почему при установленной частоте резервного копирования 60 минут между созданием резервных копий проходит больше 60 минут?](#why-if-i-have-a-backup-frequency-of-60-minutes-there-is-more-than-60-minutes-between-backups)
* [Что происходит со старыми резервными копиями при создании новой?](#what-happens-to-the-old-backups-when-a-new-backup-is-made)
* [Что произойдет, если выполнено масштабирование до другого размера, а резервная копия была создана до этой операции?](#what-happens-if-i-have-scaled-to-a-different-size-and-a-backup-is-restored-that-was-made-before-the-scaling-operation)

### <a name="can-i-enable-persistence-on-a-previously-created-cache"></a>Можно ли включить постоянное хранение для ранее созданного кэша?
Да, вы можете настроить сохраняемость Redis как при создании кэша, так и в уже существующем кэше Премиум.

### <a name="can-i-change-the-backup-frequency-after-i-create-the-cache"></a>Можно ли изменить частоту резервного копирования после создания кэша?
Да, вы можете изменить частоту архивации в колонке **Redis data persistence** (Сохраняемость данных Redis). Инструкции см. в разделе [Настройка сохраняемости Redis](#configure-redis-persistence).

### <a name="why-if-i-have-a-backup-frequency-of-60-minutes-there-is-more-than-60-minutes-between-backups"></a>Почему при установленной частоте резервного копирования 60 минут между созданием резервных копий проходит больше 60 минут?
Интервал резервного копирования не начинается, пока не завершится процесс предыдущего резервного копирования. Если интервал резервного копирования 60 минут и на процесс резервного копирования уходит 15 минут, следующее резервное копирование начнется не ранее чем через 75 минут после начала предыдущего резервного копирования.

### <a name="what-happens-to-the-old-backups-when-a-new-backup-is-made"></a>Что происходит со старыми резервными копиями при создании новой?
Все резервные копии за исключением последней автоматически удаляются. Это удаление может происходить не сразу, но старые резервные копии не хранятся в течение неограниченного периода времени.

### <a name="what-happens-if-i-have-scaled-to-a-different-size-and-a-backup-is-restored-that-was-made-before-the-scaling-operation"></a>Что произойдет, если выполнено масштабирование до другого размера, а резервная копия была создана до этой операции?
* Если выполнено масштабирование до большего размера, то ничего не произойдет.
* Если выполнено масштабирование до меньшего размера, а значение существующего пользовательского параметра [databases](cache-configure.md#databases) превышает значение [databases limit](cache-configure.md#databases) для нового размера, то данные в этих базах данных не будут восстановлены. Дополнительные сведения см. в разделе [Что происходит с пользовательским параметром databases при масштабировании?](cache-how-to-scale.md#is-my-custom-databases-setting-affected-during-scaling)
* Если выполнено масштабирование до меньшего размера, и вам не хватает места для хранения всех данных из последнего архива, то при восстановлении ключи будут исключены. Обычно для этого используется политика вытеснения [allkeys-lru](http://redis.io/topics/lru-cache).

## <a name="next-steps"></a>Дальнейшие действия
Узнайте, как использовать расширенные функции кэша.

* [Знакомство с кэшем Redis для Azure уровня Премиум](cache-premium-tier-intro.md)

<!-- IMAGES -->

[redis-cache-new-cache-menu]: ./media/cache-how-to-premium-persistence/redis-cache-new-cache-menu.png

[redis-cache-premium-pricing-tier]: ./media/cache-how-to-premium-persistence/redis-cache-premium-pricing-tier.png

[redis-cache-persistence]: ./media/cache-how-to-premium-persistence/redis-cache-persistence.png

[redis-cache-persistence-selected]: ./media/cache-how-to-premium-persistence/redis-cache-persistence-selected.png

[redis-cache-settings]: ./media/cache-how-to-premium-persistence/redis-cache-settings.png

