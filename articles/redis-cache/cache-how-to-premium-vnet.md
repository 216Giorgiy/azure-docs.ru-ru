<properties 
	pageTitle="Настройка поддержки виртуальной сети для кэша Redis для Azure уровня Премиум" 
	description="Узнайте, как настроить поддержку виртуальной сети и управлять ей для экземпляров кэша Redis для Azure уровня Премиум" 
	services="redis-cache" 
	documentationCenter="" 
	authors="steved0x" 
	manager="dwrede" 
	editor=""/>

<tags 
	ms.service="cache" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="cache-redis" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="12/02/2015" 
	ms.author="sdanie"/>

# Настройка поддержки виртуальной сети для кэша Redis для Azure уровня Премиум
Кэш Redis для Azure предлагает разные варианты кэша, которые обеспечивают гибкость в выборе размера и функций кэша, включая новый уровень «Премиум».

Кэш Redis для Azure уровня Премиум включает кластеризацию, постоянное хранение данных и поддержку виртуальной сети. Виртуальная сеть — это представление вашей собственной сети в облаке. При настройке экземпляра кэша Redis для Azure в виртуальной сети этот экземпляр не является общедоступным и доступен только для клиентов в виртуальной сети. В этой статье описана настройка поддержки виртуальной сети для экземпляра кэша Redis для Azure уровня Премиум.

Сведения об использовании других функций кэша уровня Премиум см. в статьях [Настройка постоянного хранения для кэша Redis для Azure уровня Премиум](cache-how-to-premium-persistence.md) и [Настройка кластеризации для кэша Redis для Azure уровня Премиум](cache-how-to-premium-clustering.md).

## Зачем использовать виртуальные сети?
Развертывание [виртуальной сети Azure](https://azure.microsoft.com/services/virtual-network/) обеспечивает улучшенную безопасность и изоляцию кэша Redis для Azure, а также подсети, политики контроля доступа и другие функции для дальнейшего ограничения доступа к кэшу Redis для Azure.

## Поддержка виртуальной сети
Поддержка виртуальной сети настраивается во время создания кэша в колонке **Новый кэш Redis**. Для создания кэша войдите на [портал предварительной версии Azure](https://portal.azure.com), щелкните **Создать** > **Данные+хранилище** > **Кэш Redis**.

![Создание кэша Redis][redis-cache-new-cache-menu]

Чтобы настроить поддержку виртуальной сети, сначала выберите один из кэшей категории **Премиум** в колонке **Выбор ценовой категории**.

![Выберите ценовую категорию][redis-cache-premium-pricing-tier]

Интеграция виртуальной сети в кэш Redis для Azure настраивается в колонке **Виртуальная сеть**. Здесь можно выбрать существующую классическую виртуальную сеть. Чтобы использовать новую виртуальную сеть, выполните действия, описанные в статье [Создание классической виртуальной сети с помощью портала предварительной версии Azure](../virtual-network/virtual-networks-create-vnet-classic-pportal.md), и вернитесь в колонку **Виртуальная сеть кэша Redis**, чтобы выбрать эту виртуальную сеть.

>[AZURE.NOTE]Кэш Redis для Azure работает с классическими виртуальными сетями. Дополнительные сведения о создании классической виртуальной сети см. в разделе [Создание классической виртуальной сети с помощью портала предварительной версии Azure](../virtual-network/virtual-networks-create-vnet-classic-pportal.md).

![Виртуальная сеть][redis-cache-vnet]

Для выбора и настройки виртуальной сети щелкните **Виртуальная сеть** в колонке **Виртуальная сеть**.

![Виртуальная сеть][redis-cache-vnet-select]

Щелкните на нужной виртуальной сети, чтобы ее выбрать.

![Виртуальная сеть][redis-cache-vnet-subnet]

Выберите «Подсеть» для выбора нужной подсети.

![Виртуальная сеть][redis-cache-vnet-ip]

Введите нужный **Статический IP-адрес** и нажмите кнопку **ОК** для сохранения конфигурации виртуальной сети. Если выбранный статический IP-адрес уже используется, отображается сообщение об ошибке.

После создания кэша он доступен только клиентам, находящимся в той же виртуальной сети.

>[AZURE.IMPORTANT]Для доступа к экземпляру кэша Redis для Azure при использовании виртуальной сети передайте статический IP-адрес из кэша в виртуальной сети в качестве первого параметра и передайте параметр `sslhost` с конечной точкой кэша. В следующем примере используется статический IP-адрес `10.10.1.5` и конечная точка кэша `contoso5.redis.cache.windows.net`.

	private static Lazy<ConnectionMultiplexer> lazyConnection = new Lazy<ConnectionMultiplexer>(() =>
	{
	    return ConnectionMultiplexer.Connect("10.10.1.5,sslhost=contoso5.redis.cache.windows.net,abortConnect=false,ssl=true,password=password");
	});
	
	public static ConnectionMultiplexer Connection
	{
	    get
	    {
	        return lazyConnection.Value;
	    }
	}

## Часто задаваемые вопросы о виртуальных сетях кэша Redis для Azure

Следующий список содержит ответы на часто задаваемые вопросы о виртуальных сетях кэша Redis для Azure.

## Каковы распространенные ошибки конфигурации кэша Redis для Azure и виртуальных сетей?

Ниже перечислены некоторые распространенные ошибки конфигурации, которые могут препятствовать правильной работе кэша Redis для Azure.

-	Блокировка TCP-портов, используемых клиентами для подключения к Redis (т.е. портов 6379 и 6380).
-	Блокировка или перехват исходящего трафика HTTPS из виртуальной сети. Кэш Redis для Azure использует исходящий трафик HTTPS для служб Azure, в частности, хранилища.
-	Блокировка взаимодействия виртуальных машин экземпляров ролей Redis друг с другом в подсети. Экземпляры ролей Redis должны иметь возможность взаимодействовать друг с другом по протоколу TCP на любом из используемых портов. Эти порты могут изменяться, но по меньшей мере должны включать все порты, используемые в файле CSDEF Redis.
-	Блокировка подключения балансировщика нагрузки Azure к виртуальным машинам с использованием порта TCP и HTTP 16001. Работа кэша Redis для Azure зависит от возможности балансировщика нагрузки по умолчанию определить, какие экземпляры роли запущены. Балансировщик нагрузки по умолчанию проверяет связь с гостевым агентом Azure с использованием порта 16001. Только те экземпляры роли, которые ответят на проверку связи, будут помещены в очередь для получения трафика, перенаправляемого балансировщиком нагрузки. Если в очереди нет ни одного экземпляра из-за того, что проверка связи завершилась неудачно, так как порты были заблокированы, балансировщик нагрузки не будет принимать входящие подключения TCP.
-	Блокировка веб-трафика клиентского приложения, используемого для проверки открытого ключа SSL. Клиенты Redis (в виртуальной сети) должны иметь возможность отправлять HTTP-трафик в Интернет для загрузки сертификатов ЦС и списков отзыва сертификатов. Они используются для проверки сертификата SSL при использовании порта 6380 для подключения к Redis и проверки подлинности сервера SSL.
-	Блокировка подключения балансировщика нагрузки Azure к виртуальным машинам Redis в кластере по протоколу TCP на порты 1300x (13000, 13001 и т. д.) или 1500x (15000, 15001 и т. д.). Виртуальные сети настраиваются в файле csdef, так что балансировщик нагрузки будет открывать эти порты. Балансировщик нагрузки Azure необходимо разрешить в группах безопасности сети. В группах безопасности сети по умолчанию это делается с помощью тега AZURE\_LOADBALANCER. Балансировщик нагрузки Azure имеет один статический IP-адрес 168.63.126.16. Дополнительные сведения см. в разделе [Что такое группа безопасности сети?](../virtual-network/virtual-networks-nsg.md).

## Можно ли использовать виртуальные сети в кэше уровня Стандартный или Базовый?

Виртуальные сети доступны только для кэшей уровня Премиум.

## Дальнейшие действия
Узнайте, как использовать расширенные функции кэша.

-	[Настройка сохраняемости для кэша Redis для Azure уровня Премиум](cache-how-to-premium-persistence.md)
-	[Настройка кластеризации для кэша Redis для Azure уровня Премиум](cache-how-to-premium-clustering.md)





  
<!-- IMAGES -->

[redis-cache-new-cache-menu]: ./media/cache-how-to-premium-vnet/redis-cache-new-cache-menu.png

[redis-cache-premium-pricing-tier]: ./media/cache-how-to-premium-vnet/redis-cache-premium-pricing-tier.png

[redis-cache-vnet]: ./media/cache-how-to-premium-vnet/redis-cache-vnet.png

[redis-cache-vnet-select]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-select.png

[redis-cache-vnet-ip]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-ip.png

[redis-cache-vnet-subnet]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-subnet.png

<!---HONumber=AcomDC_1203_2015-->