<properties 
	pageTitle="Настройка поддержки виртуальной сети для кэша Redis для Azure уровня Премиум" 
	description="Узнайте, как настроить поддержку виртуальной сети и управлять ей для экземпляров кэша Redis для Azure уровня Премиум" 
	services="redis-cache" 
	documentationCenter="" 
	authors="steved0x" 
	manager="dwrede" 
	editor=""/>

<tags 
	ms.service="cache" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="cache-redis" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="01/19/2016" 
	ms.author="sdanie"/>

# Настройка поддержки виртуальной сети для кэша Redis для Azure уровня Премиум
Кэш Redis для Azure предлагает разные варианты кэша, которые обеспечивают гибкость в выборе размера и функций кэша, включая новый уровень «Премиум».

Кэш Redis для Azure уровня Премиум включает кластеризацию, постоянное хранение данных и поддержку виртуальной сети. Виртуальная сеть — это представление вашей собственной сети в облаке. При настройке экземпляра кэша Redis для Azure в виртуальной сети этот экземпляр не является общедоступным и доступен только для клиентов в виртуальной сети. В этой статье описана настройка поддержки виртуальной сети для экземпляра кэша Redis для Azure уровня Премиум.

Сведения об использовании других функций кэша уровня Премиум см. в статьях [Настройка постоянного хранения для кэша Redis для Azure уровня Премиум](cache-how-to-premium-persistence.md) и [Настройка кластеризации для кэша Redis для Azure уровня Премиум](cache-how-to-premium-clustering.md).

## Зачем использовать виртуальные сети?
Развертывание [виртуальной сети Azure](https://azure.microsoft.com/services/virtual-network/) обеспечивает улучшенную безопасность и изоляцию кэша Redis для Azure, а также подсети, политики контроля доступа и другие функции для дальнейшего ограничения доступа к кэшу Redis для Azure.

## Поддержка виртуальной сети
Поддержка виртуальной сети настраивается во время создания кэша в колонке **Новый кэш Redis**. Для создания кэша войдите на [портал Azure](https://portal.azure.com), щелкните **Создать** > **Данные+хранилище** > **Кэш Redis**.

![Создание кэша Redis][redis-cache-new-cache-menu]

Чтобы настроить поддержку виртуальной сети, сначала выберите один из кэшей категории **Премиум** в колонке **Выбор ценовой категории**.

![Выберите ценовую категорию][redis-cache-premium-pricing-tier]

Интеграция виртуальной сети в кэш Redis для Azure настраивается в колонке **Виртуальная сеть**. Здесь можно выбрать существующую классическую виртуальную сеть. Чтобы использовать новую виртуальную сеть, выполните действия, описанные в статье [Создание классической виртуальной сети с помощью портала Azure](../virtual-network/virtual-networks-create-vnet-classic-pportal.md), и вернитесь в колонку **Виртуальная сеть кэша Redis**, чтобы выбрать эту виртуальную сеть.

>[AZURE.NOTE]Кэш Redis для Azure работает с классическими виртуальными сетями. Дополнительные сведения о создании классической виртуальной сети см. в разделе [Создание классической виртуальной сети с помощью портала Azure](../virtual-network/virtual-networks-create-vnet-classic-pportal.md). Сведения о подключении классических виртуальных сетей к виртуальным сетям ARM см. в разделе [Подключение классических виртуальных сетей к новым виртуальным сетям](../virtual-network/virtual-networks-arm-asm-s2s.md).

![Виртуальная сеть][redis-cache-vnet]

Для выбора и настройки виртуальной сети щелкните **Виртуальная сеть** в колонке **Виртуальная сеть**.

![Виртуальная сеть][redis-cache-vnet-select]

Щелкните на нужной виртуальной сети, чтобы ее выбрать.

![Виртуальная сеть][redis-cache-vnet-subnet]

Выберите «Подсеть» для выбора нужной подсети.

![Виртуальная сеть][redis-cache-vnet-ip]

Поле **Статический IP-адрес** не является обязательным. Если в нем ничего не указано, будет выбран IP-адрес из выбранной подсети. Если требуется использовать определенный статический IP-адрес, введите его в поле **Статический IP-адрес** и нажмите кнопку **ОК**, чтобы сохранить конфигурацию виртуальной сети. Если выбранный статический IP-адрес уже используется, отображается сообщение об ошибке.

После создания кэша он доступен только клиентам, находящимся в той же виртуальной сети.

>[AZURE.IMPORTANT]Для доступа к экземпляру кэша Redis для Azure при использовании виртуальной сети передайте статический IP-адрес из кэша в виртуальной сети в качестве первого параметра и передайте параметр `sslhost` с конечной точкой кэша. В следующем примере используется статический IP-адрес `10.10.1.5` и конечная точка кэша `contoso5.redis.cache.windows.net`.

	private static Lazy<ConnectionMultiplexer> lazyConnection = new Lazy<ConnectionMultiplexer>(() =>
	{
	    return ConnectionMultiplexer.Connect("10.10.1.5,sslhost=contoso5.redis.cache.windows.net,abortConnect=false,ssl=true,password=password");
	});
	
	public static ConnectionMultiplexer Connection
	{
	    get
	    {
	        return lazyConnection.Value;
	    }
	}

## Часто задаваемые вопросы о виртуальных сетях кэша Redis для Azure

Следующий список содержит ответы на часто задаваемые вопросы о виртуальных сетях кэша Redis для Azure.

## Каковы распространенные ошибки конфигурации кэша Redis для Azure и виртуальных сетей?

При размещении кэша Redis для Azure в виртуальной сети используются порты, указанные в следующей таблице. Если эти порты заблокированы, кэш может работать неправильно. Блокировка одного или нескольких из этих портов является самой распространенной проблемой неправильной настройки при использовании кэша Redis для Azure в виртуальной сети.

| Порты | Направление | Транспортный протокол | Назначение | Удаленный IP-адрес |
|-------------|------------------|--------------------|-----------------------------------------------------------------------------------|-------------------------------------|
| 80, 443 | Исходящие | TCP | Зависимости Redis в службе хранилища Azure или PKI (Интернет) | * |
| 53 | Исходящие | TCP/UDP | Зависимости Redis в DNS (Интернет/виртуальная сеть) | * |
| 6379, 6380 | Входящий трафик | TCP | Подключение клиента к Redis, балансировка нагрузки Azure | VIRTUAL\_NETWORK, AZURE\_LOADBALANCER |
| 8443 | Входящий и исходящий трафик | TCP | Сведения о реализации для Redis | VIRTUAL\_NETWORK |
| 8500 | Входящий трафик | TCP/UDP | Балансировка нагрузки Azure | AZURE\_LOADBALANCER |
| 10221-10231 | Входящий и исходящий трафик | TCP | Сведения о реализации для Redis (можно ограничить удаленную конечную точку до VIRTUAL\_NETWORK) | VIRTUAL\_NETWORK, AZURE\_LOADBALANCER |
| 13000-13999 | Входящий трафик | TCP | Подключение клиента к кластерам Redis, балансировка нагрузки Azure | VIRTUAL\_NETWORK, AZURE\_LOADBALANCER |
| 15000-15999 | Входящий трафик | TCP | Подключение клиента к кластерам Redis, балансировка нагрузки Azure | VIRTUAL\_NETWORK, AZURE\_LOADBALANCER |
| 16001 | Входящий трафик | TCP/UDP | Балансировка нагрузки Azure | AZURE\_LOADBALANCER |
| 20226 | Входящий и исходящий трафик | TCP | Сведения о реализации для кластеров Redis | VIRTUAL\_NETWORK |




## Можно ли использовать виртуальные сети в кэше уровня Стандартный или Базовый?

Виртуальные сети доступны только для кэшей уровня Премиум.

## Дальнейшие действия
Узнайте, как использовать расширенные функции кэша.

-	[Настройка сохраняемости для кэша Redis для Azure уровня Премиум](cache-how-to-premium-persistence.md)
-	[Настройка кластеризации для кэша Redis для Azure уровня Премиум](cache-how-to-premium-clustering.md)





  
<!-- IMAGES -->

[redis-cache-new-cache-menu]: ./media/cache-how-to-premium-vnet/redis-cache-new-cache-menu.png

[redis-cache-premium-pricing-tier]: ./media/cache-how-to-premium-vnet/redis-cache-premium-pricing-tier.png

[redis-cache-vnet]: ./media/cache-how-to-premium-vnet/redis-cache-vnet.png

[redis-cache-vnet-select]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-select.png

[redis-cache-vnet-ip]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-ip.png

[redis-cache-vnet-subnet]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-subnet.png

<!---HONumber=AcomDC_0121_2016-->